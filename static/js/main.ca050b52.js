/*! For license information please see main.ca050b52.js.LICENSE.txt */
(()=>{var e={4:(e,t,n)=>{"use strict";var r=n(853),i=n(43),o=n(950);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function h(e){if(l(e)!==e)throw Error(a(188))}function d(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=d(e)))return t;e=e.sibling}return null}var p=Object.assign,f=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),b=Symbol.for("react.consumer"),x=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),E=Symbol.for("react.memo"),k=Symbol.for("react.lazy");Symbol.for("react.scope");var P=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var C=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var I=Symbol.iterator;function A(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=I&&e[I]||e["@@iterator"])?e:null}var M=Symbol.for("react.client.reference");function R(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===M?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case v:return"Profiler";case y:return"StrictMode";case S:return"Suspense";case T:return"SuspenseList";case P:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case g:return"Portal";case x:return e.displayName||"Context";case b:return(e._context.displayName||"Context")+".Consumer";case w:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case E:return null!==(t=e.displayName||null)?t:R(e.type)||"Memo";case k:t=e._payload,e=e._init;try{return R(e(t))}catch(n){}}return null}var D=Array.isArray,z=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j={pending:!1,data:null,method:null,action:null},O=[],F=-1;function B(e){return{current:e}}function N(e){0>F||(e.current=O[F],O[F]=null,F--)}function U(e,t){F++,O[F]=e.current,e.current=t}var V,G,q=B(null),Z=B(null),W=B(null),H=B(null);function X(e,t){switch(U(W,t),U(Z,e),U(q,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?_h(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=yh(t=_h(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}N(q),U(q,e)}function K(){N(q),N(Z),N(W)}function Y(e){null!==e.memoizedState&&U(H,e);var t=q.current,n=yh(t,e.type);t!==n&&(U(Z,e),U(q,n))}function J(e){Z.current===e&&(N(q),N(Z)),H.current===e&&(N(H),ud._currentValue=j)}function Q(e){if(void 0===V)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);V=t&&t[1]||"",G=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+V+e+G}var $=!1;function ee(e,t){if(!e||$)return"";$=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var r=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(o){r=o}e.call(n.prototype)}}else{try{throw Error()}catch(a){r=a}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&r&&"string"===typeof s.stack)return[s.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var o=r.DetermineComponentFrameRoot(),a=o[0],s=o[1];if(a&&s){var l=a.split("\n"),c=s.split("\n");for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--;for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do{if(r--,0>--i||l[r]!==c[i]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=i);break}}}finally{$=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?Q(n):""}function te(e,t){switch(e.tag){case 26:case 27:case 5:return Q(e.type);case 16:return Q("Lazy");case 13:return e.child!==t&&null!==t?Q("Suspense Fallback"):Q("Suspense");case 19:return Q("SuspenseList");case 0:case 15:return ee(e.type,!1);case 11:return ee(e.type.render,!1);case 1:return ee(e.type,!0);case 31:return Q("Activity");default:return""}}function ne(e){try{var t="",n=null;do{t+=te(e,n),n=e,e=e.return}while(e);return t}catch(r){return"\nError generating stack: "+r.message+"\n"+r.stack}}var re=Object.prototype.hasOwnProperty,ie=r.unstable_scheduleCallback,oe=r.unstable_cancelCallback,ae=r.unstable_shouldYield,se=r.unstable_requestPaint,le=r.unstable_now,ce=r.unstable_getCurrentPriorityLevel,ue=r.unstable_ImmediatePriority,he=r.unstable_UserBlockingPriority,de=r.unstable_NormalPriority,pe=r.unstable_LowPriority,fe=r.unstable_IdlePriority,me=r.log,ge=r.unstable_setDisableYieldValue,_e=null,ye=null;function ve(e){if("function"===typeof me&&ge(e),ye&&"function"===typeof ye.setStrictMode)try{ye.setStrictMode(_e,e)}catch(t){}}var be=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(xe(e)/we|0)|0},xe=Math.log,we=Math.LN2;var Se=256,Te=262144,Ee=4194304;function ke(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Pe(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var i=0,o=e.suspendedLanes,a=e.pingedLanes;e=e.warmLanes;var s=134217727&r;return 0!==s?0!==(r=s&~o)?i=ke(r):0!==(a&=s)?i=ke(a):n||0!==(n=s&~e)&&(i=ke(n)):0!==(s=r&~o)?i=ke(s):0!==a?i=ke(a):n||0!==(n=r&~e)&&(i=ke(n)),0===i?0:0!==t&&t!==i&&0===(t&o)&&((o=i&-i)>=(n=t&-t)||32===o&&0!==(4194048&n))?t:i}function Ce(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Ie(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ae(){var e=Ee;return 0===(62914560&(Ee<<=1))&&(Ee=4194304),e}function Me(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Re(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function De(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-be(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|261930&n}function ze(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-be(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function Le(e,t){var n=t&-t;return 0!==((n=0!==(42&n)?1:je(n))&(e.suspendedLanes|t))?0:n}function je(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Oe(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Fe(){var e=L.p;return 0!==e?e:void 0===(e=window.event)?32:kd(e.type)}function Be(e,t){var n=L.p;try{return L.p=e,t()}finally{L.p=n}}var Ne=Math.random().toString(36).slice(2),Ue="__reactFiber$"+Ne,Ve="__reactProps$"+Ne,Ge="__reactContainer$"+Ne,qe="__reactEvents$"+Ne,Ze="__reactListeners$"+Ne,We="__reactHandles$"+Ne,He="__reactResources$"+Ne,Xe="__reactMarker$"+Ne;function Ke(e){delete e[Ue],delete e[Ve],delete e[qe],delete e[Ze],delete e[We]}function Ye(e){var t=e[Ue];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ge]||n[Ue]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=jh(e);null!==e;){if(n=e[Ue])return n;e=jh(e)}return t}n=(e=n).parentNode}return null}function Je(e){if(e=e[Ue]||e[Ge]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Qe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function $e(e){var t=e[He];return t||(t=e[He]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function et(e){e[Xe]=!0}var tt=new Set,nt={};function rt(e,t){it(e,t),it(e+"Capture",t)}function it(e,t){for(nt[e]=t,e=0;e<t.length;e++)tt.add(t[e])}var ot=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),at={},st={};function lt(e,t,n){if(i=t,re.call(st,i)||!re.call(at,i)&&(ot.test(i)?st[i]=!0:(at[i]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var i}function ct(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function ut(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function ht(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function pt(e){if(!e._valueTracker){var t=dt(e)?"checked":"value";e._valueTracker=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var i=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function ft(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=dt(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function mt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var gt=/[\n"\\]/g;function _t(e){return e.replace(gt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function yt(e,t,n,r,i,o,a,s){e.name="",null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ht(t)):e.value!==""+ht(t)&&(e.value=""+ht(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?bt(e,a,ht(t)):null!=n?bt(e,a,ht(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=o&&(e.defaultChecked=!!o),null!=i&&(e.checked=i&&"function"!==typeof i&&"symbol"!==typeof i),null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.name=""+ht(s):e.removeAttribute("name")}function vt(e,t,n,r,i,o,a,s){if(null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.type=o),null!=t||null!=n){if(!("submit"!==o&&"reset"!==o||void 0!==t&&null!==t))return void pt(e);n=null!=n?""+ht(n):"",t=null!=t?""+ht(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}r="function"!==typeof(r=null!=r?r:i)&&"symbol"!==typeof r&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.name=a),pt(e)}function bt(e,t,n){"number"===t&&mt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function xt(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ht(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function wt(e,t,n){null==t||((t=""+ht(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ht(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function St(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(a(92));if(D(r)){if(1<r.length)throw Error(a(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=ht(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r),pt(e)}function Tt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Et=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kt(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!==typeof n||0===n||Et.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Pt(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(a(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var i in t)r=t[i],t.hasOwnProperty(i)&&n[i]!==r&&kt(e,i,r)}else for(var o in t)t.hasOwnProperty(o)&&kt(e,o,t[o])}function Ct(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var It=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),At=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mt(e){return At.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Rt(){}var Dt=null;function zt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Lt=null,jt=null;function Ot(e){var t=Je(e);if(t&&(e=t.stateNode)){var n=e[Ve]||null;e:switch(e=t.stateNode,t.type){case"input":if(yt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+_t(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=r[Ve]||null;if(!i)throw Error(a(90));yt(r,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&ft(r)}break e;case"textarea":wt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&xt(e,!!n.multiple,t,!1)}}}var Ft=!1;function Bt(e,t,n){if(Ft)return e(t,n);Ft=!0;try{return e(t)}finally{if(Ft=!1,(null!==Lt||null!==jt)&&($c(),Lt&&(t=Lt,e=jt,jt=Lt=null,Ot(t),e)))for(t=0;t<e.length;t++)Ot(e[t])}}function Nt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Ve]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Ut=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Vt=!1;if(Ut)try{var Gt={};Object.defineProperty(Gt,"passive",{get:function(){Vt=!0}}),window.addEventListener("test",Gt,Gt),window.removeEventListener("test",Gt,Gt)}catch(Jd){Vt=!1}var qt=null,Zt=null,Wt=null;function Ht(){if(Wt)return Wt;var e,t,n=Zt,r=n.length,i="value"in qt?qt.value:qt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return Wt=i.slice(e,1<t?1-t:void 0)}function Xt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Kt(){return!0}function Yt(){return!1}function Jt(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Kt:Yt,this.isPropagationStopped=Yt,this}return p(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Kt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Kt)},persist:function(){},isPersistent:Kt}),t}var Qt,$t,en,tn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nn=Jt(tn),rn=p({},tn,{view:0,detail:0}),on=Jt(rn),an=p({},rn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_n,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==en&&(en&&"mousemove"===e.type?(Qt=e.screenX-en.screenX,$t=e.screenY-en.screenY):$t=Qt=0,en=e),Qt)},movementY:function(e){return"movementY"in e?e.movementY:$t}}),sn=Jt(an),ln=Jt(p({},an,{dataTransfer:0})),cn=Jt(p({},rn,{relatedTarget:0})),un=Jt(p({},tn,{animationName:0,elapsedTime:0,pseudoElement:0})),hn=Jt(p({},tn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),dn=Jt(p({},tn,{data:0})),pn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=mn[e])&&!!t[e]}function _n(){return gn}var yn=Jt(p({},rn,{key:function(e){if(e.key){var t=pn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Xt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?fn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_n,charCode:function(e){return"keypress"===e.type?Xt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Xt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),vn=Jt(p({},an,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),bn=Jt(p({},rn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_n})),xn=Jt(p({},tn,{propertyName:0,elapsedTime:0,pseudoElement:0})),wn=Jt(p({},an,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Sn=Jt(p({},tn,{newState:0,oldState:0})),Tn=[9,13,27,32],En=Ut&&"CompositionEvent"in window,kn=null;Ut&&"documentMode"in document&&(kn=document.documentMode);var Pn=Ut&&"TextEvent"in window&&!kn,Cn=Ut&&(!En||kn&&8<kn&&11>=kn),In=String.fromCharCode(32),An=!1;function Mn(e,t){switch(e){case"keyup":return-1!==Tn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Dn=!1;var zn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ln(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!zn[e.type]:"textarea"===t}function jn(e,t,n,r){Lt?jt?jt.push(r):jt=[r]:Lt=r,0<(t=rh(t,"onChange")).length&&(n=new nn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var On=null,Fn=null;function Bn(e){Ku(e,0)}function Nn(e){if(ft(Qe(e)))return e}function Un(e,t){if("change"===e)return t}var Vn=!1;if(Ut){var Gn;if(Ut){var qn="oninput"in document;if(!qn){var Zn=document.createElement("div");Zn.setAttribute("oninput","return;"),qn="function"===typeof Zn.oninput}Gn=qn}else Gn=!1;Vn=Gn&&(!document.documentMode||9<document.documentMode)}function Wn(){On&&(On.detachEvent("onpropertychange",Hn),Fn=On=null)}function Hn(e){if("value"===e.propertyName&&Nn(Fn)){var t=[];jn(t,Fn,e,zt(e)),Bt(Bn,t)}}function Xn(e,t,n){"focusin"===e?(Wn(),Fn=n,(On=t).attachEvent("onpropertychange",Hn)):"focusout"===e&&Wn()}function Kn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Nn(Fn)}function Yn(e,t){if("click"===e)return Nn(t)}function Jn(e,t){if("input"===e||"change"===e)return Nn(t)}var Qn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function $n(e,t){if(Qn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!re.call(t,i)||!Qn(e[i],t[i]))return!1}return!0}function er(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function tr(e,t){var n,r=er(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=er(r)}}function nr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?nr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function rr(e){for(var t=mt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=mt((e=t.contentWindow).document)}return t}function ir(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var or=Ut&&"documentMode"in document&&11>=document.documentMode,ar=null,sr=null,lr=null,cr=!1;function ur(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;cr||null==ar||ar!==mt(r)||("selectionStart"in(r=ar)&&ir(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},lr&&$n(lr,r)||(lr=r,0<(r=rh(sr,"onSelect")).length&&(t=new nn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ar)))}function hr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var dr={animationend:hr("Animation","AnimationEnd"),animationiteration:hr("Animation","AnimationIteration"),animationstart:hr("Animation","AnimationStart"),transitionrun:hr("Transition","TransitionRun"),transitionstart:hr("Transition","TransitionStart"),transitioncancel:hr("Transition","TransitionCancel"),transitionend:hr("Transition","TransitionEnd")},pr={},fr={};function mr(e){if(pr[e])return pr[e];if(!dr[e])return e;var t,n=dr[e];for(t in n)if(n.hasOwnProperty(t)&&t in fr)return pr[e]=n[t];return e}Ut&&(fr=document.createElement("div").style,"AnimationEvent"in window||(delete dr.animationend.animation,delete dr.animationiteration.animation,delete dr.animationstart.animation),"TransitionEvent"in window||delete dr.transitionend.transition);var gr=mr("animationend"),_r=mr("animationiteration"),yr=mr("animationstart"),vr=mr("transitionrun"),br=mr("transitionstart"),xr=mr("transitioncancel"),wr=mr("transitionend"),Sr=new Map,Tr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Er(e,t){Sr.set(e,t),rt(t,[e])}Tr.push("scrollEnd");var kr="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},Pr=[],Cr=0,Ir=0;function Ar(){for(var e=Cr,t=Ir=Cr=0;t<e;){var n=Pr[t];Pr[t++]=null;var r=Pr[t];Pr[t++]=null;var i=Pr[t];Pr[t++]=null;var o=Pr[t];if(Pr[t++]=null,null!==r&&null!==i){var a=r.pending;null===a?i.next=i:(i.next=a.next,a.next=i),r.pending=i}0!==o&&zr(n,i,o)}}function Mr(e,t,n,r){Pr[Cr++]=e,Pr[Cr++]=t,Pr[Cr++]=n,Pr[Cr++]=r,Ir|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Rr(e,t,n,r){return Mr(e,t,n,r),Lr(e)}function Dr(e,t){return Mr(e,null,null,t),Lr(e)}function zr(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(r=o.alternate)&&(r.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(i=!0)),e=o,o=o.return;return 3===e.tag?(o=e.stateNode,i&&null!==t&&(i=31-be(n),null===(r=(e=o.hiddenUpdates)[i])?e[i]=[t]:r.push(t),t.lane=536870912|n),o):null}function Lr(e){if(50<qc)throw qc=0,Zc=null,Error(a(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var jr={};function Or(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fr(e,t,n,r){return new Or(e,t,n,r)}function Br(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Nr(e,t){var n=e.alternate;return null===n?((n=Fr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Ur(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Vr(e,t,n,r,i,o){var s=0;if(r=e,"function"===typeof e)Br(e)&&(s=1);else if("string"===typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,q.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case P:return(e=Fr(31,n,t,i)).elementType=P,e.lanes=o,e;case _:return Gr(n.children,i,o,t);case y:s=8,i|=24;break;case v:return(e=Fr(12,n,t,2|i)).elementType=v,e.lanes=o,e;case S:return(e=Fr(13,n,t,i)).elementType=S,e.lanes=o,e;case T:return(e=Fr(19,n,t,i)).elementType=T,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case x:s=10;break e;case b:s=9;break e;case w:s=11;break e;case E:s=14;break e;case k:s=16,r=null;break e}s=29,n=Error(a(130,null===e?"null":typeof e,"")),r=null}return(t=Fr(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Gr(e,t,n,r){return(e=Fr(7,e,r,t)).lanes=n,e}function qr(e,t,n){return(e=Fr(6,e,null,t)).lanes=n,e}function Zr(e){var t=Fr(18,null,null,0);return t.stateNode=e,t}function Wr(e,t,n){return(t=Fr(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Hr=new WeakMap;function Xr(e,t){if("object"===typeof e&&null!==e){var n=Hr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:ne(t)},Hr.set(e,t),t)}return{value:e,source:t,stack:ne(t)}}var Kr=[],Yr=0,Jr=null,Qr=0,$r=[],ei=0,ti=null,ni=1,ri="";function ii(e,t){Kr[Yr++]=Qr,Kr[Yr++]=Jr,Jr=e,Qr=t}function oi(e,t,n){$r[ei++]=ni,$r[ei++]=ri,$r[ei++]=ti,ti=e;var r=ni;e=ri;var i=32-be(r)-1;r&=~(1<<i),n+=1;var o=32-be(t)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,ni=1<<32-be(t)+i|n<<i|r,ri=o+e}else ni=1<<o|n<<i|r,ri=e}function ai(e){null!==e.return&&(ii(e,1),oi(e,1,0))}function si(e){for(;e===Jr;)Jr=Kr[--Yr],Kr[Yr]=null,Qr=Kr[--Yr],Kr[Yr]=null;for(;e===ti;)ti=$r[--ei],$r[ei]=null,ri=$r[--ei],$r[ei]=null,ni=$r[--ei],$r[ei]=null}function li(e,t){$r[ei++]=ni,$r[ei++]=ri,$r[ei++]=ti,ni=t.id,ri=t.overflow,ti=e}var ci=null,ui=null,hi=!1,di=null,pi=!1,fi=Error(a(519));function mi(e){throw xi(Xr(Error(a(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),fi}function gi(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Ue]=e,t[Ve]=r,n){case"dialog":Yu("cancel",t),Yu("close",t);break;case"iframe":case"object":case"embed":Yu("load",t);break;case"video":case"audio":for(n=0;n<Hu.length;n++)Yu(Hu[n],t);break;case"source":Yu("error",t);break;case"img":case"image":case"link":Yu("error",t),Yu("load",t);break;case"details":Yu("toggle",t);break;case"input":Yu("invalid",t),vt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case"select":Yu("invalid",t);break;case"textarea":Yu("invalid",t),St(t,r.value,r.defaultValue,r.children)}"string"!==typeof(n=r.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||ch(t.textContent,n)?(null!=r.popover&&(Yu("beforetoggle",t),Yu("toggle",t)),null!=r.onScroll&&Yu("scroll",t),null!=r.onScrollEnd&&Yu("scrollend",t),null!=r.onClick&&(t.onclick=Rt),t=!0):t=!1,t||mi(e,!0)}function _i(e){for(ci=e.return;ci;)switch(ci.tag){case 5:case 31:case 13:return void(pi=!1);case 27:case 3:return void(pi=!0);default:ci=ci.return}}function yi(e){if(e!==ci)return!1;if(!hi)return _i(e),hi=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||vh(e.type,e.memoizedProps)),t=!t),t&&ui&&mi(e),_i(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));ui=Lh(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));ui=Lh(e)}else 27===n?(n=ui,kh(e.type)?(e=zh,zh=null,ui=e):ui=n):ui=ci?Dh(e.stateNode.nextSibling):null;return!0}function vi(){ui=ci=null,hi=!1}function bi(){var e=di;return null!==e&&(null===Ac?Ac=e:Ac.push.apply(Ac,e),di=null),e}function xi(e){null===di?di=[e]:di.push(e)}var wi=B(null),Si=null,Ti=null;function Ei(e,t,n){U(wi,t._currentValue),t._currentValue=n}function ki(e){e._currentValue=wi.current,N(wi)}function Pi(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ci(e,t,n,r){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var o=i.dependencies;if(null!==o){var s=i.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=i;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Pi(o.return,n,e),r||(s=null);break e}o=l.next}}else if(18===i.tag){if(null===(s=i.return))throw Error(a(341));s.lanes|=n,null!==(o=s.alternate)&&(o.lanes|=n),Pi(s,n,e),s=null}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===e){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}}function Ii(e,t,n,r){e=null;for(var i=t,o=!1;null!==i;){if(!o)if(0!==(524288&i.flags))o=!0;else if(0!==(262144&i.flags))break;if(10===i.tag){var s=i.alternate;if(null===s)throw Error(a(387));if(null!==(s=s.memoizedProps)){var l=i.type;Qn(i.pendingProps.value,s.value)||(null!==e?e.push(l):e=[l])}}else if(i===H.current){if(null===(s=i.alternate))throw Error(a(387));s.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(ud):e=[ud])}i=i.return}null!==e&&Ci(t,e,n,r),t.flags|=262144}function Ai(e){for(e=e.firstContext;null!==e;){if(!Qn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Mi(e){Si=e,Ti=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ri(e){return zi(Si,e)}function Di(e,t){return null===Si&&Mi(e),zi(e,t)}function zi(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===Ti){if(null===e)throw Error(a(308));Ti=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Ti=Ti.next=t;return n}var Li="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},ji=r.unstable_scheduleCallback,Oi=r.unstable_NormalPriority,Fi={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Bi(){return{controller:new Li,data:new Map,refCount:0}}function Ni(e){e.refCount--,0===e.refCount&&ji(Oi,function(){e.controller.abort()})}var Ui=null,Vi=0,Gi=0,qi=null;function Zi(){if(0===--Vi&&null!==Ui){null!==qi&&(qi.status="fulfilled");var e=Ui;Ui=null,Gi=0,qi=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Wi=z.S;z.S=function(e,t){Dc=le(),"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Ui){var n=Ui=[];Vi=0,Gi=Vu(),qi={status:"pending",value:void 0,then:function(e){n.push(e)}}}Vi++,t.then(Zi,Zi)}(0,t),null!==Wi&&Wi(e,t)};var Hi=B(null);function Xi(){var e=Hi.current;return null!==e?e:fc.pooledCache}function Ki(e,t){U(Hi,null===t?Hi.current:t.pool)}function Yi(){var e=Xi();return null===e?null:{parent:Fi._currentValue,pool:e}}var Ji=Error(a(460)),Qi=Error(a(474)),$i=Error(a(542)),eo={then:function(){}};function to(e){return"fulfilled"===(e=e.status)||"rejected"===e}function no(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Rt,Rt),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw ao(e=t.reason),e;default:if("string"===typeof t.status)t.then(Rt,Rt);else{if(null!==(e=fc)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw ao(e=t.reason),e}throw io=t,Ji}}function ro(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"===typeof t&&"function"===typeof t.then)throw io=t,Ji;throw t}}var io=null;function oo(){if(null===io)throw Error(a(459));var e=io;return io=null,e}function ao(e){if(e===Ji||e===$i)throw Error(a(483))}var so=null,lo=0;function co(e){var t=lo;return lo+=1,null===so&&(so=[]),no(so,e,t)}function uo(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function ho(e,t){if(t.$$typeof===f)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function po(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=Nr(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=qr(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===_?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===k&&ro(o)===t.type)?(uo(t=i(t,n.props),n),t.return=e,t):(uo(t=Vr(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Wr(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,o){return null===t||7!==t.tag?((t=Gr(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=qr(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case m:return uo(n=Vr(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case g:return(t=Wr(t,e.mode,n)).return=e,t;case k:return d(e,t=ro(t),n)}if(D(t)||A(t))return(t=Gr(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return d(e,co(t),n);if(t.$$typeof===x)return d(e,Di(e,t),n);ho(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case m:return n.key===i?c(e,t,n,r):null;case g:return n.key===i?u(e,t,n,r):null;case k:return p(e,t,n=ro(n),r)}if(D(n)||A(n))return null!==i?null:h(e,t,n,r,null);if("function"===typeof n.then)return p(e,t,co(n),r);if(n.$$typeof===x)return p(e,t,Di(e,n),r);ho(e,n)}return null}function f(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case m:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case g:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case k:return f(e,t,n,r=ro(r),i)}if(D(r)||A(r))return h(t,e=e.get(n)||null,r,i,null);if("function"===typeof r.then)return f(e,t,n,co(r),i);if(r.$$typeof===x)return f(e,t,n,Di(t,r),i);ho(t,r)}return null}function y(l,c,u,h){if("object"===typeof u&&null!==u&&u.type===_&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case m:e:{for(var v=u.key;null!==c;){if(c.key===v){if((v=u.type)===_){if(7===c.tag){n(l,c.sibling),(h=i(c,u.props.children)).return=l,l=h;break e}}else if(c.elementType===v||"object"===typeof v&&null!==v&&v.$$typeof===k&&ro(v)===c.type){n(l,c.sibling),uo(h=i(c,u.props),u),h.return=l,l=h;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===_?((h=Gr(u.props.children,l.mode,h,u.key)).return=l,l=h):(uo(h=Vr(u.type,u.key,u.props,null,l.mode,h),u),h.return=l,l=h)}return s(l);case g:e:{for(v=u.key;null!==c;){if(c.key===v){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(h=i(c,u.children||[])).return=l,l=h;break e}n(l,c);break}t(l,c),c=c.sibling}(h=Wr(u,l.mode,h)).return=l,l=h}return s(l);case k:return y(l,c,u=ro(u),h)}if(D(u))return function(i,a,s,l){for(var c=null,u=null,h=a,m=a=0,g=null;null!==h&&m<s.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var _=p(i,h,s[m],l);if(null===_){null===h&&(h=g);break}e&&h&&null===_.alternate&&t(i,h),a=o(_,a,m),null===u?c=_:u.sibling=_,u=_,h=g}if(m===s.length)return n(i,h),hi&&ii(i,m),c;if(null===h){for(;m<s.length;m++)null!==(h=d(i,s[m],l))&&(a=o(h,a,m),null===u?c=h:u.sibling=h,u=h);return hi&&ii(i,m),c}for(h=r(h);m<s.length;m++)null!==(g=f(h,i,m,s[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),a=o(g,a,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach(function(e){return t(i,e)}),hi&&ii(i,m),c}(l,c,u,h);if(A(u)){if("function"!==typeof(v=A(u)))throw Error(a(150));return function(i,s,l,c){if(null==l)throw Error(a(151));for(var u=null,h=null,m=s,g=s=0,_=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(_=m,m=null):_=m.sibling;var v=p(i,m,y.value,c);if(null===v){null===m&&(m=_);break}e&&m&&null===v.alternate&&t(i,m),s=o(v,s,g),null===h?u=v:h.sibling=v,h=v,m=_}if(y.done)return n(i,m),hi&&ii(i,g),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=d(i,y.value,c))&&(s=o(y,s,g),null===h?u=y:h.sibling=y,h=y);return hi&&ii(i,g),u}for(m=r(m);!y.done;g++,y=l.next())null!==(y=f(m,i,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),s=o(y,s,g),null===h?u=y:h.sibling=y,h=y);return e&&m.forEach(function(e){return t(i,e)}),hi&&ii(i,g),u}(l,c,u=v.call(u),h)}if("function"===typeof u.then)return y(l,c,co(u),h);if(u.$$typeof===x)return y(l,c,Di(l,u),h);ho(l,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(h=i(c,u)).return=l,l=h):(n(l,c),(h=qr(u,l.mode,h)).return=l,l=h),s(l)):n(l,c)}return function(e,t,n,r){try{lo=0;var i=y(e,t,n,r);return so=null,i}catch(a){if(a===Ji||a===$i)throw a;var o=Fr(29,a,null,e.mode);return o.lanes=r,o.return=e,o}}}var fo=po(!0),mo=po(!1),go=!1;function _o(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function yo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function vo(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function bo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&pc)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=Lr(e),zr(e,null,n),t}return Mr(e,r,t,n),Lr(e)}function xo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,ze(e,n)}}function wo(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var So=!1;function To(){if(So){if(null!==qi)throw qi}}function Eo(e,t,n,r){So=!1;var i=e.updateQueue;go=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===a?o=c:a.next=c,a=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=i.baseState;for(a=0,u=c=l=null,s=o;;){var d=-536870913&s.lane,f=d!==s.lane;if(f?(gc&d)===d:(r&d)===d){0!==d&&d===Gi&&(So=!0),null!==u&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var m=e,g=s;d=t;var _=n;switch(g.tag){case 1:if("function"===typeof(m=g.payload)){h=m.call(_,h,d);break e}h=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(d="function"===typeof(m=g.payload)?m.call(_,h,d):m)||void 0===d)break e;h=p({},h,d);break e;case 2:go=!0}}null!==(d=s.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=i.callbacks)?i.callbacks=[d]:f.push(d))}else f={lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=f,l=h):u=u.next=f,a|=d;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(f=s).next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null===o&&(i.shared.lanes=0),Tc|=a,e.lanes=a,e.memoizedState=h}}function ko(e,t){if("function"!==typeof e)throw Error(a(191,e));e.call(t)}function Po(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ko(n[e],t)}var Co=B(null),Io=B(0);function Ao(e,t){U(Io,e=wc),U(Co,t),wc=e|t.baseLanes}function Mo(){U(Io,wc),U(Co,Co.current)}function Ro(){wc=Io.current,N(Co),N(Io)}var Do=B(null),zo=null;function Lo(e){var t=e.alternate;U(No,1&No.current),U(Do,e),null===zo&&(null===t||null!==Co.current||null!==t.memoizedState)&&(zo=e)}function jo(e){U(No,No.current),U(Do,e),null===zo&&(zo=e)}function Oo(e){22===e.tag?(U(No,No.current),U(Do,e),null===zo&&(zo=e)):Fo()}function Fo(){U(No,No.current),U(Do,Do.current)}function Bo(e){N(Do),zo===e&&(zo=null),N(No)}var No=B(0);function Uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Mh(n)||Rh(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(0!==(128&t.flags))return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Vo=0,Go=null,qo=null,Zo=null,Wo=!1,Ho=!1,Xo=!1,Ko=0,Yo=0,Jo=null,Qo=0;function $o(){throw Error(a(321))}function ea(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Qn(e[n],t[n]))return!1;return!0}function ta(e,t,n,r,i,o){return Vo=o,Go=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,z.H=null===e||null===e.memoizedState?gs:_s,Xo=!1,o=n(r,i),Xo=!1,Ho&&(o=ra(t,n,r,i)),na(e),o}function na(e){z.H=ms;var t=null!==qo&&null!==qo.next;if(Vo=0,Zo=qo=Go=null,Wo=!1,Yo=0,Jo=null,t)throw Error(a(300));null===e||Ds||null!==(e=e.dependencies)&&Ai(e)&&(Ds=!0)}function ra(e,t,n,r){Go=e;var i=0;do{if(Ho&&(Jo=null),Yo=0,Ho=!1,25<=i)throw Error(a(301));if(i+=1,Zo=qo=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}z.H=ys,o=t(n,r)}while(Ho);return o}function ia(){var e=z.H,t=e.useState()[0];return t="function"===typeof t.then?ua(t):t,e=e.useState()[0],(null!==qo?qo.memoizedState:null)!==e&&(Go.flags|=1024),t}function oa(){var e=0!==Ko;return Ko=0,e}function aa(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function sa(e){if(Wo){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Wo=!1}Vo=0,Zo=qo=Go=null,Ho=!1,Yo=Ko=0,Jo=null}function la(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Zo?Go.memoizedState=Zo=e:Zo=Zo.next=e,Zo}function ca(){if(null===qo){var e=Go.alternate;e=null!==e?e.memoizedState:null}else e=qo.next;var t=null===Zo?Go.memoizedState:Zo.next;if(null!==t)Zo=t,qo=e;else{if(null===e){if(null===Go.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(qo=e).memoizedState,baseState:qo.baseState,baseQueue:qo.baseQueue,queue:qo.queue,next:null},null===Zo?Go.memoizedState=Zo=e:Zo=Zo.next=e}return Zo}function ua(e){var t=Yo;return Yo+=1,null===Jo&&(Jo=[]),e=no(Jo,e,t),t=Go,null===(null===Zo?t.memoizedState:Zo.next)&&(t=t.alternate,z.H=null===t||null===t.memoizedState?gs:_s),e}function ha(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return ua(e);if(e.$$typeof===x)return Ri(e)}throw Error(a(438,String(e)))}function da(e){var t=null,n=Go.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=Go.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Go.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=C;return t.index++,n}function pa(e,t){return"function"===typeof t?t(e):t}function fa(e){return ma(ca(),qo,e)}function ma(e,t,n){var r=e.queue;if(null===r)throw Error(a(311));r.lastRenderedReducer=n;var i=e.baseQueue,o=r.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}t.baseQueue=i=o,r.pending=null}if(o=e.baseState,null===i)e.memoizedState=o;else{var l=s=null,c=null,u=t=i.next,h=!1;do{var d=-536870913&u.lane;if(d!==u.lane?(gc&d)===d:(Vo&d)===d){var p=u.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),d===Gi&&(h=!0);else{if((Vo&p)===p){u=u.next,p===Gi&&(h=!0);continue}d={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=d,s=o):c=c.next=d,Go.lanes|=p,Tc|=p}d=u.action,Xo&&n(o,d),o=u.hasEagerState?u.eagerState:n(o,d)}else p={lane:d,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,s=o):c=c.next=p,Go.lanes|=d,Tc|=d;u=u.next}while(null!==u&&u!==t);if(null===c?s=o:c.next=l,!Qn(o,e.memoizedState)&&(Ds=!0,h&&null!==(n=qi)))throw n;e.memoizedState=o,e.baseState=s,e.baseQueue=c,r.lastRenderedState=o}return null===i&&(r.lanes=0),[e.memoizedState,r.dispatch]}function ga(e){var t=ca(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);Qn(o,t.memoizedState)||(Ds=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function _a(e,t,n){var r=Go,i=ca(),o=hi;if(o){if(void 0===n)throw Error(a(407));n=n()}else n=t();var s=!Qn((qo||i).memoizedState,n);if(s&&(i.memoizedState=n,Ds=!0),i=i.queue,Va(ba.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||null!==Zo&&1&Zo.memoizedState.tag){if(r.flags|=2048,Oa(9,{destroy:void 0},va.bind(null,r,i,n,t),null),null===fc)throw Error(a(349));o||0!==(127&Vo)||ya(r,t,n)}return n}function ya(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Go.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Go.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function va(e,t,n,r){t.value=n,t.getSnapshot=r,xa(t)&&wa(e)}function ba(e,t,n){return n(function(){xa(t)&&wa(e)})}function xa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Qn(e,n)}catch(r){return!0}}function wa(e){var t=Dr(e,2);null!==t&&Xc(t,e,2)}function Sa(e){var t=la();if("function"===typeof e){var n=e;if(e=n(),Xo){ve(!0);try{n()}finally{ve(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pa,lastRenderedState:e},t}function Ta(e,t,n,r){return e.baseState=n,ma(e,qo,"function"===typeof r?r:pa)}function Ea(e,t,n,r,i){if(ds(e))throw Error(a(485));if(null!==(e=t.action)){var o={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==z.T?n(!0):o.isTransition=!1,r(o),null===(n=t.pending)?(o.next=t.pending=o,ka(t,o)):(o.next=n.next,t.pending=n.next=o)}}function ka(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var o=z.T,a={};z.T=a;try{var s=n(i,r),l=z.S;null!==l&&l(a,s),Pa(e,t,s)}catch(c){Ia(e,t,c)}finally{null!==o&&null!==a.types&&(o.types=a.types),z.T=o}}else try{Pa(e,t,o=n(i,r))}catch(u){Ia(e,t,u)}}function Pa(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){Ca(e,t,n)},function(n){return Ia(e,t,n)}):Ca(e,t,n)}function Ca(e,t,n){t.status="fulfilled",t.value=n,Aa(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,ka(e,n)))}function Ia(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,Aa(t),t=t.next}while(t!==r)}e.action=null}function Aa(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Ma(e,t){return t}function Ra(e,t){if(hi){var n=fc.formState;if(null!==n){e:{var r=Go;if(hi){if(ui){t:{for(var i=ui,o=pi;8!==i.nodeType;){if(!o){i=null;break t}if(null===(i=Dh(i.nextSibling))){i=null;break t}}i="F!"===(o=i.data)||"F"===o?i:null}if(i){ui=Dh(i.nextSibling),r="F!"===i.data;break e}}mi(r)}r=!1}r&&(t=n[0])}}return(n=la()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:t},n.queue=r,n=cs.bind(null,Go,r),r.dispatch=n,r=Sa(!1),o=hs.bind(null,Go,!1,r.queue),i={state:t,dispatch:null,action:e,pending:null},(r=la()).queue=i,n=Ea.bind(null,Go,i,o,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function Da(e){return za(ca(),qo,e)}function za(e,t,n){if(t=ma(e,t,Ma)[0],e=fa(pa)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var r=ua(t)}catch(a){if(a===Ji)throw $i;throw a}else r=t;var i=(t=ca()).queue,o=i.dispatch;return n!==t.memoizedState&&(Go.flags|=2048,Oa(9,{destroy:void 0},La.bind(null,i,n),null)),[r,o,e]}function La(e,t){e.action=t}function ja(e){var t=ca(),n=qo;if(null!==n)return za(t,n,e);ca(),t=t.memoizedState;var r=(n=ca()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function Oa(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=Go.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Go.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Fa(){return ca().memoizedState}function Ba(e,t,n,r){var i=la();Go.flags|=e,i.memoizedState=Oa(1|t,{destroy:void 0},n,void 0===r?null:r)}function Na(e,t,n,r){var i=ca();r=void 0===r?null:r;var o=i.memoizedState.inst;null!==qo&&null!==r&&ea(r,qo.memoizedState.deps)?i.memoizedState=Oa(t,o,n,r):(Go.flags|=e,i.memoizedState=Oa(1|t,o,n,r))}function Ua(e,t){Ba(8390656,8,e,t)}function Va(e,t){Na(2048,8,e,t)}function Ga(e){var t=ca().memoizedState;return function(e){Go.flags|=4;var t=Go.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Go.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(0!==(2&pc))throw Error(a(440));return t.impl.apply(void 0,arguments)}}function qa(e,t){return Na(4,2,e,t)}function Za(e,t){return Na(4,4,e,t)}function Wa(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Ha(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,Na(4,4,Wa.bind(null,t,e),n)}function Xa(){}function Ka(e,t){var n=ca();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&ea(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ya(e,t){var n=ca();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&ea(t,r[1]))return r[0];if(r=e(),Xo){ve(!0);try{e()}finally{ve(!1)}}return n.memoizedState=[r,t],r}function Ja(e,t,n){return void 0===n||0!==(1073741824&Vo)&&0===(261930&gc)?e.memoizedState=t:(e.memoizedState=n,e=Hc(),Go.lanes|=e,Tc|=e,n)}function Qa(e,t,n,r){return Qn(n,t)?n:null!==Co.current?(e=Ja(e,n,r),Qn(e,t)||(Ds=!0),e):0===(42&Vo)||0!==(1073741824&Vo)&&0===(261930&gc)?(Ds=!0,e.memoizedState=n):(e=Hc(),Go.lanes|=e,Tc|=e,t)}function $a(e,t,n,r,i){var o=L.p;L.p=0!==o&&8>o?o:8;var a=z.T,s={};z.T=s,hs(e,!1,t,n);try{var l=i(),c=z.S;if(null!==c&&c(s,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)us(e,t,function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}(l,r),Wc());else us(e,t,r,Wc())}catch(u){us(e,t,{then:function(){},status:"rejected",reason:u},Wc())}finally{L.p=o,null!==a&&null!==s.types&&(a.types=s.types),z.T=a}}function es(){}function ts(e,t,n,r){if(5!==e.tag)throw Error(a(476));var i=ns(e).queue;$a(e,i,t,j,null===n?es:function(){return rs(e),n(r)})}function ns(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:j,baseState:j,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pa,lastRenderedState:j},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pa,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function rs(e){var t=ns(e);null===t.next&&(t=e.alternate.memoizedState),us(e,t.next.queue,{},Wc())}function is(){return Ri(ud)}function os(){return ca().memoizedState}function as(){return ca().memoizedState}function ss(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Wc(),r=bo(t,e=vo(n),n);return null!==r&&(Xc(r,t,n),xo(r,t,n)),t={cache:Bi()},void(e.payload=t)}t=t.return}}function ls(e,t,n){var r=Wc();n={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ds(e)?ps(t,n):null!==(n=Rr(e,t,n,r))&&(Xc(n,e,r),fs(n,t,r))}function cs(e,t,n){us(e,t,n,Wc())}function us(e,t,n,r){var i={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(ds(e))ps(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(i.hasEagerState=!0,i.eagerState=s,Qn(s,a))return Mr(e,t,i,0),null===fc&&Ar(),!1}catch(l){}if(null!==(n=Rr(e,t,i,r)))return Xc(n,e,r),fs(n,t,r),!0}return!1}function hs(e,t,n,r){if(r={lane:2,revertLane:Vu(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},ds(e)){if(t)throw Error(a(479))}else null!==(t=Rr(e,n,r,2))&&Xc(t,e,2)}function ds(e){var t=e.alternate;return e===Go||null!==t&&t===Go}function ps(e,t){Ho=Wo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function fs(e,t,n){if(0!==(4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,ze(e,n)}}var ms={readContext:Ri,use:ha,useCallback:$o,useContext:$o,useEffect:$o,useImperativeHandle:$o,useLayoutEffect:$o,useInsertionEffect:$o,useMemo:$o,useReducer:$o,useRef:$o,useState:$o,useDebugValue:$o,useDeferredValue:$o,useTransition:$o,useSyncExternalStore:$o,useId:$o,useHostTransitionStatus:$o,useFormState:$o,useActionState:$o,useOptimistic:$o,useMemoCache:$o,useCacheRefresh:$o};ms.useEffectEvent=$o;var gs={readContext:Ri,use:ha,useCallback:function(e,t){return la().memoizedState=[e,void 0===t?null:t],e},useContext:Ri,useEffect:Ua,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,Ba(4194308,4,Wa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ba(4194308,4,e,t)},useInsertionEffect:function(e,t){Ba(4,2,e,t)},useMemo:function(e,t){var n=la();t=void 0===t?null:t;var r=e();if(Xo){ve(!0);try{e()}finally{ve(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=la();if(void 0!==n){var i=n(t);if(Xo){ve(!0);try{n(t)}finally{ve(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=ls.bind(null,Go,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},la().memoizedState=e},useState:function(e){var t=(e=Sa(e)).queue,n=cs.bind(null,Go,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Xa,useDeferredValue:function(e,t){return Ja(la(),e,t)},useTransition:function(){var e=Sa(!1);return e=$a.bind(null,Go,e.queue,!0,!1),la().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=Go,i=la();if(hi){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===fc)throw Error(a(349));0!==(127&gc)||ya(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,Ua(ba.bind(null,r,o,e),[e]),r.flags|=2048,Oa(9,{destroy:void 0},va.bind(null,r,o,n,t),null),n},useId:function(){var e=la(),t=fc.identifierPrefix;if(hi){var n=ri;t="_"+t+"R_"+(n=(ni&~(1<<32-be(ni)-1)).toString(32)+n),0<(n=Ko++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=Qo++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:is,useFormState:Ra,useActionState:Ra,useOptimistic:function(e){var t=la();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=hs.bind(null,Go,!0,n),n.dispatch=t,[e,t]},useMemoCache:da,useCacheRefresh:function(){return la().memoizedState=ss.bind(null,Go)},useEffectEvent:function(e){var t=la(),n={impl:e};return t.memoizedState=n,function(){if(0!==(2&pc))throw Error(a(440));return n.impl.apply(void 0,arguments)}}},_s={readContext:Ri,use:ha,useCallback:Ka,useContext:Ri,useEffect:Va,useImperativeHandle:Ha,useInsertionEffect:qa,useLayoutEffect:Za,useMemo:Ya,useReducer:fa,useRef:Fa,useState:function(){return fa(pa)},useDebugValue:Xa,useDeferredValue:function(e,t){return Qa(ca(),qo.memoizedState,e,t)},useTransition:function(){var e=fa(pa)[0],t=ca().memoizedState;return["boolean"===typeof e?e:ua(e),t]},useSyncExternalStore:_a,useId:os,useHostTransitionStatus:is,useFormState:Da,useActionState:Da,useOptimistic:function(e,t){return Ta(ca(),0,e,t)},useMemoCache:da,useCacheRefresh:as};_s.useEffectEvent=Ga;var ys={readContext:Ri,use:ha,useCallback:Ka,useContext:Ri,useEffect:Va,useImperativeHandle:Ha,useInsertionEffect:qa,useLayoutEffect:Za,useMemo:Ya,useReducer:ga,useRef:Fa,useState:function(){return ga(pa)},useDebugValue:Xa,useDeferredValue:function(e,t){var n=ca();return null===qo?Ja(n,e,t):Qa(n,qo.memoizedState,e,t)},useTransition:function(){var e=ga(pa)[0],t=ca().memoizedState;return["boolean"===typeof e?e:ua(e),t]},useSyncExternalStore:_a,useId:os,useHostTransitionStatus:is,useFormState:ja,useActionState:ja,useOptimistic:function(e,t){var n=ca();return null!==qo?Ta(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:da,useCacheRefresh:as};function vs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:p({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}ys.useEffectEvent=Ga;var bs={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Wc(),i=vo(r);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=bo(e,i,r))&&(Xc(t,e,r),xo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Wc(),i=vo(r);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=bo(e,i,r))&&(Xc(t,e,r),xo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Wc(),r=vo(n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=bo(e,r,n))&&(Xc(t,e,n),xo(t,e,n))}};function xs(e,t,n,r,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!$n(n,r)||!$n(i,o))}function ws(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&bs.enqueueReplaceState(t,t.state,null)}function Ss(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=p({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}function Ts(e){kr(e)}function Es(e){console.error(e)}function ks(e){kr(e)}function Ps(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Cs(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Is(e,t,n){return(n=vo(n)).tag=3,n.payload={element:null},n.callback=function(){Ps(e,t)},n}function As(e){return(e=vo(e)).tag=3,e}function Ms(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"===typeof i){var o=r.value;e.payload=function(){return i(o)},e.callback=function(){Cs(t,n,r)}}var a=n.stateNode;null!==a&&"function"===typeof a.componentDidCatch&&(e.callback=function(){Cs(t,n,r),"function"!==typeof i&&(null===jc?jc=new Set([this]):jc.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Rs=Error(a(461)),Ds=!1;function zs(e,t,n,r){t.child=null===e?mo(t,null,n,r):fo(t,e.child,n,r)}function Ls(e,t,n,r,i){n=n.render;var o=t.ref;if("ref"in r){var a={};for(var s in r)"ref"!==s&&(a[s]=r[s])}else a=r;return Mi(t),r=ta(e,t,n,a,o,i),s=oa(),null===e||Ds?(hi&&s&&ai(t),t.flags|=1,zs(e,t,r,i),t.child):(aa(e,t,i),il(e,t,i))}function js(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Br(o)||void 0!==o.defaultProps||null!==n.compare?((e=Vr(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Os(e,t,o,r,i))}if(o=e.child,!ol(e,i)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:$n)(a,r)&&e.ref===t.ref)return il(e,t,i)}return t.flags|=1,(e=Nr(o,r)).ref=t.ref,e.return=t,t.child=e}function Os(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if($n(o,r)&&e.ref===t.ref){if(Ds=!1,t.pendingProps=r=o,!ol(e,i))return t.lanes=e.lanes,il(e,t,i);0!==(131072&e.flags)&&(Ds=!0)}}return qs(e,t,n,r,i)}function Fs(e,t,n,r){var i=r.children,o=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===r.mode){if(0!==(128&t.flags)){if(o=null!==o?o.baseLanes|n:n,null!==e){for(r=t.child=e.child,i=0;null!==r;)i=i|r.lanes|r.childLanes,r=r.sibling;r=i&~o}else r=0,t.child=null;return Ns(e,t,o,n,r)}if(0===(536870912&n))return r=t.lanes=536870912,Ns(e,t,null!==o?o.baseLanes|n:n,n,r);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Ki(0,null!==o?o.cachePool:null),null!==o?Ao(t,o):Mo(),Oo(t)}else null!==o?(Ki(0,o.cachePool),Ao(t,o),Fo(),t.memoizedState=null):(null!==e&&Ki(0,null),Mo(),Fo());return zs(e,t,i,n),t.child}function Bs(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Ns(e,t,n,r,i){var o=Xi();return o=null===o?null:{parent:Fi._currentValue,pool:o},t.memoizedState={baseLanes:n,cachePool:o},null!==e&&Ki(0,null),Mo(),Oo(t),null!==e&&Ii(e,t,r,!0),t.childLanes=i,null}function Us(e,t){return(t=$s({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Vs(e,t,n){return fo(t,e.child,null,n),(e=Us(t,t.pendingProps)).flags|=2,Bo(t),t.memoizedState=null,e}function Gs(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(a(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function qs(e,t,n,r,i){return Mi(t),n=ta(e,t,n,r,void 0,i),r=oa(),null===e||Ds?(hi&&r&&ai(t),t.flags|=1,zs(e,t,n,i),t.child):(aa(e,t,i),il(e,t,i))}function Zs(e,t,n,r,i,o){return Mi(t),t.updateQueue=null,n=ra(t,r,n,i),na(e),r=oa(),null===e||Ds?(hi&&r&&ai(t),t.flags|=1,zs(e,t,n,o),t.child):(aa(e,t,o),il(e,t,o))}function Ws(e,t,n,r,i){if(Mi(t),null===t.stateNode){var o=jr,a=n.contextType;"object"===typeof a&&null!==a&&(o=Ri(a)),o=new n(r,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=bs,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=r,o.state=t.memoizedState,o.refs={},_o(t),a=n.contextType,o.context="object"===typeof a&&null!==a?Ri(a):jr,o.state=t.memoizedState,"function"===typeof(a=n.getDerivedStateFromProps)&&(vs(t,n,a,r),o.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(a=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),a!==o.state&&bs.enqueueReplaceState(o,o.state,null),Eo(t,r,o,i),To(),o.state=t.memoizedState),"function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){o=t.stateNode;var s=t.memoizedProps,l=Ss(n,s);o.props=l;var c=o.context,u=n.contextType;a=jr,"object"===typeof u&&null!==u&&(a=Ri(u));var h=n.getDerivedStateFromProps;u="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s||c!==a)&&ws(t,o,r,a),go=!1;var d=t.memoizedState;o.state=d,Eo(t,r,o,i),To(),c=t.memoizedState,s||d!==c||go?("function"===typeof h&&(vs(t,n,h,r),c=t.memoizedState),(l=go||xs(t,n,l,r,d,c,a))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=a,r=l):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,yo(e,t),u=Ss(n,a=t.memoizedProps),o.props=u,h=t.pendingProps,d=o.context,c=n.contextType,l=jr,"object"===typeof c&&null!==c&&(l=Ri(c)),(c="function"===typeof(s=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==h||d!==l)&&ws(t,o,r,l),go=!1,d=t.memoizedState,o.state=d,Eo(t,r,o,i),To();var p=t.memoizedState;a!==h||d!==p||go||null!==e&&null!==e.dependencies&&Ai(e.dependencies)?("function"===typeof s&&(vs(t,n,s,r),p=t.memoizedState),(u=go||xs(t,n,u,r,d,p,l)||null!==e&&null!==e.dependencies&&Ai(e.dependencies))?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=l,r=u):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return o=r,Gs(e,t),r=0!==(128&t.flags),o||r?(o=t.stateNode,n=r&&"function"!==typeof n.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&r?(t.child=fo(t,e.child,null,i),t.child=fo(t,null,n,i)):zs(e,t,n,i),t.memoizedState=o.state,e=t.child):e=il(e,t,i),e}function Hs(e,t,n,r){return vi(),t.flags|=256,zs(e,t,n,r),t.child}var Xs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ks(e){return{baseLanes:e,cachePool:Yi()}}function Ys(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Pc),e}function Js(e,t,n){var r,i=t.pendingProps,o=!1,s=0!==(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&0!==(2&No.current)),r&&(o=!0,t.flags&=-129),r=0!==(32&t.flags),t.flags&=-33,null===e){if(hi){if(o?Lo(t):Fo(),(e=ui)?null!==(e=null!==(e=Ah(e,pi))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ti?{id:ni,overflow:ri}:null,retryLane:536870912,hydrationErrors:null},(n=Zr(e)).return=t,t.child=n,ci=t,ui=null):e=null,null===e)throw mi(t);return Rh(e)?t.lanes=32:t.lanes=536870912,null}var l=i.children;return i=i.fallback,o?(Fo(),l=$s({mode:"hidden",children:l},o=t.mode),i=Gr(i,o,n,null),l.return=t,i.return=t,l.sibling=i,t.child=l,(i=t.child).memoizedState=Ks(n),i.childLanes=Ys(e,r,n),t.memoizedState=Xs,Bs(null,i)):(Lo(t),Qs(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(s)256&t.flags?(Lo(t),t.flags&=-257,t=el(e,t,n)):null!==t.memoizedState?(Fo(),t.child=e.child,t.flags|=128,t=null):(Fo(),l=i.fallback,o=t.mode,i=$s({mode:"visible",children:i.children},o),(l=Gr(l,o,n,null)).flags|=2,i.return=t,l.return=t,i.sibling=l,t.child=i,fo(t,e.child,null,n),(i=t.child).memoizedState=Ks(n),i.childLanes=Ys(e,r,n),t.memoizedState=Xs,t=Bs(null,i));else if(Lo(t),Rh(l)){if(r=l.nextSibling&&l.nextSibling.dataset)var u=r.dgst;r=u,(i=Error(a(419))).stack="",i.digest=r,xi({value:i,source:null,stack:null}),t=el(e,t,n)}else if(Ds||Ii(e,t,n,!1),r=0!==(n&e.childLanes),Ds||r){if(null!==(r=fc)&&(0!==(i=Le(r,n))&&i!==c.retryLane))throw c.retryLane=i,Dr(e,i),Xc(r,e,i),Rs;Mh(l)||au(),t=el(e,t,n)}else Mh(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,ui=Dh(l.nextSibling),ci=t,hi=!0,di=null,pi=!1,null!==e&&li(t,e),(t=Qs(t,i.children)).flags|=4096);return t}return o?(Fo(),l=i.fallback,o=t.mode,u=(c=e.child).sibling,(i=Nr(c,{mode:"hidden",children:i.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?l=Nr(u,l):(l=Gr(l,o,n,null)).flags|=2,l.return=t,i.return=t,i.sibling=l,t.child=i,Bs(null,i),i=t.child,null===(l=e.child.memoizedState)?l=Ks(n):(null!==(o=l.cachePool)?(c=Fi._currentValue,o=o.parent!==c?{parent:c,pool:c}:o):o=Yi(),l={baseLanes:l.baseLanes|n,cachePool:o}),i.memoizedState=l,i.childLanes=Ys(e,r,n),t.memoizedState=Xs,Bs(e.child,i)):(Lo(t),e=(n=e.child).sibling,(n=Nr(n,{mode:"visible",children:i.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Qs(e,t){return(t=$s({mode:"visible",children:t},e.mode)).return=e,e.child=t}function $s(e,t){return(e=Fr(22,e,null,t)).lanes=0,e}function el(e,t,n){return fo(t,e.child,null,n),(e=Qs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function tl(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Pi(e.return,t,n)}function nl(e,t,n,r,i,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,treeForkCount:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i,a.treeForkCount=o)}function rl(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;r=r.children;var a=No.current,s=0!==(2&a);if(s?(a=1&a|2,t.flags|=128):a&=1,U(No,a),zs(e,t,r,n),r=hi?Qr:0,!s&&null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&tl(e,n,t);else if(19===e.tag)tl(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Uo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),nl(t,!1,i,n,o,r);break;case"backwards":case"unstable_legacy-backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Uo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}nl(t,!0,n,null,o,r);break;case"together":nl(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function il(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Tc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Ii(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Nr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Nr(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function ol(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Ai(e))}function al(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ds=!0;else{if(!ol(e,n)&&0===(128&t.flags))return Ds=!1,function(e,t,n){switch(t.tag){case 3:X(t,t.stateNode.containerInfo),Ei(0,Fi,e.memoizedState.cache),vi();break;case 27:case 5:Y(t);break;case 4:X(t,t.stateNode.containerInfo);break;case 10:Ei(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,jo(t),null;break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(Lo(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Js(e,t,n):(Lo(t),null!==(e=il(e,t,n))?e.sibling:null);Lo(t);break;case 19:var i=0!==(128&e.flags);if((r=0!==(n&t.childLanes))||(Ii(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return rl(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),U(No,No.current),r)break;return null;case 22:return t.lanes=0,Fs(e,t,n,t.pendingProps);case 24:Ei(0,Fi,e.memoizedState.cache)}return il(e,t,n)}(e,t,n);Ds=0!==(131072&e.flags)}else Ds=!1,hi&&0!==(1048576&t.flags)&&oi(t,Qr,t.index);switch(t.lanes=0,t.tag){case 16:e:{var r=t.pendingProps;if(e=ro(t.elementType),t.type=e,"function"!==typeof e){if(void 0!==e&&null!==e){var i=e.$$typeof;if(i===w){t.tag=11,t=Ls(null,t,e,r,n);break e}if(i===E){t.tag=14,t=js(null,t,e,r,n);break e}}throw t=R(e)||e,Error(a(306,t,""))}Br(e)?(r=Ss(e,r),t.tag=1,t=Ws(null,t,e,r,n)):(t.tag=0,t=qs(null,t,e,r,n))}return t;case 0:return qs(e,t,t.type,t.pendingProps,n);case 1:return Ws(e,t,r=t.type,i=Ss(r,t.pendingProps),n);case 3:e:{if(X(t,t.stateNode.containerInfo),null===e)throw Error(a(387));r=t.pendingProps;var o=t.memoizedState;i=o.element,yo(e,t),Eo(t,r,null,n);var s=t.memoizedState;if(r=s.cache,Ei(0,Fi,r),r!==o.cache&&Ci(t,[Fi],n,!0),To(),r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Hs(e,t,r,n);break e}if(r!==i){xi(i=Xr(Error(a(424)),t)),t=Hs(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ui=Dh(e.firstChild),ci=t,hi=!0,di=null,pi=!0,n=mo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(vi(),r===i){t=il(e,t,n);break e}zs(e,t,r,n)}t=t.child}return t;case 26:return Gs(e,t),null===e?(n=Zh(t.type,null,t.pendingProps,null))?t.memoizedState=n:hi||(n=t.type,e=t.pendingProps,(r=gh(W.current).createElement(n))[Ue]=t,r[Ve]=e,dh(r,n,e),et(r),t.stateNode=r):t.memoizedState=Zh(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Y(t),null===e&&hi&&(r=t.stateNode=Oh(t.type,t.pendingProps,W.current),ci=t,pi=!0,i=ui,kh(t.type)?(zh=i,ui=Dh(r.firstChild)):ui=i),zs(e,t,t.pendingProps.children,n),Gs(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&hi&&((i=r=ui)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[Xe])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(o!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((o=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var o=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===o)return e}if(null===(e=Dh(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,pi))?(t.stateNode=r,ci=t,ui=Dh(r.firstChild),pi=!1,i=!0):i=!1),i||mi(t)),Y(t),i=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,r=o.children,vh(i,o)?r=null:null!==s&&vh(i,s)&&(t.flags|=32),null!==t.memoizedState&&(i=ta(e,t,ia,null,null,n),ud._currentValue=i),Gs(e,t),zs(e,t,r,n),t.child;case 6:return null===e&&hi&&((e=n=ui)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Dh(e.nextSibling)))return null}return e}(n,t.pendingProps,pi))?(t.stateNode=n,ci=t,ui=null,e=!0):e=!1),e||mi(t)),null;case 13:return Js(e,t,n);case 4:return X(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=fo(t,null,r,n):zs(e,t,r,n),t.child;case 11:return Ls(e,t,t.type,t.pendingProps,n);case 7:return zs(e,t,t.pendingProps,n),t.child;case 8:case 12:return zs(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,Ei(0,t.type,r.value),zs(e,t,r.children,n),t.child;case 9:return i=t.type._context,r=t.pendingProps.children,Mi(t),r=r(i=Ri(i)),t.flags|=1,zs(e,t,r,n),t.child;case 14:return js(e,t,t.type,t.pendingProps,n);case 15:return Os(e,t,t.type,t.pendingProps,n);case 19:return rl(e,t,n);case 31:return function(e,t,n){var r=t.pendingProps,i=0!==(128&t.flags);if(t.flags&=-129,null===e){if(hi){if("hidden"===r.mode)return e=Us(t,r),t.lanes=536870912,Bs(null,e);if(jo(t),(e=ui)?null!==(e=null!==(e=Ah(e,pi))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ti?{id:ni,overflow:ri}:null,retryLane:536870912,hydrationErrors:null},(n=Zr(e)).return=t,t.child=n,ci=t,ui=null):e=null,null===e)throw mi(t);return t.lanes=536870912,null}return Us(t,r)}var o=e.memoizedState;if(null!==o){var s=o.dehydrated;if(jo(t),i)if(256&t.flags)t.flags&=-257,t=Vs(e,t,n);else{if(null===t.memoizedState)throw Error(a(558));t.child=e.child,t.flags|=128,t=null}else if(Ds||Ii(e,t,n,!1),i=0!==(n&e.childLanes),Ds||i){if(null!==(r=fc)&&0!==(s=Le(r,n))&&s!==o.retryLane)throw o.retryLane=s,Dr(e,s),Xc(r,e,s),Rs;au(),t=Vs(e,t,n)}else e=o.treeContext,ui=Dh(s.nextSibling),ci=t,hi=!0,di=null,pi=!1,null!==e&&li(t,e),(t=Us(t,r)).flags|=4096;return t}return(e=Nr(e.child,{mode:r.mode,children:r.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return Fs(e,t,n,t.pendingProps);case 24:return Mi(t),r=Ri(Fi),null===e?(null===(i=Xi())&&(i=fc,o=Bi(),i.pooledCache=o,o.refCount++,null!==o&&(i.pooledCacheLanes|=n),i=o),t.memoizedState={parent:r,cache:i},_o(t),Ei(0,Fi,i)):(0!==(e.lanes&n)&&(yo(e,t),Eo(t,null,null,n),To()),i=e.memoizedState,o=t.memoizedState,i.parent!==r?(i={parent:r,cache:r},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),Ei(0,Fi,r)):(r=o.cache,Ei(0,Fi,r),r!==i.cache&&Ci(t,[Fi],n,!0))),zs(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}function sl(e){e.flags|=4}function ll(e,t,n,r,i){if((t=0!==(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&i)===i)if(e.stateNode.complete)e.flags|=8192;else{if(!ru())throw io=eo,Qi;e.flags|=8192}}else e.flags&=-16777217}function cl(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!id(t)){if(!ru())throw io=eo,Qi;e.flags|=8192}}function ul(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Ae():536870912,e.lanes|=t,Cc|=t)}function hl(e,t){if(!hi)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function dl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=65011712&i.subtreeFlags,r|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function pl(e,t,n){var r=t.pendingProps;switch(si(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return dl(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),ki(Fi),K(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(yi(t)?sl(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,bi())),dl(t),null;case 26:var i=t.type,o=t.memoizedState;return null===e?(sl(t),null!==o?(dl(t),cl(t,o)):(dl(t),ll(t,i,0,0,n))):o?o!==e.memoizedState?(sl(t),dl(t),cl(t,o)):(dl(t),t.flags&=-16777217):((e=e.memoizedProps)!==r&&sl(t),dl(t),ll(t,i,0,0,n)),null;case 27:if(J(t),n=W.current,i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&sl(t);else{if(!r){if(null===t.stateNode)throw Error(a(166));return dl(t),null}e=q.current,yi(t)?gi(t):(e=Oh(i,r,n),t.stateNode=e,sl(t))}return dl(t),null;case 5:if(J(t),i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&sl(t);else{if(!r){if(null===t.stateNode)throw Error(a(166));return dl(t),null}if(o=q.current,yi(t))gi(t);else{var s=gh(W.current);switch(o){case 1:o=s.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:o=s.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":o=s.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":o=s.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":(o=s.createElement("div")).innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o="string"===typeof r.is?s.createElement("select",{is:r.is}):s.createElement("select"),r.multiple?o.multiple=!0:r.size&&(o.size=r.size);break;default:o="string"===typeof r.is?s.createElement(i,{is:r.is}):s.createElement(i)}}o[Ue]=t,o[Ve]=r;e:for(s=t.child;null!==s;){if(5===s.tag||6===s.tag)o.appendChild(s.stateNode);else if(4!==s.tag&&27!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;null===s.sibling;){if(null===s.return||s.return===t)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=o;e:switch(dh(o,i,r),i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&sl(t)}}return dl(t),ll(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&sl(t);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(e=W.current,yi(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(i=ci))switch(i.tag){case 27:case 5:r=i.memoizedProps}e[Ue]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||ch(e.nodeValue,n)))||mi(t,!0)}else(e=gh(e).createTextNode(r))[Ue]=t,t.stateNode=e}return dl(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(r=yi(t),null!==n){if(null===e){if(!r)throw Error(a(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(a(557));e[Ue]=t}else vi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;dl(t),e=!1}else n=bi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(Bo(t),t):(Bo(t),null);if(0!==(128&t.flags))throw Error(a(558))}return dl(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=yi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[Ue]=t}else vi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;dl(t),i=!1}else i=bi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=i),i=!0;if(!i)return 256&t.flags?(Bo(t),t):(Bo(t),null)}return Bo(t),0!==(128&t.flags)?(t.lanes=n,t):(n=null!==r,e=null!==e&&null!==e.memoizedState,n&&(i=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(i=r.alternate.memoizedState.cachePool.pool),o=null,null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(o=r.memoizedState.cachePool.pool),o!==i&&(r.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),ul(t,t.updateQueue),dl(t),null);case 4:return K(),null===e&&$u(t.stateNode.containerInfo),dl(t),null;case 10:return ki(t.type),dl(t),null;case 19:if(N(No),null===(r=t.memoizedState))return dl(t),null;if(i=0!==(128&t.flags),null===(o=r.rendering))if(i)hl(r,!1);else{if(0!==Sc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=Uo(e))){for(t.flags|=128,hl(r,!1),e=o.updateQueue,t.updateQueue=e,ul(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Ur(n,e),n=n.sibling;return U(No,1&No.current|2),hi&&ii(t,r.treeForkCount),t.child}e=e.sibling}null!==r.tail&&le()>zc&&(t.flags|=128,i=!0,hl(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=Uo(o))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,ul(t,e),hl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!o.alternate&&!hi)return dl(t),null}else 2*le()-r.renderingStartTime>zc&&536870912!==n&&(t.flags|=128,i=!0,hl(r,!1),t.lanes=4194304);r.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=r.last)?e.sibling=o:t.child=o,r.last=o)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=le(),e.sibling=null,n=No.current,U(No,i?1&n|2:1&n),hi&&ii(t,r.treeForkCount),e):(dl(t),null);case 22:case 23:return Bo(t),Ro(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!==(536870912&n)&&0===(128&t.flags)&&(dl(t),6&t.subtreeFlags&&(t.flags|=8192)):dl(t),null!==(n=t.updateQueue)&&ul(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&N(Hi),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),ki(Fi),dl(t),null;case 25:case 30:return null}throw Error(a(156,t.tag))}function fl(e,t){switch(si(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ki(Fi),K(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return J(t),null;case 31:if(null!==t.memoizedState){if(Bo(t),null===t.alternate)throw Error(a(340));vi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(Bo(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));vi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return N(No),null;case 4:return K(),null;case 10:return ki(t.type),null;case 22:case 23:return Bo(t),Ro(),null!==e&&N(Hi),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return ki(Fi),null;default:return null}}function ml(e,t){switch(si(t),t.tag){case 3:ki(Fi),K();break;case 26:case 27:case 5:J(t);break;case 4:K();break;case 31:null!==t.memoizedState&&Bo(t);break;case 13:Bo(t);break;case 19:N(No);break;case 10:ki(t.type);break;case 22:case 23:Bo(t),Ro(),null!==e&&N(Hi);break;case 24:ki(Fi)}}function gl(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var o=n.create,a=n.inst;r=o(),a.destroy=r}n=n.next}while(n!==i)}}catch(s){Su(t,t.return,s)}}function _l(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var o=i.next;r=o;do{if((r.tag&e)===e){var a=r.inst,s=a.destroy;if(void 0!==s){a.destroy=void 0,i=t;var l=n,c=s;try{c()}catch(u){Su(i,l,u)}}}r=r.next}while(r!==o)}}catch(u){Su(t,t.return,u)}}function yl(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Po(t,n)}catch(r){Su(e,e.return,r)}}}function vl(e,t,n){n.props=Ss(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){Su(e,t,r)}}function bl(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(i){Su(e,t,i)}}function xl(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"===typeof r)try{r()}catch(i){Su(e,t,i)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(o){Su(e,t,o)}else n.current=null}function wl(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(i){Su(e,e.return,i)}}function Sl(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,o=null,s=null,l=null,c=null,u=null,h=null;for(f in n){var d=n[f];if(n.hasOwnProperty(f)&&null!=d)switch(f){case"checked":case"value":break;case"defaultValue":c=d;default:r.hasOwnProperty(f)||uh(e,t,f,null,r,d)}}for(var p in r){var f=r[p];if(d=n[p],r.hasOwnProperty(p)&&(null!=f||null!=d))switch(p){case"type":o=f;break;case"name":i=f;break;case"checked":u=f;break;case"defaultChecked":h=f;break;case"value":s=f;break;case"defaultValue":l=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(a(137,t));break;default:f!==d&&uh(e,t,p,f,r,d)}}return void yt(e,s,l,c,u,h,o,i);case"select":for(o in f=s=l=p=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":f=c;default:r.hasOwnProperty(o)||uh(e,t,o,null,r,c)}for(i in r)if(o=r[i],c=n[i],r.hasOwnProperty(i)&&(null!=o||null!=c))switch(i){case"value":p=o;break;case"defaultValue":l=o;break;case"multiple":s=o;default:o!==c&&uh(e,t,i,o,r,c)}return t=l,n=s,r=f,void(null!=p?xt(e,!!n,p,!1):!!r!==!!n&&(null!=t?xt(e,!!n,t,!0):xt(e,!!n,n?[]:"",!1)));case"textarea":for(l in f=p=null,n)if(i=n[l],n.hasOwnProperty(l)&&null!=i&&!r.hasOwnProperty(l))switch(l){case"value":case"children":break;default:uh(e,t,l,null,r,i)}for(s in r)if(i=r[s],o=n[s],r.hasOwnProperty(s)&&(null!=i||null!=o))switch(s){case"value":p=i;break;case"defaultValue":f=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(a(91));break;default:i!==o&&uh(e,t,s,i,r,o)}return void wt(e,p,f);case"option":for(var m in n)if(p=n[m],n.hasOwnProperty(m)&&null!=p&&!r.hasOwnProperty(m))if("selected"===m)e.selected=!1;else uh(e,t,m,null,r,p);for(c in r)if(p=r[c],f=n[c],r.hasOwnProperty(c)&&p!==f&&(null!=p||null!=f))if("selected"===c)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else uh(e,t,c,p,r,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)p=n[g],n.hasOwnProperty(g)&&null!=p&&!r.hasOwnProperty(g)&&uh(e,t,g,null,r,p);for(u in r)if(p=r[u],f=n[u],r.hasOwnProperty(u)&&p!==f&&(null!=p||null!=f))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(a(137,t));break;default:uh(e,t,u,p,r,f)}return;default:if(Ct(t)){for(var _ in n)p=n[_],n.hasOwnProperty(_)&&void 0!==p&&!r.hasOwnProperty(_)&&hh(e,t,_,void 0,r,p);for(h in r)p=r[h],f=n[h],!r.hasOwnProperty(h)||p===f||void 0===p&&void 0===f||hh(e,t,h,p,r,f);return}}for(var y in n)p=n[y],n.hasOwnProperty(y)&&null!=p&&!r.hasOwnProperty(y)&&uh(e,t,y,null,r,p);for(d in r)p=r[d],f=n[d],!r.hasOwnProperty(d)||p===f||null==p&&null==f||uh(e,t,d,p,r,f)}(r,e.type,n,t),r[Ve]=t}catch(i){Su(e,e.return,i)}}function Tl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&kh(e.type)||4===e.tag}function El(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Tl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&kh(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function kl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Rt));else if(4!==r&&(27===r&&kh(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(kl(e,t,n),e=e.sibling;null!==e;)kl(e,t,n),e=e.sibling}function Pl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&kh(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Pl(e,t,n),e=e.sibling;null!==e;)Pl(e,t,n),e=e.sibling}function Cl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);dh(t,r,n),t[Ue]=e,t[Ve]=n}catch(o){Su(e,e.return,o)}}var Il=!1,Al=!1,Ml=!1,Rl="function"===typeof WeakSet?WeakSet:Set,Dl=null;function zl(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Xl(e,n),4&r&&gl(5,n);break;case 1:if(Xl(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(a){Su(n,n.return,a)}else{var i=Ss(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(s){Su(n,n.return,s)}}64&r&&yl(n),512&r&&bl(n,n.return);break;case 3:if(Xl(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Po(e,t)}catch(a){Su(n,n.return,a)}}break;case 27:null===t&&4&r&&Cl(n);case 26:case 5:Xl(e,n),null===t&&4&r&&wl(n),512&r&&bl(n,n.return);break;case 12:Xl(e,n);break;case 31:Xl(e,n),4&r&&Nl(e,n);break;case 13:Xl(e,n),4&r&&Ul(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=Pu.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||Il)){t=null!==t&&null!==t.memoizedState||Al,i=Il;var o=Al;Il=r,(Al=t)&&!o?Yl(e,n,0!==(8772&n.subtreeFlags)):Xl(e,n),Il=i,Al=o}break;case 30:break;default:Xl(e,n)}}function Ll(e){var t=e.alternate;null!==t&&(e.alternate=null,Ll(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ke(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var jl=null,Ol=!1;function Fl(e,t,n){for(n=n.child;null!==n;)Bl(e,t,n),n=n.sibling}function Bl(e,t,n){if(ye&&"function"===typeof ye.onCommitFiberUnmount)try{ye.onCommitFiberUnmount(_e,n)}catch(o){}switch(n.tag){case 26:Al||xl(n,t),Fl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Al||xl(n,t);var r=jl,i=Ol;kh(n.type)&&(jl=n.stateNode,Ol=!1),Fl(e,t,n),Fh(n.stateNode),jl=r,Ol=i;break;case 5:Al||xl(n,t);case 6:if(r=jl,i=Ol,jl=null,Fl(e,t,n),Ol=i,null!==(jl=r))if(Ol)try{(9===jl.nodeType?jl.body:"HTML"===jl.nodeName?jl.ownerDocument.body:jl).removeChild(n.stateNode)}catch(a){Su(n,t,a)}else try{jl.removeChild(n.stateNode)}catch(a){Su(n,t,a)}break;case 18:null!==jl&&(Ol?(Ph(9===(e=jl).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),qd(e)):Ph(jl,n.stateNode));break;case 4:r=jl,i=Ol,jl=n.stateNode.containerInfo,Ol=!0,Fl(e,t,n),jl=r,Ol=i;break;case 0:case 11:case 14:case 15:_l(2,n,t),Al||_l(4,n,t),Fl(e,t,n);break;case 1:Al||(xl(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount&&vl(n,t,r)),Fl(e,t,n);break;case 21:Fl(e,t,n);break;case 22:Al=(r=Al)||null!==n.memoizedState,Fl(e,t,n),Al=r;break;default:Fl(e,t,n)}}function Nl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{qd(e)}catch(n){Su(t,t.return,n)}}}function Ul(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{qd(e)}catch(n){Su(t,t.return,n)}}function Vl(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Rl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Rl),t;default:throw Error(a(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var r=Cu.bind(null,e,t);t.then(r,r)}})}function Gl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r],o=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 27:if(kh(l.type)){jl=l.stateNode,Ol=!1;break e}break;case 5:jl=l.stateNode,Ol=!1;break e;case 3:case 4:jl=l.stateNode.containerInfo,Ol=!0;break e}l=l.return}if(null===jl)throw Error(a(160));Bl(o,s,i),jl=null,Ol=!1,null!==(o=i.alternate)&&(o.return=null),i.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Zl(t,e),t=t.sibling}var ql=null;function Zl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Gl(t,e),Wl(e),4&r&&(_l(3,e,e.return),gl(3,e),_l(5,e,e.return));break;case 1:Gl(t,e),Wl(e),512&r&&(Al||null===n||xl(n,n.return)),64&r&&Il&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var i=ql;if(Gl(t,e),Wl(e),512&r&&(Al||null===n||xl(n,n.return)),4&r){var o=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,i=i.ownerDocument||i;t:switch(r){case"title":(!(o=i.getElementsByTagName("title")[0])||o[Xe]||o[Ue]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=i.createElement(r),i.head.insertBefore(o,i.querySelector("head > title"))),dh(o,r,n),o[Ue]=e,et(o),r=o;break e;case"link":var s=nd("link","href",i).get(r+(n.href||""));if(s)for(var l=0;l<s.length;l++)if((o=s[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(l,1);break t}dh(o=i.createElement(r),r,n),i.head.appendChild(o);break;case"meta":if(s=nd("meta","content",i).get(r+(n.content||"")))for(l=0;l<s.length;l++)if((o=s[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(l,1);break t}dh(o=i.createElement(r),r,n),i.head.appendChild(o);break;default:throw Error(a(468,r))}o[Ue]=e,et(o),r=o}e.stateNode=r}else rd(i,e.type,e.stateNode);else e.stateNode=Jh(i,r,e.memoizedProps);else o!==r?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===r?rd(i,e.type,e.stateNode):Jh(i,r,e.memoizedProps)):null===r&&null!==e.stateNode&&Sl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Gl(t,e),Wl(e),512&r&&(Al||null===n||xl(n,n.return)),null!==n&&4&r&&Sl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Gl(t,e),Wl(e),512&r&&(Al||null===n||xl(n,n.return)),32&e.flags){i=e.stateNode;try{Tt(i,"")}catch(m){Su(e,e.return,m)}}4&r&&null!=e.stateNode&&Sl(e,i=e.memoizedProps,null!==n?n.memoizedProps:i),1024&r&&(Ml=!0);break;case 6:if(Gl(t,e),Wl(e),4&r){if(null===e.stateNode)throw Error(a(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(m){Su(e,e.return,m)}}break;case 3:if(td=null,i=ql,ql=Uh(t.containerInfo),Gl(t,e),ql=i,Wl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{qd(t.containerInfo)}catch(m){Su(e,e.return,m)}Ml&&(Ml=!1,Hl(e));break;case 4:r=ql,ql=Uh(e.stateNode.containerInfo),Gl(t,e),Wl(e),ql=r;break;case 12:default:Gl(t,e),Wl(e);break;case 31:case 19:Gl(t,e),Wl(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Vl(e,r)));break;case 13:Gl(t,e),Wl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(Rc=le()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Vl(e,r)));break;case 22:i=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=Il,h=Al;if(Il=u||i,Al=h||c,Gl(t,e),Al=h,Il=u,Wl(e),8192&r)e:for(t=e.stateNode,t._visibility=i?-2&t._visibility:1|t._visibility,i&&(null===n||c||Il||Al||Kl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(o=c.stateNode,i)"function"===typeof(s=o.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{l=c.stateNode;var d=c.memoizedProps.style,p=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;l.style.display=null==p||"boolean"===typeof p?"":(""+p).trim()}}catch(m){Su(c,c.return,m)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(m){Su(c,c.return,m)}}}else if(18===t.tag){if(null===n){c=t;try{var f=c.stateNode;i?Ch(f,!0):Ch(c.stateNode,!1)}catch(m){Su(c,c.return,m)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,Vl(e,n))));case 30:case 21:}}function Wl(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(Tl(r)){n=r;break}r=r.return}if(null==n)throw Error(a(160));switch(n.tag){case 27:var i=n.stateNode;Pl(e,El(e),i);break;case 5:var o=n.stateNode;32&n.flags&&(Tt(o,""),n.flags&=-33),Pl(e,El(e),o);break;case 3:case 4:var s=n.stateNode.containerInfo;kl(e,El(e),s);break;default:throw Error(a(161))}}catch(l){Su(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Hl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Hl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Xl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)zl(e,t.alternate,t),t=t.sibling}function Kl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:_l(4,t,t.return),Kl(t);break;case 1:xl(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&vl(t,t.return,n),Kl(t);break;case 27:Fh(t.stateNode);case 26:case 5:xl(t,t.return),Kl(t);break;case 22:null===t.memoizedState&&Kl(t);break;default:Kl(t)}e=e.sibling}}function Yl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,o=t,a=o.flags;switch(o.tag){case 0:case 11:case 15:Yl(i,o,n),gl(4,o);break;case 1:if(Yl(i,o,n),"function"===typeof(i=(r=o).stateNode).componentDidMount)try{i.componentDidMount()}catch(c){Su(r,r.return,c)}if(null!==(i=(r=o).updateQueue)){var s=r.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)ko(l[i],s)}catch(c){Su(r,r.return,c)}}n&&64&a&&yl(o),bl(o,o.return);break;case 27:Cl(o);case 26:case 5:Yl(i,o,n),n&&null===r&&4&a&&wl(o),bl(o,o.return);break;case 12:Yl(i,o,n);break;case 31:Yl(i,o,n),n&&4&a&&Nl(i,o);break;case 13:Yl(i,o,n),n&&4&a&&Ul(i,o);break;case 22:null===o.memoizedState&&Yl(i,o,n),bl(o,o.return);break;case 30:break;default:Yl(i,o,n)}t=t.sibling}}function Jl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Ni(n))}function Ql(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ni(e))}function $l(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)ec(e,t,n,r),t=t.sibling}function ec(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:$l(e,t,n,r),2048&i&&gl(9,t);break;case 1:case 31:case 13:default:$l(e,t,n,r);break;case 3:$l(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ni(e)));break;case 12:if(2048&i){$l(e,t,n,r),e=t.stateNode;try{var o=t.memoizedProps,a=o.id,s=o.onPostCommit;"function"===typeof s&&s(a,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){Su(t,t.return,l)}}else $l(e,t,n,r);break;case 23:break;case 22:o=t.stateNode,a=t.alternate,null!==t.memoizedState?2&o._visibility?$l(e,t,n,r):nc(e,t):2&o._visibility?$l(e,t,n,r):(o._visibility|=2,tc(e,t,n,r,0!==(10256&t.subtreeFlags)||!1)),2048&i&&Jl(a,t);break;case 24:$l(e,t,n,r),2048&i&&Ql(t.alternate,t)}}function tc(e,t,n,r,i){for(i=i&&(0!==(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var o=e,a=t,s=n,l=r,c=a.flags;switch(a.tag){case 0:case 11:case 15:tc(o,a,s,l,i),gl(8,a);break;case 23:break;case 22:var u=a.stateNode;null!==a.memoizedState?2&u._visibility?tc(o,a,s,l,i):nc(o,a):(u._visibility|=2,tc(o,a,s,l,i)),i&&2048&c&&Jl(a.alternate,a);break;case 24:tc(o,a,s,l,i),i&&2048&c&&Ql(a.alternate,a);break;default:tc(o,a,s,l,i)}t=t.sibling}}function nc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:nc(n,r),2048&i&&Jl(r.alternate,r);break;case 24:nc(n,r),2048&i&&Ql(r.alternate,r);break;default:nc(n,r)}t=t.sibling}}var rc=8192;function ic(e,t,n){if(e.subtreeFlags&rc)for(e=e.child;null!==e;)oc(e,t,n),e=e.sibling}function oc(e,t,n){switch(e.tag){case 26:ic(e,t,n),e.flags&rc&&null!==e.memoizedState&&function(e,t,n,r){if("stylesheet"===n.type&&("string"!==typeof r.media||!1!==matchMedia(r.media).matches)&&0===(4&n.state.loading)){if(null===n.instance){var i=Wh(r.href),o=t.querySelector(Hh(i));if(o)return null!==(t=o._p)&&"object"===typeof t&&"function"===typeof t.then&&(e.count++,e=ad.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=o,void et(o);o=t.ownerDocument||t,r=Xh(r),(i=Bh.get(i))&&$h(r,i),et(o=o.createElement("link"));var a=o;a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),dh(o,"link",r),n.instance=o}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&0===(3&n.state.loading)&&(e.count++,n=ad.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,ql,e.memoizedState,e.memoizedProps);break;case 5:default:ic(e,t,n);break;case 3:case 4:var r=ql;ql=Uh(e.stateNode.containerInfo),ic(e,t,n),ql=r;break;case 22:null===e.memoizedState&&(null!==(r=e.alternate)&&null!==r.memoizedState?(r=rc,rc=16777216,ic(e,t,n),rc=r):ic(e,t,n))}}function ac(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function sc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Dl=r,uc(r,e)}ac(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)lc(e),e=e.sibling}function lc(e){switch(e.tag){case 0:case 11:case 15:sc(e),2048&e.flags&&_l(9,e,e.return);break;case 3:case 12:default:sc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,cc(e)):sc(e)}}function cc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Dl=r,uc(r,e)}ac(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:_l(8,t,t.return),cc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,cc(t));break;default:cc(t)}e=e.sibling}}function uc(e,t){for(;null!==Dl;){var n=Dl;switch(n.tag){case 0:case 11:case 15:_l(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Ni(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Dl=r;else e:for(n=e;null!==Dl;){var i=(r=Dl).sibling,o=r.return;if(Ll(r),r===n){Dl=null;break e}if(null!==i){i.return=o,Dl=i;break e}Dl=o}}}var hc={getCacheForType:function(e){var t=Ri(Fi),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return Ri(Fi).controller.signal}},dc="function"===typeof WeakMap?WeakMap:Map,pc=0,fc=null,mc=null,gc=0,_c=0,yc=null,vc=!1,bc=!1,xc=!1,wc=0,Sc=0,Tc=0,Ec=0,kc=0,Pc=0,Cc=0,Ic=null,Ac=null,Mc=!1,Rc=0,Dc=0,zc=1/0,Lc=null,jc=null,Oc=0,Fc=null,Bc=null,Nc=0,Uc=0,Vc=null,Gc=null,qc=0,Zc=null;function Wc(){return 0!==(2&pc)&&0!==gc?gc&-gc:null!==z.T?Vu():Fe()}function Hc(){if(0===Pc)if(0===(536870912&gc)||hi){var e=Te;0===(3932160&(Te<<=1))&&(Te=262144),Pc=e}else Pc=536870912;return null!==(e=Do.current)&&(e.flags|=32),Pc}function Xc(e,t,n){(e!==fc||2!==_c&&9!==_c)&&null===e.cancelPendingCommit||(tu(e,0),Qc(e,gc,Pc,!1)),Re(e,n),0!==(2&pc)&&e===fc||(e===fc&&(0===(2&pc)&&(Ec|=n),4===Sc&&Qc(e,gc,Pc,!1)),Lu(e))}function Kc(e,t,n){if(0!==(6&pc))throw Error(a(327));for(var r=!n&&0===(127&t)&&0===(t&e.expiredLanes)||Ce(e,t),i=r?function(e,t){var n=pc;pc|=2;var r=iu(),i=ou();fc!==e||gc!==t?(Lc=null,zc=le()+500,tu(e,t)):bc=Ce(e,t);e:for(;;)try{if(0!==_c&&null!==mc){t=mc;var o=yc;t:switch(_c){case 1:_c=0,yc=null,du(e,t,o,1);break;case 2:case 9:if(to(o)){_c=0,yc=null,hu(t);break}t=function(){2!==_c&&9!==_c||fc!==e||(_c=7),Lu(e)},o.then(t,t);break e;case 3:_c=7;break e;case 4:_c=5;break e;case 7:to(o)?(_c=0,yc=null,hu(t)):(_c=0,yc=null,du(e,t,o,7));break;case 5:var s=null;switch(mc.tag){case 26:s=mc.memoizedState;case 5:case 27:var l=mc;if(s?id(s):l.stateNode.complete){_c=0,yc=null;var c=l.sibling;if(null!==c)mc=c;else{var u=l.return;null!==u?(mc=u,pu(u)):mc=null}break t}}_c=0,yc=null,du(e,t,o,5);break;case 6:_c=0,yc=null,du(e,t,o,6);break;case 8:eu(),Sc=6;break e;default:throw Error(a(462))}}cu();break}catch(h){nu(e,h)}return Ti=Si=null,z.H=r,z.A=i,pc=n,null!==mc?0:(fc=null,gc=0,Ar(),Sc)}(e,t):su(e,t,!0),o=r;;){if(0===i){bc&&!r&&Qc(e,t,0,!1);break}if(n=e.current.alternate,!o||Jc(n)){if(2===i){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var l=e;i=Ic;var c=l.current.memoizedState.isDehydrated;if(c&&(tu(l,s).flags|=256),2!==(s=su(l,s,!1))){if(xc&&!c){l.errorRecoveryDisabledLanes|=o,Ec|=o,i=4;break e}o=Ac,Ac=i,null!==o&&(null===Ac?Ac=o:Ac.push.apply(Ac,o))}i=s}if(o=!1,2!==i)continue}}if(1===i){tu(e,0),Qc(e,t,0,!0);break}e:{switch(r=e,o=i){case 0:case 1:throw Error(a(345));case 4:if((4194048&t)!==t)break;case 6:Qc(r,t,Pc,!vc);break e;case 2:Ac=null;break;case 3:case 5:break;default:throw Error(a(329))}if((62914560&t)===t&&10<(i=Rc+300-le())){if(Qc(r,t,Pc,!vc),0!==Pe(r,0,!0))break e;Nc=t,r.timeoutHandle=xh(Yc.bind(null,r,n,Ac,Lc,Mc,t,Pc,Ec,Cc,vc,o,"Throttled",-0,0),i)}else Yc(r,n,Ac,Lc,Mc,t,Pc,Ec,Cc,vc,o,null,-0,0)}break}i=su(e,t,!1),o=!1}Lu(e)}function Yc(e,t,n,r,i,o,a,s,l,c,u,h,d,p){if(e.timeoutHandle=-1,8192&(h=t.subtreeFlags)||16785408===(16785408&h)){oc(t,o,h={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Rt});var f=(62914560&o)===o?Rc-le():(4194048&o)===o?Dc-le():0;if(null!==(f=function(e,t){return e.stylesheets&&0===e.count&&ld(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var r=setTimeout(function(){if(e.stylesheets&&ld(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===od&&(od=62500*function(){if("function"===typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),r=0;r<n.length;r++){var i=n[r],o=i.transferSize,a=i.initiatorType,s=i.duration;if(o&&s&&ph(a)){for(a=0,s=i.responseEnd,r+=1;r<n.length;r++){var l=n[r],c=l.startTime;if(c>s)break;var u=l.transferSize,h=l.initiatorType;u&&ph(h)&&(a+=u*((l=l.responseEnd)<s?1:(s-c)/(l-c)))}if(--r,t+=8*(o+a)/(i.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"===typeof(e=navigator.connection.downlink)?e:5}());var i=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&ld(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>od?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(i)}}:null}(h,f)))return Nc=o,e.cancelPendingCommit=f(mu.bind(null,e,t,o,n,r,i,a,s,l,u,h,null,d,p)),void Qc(e,o,a,!c)}mu(e,t,o,n,r,i,a,s,l)}function Jc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!Qn(o(),i))return!1}catch(a){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Qc(e,t,n,r){t&=~kc,t&=~Ec,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var o=31-be(i),a=1<<o;r[o]=-1,i&=~a}0!==n&&De(e,n,t)}function $c(){return 0!==(6&pc)||(ju(0,!1),!1)}function eu(){if(null!==mc){if(0===_c)var e=mc.return;else Ti=Si=null,sa(e=mc),so=null,lo=0,e=mc;for(;null!==e;)ml(e.alternate,e),e=e.return;mc=null}}function tu(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,wh(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Nc=0,eu(),fc=e,mc=n=Nr(e.current,null),gc=t,_c=0,yc=null,vc=!1,bc=Ce(e,t),xc=!1,Cc=Pc=kc=Ec=Tc=Sc=0,Ac=Ic=null,Mc=!1,0!==(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-be(r),o=1<<i;t|=e[i],r&=~o}return wc=t,Ar(),n}function nu(e,t){Go=null,z.H=ms,t===Ji||t===$i?(t=oo(),_c=3):t===Qi?(t=oo(),_c=4):_c=t===Rs?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,yc=t,null===mc&&(Sc=1,Ps(e,Xr(t,e.current)))}function ru(){var e=Do.current;return null===e||((4194048&gc)===gc?null===zo:((62914560&gc)===gc||0!==(536870912&gc))&&e===zo)}function iu(){var e=z.H;return z.H=ms,null===e?ms:e}function ou(){var e=z.A;return z.A=hc,e}function au(){Sc=4,vc||(4194048&gc)!==gc&&null!==Do.current||(bc=!0),0===(134217727&Tc)&&0===(134217727&Ec)||null===fc||Qc(fc,gc,Pc,!1)}function su(e,t,n){var r=pc;pc|=2;var i=iu(),o=ou();fc===e&&gc===t||(Lc=null,tu(e,t)),t=!1;var a=Sc;e:for(;;)try{if(0!==_c&&null!==mc){var s=mc,l=yc;switch(_c){case 8:eu(),a=6;break e;case 3:case 2:case 9:case 6:null===Do.current&&(t=!0);var c=_c;if(_c=0,yc=null,du(e,s,l,c),n&&bc){a=0;break e}break;default:c=_c,_c=0,yc=null,du(e,s,l,c)}}lu(),a=Sc;break}catch(u){nu(e,u)}return t&&e.shellSuspendCounter++,Ti=Si=null,pc=r,z.H=i,z.A=o,null===mc&&(fc=null,gc=0,Ar()),a}function lu(){for(;null!==mc;)uu(mc)}function cu(){for(;null!==mc&&!ae();)uu(mc)}function uu(e){var t=al(e.alternate,e,wc);e.memoizedProps=e.pendingProps,null===t?pu(e):mc=t}function hu(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Zs(n,t,t.pendingProps,t.type,void 0,gc);break;case 11:t=Zs(n,t,t.pendingProps,t.type.render,t.ref,gc);break;case 5:sa(t);default:ml(n,t),t=al(n,t=mc=Ur(t,wc),wc)}e.memoizedProps=e.pendingProps,null===t?pu(e):mc=t}function du(e,t,n,r){Ti=Si=null,sa(t),so=null,lo=0;var i=t.return;try{if(function(e,t,n,r,i){if(n.flags|=32768,null!==r&&"object"===typeof r&&"function"===typeof r.then){if(null!==(t=n.alternate)&&Ii(t,n,i,!0),null!==(n=Do.current)){switch(n.tag){case 31:case 13:return null===zo?au():null===n.alternate&&0===Sc&&(Sc=3),n.flags&=-257,n.flags|=65536,n.lanes=i,r===eo?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),Tu(e,r,i)),!1;case 22:return n.flags|=65536,r===eo?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),Tu(e,r,i)),!1}throw Error(a(435,n.tag))}return Tu(e,r,i),au(),!1}if(hi)return null!==(t=Do.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,r!==fi&&xi(Xr(e=Error(a(422),{cause:r}),n))):(r!==fi&&xi(Xr(t=Error(a(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,r=Xr(r,n),wo(e,i=Is(e.stateNode,r,i)),4!==Sc&&(Sc=2)),!1;var o=Error(a(520),{cause:r});if(o=Xr(o,n),null===Ic?Ic=[o]:Ic.push(o),4!==Sc&&(Sc=2),null===t)return!0;r=Xr(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=i&-i,n.lanes|=e,wo(n,e=Is(n.stateNode,r,e)),!1;case 1:if(t=n.type,o=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==o&&"function"===typeof o.componentDidCatch&&(null===jc||!jc.has(o))))return n.flags|=65536,i&=-i,n.lanes|=i,Ms(i=As(i),e,n,r),wo(n,i),!1}n=n.return}while(null!==n);return!1}(e,i,t,n,gc))return Sc=1,Ps(e,Xr(n,e.current)),void(mc=null)}catch(o){if(null!==i)throw mc=i,o;return Sc=1,Ps(e,Xr(n,e.current)),void(mc=null)}32768&t.flags?(hi||1===r?e=!0:bc||0!==(536870912&gc)?e=!1:(vc=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=Do.current)&&13===r.tag&&(r.flags|=16384))),fu(t,e)):pu(t)}function pu(e){var t=e;do{if(0!==(32768&t.flags))return void fu(t,vc);e=t.return;var n=pl(t.alternate,t,wc);if(null!==n)return void(mc=n);if(null!==(t=t.sibling))return void(mc=t);mc=t=e}while(null!==t);0===Sc&&(Sc=5)}function fu(e,t){do{var n=fl(e.alternate,e);if(null!==n)return n.flags&=32767,void(mc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(mc=e);mc=e=n}while(null!==e);Sc=6,mc=null}function mu(e,t,n,r,i,o,s,l,c){e.cancelPendingCommit=null;do{bu()}while(0!==Oc);if(0!==(6&pc))throw Error(a(327));if(null!==t){if(t===e.current)throw Error(a(177));if(o=t.lanes|t.childLanes,function(e,t,n,r,i,o){var a=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=a&~n;0<n;){var u=31-be(n),h=1<<u;s[u]=0,l[u]=-1;var d=c[u];if(null!==d)for(c[u]=null,u=0;u<d.length;u++){var p=d[u];null!==p&&(p.lane&=-536870913)}n&=~h}0!==r&&De(e,r,0),0!==o&&0===i&&0!==e.tag&&(e.suspendedLanes|=o&~(a&~t))}(e,n,o|=Ir,s,l,c),e===fc&&(mc=fc=null,gc=0),Bc=t,Fc=e,Nc=n,Uc=o,Vc=i,Gc=r,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,ie(de,function(){return xu(),null})):(e.callbackNode=null,e.callbackPriority=0),r=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||r){r=z.T,z.T=null,i=L.p,L.p=2,s=pc,pc|=4;try{!function(e,t){if(e=e.containerInfo,fh=vd,ir(e=rr(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(g){n=null;break e}var s=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==i&&3!==d.nodeType||(l=s+i),d!==o||0!==r&&3!==d.nodeType||(c=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===i&&(l=s),p===o&&++h===r&&(c=s),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(mh={focusedElem:e,selectionRange:n},vd=!1,Dl=t;null!==Dl;)if(e=(t=Dl).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Dl=e;else for(;null!==Dl;){switch(o=(t=Dl).alternate,e=t.flags,t.tag){case 0:if(0!==(4&e)&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(i=e[n]).ref.impl=i.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==o){e=void 0,n=t,i=o.memoizedProps,o=o.memoizedState,r=n.stateNode;try{var m=Ss(n.type,i);e=r.getSnapshotBeforeUpdate(m,o),r.__reactInternalSnapshotBeforeUpdate=e}catch(_){Su(n,n.return,_)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))Ih(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ih(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,Dl=e;break}Dl=t.return}}(e,t)}finally{pc=s,L.p=i,z.T=r}}Oc=1,gu(),_u(),yu()}}function gu(){if(1===Oc){Oc=0;var e=Fc,t=Bc,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=z.T,z.T=null;var r=L.p;L.p=2;var i=pc;pc|=4;try{Zl(t,e);var o=mh,a=rr(e.containerInfo),s=o.focusedElem,l=o.selectionRange;if(a!==s&&s&&s.ownerDocument&&nr(s.ownerDocument.documentElement,s)){if(null!==l&&ir(s)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in s)s.selectionStart=c,s.selectionEnd=Math.min(u,s.value.length);else{var h=s.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var p=d.getSelection(),f=s.textContent.length,m=Math.min(l.start,f),g=void 0===l.end?m:Math.min(l.end,f);!p.extend&&m>g&&(a=g,g=m,m=a);var _=tr(s,m),y=tr(s,g);if(_&&y&&(1!==p.rangeCount||p.anchorNode!==_.node||p.anchorOffset!==_.offset||p.focusNode!==y.node||p.focusOffset!==y.offset)){var v=h.createRange();v.setStart(_.node,_.offset),p.removeAllRanges(),m>g?(p.addRange(v),p.extend(y.node,y.offset)):(v.setEnd(y.node,y.offset),p.addRange(v))}}}}for(h=[],p=s;p=p.parentNode;)1===p.nodeType&&h.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<h.length;s++){var b=h[s];b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}vd=!!fh,mh=fh=null}finally{pc=i,L.p=r,z.T=n}}e.current=t,Oc=2}}function _u(){if(2===Oc){Oc=0;var e=Fc,t=Bc,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=z.T,z.T=null;var r=L.p;L.p=2;var i=pc;pc|=4;try{zl(e,t.alternate,t)}finally{pc=i,L.p=r,z.T=n}}Oc=3}}function yu(){if(4===Oc||3===Oc){Oc=0,se();var e=Fc,t=Bc,n=Nc,r=Gc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Oc=5:(Oc=0,Bc=Fc=null,vu(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(jc=null),Oe(n),t=t.stateNode,ye&&"function"===typeof ye.onCommitFiberRoot)try{ye.onCommitFiberRoot(_e,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==r){t=z.T,i=L.p,L.p=2,z.T=null;try{for(var o=e.onRecoverableError,a=0;a<r.length;a++){var s=r[a];o(s.value,{componentStack:s.stack})}}finally{z.T=t,L.p=i}}0!==(3&Nc)&&bu(),Lu(e),i=e.pendingLanes,0!==(261930&n)&&0!==(42&i)?e===Zc?qc++:(qc=0,Zc=e):qc=0,ju(0,!1)}}function vu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Ni(t)))}function bu(){return gu(),_u(),yu(),xu()}function xu(){if(5!==Oc)return!1;var e=Fc,t=Uc;Uc=0;var n=Oe(Nc),r=z.T,i=L.p;try{L.p=32>n?32:n,z.T=null,n=Vc,Vc=null;var o=Fc,s=Nc;if(Oc=0,Bc=Fc=null,Nc=0,0!==(6&pc))throw Error(a(331));var l=pc;if(pc|=4,lc(o.current),ec(o,o.current,s,n),pc=l,ju(0,!1),ye&&"function"===typeof ye.onPostCommitFiberRoot)try{ye.onPostCommitFiberRoot(_e,o)}catch(c){}return!0}finally{L.p=i,z.T=r,vu(e,t)}}function wu(e,t,n){t=Xr(n,t),null!==(e=bo(e,t=Is(e.stateNode,t,2),2))&&(Re(e,2),Lu(e))}function Su(e,t,n){if(3===e.tag)wu(e,e,n);else for(;null!==t;){if(3===t.tag){wu(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===jc||!jc.has(r))){e=Xr(n,e),null!==(r=bo(t,n=As(2),2))&&(Ms(n,r,t,e),Re(r,2),Lu(r));break}}t=t.return}}function Tu(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new dc;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(xc=!0,i.add(n),e=Eu.bind(null,e,t,n),t.then(e,e))}function Eu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,fc===e&&(gc&n)===n&&(4===Sc||3===Sc&&(62914560&gc)===gc&&300>le()-Rc?0===(2&pc)&&tu(e,0):kc|=n,Cc===gc&&(Cc=0)),Lu(e)}function ku(e,t){0===t&&(t=Ae()),null!==(e=Dr(e,t))&&(Re(e,t),Lu(e))}function Pu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),ku(e,n)}function Cu(e,t){var n=0;switch(e.tag){case 31:case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==r&&r.delete(t),ku(e,n)}var Iu=null,Au=null,Mu=!1,Ru=!1,Du=!1,zu=0;function Lu(e){e!==Au&&null===e.next&&(null===Au?Iu=Au=e:Au=Au.next=e),Ru=!0,Mu||(Mu=!0,Th(function(){0!==(6&pc)?ie(ue,Ou):Fu()}))}function ju(e,t){if(!Du&&Ru){Du=!0;do{for(var n=!1,r=Iu;null!==r;){if(!t)if(0!==e){var i=r.pendingLanes;if(0===i)var o=0;else{var a=r.suspendedLanes,s=r.pingedLanes;o=(1<<31-be(42|e)+1)-1,o=201326741&(o&=i&~(a&~s))?201326741&o|1:o?2|o:0}0!==o&&(n=!0,Uu(r,o))}else o=gc,0===(3&(o=Pe(r,r===fc?o:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||Ce(r,o)||(n=!0,Uu(r,o));r=r.next}}while(n);Du=!1}}function Ou(){Fu()}function Fu(){Ru=Mu=!1;var e=0;0!==zu&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==bh&&(bh=e,!0);return bh=null,!1}()&&(e=zu);for(var t=le(),n=null,r=Iu;null!==r;){var i=r.next,o=Bu(r,t);0===o?(r.next=null,null===n?Iu=i:n.next=i,null===i&&(Au=n)):(n=r,(0!==e||0!==(3&o))&&(Ru=!0)),r=i}0!==Oc&&5!==Oc||ju(e,!1),0!==zu&&(zu=0)}function Bu(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var a=31-be(o),s=1<<a,l=i[a];-1===l?0!==(s&n)&&0===(s&r)||(i[a]=Ie(s,t)):l<=t&&(e.expiredLanes|=s),o&=~s}if(n=gc,n=Pe(e,e===(t=fc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===_c||9===_c)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&oe(r),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||Ce(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&oe(r),Oe(n)){case 2:case 8:n=he;break;case 32:default:n=de;break;case 268435456:n=fe}return r=Nu.bind(null,e),n=ie(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&oe(r),e.callbackPriority=2,e.callbackNode=null,2}function Nu(e,t){if(0!==Oc&&5!==Oc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(bu()&&e.callbackNode!==n)return null;var r=gc;return 0===(r=Pe(e,e===fc?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Kc(e,r,t),Bu(e,le()),null!=e.callbackNode&&e.callbackNode===n?Nu.bind(null,e):null)}function Uu(e,t){if(bu())return null;Kc(e,t,!0)}function Vu(){if(0===zu){var e=Gi;0===e&&(e=Se,0===(261888&(Se<<=1))&&(Se=256)),zu=e}return zu}function Gu(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Mt(""+e)}function qu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Zu=0;Zu<Tr.length;Zu++){var Wu=Tr[Zu];Er(Wu.toLowerCase(),"on"+(Wu[0].toUpperCase()+Wu.slice(1)))}Er(gr,"onAnimationEnd"),Er(_r,"onAnimationIteration"),Er(yr,"onAnimationStart"),Er("dblclick","onDoubleClick"),Er("focusin","onFocus"),Er("focusout","onBlur"),Er(vr,"onTransitionRun"),Er(br,"onTransitionStart"),Er(xr,"onTransitionCancel"),Er(wr,"onTransitionEnd"),it("onMouseEnter",["mouseout","mouseover"]),it("onMouseLeave",["mouseout","mouseover"]),it("onPointerEnter",["pointerout","pointerover"]),it("onPointerLeave",["pointerout","pointerover"]),rt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rt("onBeforeInput",["compositionend","keypress","textInput","paste"]),rt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Xu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Hu));function Ku(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==o&&i.isPropagationStopped())break e;o=s,i.currentTarget=c;try{o(i)}catch(u){kr(u)}i.currentTarget=null,o=l}else for(a=0;a<r.length;a++){if(l=(s=r[a]).instance,c=s.currentTarget,s=s.listener,l!==o&&i.isPropagationStopped())break e;o=s,i.currentTarget=c;try{o(i)}catch(u){kr(u)}i.currentTarget=null,o=l}}}}function Yu(e,t){var n=t[qe];void 0===n&&(n=t[qe]=new Set);var r=e+"__bubble";n.has(r)||(eh(t,e,2,!1),n.add(r))}function Ju(e,t,n){var r=0;t&&(r|=4),eh(n,e,r,t)}var Qu="_reactListening"+Math.random().toString(36).slice(2);function $u(e){if(!e[Qu]){e[Qu]=!0,tt.forEach(function(t){"selectionchange"!==t&&(Xu.has(t)||Ju(t,!1,e),Ju(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Qu]||(t[Qu]=!0,Ju("selectionchange",!1,t))}}function eh(e,t,n,r){switch(kd(t)){case 2:var i=bd;break;case 8:i=xd;break;default:i=wd}n=i.bind(null,t,n,e),i=void 0,!Vt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function th(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i)break;if(4===a)for(a=r.return;null!==a;){var c=a.tag;if((3===c||4===c)&&a.stateNode.containerInfo===i)return;a=a.return}for(;null!==s;){if(null===(a=Ye(s)))return;if(5===(c=a.tag)||6===c||26===c||27===c){r=o=a;continue e}s=s.parentNode}}r=r.return}Bt(function(){var r=o,i=zt(n),a=[];e:{var s=Sr.get(e);if(void 0!==s){var c=nn,u=e;switch(e){case"keypress":if(0===Xt(n))break e;case"keydown":case"keyup":c=yn;break;case"focusin":u="focus",c=cn;break;case"focusout":u="blur",c=cn;break;case"beforeblur":case"afterblur":c=cn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=sn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=ln;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=bn;break;case gr:case _r:case yr:c=un;break;case wr:c=xn;break;case"scroll":case"scrollend":c=on;break;case"wheel":c=wn;break;case"copy":case"cut":case"paste":c=hn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=vn;break;case"toggle":case"beforetoggle":c=Sn}var h=0!==(4&t),d=!h&&("scroll"===e||"scrollend"===e),p=h?null!==s?s+"Capture":null:s;h=[];for(var f,m=r;null!==m;){var g=m;if(f=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===f||null===p||null!=(g=Nt(m,p))&&h.push(nh(m,g,f)),d)break;m=m.return}0<h.length&&(s=new c(s,u,null,n,i),a.push({event:s,listeners:h}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Dt||!(u=n.relatedTarget||n.fromElement)||!Ye(u)&&!u[Ge])&&(c||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?Ye(u):null)&&(d=l(u),h=u.tag,u!==d||5!==h&&27!==h&&6!==h)&&(u=null)):(c=null,u=r),c!==u)){if(h=sn,g="onMouseLeave",p="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(h=vn,g="onPointerLeave",p="onPointerEnter",m="pointer"),d=null==c?s:Qe(c),f=null==u?s:Qe(u),(s=new h(g,m+"leave",c,n,i)).target=d,s.relatedTarget=f,g=null,Ye(i)===r&&((h=new h(p,m+"enter",u,n,i)).target=f,h.relatedTarget=d,g=h),d=g,c&&u)e:{for(h=ih,m=u,f=0,g=p=c;g;g=h(g))f++;g=0;for(var _=m;_;_=h(_))g++;for(;0<f-g;)p=h(p),f--;for(;0<g-f;)m=h(m),g--;for(;f--;){if(p===m||null!==m&&p===m.alternate){h=p;break e}p=h(p),m=h(m)}h=null}else h=null;null!==c&&oh(a,s,c,h,!1),null!==u&&null!==d&&oh(a,d,u,h,!0)}if("select"===(c=(s=r?Qe(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var y=Un;else if(Ln(s))if(Vn)y=Jn;else{y=Kn;var v=Xn}else!(c=s.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?r&&Ct(r.elementType)&&(y=Un):y=Yn;switch(y&&(y=y(e,r))?jn(a,y,n,i):(v&&v(e,s,r),"focusout"===e&&r&&"number"===s.type&&null!=r.memoizedProps.value&&bt(s,"number",s.value)),v=r?Qe(r):window,e){case"focusin":(Ln(v)||"true"===v.contentEditable)&&(ar=v,sr=r,lr=null);break;case"focusout":lr=sr=ar=null;break;case"mousedown":cr=!0;break;case"contextmenu":case"mouseup":case"dragend":cr=!1,ur(a,n,i);break;case"selectionchange":if(or)break;case"keydown":case"keyup":ur(a,n,i)}var b;if(En)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Dn?Mn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(Cn&&"ko"!==n.locale&&(Dn||"onCompositionStart"!==x?"onCompositionEnd"===x&&Dn&&(b=Ht()):(Zt="value"in(qt=i)?qt.value:qt.textContent,Dn=!0)),0<(v=rh(r,x)).length&&(x=new dn(x,e,null,n,i),a.push({event:x,listeners:v}),b?x.data=b:null!==(b=Rn(n))&&(x.data=b))),(b=Pn?function(e,t){switch(e){case"compositionend":return Rn(t);case"keypress":return 32!==t.which?null:(An=!0,In);case"textInput":return(e=t.data)===In&&An?null:e;default:return null}}(e,n):function(e,t){if(Dn)return"compositionend"===e||!En&&Mn(e,t)?(e=Ht(),Wt=Zt=qt=null,Dn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Cn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(x=rh(r,"onBeforeInput")).length&&(v=new dn("onBeforeInput","beforeinput",null,n,i),a.push({event:v,listeners:x}),v.data=b)),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var o=Gu((i[Ve]||null).action),a=r.submitter;a&&null!==(t=(t=a[Ve]||null)?Gu(t.formAction):a.getAttribute("formAction"))&&(o=t,a=null);var s=new nn("action","action",null,r,i);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==zu){var e=a?qu(i,a):new FormData(i);ts(n,{pending:!0,data:e,method:i.method,action:o},null,e)}}else"function"===typeof o&&(s.preventDefault(),e=a?qu(i,a):new FormData(i),ts(n,{pending:!0,data:e,method:i.method,action:o},o,e))},currentTarget:i}]})}}(a,e,r,n,i)}Ku(a,t)})}function nh(e,t,n){return{instance:e,listener:t,currentTarget:n}}function rh(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;if(5!==(i=i.tag)&&26!==i&&27!==i||null===o||(null!=(i=Nt(e,n))&&r.unshift(nh(e,i,o)),null!=(i=Nt(e,t))&&r.push(nh(e,i,o))),3===e.tag)return r;e=e.return}return[]}function ih(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function oh(e,t,n,r,i){for(var o=t._reactName,a=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(s=s.tag,null!==l&&l===r)break;5!==s&&26!==s&&27!==s||null===c||(l=c,i?null!=(c=Nt(n,o))&&a.unshift(nh(n,c,l)):i||null!=(c=Nt(n,o))&&a.push(nh(n,c,l))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var ah=/\r\n?/g,sh=/\u0000|\uFFFD/g;function lh(e){return("string"===typeof e?e:""+e).replace(ah,"\n").replace(sh,"")}function ch(e,t){return t=lh(t),lh(e)===t}function uh(e,t,n,r,i,o){switch(n){case"children":"string"===typeof r?"body"===t||"textarea"===t&&""===r||Tt(e,r):("number"===typeof r||"bigint"===typeof r)&&"body"!==t&&Tt(e,""+r);break;case"className":ct(e,"class",r);break;case"tabIndex":ct(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":ct(e,n,r);break;case"style":Pt(e,r,o);break;case"data":if("object"!==t){ct(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"===typeof r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=Mt(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"===typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof o&&("formAction"===n?("input"!==t&&uh(e,t,"name",i.name,i,null),uh(e,t,"formEncType",i.formEncType,i,null),uh(e,t,"formMethod",i.formMethod,i,null),uh(e,t,"formTarget",i.formTarget,i,null)):(uh(e,t,"encType",i.encType,i,null),uh(e,t,"method",i.method,i,null),uh(e,t,"target",i.target,i,null))),null==r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=Mt(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Rt);break;case"onScroll":null!=r&&Yu("scroll",e);break;case"onScrollEnd":null!=r&&Yu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(a(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(a(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"muted":e.muted=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"===typeof r||"boolean"===typeof r||"symbol"===typeof r){e.removeAttribute("xlink:href");break}n=Mt(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"===typeof r||"symbol"===typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Yu("beforetoggle",e),Yu("toggle",e),lt(e,"popover",r);break;case"xlinkActuate":ut(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":ut(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":ut(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":ut(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":ut(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":ut(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":ut(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":ut(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":ut(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":lt(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&lt(e,n=It.get(n)||n,r)}}function hh(e,t,n,r,i,o){switch(n){case"style":Pt(e,r,o);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(a(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(a(60));e.innerHTML=n}}break;case"children":"string"===typeof r?Tt(e,r):("number"===typeof r||"bigint"===typeof r)&&Tt(e,""+r);break;case"onScroll":null!=r&&Yu("scroll",e);break;case"onScrollEnd":null!=r&&Yu("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Rt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:nt.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(i=n.endsWith("Capture"),t=n.slice(2,i?n.length-7:void 0),"function"===typeof(o=null!=(o=e[Ve]||null)?o[n]:null)&&e.removeEventListener(t,o,i),"function"!==typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):lt(e,n,r):("function"!==typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,i)))}}function dh(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Yu("error",e),Yu("load",e);var r,i=!1,o=!1;for(r in n)if(n.hasOwnProperty(r)){var s=n[r];if(null!=s)switch(r){case"src":i=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:uh(e,t,r,s,n,null)}}return o&&uh(e,t,"srcSet",n.srcSet,n,null),void(i&&uh(e,t,"src",n.src,n,null));case"input":Yu("invalid",e);var l=r=s=o=null,c=null,u=null;for(i in n)if(n.hasOwnProperty(i)){var h=n[i];if(null!=h)switch(i){case"name":o=h;break;case"type":s=h;break;case"checked":c=h;break;case"defaultChecked":u=h;break;case"value":r=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(a(137,t));break;default:uh(e,t,i,h,n,null)}}return void vt(e,r,l,c,u,s,o,!1);case"select":for(o in Yu("invalid",e),i=s=r=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":r=l;break;case"defaultValue":s=l;break;case"multiple":i=l;default:uh(e,t,o,l,n,null)}return t=r,n=s,e.multiple=!!i,void(null!=t?xt(e,!!i,t,!1):null!=n&&xt(e,!!i,n,!0));case"textarea":for(s in Yu("invalid",e),r=o=i=null,n)if(n.hasOwnProperty(s)&&null!=(l=n[s]))switch(s){case"value":i=l;break;case"defaultValue":o=l;break;case"children":r=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(a(91));break;default:uh(e,t,s,l,n,null)}return void St(e,i,o,r);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(i=n[c]))if("selected"===c)e.selected=i&&"function"!==typeof i&&"symbol"!==typeof i;else uh(e,t,c,i,n,null);return;case"dialog":Yu("beforetoggle",e),Yu("toggle",e),Yu("cancel",e),Yu("close",e);break;case"iframe":case"object":Yu("load",e);break;case"video":case"audio":for(i=0;i<Hu.length;i++)Yu(Hu[i],e);break;case"image":Yu("error",e),Yu("load",e);break;case"details":Yu("toggle",e);break;case"embed":case"source":case"link":Yu("error",e),Yu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(i=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:uh(e,t,u,i,n,null)}return;default:if(Ct(t)){for(h in n)n.hasOwnProperty(h)&&(void 0!==(i=n[h])&&hh(e,t,h,i,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(i=n[l])&&uh(e,t,l,i,n,null))}function ph(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var fh=null,mh=null;function gh(e){return 9===e.nodeType?e:e.ownerDocument}function _h(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yh(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function vh(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var bh=null;var xh="function"===typeof setTimeout?setTimeout:void 0,wh="function"===typeof clearTimeout?clearTimeout:void 0,Sh="function"===typeof Promise?Promise:void 0,Th="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof Sh?function(e){return Sh.resolve(null).then(e).catch(Eh)}:xh;function Eh(e){setTimeout(function(){throw e})}function kh(e){return"head"===e}function Ph(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)||"/&"===n){if(0===r)return e.removeChild(i),void qd(t);r--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)r++;else if("html"===n)Fh(e.ownerDocument.documentElement);else if("head"===n){Fh(n=e.ownerDocument.head);for(var o=n.firstChild;o;){var a=o.nextSibling,s=o.nodeName;o[Xe]||"SCRIPT"===s||"STYLE"===s||"LINK"===s&&"stylesheet"===o.rel.toLowerCase()||n.removeChild(o),o=a}}else"body"===n&&Fh(e.ownerDocument.body);n=i}while(n);qd(t)}function Ch(e,t){var n=e;e=0;do{var r=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===e)break;e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++;n=r}while(n)}function Ih(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Ih(n),Ke(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function Ah(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Dh(e.nextSibling)))return null}return e}function Mh(e){return"$?"===e.data||"$~"===e.data}function Rh(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Dh(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var zh=null;function Lh(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n||"/&"===n){if(0===t)return Dh(e.nextSibling);t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function jh(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e;t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function Oh(e,t,n){switch(t=gh(n),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}function Fh(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ke(e)}var Bh=new Map,Nh=new Set;function Uh(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Vh=L.d;L.d={f:function(){var e=Vh.f(),t=$c();return e||t},r:function(e){var t=Je(e);null!==t&&5===t.tag&&"form"===t.type?rs(t):Vh.r(e)},D:function(e){Vh.D(e),qh("dns-prefetch",e,null)},C:function(e,t){Vh.C(e,t),qh("preconnect",e,t)},L:function(e,t,n){Vh.L(e,t,n);var r=Gh;if(r&&e&&t){var i='link[rel="preload"][as="'+_t(t)+'"]';"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+_t(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(i+='[imagesizes="'+_t(n.imageSizes)+'"]')):i+='[href="'+_t(e)+'"]';var o=i;switch(t){case"style":o=Wh(e);break;case"script":o=Kh(e)}Bh.has(o)||(e=p({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Bh.set(o,e),null!==r.querySelector(i)||"style"===t&&r.querySelector(Hh(o))||"script"===t&&r.querySelector(Yh(o))||(dh(t=r.createElement("link"),"link",e),et(t),r.head.appendChild(t)))}},m:function(e,t){Vh.m(e,t);var n=Gh;if(n&&e){var r=t&&"string"===typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+_t(r)+'"][href="'+_t(e)+'"]',o=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=Kh(e)}if(!Bh.has(o)&&(e=p({rel:"modulepreload",href:e},t),Bh.set(o,e),null===n.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Yh(o)))return}dh(r=n.createElement("link"),"link",e),et(r),n.head.appendChild(r)}}},X:function(e,t){Vh.X(e,t);var n=Gh;if(n&&e){var r=$e(n).hoistableScripts,i=Kh(e),o=r.get(i);o||((o=n.querySelector(Yh(i)))||(e=p({src:e,async:!0},t),(t=Bh.get(i))&&ed(e,t),et(o=n.createElement("script")),dh(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}},S:function(e,t,n){Vh.S(e,t,n);var r=Gh;if(r&&e){var i=$e(r).hoistableStyles,o=Wh(e);t=t||"default";var a=i.get(o);if(!a){var s={loading:0,preload:null};if(a=r.querySelector(Hh(o)))s.loading=5;else{e=p({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Bh.get(o))&&$h(e,n);var l=a=r.createElement("link");et(l),dh(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){s.loading|=1}),l.addEventListener("error",function(){s.loading|=2}),s.loading|=4,Qh(a,t,r)}a={type:"stylesheet",instance:a,count:1,state:s},i.set(o,a)}}},M:function(e,t){Vh.M(e,t);var n=Gh;if(n&&e){var r=$e(n).hoistableScripts,i=Kh(e),o=r.get(i);o||((o=n.querySelector(Yh(i)))||(e=p({src:e,async:!0,type:"module"},t),(t=Bh.get(i))&&ed(e,t),et(o=n.createElement("script")),dh(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}}};var Gh="undefined"===typeof document?null:document;function qh(e,t,n){var r=Gh;if(r&&"string"===typeof t&&t){var i=_t(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"===typeof n&&(i+='[crossorigin="'+n+'"]'),Nh.has(i)||(Nh.add(i),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(i)&&(dh(t=r.createElement("link"),"link",e),et(t),r.head.appendChild(t)))}}function Zh(e,t,n,r){var i,o,s,l,c=(c=W.current)?Uh(c):null;if(!c)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Wh(n.href),(r=(n=$e(c).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Wh(n.href);var u=$e(c).hoistableStyles,h=u.get(e);if(h||(c=c.ownerDocument||c,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,h),(u=c.querySelector(Hh(e)))&&!u._p&&(h.instance=u,h.state.loading=5),Bh.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Bh.set(e,n),u||(i=c,o=e,s=n,l=h.state,i.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=i.createElement("link"),l.preload=o,o.addEventListener("load",function(){return l.loading|=1}),o.addEventListener("error",function(){return l.loading|=2}),dh(o,"link",s),et(o),i.head.appendChild(o))))),t&&null===r)throw Error(a(528,""));return h}if(t&&null!==r)throw Error(a(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Kh(n),(r=(n=$e(c).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Wh(e){return'href="'+_t(e)+'"'}function Hh(e){return'link[rel="stylesheet"]['+e+"]"}function Xh(e){return p({},e,{"data-precedence":e.precedence,precedence:null})}function Kh(e){return'[src="'+_t(e)+'"]'}function Yh(e){return"script[async]"+e}function Jh(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+_t(n.href)+'"]');if(r)return t.instance=r,et(r),r;var i=p({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return et(r=(e.ownerDocument||e).createElement("style")),dh(r,"style",i),Qh(r,n.precedence,e),t.instance=r;case"stylesheet":i=Wh(n.href);var o=e.querySelector(Hh(i));if(o)return t.state.loading|=4,t.instance=o,et(o),o;r=Xh(n),(i=Bh.get(i))&&$h(r,i),et(o=(e.ownerDocument||e).createElement("link"));var s=o;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),dh(o,"link",r),t.state.loading|=4,Qh(o,n.precedence,e),t.instance=o;case"script":return o=Kh(n.src),(i=e.querySelector(Yh(o)))?(t.instance=i,et(i),i):(r=n,(i=Bh.get(o))&&ed(r=p({},n),i),et(i=(e=e.ownerDocument||e).createElement("script")),dh(i,"link",r),e.head.appendChild(i),t.instance=i);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Qh(r,n.precedence,e));return t.instance}function Qh(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,o=i,a=0;a<r.length;a++){var s=r[a];if(s.dataset.precedence===t)o=s;else if(o!==i)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function $h(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function ed(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var td=null;function nd(e,t,n){if(null===td){var r=new Map,i=td=new Map;i.set(n,r)}else(r=(i=td).get(n))||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var o=n[i];if(!(o[Xe]||o[Ue]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var a=o.getAttribute(t)||"";a=e+a;var s=r.get(a);s?s.push(o):r.set(a,[o])}}return r}function rd(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function id(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var od=0;function ad(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)ld(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var sd=null;function ld(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,sd=new Map,t.forEach(cd,e),sd=null,ad.call(e))}function cd(e,t){if(!(4&t.state.loading)){var n=sd.get(e);if(n)var r=n.get(null);else{n=new Map,sd.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<i.length;o++){var a=i[o];"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(n.set(a.dataset.precedence,a),r=a)}r&&n.set(null,r)}a=(i=t.instance).getAttribute("data-precedence"),(o=n.get(a)||r)===r&&n.set(null,i),n.set(a,i),this.count++,r=ad.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),o?o.parentNode.insertBefore(i,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var ud={$$typeof:x,Provider:null,Consumer:null,_currentValue:j,_currentValue2:j,_threadCount:0};function hd(e,t,n,r,i,o,a,s,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Me(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Me(0),this.hiddenUpdates=Me(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=o,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function dd(e,t,n,r,i,o,a,s,l,c,u,h){return e=new hd(e,t,n,a,l,c,u,h,s),t=1,!0===o&&(t|=24),o=Fr(3,null,null,t),e.current=o,o.stateNode=e,(t=Bi()).refCount++,e.pooledCache=t,t.refCount++,o.memoizedState={element:r,isDehydrated:n,cache:t},_o(o),e}function pd(e){return e?e=jr:jr}function fd(e,t,n,r,i,o){i=pd(i),null===r.context?r.context=i:r.pendingContext=i,(r=vo(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(r.callback=o),null!==(n=bo(e,r,t))&&(Xc(n,0,t),xo(n,e,t))}function md(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function gd(e,t){md(e,t),(e=e.alternate)&&md(e,t)}function _d(e){if(13===e.tag||31===e.tag){var t=Dr(e,67108864);null!==t&&Xc(t,0,67108864),gd(e,67108864)}}function yd(e){if(13===e.tag||31===e.tag){var t=Wc(),n=Dr(e,t=je(t));null!==n&&Xc(n,0,t),gd(e,t)}}var vd=!0;function bd(e,t,n,r){var i=z.T;z.T=null;var o=L.p;try{L.p=2,wd(e,t,n,r)}finally{L.p=o,z.T=i}}function xd(e,t,n,r){var i=z.T;z.T=null;var o=L.p;try{L.p=8,wd(e,t,n,r)}finally{L.p=o,z.T=i}}function wd(e,t,n,r){if(vd){var i=Sd(r);if(null===i)th(e,t,r,Td,n),Ld(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Cd=jd(Cd,e,t,n,r,i),!0;case"dragenter":return Id=jd(Id,e,t,n,r,i),!0;case"mouseover":return Ad=jd(Ad,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Md.set(o,jd(Md.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Rd.set(o,jd(Rd.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Ld(e,r),4&t&&-1<zd.indexOf(e)){for(;null!==i;){var o=Je(i);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var a=ke(o.pendingLanes);if(0!==a){var s=o;for(s.pendingLanes|=2,s.entangledLanes|=2;a;){var l=1<<31-be(a);s.entanglements[1]|=l,a&=~l}Lu(o),0===(6&pc)&&(zc=le()+500,ju(0,!1))}}break;case 31:case 13:null!==(s=Dr(o,2))&&Xc(s,0,2),$c(),gd(o,2)}if(null===(o=Sd(r))&&th(e,t,r,Td,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else th(e,t,r,null,n)}}function Sd(e){return Ed(e=zt(e))}var Td=null;function Ed(e){if(Td=null,null!==(e=Ye(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(31===n){if(null!==(e=u(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Td=e,null}function kd(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ce()){case ue:return 2;case he:return 8;case de:case pe:return 32;case fe:return 268435456;default:return 32}default:return 32}}var Pd=!1,Cd=null,Id=null,Ad=null,Md=new Map,Rd=new Map,Dd=[],zd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ld(e,t){switch(e){case"focusin":case"focusout":Cd=null;break;case"dragenter":case"dragleave":Id=null;break;case"mouseover":case"mouseout":Ad=null;break;case"pointerover":case"pointerout":Md.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rd.delete(t.pointerId)}}function jd(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=Je(t))&&_d(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Od(e){var t=Ye(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void Be(e.priority,function(){yd(n)})}else if(31===t){if(null!==(t=u(n)))return e.blockedOn=t,void Be(e.priority,function(){yd(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Fd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Sd(e.nativeEvent);if(null!==n)return null!==(t=Je(n))&&_d(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Dt=r,n.target.dispatchEvent(r),Dt=null,t.shift()}return!0}function Bd(e,t,n){Fd(e)&&n.delete(t)}function Nd(){Pd=!1,null!==Cd&&Fd(Cd)&&(Cd=null),null!==Id&&Fd(Id)&&(Id=null),null!==Ad&&Fd(Ad)&&(Ad=null),Md.forEach(Bd),Rd.forEach(Bd)}function Ud(e,t){e.blockedOn===t&&(e.blockedOn=null,Pd||(Pd=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Nd)))}var Vd=null;function Gd(e){Vd!==e&&(Vd=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Vd===e&&(Vd=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2];if("function"!==typeof r){if(null===Ed(r||n))continue;break}var o=Je(n);null!==o&&(e.splice(t,3),t-=3,ts(o,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function qd(e){function t(t){return Ud(t,e)}null!==Cd&&Ud(Cd,e),null!==Id&&Ud(Id,e),null!==Ad&&Ud(Ad,e),Md.forEach(t),Rd.forEach(t);for(var n=0;n<Dd.length;n++){var r=Dd[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<Dd.length&&null===(n=Dd[0]).blockedOn;)Od(n),null===n.blockedOn&&Dd.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],o=n[r+1],a=i[Ve]||null;if("function"===typeof o)a||Gd(n);else if(a){var s=null;if(o&&o.hasAttribute("formAction")){if(i=o,a=o[Ve]||null)s=a.formAction;else if(null!==Ed(i))continue}else s=a.action;"function"===typeof s?n[r+1]=s:(n.splice(r,3),r-=3),Gd(n)}}}function Zd(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return i=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==i&&(i(),i=null),r||setTimeout(n,20)}function n(){if(!r&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"===typeof navigation){var r=!1,i=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){r=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==i&&(i(),i=null)}}}function Wd(e){this._internalRoot=e}function Hd(e){this._internalRoot=e}Hd.prototype.render=Wd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));fd(t.current,Wc(),e,t,null,null)},Hd.prototype.unmount=Wd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;fd(e.current,2,null,e,null,null),$c(),t[Ge]=null}},Hd.prototype.unstable_scheduleHydration=function(e){if(e){var t=Fe();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dd.length&&0!==t&&t<Dd[n].priority;n++);Dd.splice(n,0,e),0===n&&Od(e)}};var Xd=i.version;if("19.2.0"!==Xd)throw Error(a(527,Xd,"19.2.0"));L.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return h(i),e;if(o===r)return h(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,c=i.child;c;){if(c===n){s=!0,n=i,r=o;break}if(c===r){s=!0,r=i,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,r=i;break}if(c===r){s=!0,r=o,n=i;break}c=c.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?d(e):null)?null:e.stateNode};var Kd={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.2.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Yd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yd.isDisabled&&Yd.supportsFiber)try{_e=Yd.inject(Kd),ye=Yd}catch(Qd){}}t.createRoot=function(e,t){if(!s(e))throw Error(a(299));var n=!1,r="",i=Ts,o=Es,l=ks;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=dd(e,1,!1,null,0,n,r,null,i,o,l,Zd),e[Ge]=t.current,$u(e),new Wd(t)},t.hydrateRoot=function(e,t,n){if(!s(e))throw Error(a(299));var r=!1,i="",o=Ts,l=Es,c=ks,u=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onUncaughtError&&(o=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.formState&&(u=n.formState)),(t=dd(e,1,!0,t,0,r,i,u,o,l,c,Zd)).context=pd(null),n=t.current,(i=vo(r=je(r=Wc()))).callback=null,bo(n,i,r),n=r,t.current.lanes=n,Re(t,n),Lu(t),e[Ge]=t.current,$u(e),new Hd(t)},t.version="19.2.0"},43:(e,t,n)=>{"use strict";e.exports=n(288)},45:(e,t,n)=>{var r=n(738).default;e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},66:function(e,t,n){var r=n(693).default;e.exports=function(){"use strict";var e={},t={};function n(n,r,i){if(t[n]=i,"index"===n){var o="var sharedModule = {}; ("+t.shared+")(sharedModule); ("+t.worker+")(sharedModule);",a={};return t.shared(a),t.index(e,a),"undefined"!==typeof window&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))),e}}return n("shared",["exports"],function(e){function t(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((r=r.apply(e,t||[])).next())})}function n(e,t){this.x=e,this.y=t}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,a;"function"==typeof SuppressedError&&SuppressedError,n.prototype={clone(){return new n(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),r=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=r,this},_rotateAround(e,t){const n=Math.cos(e),r=Math.sin(e),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-r*(this.y-t.y),this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:n},n.convert=function(e){if(e instanceof n)return e;if(Array.isArray(e))return new n(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new n(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};var s=function(){if(a)return o;function e(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}return a=1,o=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=i/o}var a=0,s=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?a=n:s=n,n=.5*(s-a)+a;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},o}(),l=i(s);let c,u;function h(){return null==c&&(c="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),c}function d(){if(null==u&&(u=!1,h())){const e=5,t=new OffscreenCanvas(e,e).getContext("2d",{willReadFrequently:!0});if(t){for(let r=0;r<e*e;r++){const n=4*r;t.fillStyle="rgb(".concat(n,",").concat(n+1,",").concat(n+2,")"),t.fillRect(r%e,Math.floor(r/e),1,1)}const n=t.getImageData(0,0,e,e).data;for(let t=0;t<e*e*4;t++)if(t%4!=3&&n[t]!==t){u=!0;break}}}return u||!1}var p=1e-6,f="undefined"!=typeof Float32Array?Float32Array:Array;function m(){var e=new f(9);return f!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function g(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _(){var e=new f(3);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function y(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function v(e,t,n){var r=new f(3);return r[0]=e,r[1]=t,r[2]=n,r}function b(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function x(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function w(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],l=n[2];return e[0]=i*l-o*s,e[1]=o*a-r*l,e[2]=r*s-i*a,e}var S,T=y;function E(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}function k(){var e=new f(4);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function P(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"zyx",o=Math.PI/360;t*=o,r*=o,n*=o;var a=Math.sin(t),s=Math.cos(t),l=Math.sin(n),c=Math.cos(n),u=Math.sin(r),h=Math.cos(r);switch(i){case"xyz":e[0]=a*c*h+s*l*u,e[1]=s*l*h-a*c*u,e[2]=s*c*u+a*l*h,e[3]=s*c*h-a*l*u;break;case"xzy":e[0]=a*c*h-s*l*u,e[1]=s*l*h-a*c*u,e[2]=s*c*u+a*l*h,e[3]=s*c*h+a*l*u;break;case"yxz":e[0]=a*c*h+s*l*u,e[1]=s*l*h-a*c*u,e[2]=s*c*u-a*l*h,e[3]=s*c*h+a*l*u;break;case"yzx":e[0]=a*c*h+s*l*u,e[1]=s*l*h+a*c*u,e[2]=s*c*u-a*l*h,e[3]=s*c*h-a*l*u;break;case"zxy":e[0]=a*c*h-s*l*u,e[1]=s*l*h+a*c*u,e[2]=s*c*u+a*l*h,e[3]=s*c*h-a*l*u;break;case"zyx":e[0]=a*c*h-s*l*u,e[1]=s*l*h+a*c*u,e[2]=s*c*u-a*l*h,e[3]=s*c*h+a*l*u;break;default:throw new Error("Unknown angle order "+i)}return e}function C(){var e=new f(2);return f!=Float32Array&&(e[0]=0,e[1]=0),e}function I(e,t){var n=new f(2);return n[0]=e,n[1]=t,n}_(),S=new f(4),f!=Float32Array&&(S[0]=0,S[1]=0,S[2]=0,S[3]=0),_(),v(1,0,0),v(0,1,0),k(),k(),m(),C();const A=8192;function M(e,t,n){return t*(A/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}function R(e,t){return(e%t+t)%t}function D(e,t,n){return e*(1-n)+t*n}function z(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function L(e,t,n,r){const i=new l(e,t,n,r);return e=>i.solve(e)}const j=L(.25,.1,.25,1);function O(e,t,n){return Math.min(n,Math.max(t,e))}function F(e,t,n){const r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function B(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const i of n)for(const t in i)e[t]=i[t];return e}let N=1;function U(e,t,n){const r={};for(const i in e)r[i]=t.call(this,e[i],i,e);return r}function V(e,t,n){const r={};for(const i in e)t.call(this,e[i],i,e)&&(r[i]=e[i]);return r}function G(e){return Array.isArray(e)?e.map(G):"object"==typeof e&&e?U(e,G):e}const q={};function Z(e){q[e]||("undefined"!=typeof console&&console.warn(e),q[e]=!0)}function W(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function H(e){return"undefined"!=typeof WorkerGlobalScope&&void 0!==e&&e instanceof WorkerGlobalScope}let X=null;function K(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}const Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function J(e,n,r,i,o){return t(this,void 0,void 0,function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const t=new VideoFrame(e,{timestamp:0});try{const a=null==t?void 0:t.format;if(!a||!a.startsWith("BGR")&&!a.startsWith("RGB"))throw new Error("Unrecognized format ".concat(a));const s=a.startsWith("BGR"),l=new Uint8ClampedArray(i*o*4);if(yield t.copyTo(l,function(e,t,n,r,i){const o=4*Math.max(-t,0),a=(Math.max(0,n)-n)*r*4+o,s=4*r,l=Math.max(0,t),c=Math.max(0,n);return{rect:{x:l,y:c,width:Math.min(e.width,t+r)-l,height:Math.min(e.height,n+i)-c},layout:[{offset:a,stride:s}]}}(e,n,r,i,o)),s)for(let e=0;e<l.length;e+=4){const t=l[e];l[e]=l[e+2],l[e+2]=t}return l}finally{t.close()}})}let Q,$;function ee(e,t,n,r){return e.addEventListener(t,n,r),{unsubscribe:()=>{e.removeEventListener(t,n,r)}}}function te(e){return e*Math.PI/180}function ne(e){return e/Math.PI*180}const re={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ie={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},oe="AbortError";function ae(){return new Error(oe)}const se={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function le(e){return se.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]}const ce="global-dispatcher";class ue extends Error{constructor(e,t,n,r){super("AJAXError: ".concat(t," (").concat(e,"): ").concat(n)),this.status=e,this.statusText=t,this.url=n,this.body=r}}const he=()=>H(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,de=function(e,n){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){const t=le(e.url);if(t)return t(e,n);if(H(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,targetMapId:ce},n)}if(!(/^file:/.test(r=e.url)||/^file:/.test(he())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(e,n){return t(this,void 0,void 0,function*(){const t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,cache:e.cache,referrer:he(),signal:n.signal});let r,i;"json"!==e.type||t.headers.has("Accept")||t.headers.set("Accept","application/json");try{r=yield fetch(t)}catch(t){throw new ue(0,t.message,e.url,new Blob)}if(!r.ok){const t=yield r.blob();throw new ue(r.status,r.statusText,e.url,t)}i="arrayBuffer"===e.type||"image"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text();const o=yield i;if(n.signal.aborted)throw ae();return{data:o,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires")}})}(e,n);if(H(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,mustQueue:!0,targetMapId:ce},n)}var r;return function(e,t){return new Promise((n,r)=>{var i;const o=new XMLHttpRequest;o.open(e.method||"GET",e.url,!0),"arrayBuffer"!==e.type&&"image"!==e.type||(o.responseType="arraybuffer");for(const t in e.headers)o.setRequestHeader(t,e.headers[t]);"json"===e.type&&(o.responseType="text",(null===(i=e.headers)||void 0===i?void 0:i.Accept)||o.setRequestHeader("Accept","application/json")),o.withCredentials="include"===e.credentials,o.onerror=()=>{r(new Error(o.statusText))},o.onload=()=>{if(!t.signal.aborted)if((o.status>=200&&o.status<300||0===o.status)&&null!==o.response){let t=o.response;if("json"===e.type)try{t=JSON.parse(o.response)}catch(e){return void r(e)}n({data:t,cacheControl:o.getResponseHeader("Cache-Control"),expires:o.getResponseHeader("Expires")})}else{const t=new Blob([o.response],{type:o.getResponseHeader("Content-Type")});r(new ue(o.status,o.statusText,e.url,t))}},t.signal.addEventListener("abort",()=>{o.abort(),r(ae())}),o.send(e.body)})}(e,n)};function pe(e){if(!e||e.indexOf("://")<=0||0===e.indexOf("data:image/")||0===e.indexOf("blob:"))return!0;const t=new URL(e),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function fe(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function me(e,t,n){if(n&&n[e]){const r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}class ge{constructor(e){B(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=e}}class _e extends ge{constructor(e){super("error",B({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}class ye{on(e,t){return this._listeners=this._listeners||{},fe(e,t,this._listeners),{unsubscribe:()=>{this.off(e,t)}}}off(e,t){return me(e,t,this._listeners),me(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},fe(e,t,this._oneTimeListeners),this):new Promise(t=>this.once(e,t))}fire(e,t){"string"==typeof e&&(e=new ge(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of r)me(n,o,this._oneTimeListeners),o.call(this,e);const i=this._eventedParent;i&&(B(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(e))}else e instanceof _e&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const be=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xe(e,t){const n={};for(const r in e)"ref"!==r&&(n[r]=e[r]);return be.forEach(e=>{e in t&&(n[e]=t[e])}),n}function we(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!we(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!we(e[n],t[n]))return!1;return!0}return e===t}function Se(e,t){e.push(t)}function Te(e,t,n){Se(n,{command:"addSource",args:[e,t[e]]})}function Ee(e,t,n){Se(t,{command:"removeSource",args:[e]}),n[e]=!0}function ke(e,t,n,r){Ee(e,n,r),Te(e,t,n)}function Pe(e,t,n){let r;for(r in e[n])if(Object.prototype.hasOwnProperty.call(e[n],r)&&"data"!==r&&!we(e[n][r],t[n][r]))return!1;for(r in t[n])if(Object.prototype.hasOwnProperty.call(t[n],r)&&"data"!==r&&!we(e[n][r],t[n][r]))return!1;return!0}function Ce(e,t,n,r,i,o){e=e||{},t=t||{};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(we(e[a],t[a])||n.push({command:o,args:[r,a,t[a],i]}));for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&!Object.prototype.hasOwnProperty.call(e,a)&&(we(e[a],t[a])||n.push({command:o,args:[r,a,t[a],i]}))}function Ie(e){return e.id}function Ae(e,t){return e[t.id]=t,e}class Me{constructor(e,t,n,r){this.message=(e?"".concat(e,": "):"")+n,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function Re(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const i of n)for(const t in i)e[t]=i[t];return e}class De extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class ze{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[n,r]of t)this.bindings[n]=r}concat(e){return new ze(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Le={kind:"null"},je={kind:"number"},Oe={kind:"string"},Fe={kind:"boolean"},Be={kind:"color"},Ne={kind:"projectionDefinition"},Ue={kind:"object"},Ve={kind:"value"},Ge={kind:"collator"},qe={kind:"formatted"},Ze={kind:"padding"},We={kind:"colorArray"},He={kind:"numberArray"},Xe={kind:"resolvedImage"},Ke={kind:"variableAnchorOffsetCollection"};function Ye(e,t){return{kind:"array",itemType:e,N:t}}function Je(e){if("array"===e.kind){const t=Je(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}const Qe=[Le,je,Oe,Fe,Be,Ne,qe,Ue,Ye(Ve),Ze,He,We,Xe,Ke];function $e(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!$e(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Qe)if(!$e(e,t))return null}return"Expected ".concat(Je(e)," but found ").concat(Je(t)," instead.")}function et(e,t){return t.some(t=>t.kind===e.kind)}function tt(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}function nt(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const rt=.96422,it=.82521,ot=4/29,at=6/29,st=3*at*at,lt=at*at*at,ct=Math.PI/180,ut=180/Math.PI;function ht(e){return(e%=360)<0&&(e+=360),e}function dt(e){let t,n,[r,i,o,a]=e;const s=ft((.2225045*(r=pt(r))+.7168786*(i=pt(i))+.0606169*(o=pt(o)))/1);r===i&&i===o?t=n=s:(t=ft((.4360747*r+.3850649*i+.1430804*o)/rt),n=ft((.0139322*r+.0971045*i+.7141733*o)/it));const l=116*s-16;return[l<0?0:l,500*(t-s),200*(s-n),a]}function pt(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ft(e){return e>lt?Math.pow(e,1/3):e/st+ot}function mt(e){let[t,n,r,i]=e,o=(t+16)/116,a=isNaN(n)?o:o+n/500,s=isNaN(r)?o:o-r/200;return o=1*_t(o),a=rt*_t(a),s=it*_t(s),[gt(3.1338561*a-1.6168667*o-.4906146*s),gt(-.9787684*a+1.9161415*o+.033454*s),gt(.0719453*a-.2289914*o+1.4052427*s),i]}function gt(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function _t(e){return e>at?e*e*e:st*(e-ot)}const yt=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function vt(e,t){return yt(e,t)?e[t]:void 0}function bt(e){return parseInt(e.padEnd(2,e),16)/255}function xt(e,t){return wt(t?e/100:e,0,1)}function wt(e,t,n){return Math.min(Math.max(t,e),n)}function St(e){return!e.some(Number.isNaN)}const Tt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Et(e,t,n){return e+n*(t-e)}function kt(e,t,n){return e.map((e,r)=>Et(e,t[r],n))}class Pt{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.r=e,this.g=t,this.b=n,this.a=r,i||(this.r*=r,this.g*=r,this.b*=r,r||this.overwriteGetter("rgb",[e,t,n,r]))}static parse(e){if(e instanceof Pt)return e;if("string"!=typeof e)return;const t=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const t=vt(Tt,e);if(t){const[e,n,r]=t;return[e/255,n/255,r/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const t=e.length<6?1:2;let n=1;return[bt(e.slice(n,n+=t)),bt(e.slice(n,n+=t)),bt(e.slice(n,n+=t)),bt(e.slice(n,n+t)||"ff")]}if(e.startsWith("rgb")){const t=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){const[e,n,r,i,o,a,s,l,c,u,h,d]=t,p=[i||" ",s||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const e=[r,a,c].join(""),t="%%%"===e?100:""===e?255:0;if(t){const e=[wt(+n/t,0,1),wt(+o/t,0,1),wt(+l/t,0,1),h?xt(+h,d):1];if(St(e))return e}}return}}const n=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[e,t,r,i,o,a,s,l,c]=n,u=[r||" ",o||" ",s].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const e=[+t,wt(+i,0,100),wt(+a,0,100),l?xt(+l,c):1];if(St(e))return function(e){let[t,n,r,i]=e;function o(e){const i=(e+t/30)%12,o=n*Math.min(r,1-r);return r-o*Math.max(-1,Math.min(i-3,9-i,1))}return t=ht(t),n/=100,r/=100,[o(0),o(8),o(4),i]}(e)}}}(e);return t?new Pt(...t,!1):void 0}get rgb(){const{r:e,g:t,b:n,a:r}=this,i=r||1/0;return this.overwriteGetter("rgb",[e/i,t/i,n/i,r])}get hcl(){return this.overwriteGetter("hcl",function(e){const[t,n,r,i]=dt(e),o=Math.sqrt(n*n+r*r);return[Math.round(1e4*o)?ht(Math.atan2(r,n)*ut):NaN,o,t,i]}(this.rgb))}get lab(){return this.overwriteGetter("lab",dt(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,n,r]=this.rgb;return"rgba(".concat([e,t,n].map(e=>Math.round(255*e)).join(","),",").concat(r,")")}static interpolate(e,t,n){switch(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb"){case"rgb":{const[r,i,o,a]=kt(e.rgb,t.rgb,n);return new Pt(r,i,o,a,!1)}case"hcl":{const[r,i,o,a]=e.hcl,[s,l,c,u]=t.hcl;let h,d;if(isNaN(r)||isNaN(s))isNaN(r)?isNaN(s)?h=NaN:(h=s,1!==o&&0!==o||(d=l)):(h=r,1!==c&&0!==c||(d=i));else{let e=s-r;s>r&&e>180?e-=360:s<r&&r-s>180&&(e+=360),h=r+n*e}const[p,f,m,g]=function(e){let[t,n,r,i]=e;return t=isNaN(t)?0:t*ct,mt([r,Math.cos(t)*n,Math.sin(t)*n,i])}([h,null!=d?d:Et(i,l,n),Et(o,c,n),Et(a,u,n)]);return new Pt(p,f,m,g,!1)}case"lab":{const[r,i,o,a]=mt(kt(e.lab,t.lab,n));return new Pt(r,i,o,a,!1)}}}}Pt.black=new Pt(0,0,0,1),Pt.white=new Pt(1,1,1,1),Pt.transparent=new Pt(0,0,0,0),Pt.red=new Pt(1,0,0,1);class Ct{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const It=["bottom","center","top"];class At{constructor(e,t,n,r,i,o){this.text=e,this.image=t,this.scale=n,this.fontStack=r,this.textColor=i,this.verticalAlign=o}}class Mt{constructor(e){this.sections=e}static fromString(e){return new Mt([new At(e,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Mt?e:Mt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}}class Rt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Rt)return e;if("number"==typeof e)return new Rt([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Rt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new Rt(kt(e.values,t.values,n))}}class Dt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Dt)return e;if("number"==typeof e)return new Dt([e]);if(Array.isArray(e)){for(const t of e)if("number"!=typeof t)return;return new Dt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new Dt(kt(e.values,t.values,n))}}class zt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof zt)return e;if("string"==typeof e){const t=Pt.parse(e);if(!t)return;return new zt([t])}if(!Array.isArray(e))return;const t=[];for(const n of e){if("string"!=typeof n)return;const e=Pt.parse(n);if(!e)return;t.push(e)}return new zt(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb";const i=[];if(e.values.length!=t.values.length)throw new Error("colorArray: Arrays have mismatched length (".concat(e.values.length," vs. ").concat(t.values.length,"), cannot interpolate."));for(let o=0;o<e.values.length;o++)i.push(Pt.interpolate(e.values[o],t.values[o],n,r));return new zt(i)}}class Lt extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const jt=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ot{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ot)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){const n=e[t],r=e[t+1];if("string"!=typeof n||!jt.has(n))return;if(!Array.isArray(r)||2!==r.length||"number"!=typeof r[0]||"number"!=typeof r[1])return}return new Ot(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){const r=e.values,i=t.values;if(r.length!==i.length)throw new Lt("Cannot interpolate values of different length. from: ".concat(e.toString(),", to: ").concat(t.toString()));const o=[];for(let a=0;a<r.length;a+=2){if(r[a]!==i[a])throw new Lt("Cannot interpolate values containing mismatched anchors. from[".concat(a,"]: ").concat(r[a],", to[").concat(a,"]: ").concat(i[a]));o.push(r[a]);const[e,t]=r[a+1],[s,l]=i[a+1];o.push([Et(e,s,n),Et(t,l,n)])}return new Ot(o)}}class Ft{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ft({name:e,available:!1}):null}}class Bt{constructor(e,t,n){this.from=e,this.to=t,this.transition=n}static interpolate(e,t,n){return new Bt(e,t,n)}static parse(e){return e instanceof Bt?e:Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]?new Bt(e[0],e[1],e[2]):"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to&&"number"==typeof e.transition?new Bt(e.from,e.to,e.transition):"string"==typeof e?new Bt(e,e,1):void 0}}function Nt(e,t,n,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value [".concat([e,t,n,r].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Ut(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Bt||e instanceof Pt||e instanceof Ct||e instanceof Mt||e instanceof Rt||e instanceof Dt||e instanceof zt||e instanceof Ot||e instanceof Ft)return!0;if(Array.isArray(e)){for(const t of e)if(!Ut(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Ut(e[t]))return!1;return!0}return!1}function Vt(e){if(null===e)return Le;if("string"==typeof e)return Oe;if("boolean"==typeof e)return Fe;if("number"==typeof e)return je;if(e instanceof Pt)return Be;if(e instanceof Bt)return Ne;if(e instanceof Ct)return Ge;if(e instanceof Mt)return qe;if(e instanceof Rt)return Ze;if(e instanceof Dt)return He;if(e instanceof zt)return We;if(e instanceof Ot)return Ke;if(e instanceof Ft)return Xe;if(Array.isArray(e)){const t=e.length;let n;for(const r of e){const e=Vt(r);if(n){if(n===e)continue;n=Ve;break}n=e}return Ye(n||Ve,t)}return Ue}function Gt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Pt||e instanceof Bt||e instanceof Mt||e instanceof Rt||e instanceof Dt||e instanceof zt||e instanceof Ot||e instanceof Ft?e.toString():JSON.stringify(e)}class qt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(!Ut(e[1]))return t.error("invalid value");const n=e[1];let r=Vt(n);const i=t.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new qt(r,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Zt={string:Oe,number:je,boolean:Fe,object:Ue};class Wt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,r=1;const i=e[0];if("array"===i){let i,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in Zt)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=Zt[n],r++}else i=Ve;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}n=Ye(i,o)}else{if(!Zt[i])throw new Error("Types doesn't contain name = ".concat(i));n=Zt[i]}const o=[];for(;r<e.length;r++){const n=t.parse(e[r],r,Ve);if(!n)return null;o.push(n)}return new Wt(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!$e(this.type,Vt(n)))return n;if(t===this.args.length-1)throw new Lt("Expected value to be of type ".concat(Je(this.type),", but found ").concat(Je(Vt(n))," instead."))}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ht={"to-boolean":Fe,"to-color":Be,"to-number":je,"to-string":Oe};class Xt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(!Ht[n])throw new Error("Can't parse ".concat(n," as it is not part of the known types"));if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");const r=Ht[n],i=[];for(let o=1;o<e.length;o++){const n=t.parse(e[o],o,Ve);if(!n)return null;i.push(n)}return new Xt(r,i)}evaluate(e){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(e));case"color":{let t,n;for(const r of this.args){if(t=r.evaluate(e),n=null,t instanceof Pt)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?"Invalid rgba value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):Nt(t[0],t[1],t[2],t[3]),!n))return new Pt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Lt(n||"Could not parse color from value '".concat("string"==typeof t?t:JSON.stringify(t),"'"))}case"padding":{let t;for(const n of this.args){t=n.evaluate(e);const r=Rt.parse(t);if(r)return r}throw new Lt("Could not parse padding from value '".concat("string"==typeof t?t:JSON.stringify(t),"'"))}case"numberArray":{let t;for(const n of this.args){t=n.evaluate(e);const r=Dt.parse(t);if(r)return r}throw new Lt("Could not parse numberArray from value '".concat("string"==typeof t?t:JSON.stringify(t),"'"))}case"colorArray":{let t;for(const n of this.args){t=n.evaluate(e);const r=zt.parse(t);if(r)return r}throw new Lt("Could not parse colorArray from value '".concat("string"==typeof t?t:JSON.stringify(t),"'"))}case"variableAnchorOffsetCollection":{let t;for(const n of this.args){t=n.evaluate(e);const r=Ot.parse(t);if(r)return r}throw new Lt("Could not parse variableAnchorOffsetCollection from value '".concat("string"==typeof t?t:JSON.stringify(t),"'"))}case"number":{let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new Lt("Could not convert ".concat(JSON.stringify(t)," to number."))}case"formatted":return Mt.fromString(Gt(this.args[0].evaluate(e)));case"resolvedImage":return Ft.fromString(Gt(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Gt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Kt=["Unknown","Point","LineString","Polygon"];class Yt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Kt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=Pt.parse(e),this._parseColorCache.set(e,t)),t}}class Jt{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new ze,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];this.registry=e,this.path=n,this.key=n.map(e=>"[".concat(e,"]")).join(""),this.scope=i,this.errors=o,this.expectedType=r,this._isConstant=t}parse(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t?this.concat(t,n,r)._parse(e,i):this._parse(e,i)}_parse(e,t){function n(e,t,n){return"assert"===n?new Wt(t,[e]):"coerce"===n?new Xt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found ".concat(typeof r,' instead. If you wanted a literal array, use ["literal", [...]].'),0),null;const i=this.registry[r];if(i){let r=i.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,i=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind){if("projectionDefinition"===e.kind&&["string","array"].includes(i.kind)||["color","formatted","resolvedImage"].includes(e.kind)&&["value","string"].includes(i.kind)||["padding","numberArray"].includes(e.kind)&&["value","number","array"].includes(i.kind)||"colorArray"===e.kind&&["value","string","array"].includes(i.kind)||"variableAnchorOffsetCollection"===e.kind&&["value","array"].includes(i.kind))r=n(r,e,t.typeAnnotation||"coerce");else if(this.checkSubtype(e,i))return null}else r=n(r,e,t.typeAnnotation||"assert")}if(!(r instanceof qt)&&"resolvedImage"!==r.type.kind&&this._isConstant(r)){const t=new Yt;try{r=new qt(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return this.error('Unknown expression "'.concat(r,'". If you wanted a literal array, use ["literal", [...]].'),0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}concat(e,t,n){const r="number"==typeof e?this.path.concat(e):this.path,i=n?this.scope.concat(n):this.scope;return new Jt(this.registry,this._isConstant,r,t||null,i,this.errors)}error(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i="".concat(this.key).concat(n.map(e=>"[".concat(e,"]")).join(""));this.errors.push(new De(i,e))}checkSubtype(e,t){const n=$e(e,t);return n&&this.error(n),n}}class Qt{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found ".concat(e.length-1," instead."));const n=[];for(let i=1;i<e.length-1;i+=2){const r=e[i];if("string"!=typeof r)return t.error("Expected string, but found ".concat(typeof r," instead."),i);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=t.parse(e[i+1],i+1);if(!o)return null;n.push([r,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return r?new Qt(n,r):null}outputDefined(){return this.result.outputDefined()}}class $t{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new $t(n,t.scope.get(n)):t.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class en{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,je),r=t.parse(e[2],2,Ye(t.expectedType||Ve));return n&&r?new en(r.type.itemType,n,r):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Lt("Array index out of bounds: ".concat(t," < 0."));if(t>=n.length)throw new Lt("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t!==Math.floor(t))throw new Lt("Array index must be an integer, but found ".concat(t," instead."));return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class tn{constructor(e,t){this.type=Fe,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Ve),r=t.parse(e[2],2,Ve);return n&&r?et(n.type,[Fe,Oe,je,Le,Ve])?new tn(n,r):t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Je(n.type)," instead")):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!tt(t,["boolean","string","number","null"]))throw new Lt("Expected first argument to be of type boolean, string, number or null, but found ".concat(Je(Vt(t))," instead."));if(!tt(n,["string","array"]))throw new Lt("Expected second argument to be of type array or string, but found ".concat(Je(Vt(n))," instead."));return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class nn{constructor(e,t,n){this.type=je,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 2 or 3 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Ve),r=t.parse(e[2],2,Ve);if(!n||!r)return null;if(!et(n.type,[Fe,Oe,je,Le,Ve]))return t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Je(n.type)," instead"));if(4===e.length){const i=t.parse(e[3],3,je);return i?new nn(n,r,i):null}return new nn(n,r)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!tt(t,["boolean","string","number","null"]))throw new Lt("Expected first argument to be of type boolean, string, number or null, but found ".concat(Je(Vt(t))," instead."));let r;if(this.fromIndex&&(r=this.fromIndex.evaluate(e)),tt(n,["string"])){const e=n.indexOf(t,r);return-1===e?-1:[...n.slice(0,e)].length}if(tt(n,["array"]))return n.indexOf(t,r);throw new Lt("Expected second argument to be of type array or string, but found ".concat(Je(Vt(n))," instead."))}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class rn{constructor(e,t,n,r,i,o){this.inputType=e,this.type=t,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const i={},o=[];for(let l=2;l<e.length-1;l+=2){let a=e[l];const s=e[l+1];Array.isArray(a)||(a=[a]);const c=t.concat(l);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,Vt(e)))return null}else n=Vt(e);if(void 0!==i[String(e)])return c.error("Branch labels must be unique.");i[String(e)]=o.length}const u=t.parse(s,l,r);if(!u)return null;r=r||u.type,o.push(u)}const a=t.parse(e[1],1,Ve);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,r);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(n,a.type)?null:new rn(n,r,a,i,o,s):null}evaluate(e){const t=this.input.evaluate(e);return(Vt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class on{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r=[];for(let o=1;o<e.length-1;o+=2){const i=t.parse(e[o],o,Fe);if(!i)return null;const a=t.parse(e[o+1],o+1,n);if(!a)return null;r.push([i,a]),n=n||a.type}const i=t.parse(e[e.length-1],e.length-1,n);if(!i)return null;if(!n)throw new Error("Can't infer output type");return new on(n,r,i)}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(e=>{let[t,n]=e;return n.outputDefined()})&&this.otherwise.outputDefined()}}class an{constructor(e,t,n,r){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 2 or 3 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Ve),r=t.parse(e[2],2,je);if(!n||!r)return null;if(!et(n.type,[Ye(Ve),Oe,Ve]))return t.error("Expected first argument to be of type array or string, but found ".concat(Je(n.type)," instead"));if(4===e.length){const i=t.parse(e[3],3,je);return i?new an(n.type,n,r,i):null}return new an(n.type,n,r)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);let r;if(this.endIndex&&(r=this.endIndex.evaluate(e)),tt(t,["string"]))return[...t].slice(n,r).join("");if(tt(t,["array"]))return t.slice(n,r);throw new Lt("Expected first argument to be of type array or string, but found ".concat(Je(Vt(t))," instead."))}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function sn(e,t){const n=e.length-1;let r,i,o=0,a=n,s=0;for(;o<=a;)if(s=Math.floor((o+a)/2),r=e[s],i=e[s+1],r<=t){if(s===n||t<i)return s;o=s+1}else{if(!(r>t))throw new Lt("Input is not a number.");a=s-1}return 0}class ln{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[r,i]of n)this.labels.push(r),this.outputs.push(i)}static parse(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,je);if(!n)return null;const r=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let o=1;o<e.length;o+=2){const n=1===o?-1/0:e[o],a=e[o+1],s=o,l=o+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(a,l,i);if(!c)return null;i=i||c.type,r.push([n,c])}return new ln(i,n,r)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);const i=t.length;return r>=t[i-1]?n[i-1].evaluate(e):n[sn(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function cn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var un,hn,dn=function(){if(hn)return un;function e(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}return hn=1,un=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=i/o}var a=0,s=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?a=n:s=n,n=.5*(s-a)+a;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},un}(),pn=cn(dn);class fn{constructor(e,t,n,r,i){this.type=e,this.operator=t,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(const[o,a]of i)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,n,r){let i=0;if("exponential"===e.name)i=mn(t,e.base,n,r);else if("linear"===e.name)i=mn(t,1,n,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;i=new pn(o[0],o[1],o[2],o[3]).solve(mn(t,1,n,r))}return i}static parse(e,t){let[n,r,i,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error("Unknown interpolation type ".concat(String(r[0])),1,0);{const e=r.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,je),!i)return null;const a=[];let s=null;"interpolate-hcl"!==n&&"interpolate-lab"!==n||t.expectedType==We?t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType):s=Be;for(let l=0;l<o.length;l+=2){const e=o[l],n=o[l+1],r=l+3,i=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(a.length&&a[a.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(n,i,s);if(!c)return null;s=s||c.type,a.push([e,c])}return nt(s,je)||nt(s,Ne)||nt(s,Be)||nt(s,Ze)||nt(s,He)||nt(s,We)||nt(s,Ke)||nt(s,Ye(je))?new fn(s,n,r,i,a):t.error("Type ".concat(Je(s)," is not interpolatable."))}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);const i=t.length;if(r>=t[i-1])return n[i-1].evaluate(e);const o=sn(t,r),a=fn.interpolationFactor(this.interpolation,r,t[o],t[o+1]),s=n[o].evaluate(e),l=n[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Et(s,l,a);case"color":return Pt.interpolate(s,l,a);case"padding":return Rt.interpolate(s,l,a);case"colorArray":return zt.interpolate(s,l,a);case"numberArray":return Dt.interpolate(s,l,a);case"variableAnchorOffsetCollection":return Ot.interpolate(s,l,a);case"array":return kt(s,l,a);case"projectionDefinition":return Bt.interpolate(s,l,a)}case"interpolate-hcl":switch(this.type.kind){case"color":return Pt.interpolate(s,l,a,"hcl");case"colorArray":return zt.interpolate(s,l,a,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Pt.interpolate(s,l,a,"lab");case"colorArray":return zt.interpolate(s,l,a,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function mn(e,t,n,r){const i=r-n,o=e-n;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}const gn={color:Pt.interpolate,number:Et,padding:Rt.interpolate,numberArray:Dt.interpolate,colorArray:zt.interpolate,variableAnchorOffsetCollection:Ot.interpolate,array:kt};class _n{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=null;const r=t.expectedType;r&&"value"!==r.kind&&(n=r);const i=[];for(const a of e.slice(1)){const e=t.parse(a,1+i.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,i.push(e)}if(!n)throw new Error("No output type");const o=r&&i.some(e=>$e(r,e.type));return new _n(o?Ve:n,i)}evaluate(e){let t,n=null,r=0;for(const i of this.args)if(r++,n=i.evaluate(e),n&&n instanceof Ft&&!n.available&&(t||(t=n.name),n=null,r===this.args.length&&(n=t)),null!==n)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function yn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function vn(e,t,n,r){return 0===r.compare(t,n)}function bn(e,t,n){const r="=="!==e&&"!="!==e;return class i{constructor(e,t,n){this.type=Fe,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,Ve);if(!o)return null;if(!yn(n,o.type))return t.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Je(o.type),"'."));let a=t.parse(e[2],2,Ve);if(!a)return null;if(!yn(n,a.type))return t.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Je(a.type),"'."));if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot compare types '".concat(Je(o.type),"' and '").concat(Je(a.type),"'."));r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Wt(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Wt(o.type,[a])));let s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,Ge),!s)return null}return new i(o,a,s)}evaluate(i){const o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const t=Vt(o),n=Vt(a);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new Lt('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(t.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!r&&this.hasUntypedArgument){const e=Vt(o),n=Vt(a);if("string"!==e.kind||"string"!==n.kind)return t(i,o,a)}return this.collator?n(i,o,a,this.collator.evaluate(i)):t(i,o,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}const xn=bn("==",function(e,t,n){return t===n},vn),wn=bn("!=",function(e,t,n){return t!==n},function(e,t,n,r){return!vn(0,t,n,r)}),Sn=bn("<",function(e,t,n){return t<n},function(e,t,n,r){return r.compare(t,n)<0}),Tn=bn(">",function(e,t,n){return t>n},function(e,t,n,r){return r.compare(t,n)>0}),En=bn("<=",function(e,t,n){return t<=n},function(e,t,n,r){return r.compare(t,n)<=0}),kn=bn(">=",function(e,t,n){return t>=n},function(e,t,n,r){return r.compare(t,n)>=0});class Pn{constructor(e,t,n){this.type=Ge,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Fe);if(!r)return null;const i=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Fe);if(!i)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,Oe),!o)?null:new Pn(r,i,o)}evaluate(e){return new Ct(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Cn{constructor(e,t,n,r,i){this.type=Oe,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,je);if(!n)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=t.parse(r.locale,1,Oe),!i))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,Oe),!o))return null;let a=null;if(r["min-fraction-digits"]&&(a=t.parse(r["min-fraction-digits"],1,je),!a))return null;let s=null;return r["max-fraction-digits"]&&(s=t.parse(r["max-fraction-digits"],1,je),!s)?null:new Cn(n,i,o,a,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class In{constructor(e){this.type=qe,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const r=[];let i=!1;for(let o=1;o<=e.length-1;++o){const n=e[o];if(i&&"object"==typeof n&&!Array.isArray(n)){i=!1;let e=null;if(n["font-scale"]&&(e=t.parse(n["font-scale"],1,je),!e))return null;let o=null;if(n["text-font"]&&(o=t.parse(n["text-font"],1,Ye(Oe)),!o))return null;let a=null;if(n["text-color"]&&(a=t.parse(n["text-color"],1,Be),!a))return null;let s=null;if(n["vertical-align"]){if("string"==typeof n["vertical-align"]&&!It.includes(n["vertical-align"]))return t.error("'vertical-align' must be one of: 'bottom', 'center', 'top' but found '".concat(n["vertical-align"],"' instead."));if(s=t.parse(n["vertical-align"],1,Oe),!s)return null}const l=r[r.length-1];l.scale=e,l.font=o,l.textColor=a,l.verticalAlign=s}else{const n=t.parse(e[o],1,Ve);if(!n)return null;const a=n.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:n,scale:null,font:null,textColor:null,verticalAlign:null})}}return new In(r)}evaluate(e){return new Mt(this.sections.map(t=>{const n=t.content.evaluate(e);return Vt(n)===Xe?new At("",n,null,null,null,t.verticalAlign?t.verticalAlign.evaluate(e):null):new At(Gt(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null,t.verticalAlign?t.verticalAlign.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class An{constructor(e){this.type=Xe,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,Oe);return n?new An(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=Ft.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class Mn{constructor(e){this.type=je,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error("Expected argument of type string or array, but found ".concat(Je(n.type)," instead.")):new Mn(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return[...t].length;if(Array.isArray(t))return t.length;throw new Lt("Expected value to be of type string or array, but found ".concat(Je(Vt(t))," instead."))}eachChild(e){e(this.input)}outputDefined(){return!1}}const Rn=8192;function Dn(e,t){const n=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(n*i*Rn),Math.round(r*i*Rn)]}function zn(e,t){const n=Math.pow(2,t.z);return[(i=(e[0]/Rn+t.x)/n,360*i-180),(r=(e[1]/Rn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,i}function Ln(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function jn(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function On(e,t,n){const r=e[0]-t[0],i=e[1]-t[1],o=e[0]-n[0],a=e[1]-n[1];return r*a-o*i==0&&r*o<=0&&i*a<=0}function Fn(e,t,n,r){return 0!=(i=[r[0]-n[0],r[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-i[1]*o[0]&&!(!qn(e,t,n,r)||!qn(n,r,e,t));var i,o}function Bn(e,t,n){for(const r of n)for(let n=0;n<r.length-1;++n)if(Fn(e,t,r[n],r[n+1]))return!0;return!1}function Nn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!1;for(const s of t)for(let t=0;t<s.length-1;t++){if(On(e,s[t],s[t+1]))return n;(o=s[t])[1]>(i=e)[1]!=(a=s[t+1])[1]>i[1]&&i[0]<(a[0]-o[0])*(i[1]-o[1])/(a[1]-o[1])+o[0]&&(r=!r)}var i,o,a;return r}function Un(e,t){for(const n of t)if(Nn(e,n))return!0;return!1}function Vn(e,t){for(const n of e)if(!Nn(n,t))return!1;for(let n=0;n<e.length-1;++n)if(Bn(e[n],e[n+1],t))return!1;return!0}function Gn(e,t){for(const n of t)if(Vn(e,n))return!0;return!1}function qn(e,t,n,r){const i=r[0]-n[0],o=r[1]-n[1],a=(e[0]-n[0])*o-i*(e[1]-n[1]),s=(t[0]-n[0])*o-i*(t[1]-n[1]);return a>0&&s<0||a<0&&s>0}function Zn(e,t,n){const r=[];for(let i=0;i<e.length;i++){const o=[];for(let r=0;r<e[i].length;r++){const a=Dn(e[i][r],n);Ln(t,a),o.push(a)}r.push(o)}return r}function Wn(e,t,n){const r=[];for(let i=0;i<e.length;i++){const o=Zn(e[i],t,n);r.push(o)}return r}function Hn(e,t,n,r){if(e[0]<n[0]||e[0]>n[2]){const t=.5*r;let i=e[0]-n[0]>t?-r:n[0]-e[0]>t?r:0;0===i&&(i=e[0]-n[2]>t?-r:n[2]-e[0]>t?r:0),e[0]+=i}Ln(t,e)}function Xn(e,t,n,r){const i=Math.pow(2,r.z)*Rn,o=[r.x*Rn,r.y*Rn],a=[];for(const s of e)for(const e of s){const r=[e.x+o[0],e.y+o[1]];Hn(r,t,n,i),a.push(r)}return a}function Kn(e,t,n,r){const i=Math.pow(2,r.z)*Rn,o=[r.x*Rn,r.y*Rn],a=[];for(const l of e){const e=[];for(const n of l){const r=[n.x+o[0],n.y+o[1]];Ln(t,r),e.push(r)}a.push(e)}if(t[2]-t[0]<=i/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of a)for(const r of e)Hn(r,t,n,i)}var s;return a}class Yn{constructor(e,t){this.type=Fe,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(Ut(e[1])){const t=e[1];if("FeatureCollection"===t.type){const e=[];for(const n of t.features){const{type:t,coordinates:r}=n.geometry;"Polygon"===t&&e.push(r),"MultiPolygon"===t&&e.push(...r)}if(e.length)return new Yn(t,{type:"MultiPolygon",coordinates:e})}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Yn(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Yn(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){const o=Zn(t.coordinates,r,i),a=Xn(e.geometry(),n,r,i);if(!jn(n,r))return!1;for(const e of a)if(!Nn(e,o))return!1}if("MultiPolygon"===t.type){const o=Wn(t.coordinates,r,i),a=Xn(e.geometry(),n,r,i);if(!jn(n,r))return!1;for(const e of a)if(!Un(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){const o=Zn(t.coordinates,r,i),a=Kn(e.geometry(),n,r,i);if(!jn(n,r))return!1;for(const e of a)if(!Vn(e,o))return!1}if("MultiPolygon"===t.type){const o=Wn(t.coordinates,r,i),a=Kn(e.geometry(),n,r,i);if(!jn(n,r))return!1;for(const e of a)if(!Gn(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Jn=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,r=t[e];for(;e>0;){const i=e-1>>1,o=t[i];if(n(r,o)>=0)break;t[e]=o,e=i}t[e]=r}_down(e){const{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;e<r;){let r=1+(e<<1);const o=r+1;if(o<this.length&&n(t[o],t[r])<0&&(r=o),n(t[r],i)>=0)break;t[e]=t[r],e=r}t[e]=i}};function Qn(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:er;for(;r>n;){if(r-n>600){const o=r-n+1,a=t-n+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);Qn(e,t,Math.max(n,Math.floor(t-a*l/o+c)),Math.min(r,Math.floor(t+(o-a)*l/o+c)),i)}const o=e[t];let a=n,s=r;for($n(e,n,t),i(e[r],o)>0&&$n(e,n,r);a<s;){for($n(e,a,s),a++,s--;i(e[a],o)<0;)a++;for(;i(e[s],o)>0;)s--}0===i(e[n],o)?$n(e,n,s):(s++,$n(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}}function $n(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function er(e,t){return e<t?-1:e>t?1:0}function tr(e,t){if(e.length<=1)return[e];const n=[];let r,i;for(const o of e){const e=rr(o);0!==e&&(o.area=Math.abs(e),void 0===i&&(i=e<0),i===e<0?(r&&n.push(r),r=[o]):r.push(o))}if(r&&n.push(r),t>1)for(let o=0;o<n.length;o++)n[o].length<=t||(Qn(n[o],t,1,n[o].length-1,nr),n[o]=n[o].slice(0,t));return n}function nr(e,t){return t.area-e.area}function rr(e){let t=0;for(let n,r,i=0,o=e.length,a=o-1;i<o;a=i++)n=e[i],r=e[a],t+=(r.x-n.x)*(n.y+r.y);return t}const ir=1/298.257223563,or=ir*(2-ir),ar=Math.PI/180;class sr{constructor(e){const t=6378.137*ar*1e3,n=Math.cos(e*ar),r=1/(1-or*(1-n*n)),i=Math.sqrt(r);this.kx=t*i*n,this.ky=t*i*r*(1-or)}distance(e,t){const n=this.wrap(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+r*r)}pointOnLine(e,t){let n,r,i,o,a=1/0;for(let s=0;s<e.length-1;s++){let l=e[s][0],c=e[s][1],u=this.wrap(e[s+1][0]-l)*this.kx,h=(e[s+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[s+1][0],c=e[s+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const p=u*u+h*h;p<a&&(a=p,n=l,r=c,i=s,o=d)}return{point:[n,r],index:i,t:Math.max(0,Math.min(1,o))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function lr(e,t){return t[0]-e[0]}function cr(e){return e[1]-e[0]+1}function ur(e,t){return e[1]>=e[0]&&e[1]<t}function hr(e,t){if(e[0]>e[1])return[null,null];const n=cr(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}if(1===n)return[e,null];const r=Math.floor(n/2)-1;return[[e[0],e[0]+r],[e[0]+r+1,e[1]]]}function dr(e,t){if(!ur(t,e.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let r=t[0];r<=t[1];++r)Ln(n,e[r]);return n}function pr(e){const t=[1/0,1/0,-1/0,-1/0];for(const n of e)for(const e of n)Ln(t,e);return t}function fr(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function mr(e,t,n){if(!fr(e)||!fr(t))return NaN;let r=0,i=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),n.distance([0,0],[r,i])}function gr(e,t,n){const r=n.pointOnLine(t,e);return n.distance(e,r.point)}function _r(e,t,n,r,i){const o=Math.min(gr(e,[n,r],i),gr(t,[n,r],i)),a=Math.min(gr(n,[e,t],i),gr(r,[e,t],i));return Math.min(o,a)}function yr(e,t,n,r,i){if(!ur(t,e.length)||!ur(r,n.length))return 1/0;let o=1/0;for(let a=t[0];a<t[1];++a){const t=e[a],s=e[a+1];for(let e=r[0];e<r[1];++e){const r=n[e],a=n[e+1];if(Fn(t,s,r,a))return 0;o=Math.min(o,_r(t,s,r,a,i))}}return o}function vr(e,t,n,r,i){if(!ur(t,e.length)||!ur(r,n.length))return NaN;let o=1/0;for(let a=t[0];a<=t[1];++a)for(let t=r[0];t<=r[1];++t)if(o=Math.min(o,i.distance(e[a],n[t])),0===o)return o;return o}function br(e,t,n){if(Nn(e,t,!0))return 0;let r=1/0;for(const i of t){const t=i[0],o=i[i.length-1];if(t!==o&&(r=Math.min(r,gr(e,[o,t],n)),0===r))return r;const a=n.pointOnLine(i,e);if(r=Math.min(r,n.distance(e,a.point)),0===r)return r}return r}function xr(e,t,n,r){if(!ur(t,e.length))return NaN;for(let o=t[0];o<=t[1];++o)if(Nn(e[o],n,!0))return 0;let i=1/0;for(let o=t[0];o<t[1];++o){const t=e[o],a=e[o+1];for(const e of n)for(let n=0,o=e.length,s=o-1;n<o;s=n++){const o=e[s],l=e[n];if(Fn(t,a,o,l))return 0;i=Math.min(i,_r(t,a,o,l,r))}}return i}function wr(e,t){for(const n of e)for(const e of n)if(Nn(e,t,!0))return!0;return!1}function Sr(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const i=pr(e),o=pr(t);if(r!==1/0&&mr(i,o,n)>=r)return r;if(jn(i,o)){if(wr(e,t))return 0}else if(wr(t,e))return 0;let a=1/0;for(const s of e)for(let e=0,r=s.length,i=r-1;e<r;i=e++){const r=s[i],o=s[e];for(const e of t)for(let t=0,i=e.length,s=i-1;t<i;s=t++){const i=e[s],l=e[t];if(Fn(r,o,i,l))return 0;a=Math.min(a,_r(r,o,i,l,n))}}return a}function Tr(e,t,n,r,i,o){if(!o)return;const a=mr(dr(r,o),i,n);a<t&&e.push([a,o,[0,0]])}function Er(e,t,n,r,i,o,a){if(!o||!a)return;const s=mr(dr(r,o),dr(i,a),n);s<t&&e.push([s,o,a])}function kr(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=Math.min(r.distance(e[0],n[0][0]),i);if(0===o)return o;const a=new Jn([[0,[0,e.length-1],[0,0]]],lr),s=pr(n);for(;a.length>0;){const i=a.pop();if(i[0]>=o)continue;const l=i[1],c=t?50:100;if(cr(l)<=c){if(!ur(l,e.length))return NaN;if(t){const t=xr(e,l,n,r);if(isNaN(t)||0===t)return t;o=Math.min(o,t)}else for(let t=l[0];t<=l[1];++t){const i=br(e[t],n,r);if(o=Math.min(o,i),0===o)return 0}}else{const n=hr(l,t);Tr(a,o,r,e,s,n[0]),Tr(a,o,r,e,s,n[1])}}return o}function Pr(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,a=Math.min(o,i.distance(e[0],n[0]));if(0===a)return a;const s=new Jn([[0,[0,e.length-1],[0,n.length-1]]],lr);for(;s.length>0;){const o=s.pop();if(o[0]>=a)continue;const l=o[1],c=o[2],u=t?50:100,h=r?50:100;if(cr(l)<=u&&cr(c)<=h){if(!ur(l,e.length)&&ur(c,n.length))return NaN;let o;if(t&&r)o=yr(e,l,n,c,i),a=Math.min(a,o);else if(t&&!r){const t=e.slice(l[0],l[1]+1);for(let e=c[0];e<=c[1];++e)if(o=gr(n[e],t,i),a=Math.min(a,o),0===a)return a}else if(!t&&r){const t=n.slice(c[0],c[1]+1);for(let n=l[0];n<=l[1];++n)if(o=gr(e[n],t,i),a=Math.min(a,o),0===a)return a}else o=vr(e,l,n,c,i),a=Math.min(a,o)}else{const o=hr(l,t),u=hr(c,r);Er(s,a,i,e,n,o[0],u[0]),Er(s,a,i,e,n,o[0],u[1]),Er(s,a,i,e,n,o[1],u[0]),Er(s,a,i,e,n,o[1],u[1])}}return a}function Cr(e){return"MultiPolygon"===e.type?e.coordinates.map(e=>({type:"Polygon",coordinates:e})):"MultiLineString"===e.type?e.coordinates.map(e=>({type:"LineString",coordinates:e})):"MultiPoint"===e.type?e.coordinates.map(e=>({type:"Point",coordinates:e})):[e]}class Ir{constructor(e,t){this.type=je,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'distance' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(Ut(e[1])){const t=e[1];if("FeatureCollection"===t.type)return new Ir(t,t.features.map(e=>Cr(e.geometry)).flat());if("Feature"===t.type)return new Ir(t,Cr(t.geometry));if("type"in t&&"coordinates"in t)return new Ir(t,Cr(t))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=e.geometry(),r=n.flat().map(t=>zn([t.x,t.y],e.canonical));if(0===n.length)return NaN;const i=new sr(r[0][1]);let o=1/0;for(const a of t){switch(a.type){case"Point":o=Math.min(o,Pr(r,!1,[a.coordinates],!1,i,o));break;case"LineString":o=Math.min(o,Pr(r,!1,a.coordinates,!0,i,o));break;case"Polygon":o=Math.min(o,kr(r,!1,a.coordinates,i,o))}if(0===o)return o}return o}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=e.geometry(),r=n.flat().map(t=>zn([t.x,t.y],e.canonical));if(0===n.length)return NaN;const i=new sr(r[0][1]);let o=1/0;for(const a of t){switch(a.type){case"Point":o=Math.min(o,Pr(r,!0,[a.coordinates],!1,i,o));break;case"LineString":o=Math.min(o,Pr(r,!0,a.coordinates,!0,i,o));break;case"Polygon":o=Math.min(o,kr(r,!0,a.coordinates,i,o))}if(0===o)return o}return o}(e,this.geometries);if("Polygon"===e.geometryType())return function(e,t){const n=e.geometry();if(0===n.length||0===n[0].length)return NaN;const r=tr(n,0).map(t=>t.map(t=>t.map(t=>zn([t.x,t.y],e.canonical)))),i=new sr(r[0][0][0][1]);let o=1/0;for(const a of t)for(const e of r){switch(a.type){case"Point":o=Math.min(o,kr([a.coordinates],!1,e,i,o));break;case"LineString":o=Math.min(o,kr(a.coordinates,!0,e,i,o));break;case"Polygon":o=Math.min(o,Sr(e,a.coordinates,i,o))}if(0===o)return o}return o}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ar{constructor(e){this.type=Ve,this.key=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const n=e[1];return null==n?t.error("Global state property must be defined."):"string"!=typeof n?t.error("Global state property must be string, but found ".concat(typeof e[1]," instead.")):new Ar(n)}evaluate(e){var t;const n=null===(t=e.globals)||void 0===t?void 0:t.globalState;return n&&0!==Object.keys(n).length?vt(n,this.key):null}eachChild(){}outputDefined(){return!1}}const Mr={"==":xn,"!=":wn,">":Tn,"<":Sn,">=":kn,"<=":En,array:Wt,at:en,boolean:Wt,case:on,coalesce:_n,collator:Pn,format:In,image:An,in:tn,"index-of":nn,interpolate:fn,"interpolate-hcl":fn,"interpolate-lab":fn,length:Mn,let:Qt,literal:qt,match:rn,number:Wt,"number-format":Cn,object:Wt,slice:an,step:ln,string:Wt,"to-boolean":Xt,"to-color":Xt,"to-number":Xt,"to-string":Xt,var:$t,within:Yn,distance:Ir,"global-state":Ar};class Rr{constructor(e,t,n,r){this.name=e,this.type=t,this._evaluate=n,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const n=e[0],r=Rr.definitions[n];if(!r)return t.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const i=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,a=o.filter(t=>{let[n]=t;return!Array.isArray(n)||n.length===e.length-1});let s=null;for(const[l,c]of a){s=new Jt(t.registry,Or,t.path,null,t.scope);const r=[];let o=!1;for(let t=1;t<e.length;t++){const n=e[t],i=Array.isArray(l)?l[t-1]:l.type,a=s.parse(n,1+r.length,i);if(!a){o=!0;break}r.push(a)}if(!o)if(Array.isArray(l)&&l.length!==r.length)s.error("Expected ".concat(l.length," arguments, but found ").concat(r.length," instead."));else{for(let e=0;e<r.length;e++){const t=Array.isArray(l)?l[e]:l.type,n=r[e];s.concat(e+1).checkSubtype(t,n.type)}if(0===s.errors.length)return new Rr(n,i,c,r)}}if(1===a.length)t.errors.push(...s.errors);else{const n=(a.length?a:o).map(e=>{let[t]=e;return n=t,Array.isArray(n)?"(".concat(n.map(Je).join(", "),")"):"(".concat(Je(n.type),"...)");var n}).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(Je(n.type))}t.error("Expected arguments of type ".concat(n,", but found (").concat(r.join(", "),") instead."))}return null}static register(e,t){Rr.definitions=t;for(const n in t)e[n]=Rr}}function Dr(e,t){let[n,r,i,o]=t;n=n.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);const a=o?o.evaluate(e):1,s=Nt(n,r,i,a);if(s)throw new Lt(s);return new Pt(n/255,r/255,i/255,a,!1)}function zr(e,t){return e in t}function Lr(e,t){const n=t[e];return void 0===n?null:n}function jr(e){return{type:e}}function Or(e){if(e instanceof $t)return Or(e.boundExpression);if(e instanceof Rr&&"error"===e.name)return!1;if(e instanceof Pn)return!1;if(e instanceof Yn)return!1;if(e instanceof Ir)return!1;if(e instanceof Ar)return!1;const t=e instanceof Xt||e instanceof Wt;let n=!0;return e.eachChild(e=>{n=t?n&&Or(e):n&&e instanceof qt}),!!n&&Fr(e)&&Nr(e,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Fr(e){if(e instanceof Rr){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Yn)return!1;if(e instanceof Ir)return!1;let t=!0;return e.eachChild(e=>{t&&!Fr(e)&&(t=!1)}),t}function Br(e){if(e instanceof Rr&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!Br(e)&&(t=!1)}),t}function Nr(e,t){if(e instanceof Rr&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(e=>{n&&!Nr(e,t)&&(n=!1)}),n}function Ur(e){return{result:"success",value:e}}function Vr(e){return{result:"error",value:e}}function Gr(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function qr(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Zr(e){return!!e.expression&&e.expression.interpolated}function Wr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Hr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&Vt(e)===Ue}function Xr(e){return e}function Kr(e,t){const n=e.stops&&"object"==typeof e.stops[0][0],r=n||!(n||void 0!==e.property),i=e.type||(Zr(t)?"exponential":"interval"),o=function(e){switch(e.type){case"color":return Pt.parse;case"padding":return Rt.parse;case"numberArray":return Dt.parse;case"colorArray":return zt.parse;default:return null}}(t);if(o&&((e=Re({},e)).stops&&(e.stops=e.stops.map(e=>[e[0],o(e[1])])),e.default=o(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==(a=e.colorSpace)&&"hcl"!==a&&"lab"!==a)throw new Error('Unknown color space: "'.concat(e.colorSpace,'"'));var a;const s=function(e){switch(e){case"exponential":return $r;case"interval":return Qr;case"categorical":return Jr;case"identity":return ei;default:throw new Error('Unknown function type "'.concat(e,'"'))}}(i);let l,c;if("categorical"===i){l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];c=typeof e.stops[0][0]}if(n){const n={},r=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],o=i[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},r.push(o)),n[o].stops.push([i[0].value,i[1]])}const i=[];for(const e of r)i.push([n[e].zoom,Kr(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:fn.interpolationFactor.bind(void 0,o),zoomStops:i.map(e=>e[0]),evaluate:(n,r)=>{let{zoom:o}=n;return $r({stops:i,base:e.base},t,o).evaluate(o,r)}}}if(r){const n="exponential"===i?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:fn.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map(e=>e[0]),evaluate:n=>{let{zoom:r}=n;return s(e,t,r,l,c)}}}return{kind:"source",evaluate(n,r){const i=r&&r.properties?r.properties[e.property]:void 0;return void 0===i?Yr(e.default,t.default):s(e,t,i,l,c)}}}function Yr(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function Jr(e,t,n,r,i){return Yr(typeof n===i?r[n]:void 0,e.default,t.default)}function Qr(e,t,n){if("number"!==Wr(n))return Yr(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const i=sn(e.stops.map(e=>e[0]),n);return e.stops[i][1]}function $r(e,t,n){const r=void 0!==e.base?e.base:1;if("number"!==Wr(n))return Yr(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const o=sn(e.stops.map(e=>e[0]),n),a=function(e,t,n,r){const i=r-n,o=e-n;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}(n,r,e.stops[o][0],e.stops[o+1][0]),s=e.stops[o][1],l=e.stops[o+1][1],c=gn[t.type]||Xr;return"function"==typeof s.evaluate?{evaluate(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];const i=s.evaluate.apply(void 0,n),o=l.evaluate.apply(void 0,n);if(void 0!==i&&void 0!==o)return c(i,o,a,e.colorSpace)}}:c(s,l,a,e.colorSpace)}function ei(e,t,n){switch(t.type){case"color":n=Pt.parse(n);break;case"formatted":n=Mt.fromString(n.toString());break;case"resolvedImage":n=Ft.fromString(n.toString());break;case"padding":n=Rt.parse(n);break;case"colorArray":n=zt.parse(n);break;case"numberArray":n=Dt.parse(n);break;default:Wr(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0)}return Yr(n,e.default,t.default)}Rr.register(Mr,{error:[{kind:"error"},[Oe],(e,t)=>{let[n]=t;throw new Lt(n.evaluate(e))}],typeof:[Oe,[Ve],(e,t)=>{let[n]=t;return Je(Vt(n.evaluate(e)))}],"to-rgba":[Ye(je,4),[Be],(e,t)=>{let[n]=t;const[r,i,o,a]=n.evaluate(e).rgb;return[255*r,255*i,255*o,a]}],rgb:[Be,[je,je,je],Dr],rgba:[Be,[je,je,je,je],Dr],has:{type:Fe,overloads:[[[Oe],(e,t)=>{let[n]=t;return zr(n.evaluate(e),e.properties())}],[[Oe,Ue],(e,t)=>{let[n,r]=t;return zr(n.evaluate(e),r.evaluate(e))}]]},get:{type:Ve,overloads:[[[Oe],(e,t)=>{let[n]=t;return Lr(n.evaluate(e),e.properties())}],[[Oe,Ue],(e,t)=>{let[n,r]=t;return Lr(n.evaluate(e),r.evaluate(e))}]]},"feature-state":[Ve,[Oe],(e,t)=>{let[n]=t;return Lr(n.evaluate(e),e.featureState||{})}],properties:[Ue,[],e=>e.properties()],"geometry-type":[Oe,[],e=>e.geometryType()],id:[Ve,[],e=>e.id()],zoom:[je,[],e=>e.globals.zoom],"heatmap-density":[je,[],e=>e.globals.heatmapDensity||0],elevation:[je,[],e=>e.globals.elevation||0],"line-progress":[je,[],e=>e.globals.lineProgress||0],accumulated:[Ve,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[je,jr(je),(e,t)=>{let n=0;for(const r of t)n+=r.evaluate(e);return n}],"*":[je,jr(je),(e,t)=>{let n=1;for(const r of t)n*=r.evaluate(e);return n}],"-":{type:je,overloads:[[[je,je],(e,t)=>{let[n,r]=t;return n.evaluate(e)-r.evaluate(e)}],[[je],(e,t)=>{let[n]=t;return-n.evaluate(e)}]]},"/":[je,[je,je],(e,t)=>{let[n,r]=t;return n.evaluate(e)/r.evaluate(e)}],"%":[je,[je,je],(e,t)=>{let[n,r]=t;return n.evaluate(e)%r.evaluate(e)}],ln2:[je,[],()=>Math.LN2],pi:[je,[],()=>Math.PI],e:[je,[],()=>Math.E],"^":[je,[je,je],(e,t)=>{let[n,r]=t;return Math.pow(n.evaluate(e),r.evaluate(e))}],sqrt:[je,[je],(e,t)=>{let[n]=t;return Math.sqrt(n.evaluate(e))}],log10:[je,[je],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN10}],ln:[je,[je],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))}],log2:[je,[je],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN2}],sin:[je,[je],(e,t)=>{let[n]=t;return Math.sin(n.evaluate(e))}],cos:[je,[je],(e,t)=>{let[n]=t;return Math.cos(n.evaluate(e))}],tan:[je,[je],(e,t)=>{let[n]=t;return Math.tan(n.evaluate(e))}],asin:[je,[je],(e,t)=>{let[n]=t;return Math.asin(n.evaluate(e))}],acos:[je,[je],(e,t)=>{let[n]=t;return Math.acos(n.evaluate(e))}],atan:[je,[je],(e,t)=>{let[n]=t;return Math.atan(n.evaluate(e))}],min:[je,jr(je),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[je,jr(je),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[je,[je],(e,t)=>{let[n]=t;return Math.abs(n.evaluate(e))}],round:[je,[je],(e,t)=>{let[n]=t;const r=n.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[je,[je],(e,t)=>{let[n]=t;return Math.floor(n.evaluate(e))}],ceil:[je,[je],(e,t)=>{let[n]=t;return Math.ceil(n.evaluate(e))}],"filter-==":[Fe,[Oe,Ve],(e,t)=>{let[n,r]=t;return e.properties()[n.value]===r.value}],"filter-id-==":[Fe,[Ve],(e,t)=>{let[n]=t;return e.id()===n.value}],"filter-type-==":[Fe,[Oe],(e,t)=>{let[n]=t;return e.geometryType()===n.value}],"filter-<":[Fe,[Oe,Ve],(e,t)=>{let[n,r]=t;const i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i<o}],"filter-id-<":[Fe,[Ve],(e,t)=>{let[n]=t;const r=e.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[Fe,[Oe,Ve],(e,t)=>{let[n,r]=t;const i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i>o}],"filter-id->":[Fe,[Ve],(e,t)=>{let[n]=t;const r=e.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[Fe,[Oe,Ve],(e,t)=>{let[n,r]=t;const i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[Fe,[Ve],(e,t)=>{let[n]=t;const r=e.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[Fe,[Oe,Ve],(e,t)=>{let[n,r]=t;const i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[Fe,[Ve],(e,t)=>{let[n]=t;const r=e.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[Fe,[Ve],(e,t)=>{let[n]=t;return n.value in e.properties()}],"filter-has-id":[Fe,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Fe,[Ye(Oe)],(e,t)=>{let[n]=t;return n.value.indexOf(e.geometryType())>=0}],"filter-id-in":[Fe,[Ye(Ve)],(e,t)=>{let[n]=t;return n.value.indexOf(e.id())>=0}],"filter-in-small":[Fe,[Oe,Ye(Ve)],(e,t)=>{let[n,r]=t;return r.value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[Fe,[Oe,Ye(Ve)],(e,t)=>{let[n,r]=t;return function(e,t,n,r){for(;n<=r;){const i=n+r>>1;if(t[i]===e)return!0;t[i]>e?r=i-1:n=i+1}return!1}(e.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:Fe,overloads:[[[Fe,Fe],(e,t)=>{let[n,r]=t;return n.evaluate(e)&&r.evaluate(e)}],[jr(Fe),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Fe,overloads:[[[Fe,Fe],(e,t)=>{let[n,r]=t;return n.evaluate(e)||r.evaluate(e)}],[jr(Fe),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Fe,[Fe],(e,t)=>{let[n]=t;return!n.evaluate(e)}],"is-supported-script":[Fe,[Oe],(e,t)=>{let[n]=t;const r=e.globals&&e.globals.isSupportedScript;return!r||r(n.evaluate(e))}],upcase:[Oe,[Oe],(e,t)=>{let[n]=t;return n.evaluate(e).toUpperCase()}],downcase:[Oe,[Oe],(e,t)=>{let[n]=t;return n.evaluate(e).toLowerCase()}],concat:[Oe,jr(Ve),(e,t)=>t.map(t=>Gt(t.evaluate(e))).join("")],"resolved-locale":[Oe,[Ge],(e,t)=>{let[n]=t;return n.evaluate(e).resolvedLocale()}]});class ti{constructor(e,t,n){this.expression=e,this._warningHistory={},this._evaluator=new Yt,this._defaultValue=t?function(e){if("color"===e.type&&Hr(e.default))return new Pt(0,0,0,0);switch(e.type){case"color":return Pt.parse(e.default)||null;case"padding":return Rt.parse(e.default)||null;case"numberArray":return Dt.parse(e.default)||null;case"colorArray":return zt.parse(e.default)||null;case"variableAnchorOffsetCollection":return Ot.parse(e.default)||null;case"projectionDefinition":return Bt.parse(e.default)||null;default:return void 0===e.default?null:e.default}}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null,this._globalState=n}evaluateWithoutErrorHandling(e,t,n,r,i,o){return this._globalState&&(e=ui(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,r,i,o){this._globalState&&(e=ui(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Lt("Expected value to be one of ".concat(Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", "),", but found ").concat(JSON.stringify(e)," instead."));return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function ni(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Mr}function ri(e,t,n){const r=new Jt(Mr,Or,[],t?function(e){const t={color:Be,string:Oe,number:je,enum:Oe,boolean:Fe,formatted:qe,padding:Ze,numberArray:He,colorArray:We,projectionDefinition:Ne,resolvedImage:Xe,variableAnchorOffsetCollection:Ke};return"array"===e.type?Ye(t[e.value]||Ve,e.length):t[e.type]}(t):void 0),i=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?Ur(new ti(i,t,n)):Vr(r.errors)}class ii{constructor(e,t,n){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Br(t.expression),this.globalStateRefs=ci(t.expression),this._globalState=n}evaluateWithoutErrorHandling(e,t,n,r,i,o){return this._globalState&&(e=ui(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,o)}evaluate(e,t,n,r,i,o){return this._globalState&&(e=ui(e,this._globalState)),this._styleExpression.evaluate(e,t,n,r,i,o)}}class oi{constructor(e,t,n,r,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Br(t.expression),this.globalStateRefs=ci(t.expression),this.interpolationType=r,this._globalState=i}evaluateWithoutErrorHandling(e,t,n,r,i,o){return this._globalState&&(e=ui(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,o)}evaluate(e,t,n,r,i,o){return this._globalState&&(e=ui(e,this._globalState)),this._styleExpression.evaluate(e,t,n,r,i,o)}interpolationFactor(e,t,n){return this.interpolationType?fn.interpolationFactor(this.interpolationType,e,t,n):0}}function ai(e,t,n){const r=ri(e,t,n);if("error"===r.result)return r;const i=r.value.expression,o=Fr(i);if(!o&&!Gr(t))return Vr([new De("","data expressions not supported")]);const a=Nr(i,["zoom"]);if(!a&&!qr(t))return Vr([new De("","zoom expressions not supported")]);const s=li(i);return s||a?s instanceof De?Vr([s]):s instanceof fn&&!Zr(t)?Vr([new De("",'"interpolate" expressions cannot be used with this property')]):Ur(s?new oi(o?"camera":"composite",r.value,s.labels,s instanceof fn?s.interpolation:void 0,n):new ii(o?"constant":"source",r.value,n)):Vr([new De("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class si{constructor(e,t){this._parameters=e,this._specification=t,Re(this,Kr(this._parameters,this._specification))}static deserialize(e){return new si(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function li(e){let t=null;if(e instanceof Qt)t=li(e.result);else if(e instanceof _n){for(const n of e.args)if(t=li(n),t)break}else(e instanceof ln||e instanceof fn)&&e.input instanceof Rr&&"zoom"===e.input.name&&(t=e);return t instanceof De||e.eachChild(e=>{const n=li(e);n instanceof De?t=n:!t&&n?t=new De("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new De("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ci(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return e instanceof Ar&&t.add(e.key),e.eachChild(e=>{ci(e,t)}),t}function ui(e,t){const{zoom:n,heatmapDensity:r,elevation:i,lineProgress:o,isSupportedScript:a,accumulated:s}=null!=e?e:{};return{zoom:n,heatmapDensity:r,elevation:i,lineProgress:o,isSupportedScript:a,accumulated:s,globalState:t}}function hi(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!hi(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const di={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function pi(e,t){if(null==e)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};hi(e)||(e=gi(e));const n=ri(e,di,t);if("error"===n.result)throw new Error(n.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));return{filter:(e,t,r)=>n.value.evaluate(e,t,{},r),needGeometry:mi(e),getGlobalStateRefs:()=>ci(n.value.expression)}}function fi(e,t){return e<t?-1:e>t?1:0}function mi(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(mi(e[t]))return!0;return!1}function gi(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?_i(e[1],e[2],"=="):"!="===t?bi(_i(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?_i(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(gi))):"all"===t?["all"].concat(e.slice(1).map(gi)):"none"===t?["all"].concat(e.slice(1).map(gi).map(bi)):"in"===t?yi(e[1],e.slice(2)):"!in"===t?bi(yi(e[1],e.slice(2))):"has"===t?vi(e[1]):"!has"!==t||bi(vi(e[1]));var n}function _i(e,t,n){switch(e){case"$type":return["filter-type-".concat(n),t];case"$id":return["filter-id-".concat(n),t];default:return["filter-".concat(n),e,t]}}function yi(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(fi)]]:["filter-in-small",e,["literal",t]]}}function vi(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function bi(e){return["!",e]}function xi(e){const t=typeof e;if("number"===t||"boolean"===t||"string"===t||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const n of e)t+="".concat(xi(n),",");return"".concat(t,"]")}const n=Object.keys(e).sort();let r="{";for(let i=0;i<n.length;i++)r+="".concat(JSON.stringify(n[i]),":").concat(xi(e[n[i]]),",");return"".concat(r,"}")}function wi(e){let t="";for(const n of be)t+="/".concat(xi(e[n]));return t}function Si(e){const t=e.value;return t?[new Me(e.key,t,"constants have been deprecated as of v8")]:[]}function Ti(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ei(e){if(Array.isArray(e))return e.map(Ei);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Ei(e[n]);return t}return Ti(e)}function ki(e){const t=e.key,n=e.value,r=e.valueSpec||{},i=e.objectElementValidators||{},o=e.style,a=e.styleSpec,s=e.validateSpec;let l=[];const c=Wr(n);if("object"!==c)return[new Me(t,n,"object expected, ".concat(c," found"))];for(const u in n){const e=u.split(".")[0],c=vt(r,e)||r["*"];let h;if(vt(i,e))h=i[e];else if(vt(r,e))h=s;else if(i["*"])h=i["*"];else{if(!r["*"]){l.push(new Me(t,n[u],'unknown property "'.concat(u,'"')));continue}h=s}l=l.concat(h({key:(t?"".concat(t,"."):t)+u,value:n[u],valueSpec:c,style:o,styleSpec:a,object:n,objectKey:u,validateSpec:s},n))}for(const u in r)i[u]||r[u].required&&void 0===r[u].default&&void 0===n[u]&&l.push(new Me(t,n,'missing required property "'.concat(u,'"')));return l}function Pi(e){const t=e.value,n=e.valueSpec,r=e.style,i=e.styleSpec,o=e.key,a=e.arrayElementValidator||e.validateSpec;if("array"!==Wr(t))return[new Me(o,t,"array expected, ".concat(Wr(t)," found"))];if(n.length&&t.length!==n.length)return[new Me(o,t,"array length ".concat(n.length," expected, length ").concat(t.length," found"))];if(n["min-length"]&&t.length<n["min-length"])return[new Me(o,t,"array length at least ".concat(n["min-length"]," expected, length ").concat(t.length," found"))];let s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===Wr(n.value)&&(s=n.value);let l=[];for(let c=0;c<t.length;c++)l=l.concat(a({array:t,arrayIndex:c,value:t[c],valueSpec:s,validateSpec:e.validateSpec,style:r,styleSpec:i,key:"".concat(o,"[").concat(c,"]")}));return l}function Ci(e){const t=e.key,n=e.value,r=e.valueSpec;let i=Wr(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new Me(t,n,"number expected, ".concat(i," found"))]:"minimum"in r&&n<r.minimum?[new Me(t,n,"".concat(n," is less than the minimum value ").concat(r.minimum))]:"maximum"in r&&n>r.maximum?[new Me(t,n,"".concat(n," is greater than the maximum value ").concat(r.maximum))]:[]}function Ii(e){const t=e.valueSpec,n=Ti(e.value.type);let r,i,o,a={};const s="categorical"!==n&&void 0===e.value.property,l=!s,c="array"===Wr(e.value.stops)&&"array"===Wr(e.value.stops[0])&&"object"===Wr(e.value.stops[0][0]),u=ki({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new Me(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const r=e.value;return t=t.concat(Pi({key:e.key,value:r,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Wr(r)&&0===r.length&&t.push(new Me(e.key,r,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&s&&u.push(new Me(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new Me(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!Zr(e.valueSpec)&&u.push(new Me(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Gr(e.valueSpec)?u.push(new Me(e.key,e.value,"property functions not supported")):s&&!qr(e.valueSpec)&&u.push(new Me(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new Me(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const r=e.value,s=e.key;if("array"!==Wr(r))return[new Me(s,r,"array expected, ".concat(Wr(r)," found"))];if(2!==r.length)return[new Me(s,r,"array length 2 expected, length ".concat(r.length," found"))];if(c){if("object"!==Wr(r[0]))return[new Me(s,r,"object expected, ".concat(Wr(r[0])," found"))];if(void 0===r[0].zoom)return[new Me(s,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new Me(s,r,"object stop key must have value")];if(o&&o>Ti(r[0].zoom))return[new Me(s,r[0].zoom,"stop zoom values must appear in ascending order")];Ti(r[0].zoom)!==o&&(o=Ti(r[0].zoom),i=void 0,a={}),n=n.concat(ki({key:"".concat(s,"[0]"),value:r[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Ci,value:d}}))}else n=n.concat(d({key:"".concat(s,"[0]"),value:r[0],validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},r));return ni(Ei(r[1]))?n.concat([new Me("".concat(s,"[1]"),r[1],"expressions are not allowed in function stops.")]):n.concat(e.validateSpec({key:"".concat(s,"[1]"),value:r[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const s=Wr(e.value),l=Ti(e.value),c=null!==e.value?e.value:o;if(r){if(s!==r)return[new Me(e.key,c,"".concat(s," stop domain type must match previous stop domain type ").concat(r))]}else r=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Me(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==n){let r="number expected, ".concat(s," found");return Gr(t)&&void 0===n&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Me(e.key,c,r)]}return"categorical"!==n||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===s&&void 0!==i&&l<i?[new Me(e.key,c,"stop domain values must appear in ascending order")]:(i=l,"categorical"===n&&l in a?[new Me(e.key,c,"stop domain values must be unique")]:(a[l]=!0,[])):[new Me(e.key,c,"integer expected, found ".concat(l))]}}function Ai(e){const t=("property"===e.expressionContext?ai:ri)(Ei(e.value),e.valueSpec);if("error"===t.result)return t.value.map(t=>new Me("".concat(e.key).concat(t.key),e.value,t.message));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Me(e.key,e.value,'Invalid data expression for "'.concat(e.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Br(n))return[new Me(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Br(n))return[new Me(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Nr(n,["zoom","feature-state"]))return[new Me(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Fr(n))return[new Me(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Mi(e){const t=e.key,n=e.value,r=Wr(n);return"string"!==r?[new Me(t,n,"color expected, ".concat(r," found"))]:Pt.parse(String(n))?[]:[new Me(t,n,'color expected, "'.concat(n,'" found'))]}function Ri(e){const t=e.key,n=e.value,r=e.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Ti(n))&&i.push(new Me(t,n,"expected one of [".concat(r.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(r.values).indexOf(Ti(n))&&i.push(new Me(t,n,"expected one of [".concat(Object.keys(r.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),i}function Di(e){return hi(Ei(e.value))?Ai(Re({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):zi(e)}function zi(e){const t=e.value,n=e.key;if("array"!==Wr(t))return[new Me(n,t,"array expected, ".concat(Wr(t)," found"))];const r=e.styleSpec;let i,o=[];if(t.length<1)return[new Me(n,t,"filter array must have at least 1 element")];switch(o=o.concat(Ri({key:"".concat(n,"[0]"),value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ti(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Ti(t[1])&&o.push(new Me(n,t,'"$type" cannot be use with operator "'.concat(t[0],'"')));case"==":case"!=":3!==t.length&&o.push(new Me(n,t,'filter array for operator "'.concat(t[0],'" must have 3 elements')));case"in":case"!in":t.length>=2&&(i=Wr(t[1]),"string"!==i&&o.push(new Me("".concat(n,"[1]"),t[1],"string expected, ".concat(i," found"))));for(let a=2;a<t.length;a++)i=Wr(t[a]),"$type"===Ti(t[1])?o=o.concat(Ri({key:"".concat(n,"[").concat(a,"]"),value:t[a],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&o.push(new Me("".concat(n,"[").concat(a,"]"),t[a],"string, number, or boolean expected, ".concat(i," found")));break;case"any":case"all":case"none":for(let r=1;r<t.length;r++)o=o.concat(zi({key:"".concat(n,"[").concat(r,"]"),value:t[r],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Wr(t[1]),2!==t.length?o.push(new Me(n,t,'filter array for "'.concat(t[0],'" operator must have 2 elements'))):"string"!==i&&o.push(new Me("".concat(n,"[1]"),t[1],"string expected, ".concat(i," found")))}return o}function Li(e,t){const n=e.key,r=e.validateSpec,i=e.style,o=e.styleSpec,a=e.value,s=e.objectKey,l=o["".concat(t,"_").concat(e.layerType)];if(!l)return[];const c=s.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return r({key:n,value:a,valueSpec:o.transition,style:i,styleSpec:o});const u=e.valueSpec||l[s];if(!u)return[new Me(n,a,'unknown property "'.concat(s,'"'))];let h;if("string"===Wr(a)&&Gr(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(a)))return[new Me(n,a,'"'.concat(s,'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": ').concat(JSON.stringify(h[1])," }`."))];const d=[];return"symbol"===e.layerType&&"text-font"===s&&Hr(Ei(a))&&"identity"===Ti(a.type)&&d.push(new Me(n,a,'"text-font" does not support identity functions')),d.concat(r({key:e.key,value:a,valueSpec:u,style:i,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:s}))}function ji(e){return Li(e,"paint")}function Oi(e){return Li(e,"layout")}function Fi(e){let t=[];const n=e.value,r=e.key,i=e.style,o=e.styleSpec;if("object"!==Wr(n))return[new Me(r,n,"object expected, ".concat(Wr(n)," found"))];n.type||n.ref||t.push(new Me(r,n,'either "type" or "ref" is required'));let a=Ti(n.type);const s=Ti(n.ref);if(n.id){const o=Ti(n.id);for(let a=0;a<e.arrayIndex;a++){const e=i.layers[a];Ti(e.id)===o&&t.push(new Me(r,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(e.id.__line__)))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach(e=>{e in n&&t.push(new Me(r,n[e],'"'.concat(e,'" is prohibited for ref layers')))}),i.layers.forEach(t=>{Ti(t.id)===s&&(e=t)}),e?e.ref?t.push(new Me(r,n.ref,"ref cannot reference another ref layer")):a=Ti(e.type):t.push(new Me(r,n.ref,'ref layer "'.concat(s,'" not found')))}else if("background"!==a)if(n.source){const e=i.sources&&i.sources[n.source],o=e&&Ti(e.type);e?"vector"===o&&"raster"===a?t.push(new Me(r,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster-dem"!==o&&"hillshade"===a||"raster-dem"!==o&&"color-relief"===a?t.push(new Me(r,n.source,'layer "'.concat(n.id,'" requires a raster-dem source'))):"raster"===o&&"raster"!==a?t.push(new Me(r,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==a&&"color-relief"!==a?t.push(new Me(r,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"!==a||!n.paint||!n.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new Me(r,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):t.push(new Me(r,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):t.push(new Me(r,n.source,'source "'.concat(n.source,'" not found')))}else t.push(new Me(r,n,'missing required property "source"'));return t=t.concat(ki({key:r,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:"".concat(r,".type"),value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:n,objectKey:"type"}),filter:Di,layout:e=>ki({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Oi(Re({layerType:a},e))}}),paint:e=>ki({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>ji(Re({layerType:a},e))}})}})),t}function Bi(e){const t=e.value,n=e.key,r=Wr(t);return"string"!==r?[new Me(n,t,"string expected, ".concat(r," found"))]:[]}const Ni={promoteId:function(e){let{key:t,value:n}=e;if("string"===Wr(n))return Bi({key:t,value:n});{const e=[];for(const r in n)e.push(...Bi({key:"".concat(t,".").concat(r),value:n[r]}));return e}}};function Ui(e){const t=e.value,n=e.key,r=e.styleSpec,i=e.style,o=e.validateSpec;if(!t.type)return[new Me(n,t,'"type" is required')];const a=Ti(t.type);let s;switch(a){case"vector":case"raster":return s=ki({key:n,value:t,valueSpec:r["source_".concat(a.replace("-","_"))],style:e.style,styleSpec:r,objectElementValidators:Ni,validateSpec:o}),s;case"raster-dem":return s=function(e){var t;const n=null!==(t=e.sourceName)&&void 0!==t?t:"",r=e.value,i=e.styleSpec,o=i.source_raster_dem,a=e.style;let s=[];const l=Wr(r);if(void 0===r)return s;if("object"!==l)return s.push(new Me("source_raster_dem",r,"object expected, ".concat(l," found"))),s;const c="custom"===Ti(r.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=e.value.encoding?'"'.concat(e.value.encoding,'"'):"Default";for(const d in r)!c&&u.includes(d)?s.push(new Me(d,r[d],'In "'.concat(n,'": "').concat(d,'" is only valid when "encoding" is set to "custom". ').concat(h," encoding found"))):o[d]?s=s.concat(e.validateSpec({key:d,value:r[d],valueSpec:o[d],validateSpec:e.validateSpec,style:a,styleSpec:i})):s.push(new Me(d,r[d],'unknown property "'.concat(d,'"')));return s}({sourceName:n,value:t,style:e.style,styleSpec:r,validateSpec:o}),s;case"geojson":if(s=ki({key:n,value:t,valueSpec:r.source_geojson,style:i,styleSpec:r,validateSpec:o,objectElementValidators:Ni}),t.cluster)for(const e in t.clusterProperties){const[r,i]=t.clusterProperties[e],o="string"==typeof r?[r,["accumulated"],["get",e]]:r;s.push(...Ai({key:"".concat(n,".").concat(e,".map"),value:i,expressionContext:"cluster-map"})),s.push(...Ai({key:"".concat(n,".").concat(e,".reduce"),value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return ki({key:n,value:t,valueSpec:r.source_video,style:i,validateSpec:o,styleSpec:r});case"image":return ki({key:n,value:t,valueSpec:r.source_image,style:i,validateSpec:o,styleSpec:r});case"canvas":return[new Me(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ri({key:"".concat(n,".type"),value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Vi(e){const t=e.value,n=e.styleSpec,r=n.light,i=e.style;let o=[];const a=Wr(t);if(void 0===t)return o;if("object"!==a)return o=o.concat([new Me("light",t,"object expected, ".concat(a," found"))]),o;for(const s in t){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&r[a[1]]&&r[a[1]].transition?e.validateSpec({key:s,value:t[s],valueSpec:n.transition,validateSpec:e.validateSpec,style:i,styleSpec:n}):r[s]?e.validateSpec({key:s,value:t[s],valueSpec:r[s],validateSpec:e.validateSpec,style:i,styleSpec:n}):[new Me(s,t[s],'unknown property "'.concat(s,'"'))])}return o}function Gi(e){const t=e.value,n=e.styleSpec,r=n.sky,i=e.style,o=Wr(t);if(void 0===t)return[];if("object"!==o)return[new Me("sky",t,"object expected, ".concat(o," found"))];let a=[];for(const s in t)a=a.concat(r[s]?e.validateSpec({key:s,value:t[s],valueSpec:r[s],style:i,styleSpec:n}):[new Me(s,t[s],'unknown property "'.concat(s,'"'))]);return a}function qi(e){const t=e.value,n=e.styleSpec,r=n.terrain,i=e.style;let o=[];const a=Wr(t);if(void 0===t)return o;if("object"!==a)return o=o.concat([new Me("terrain",t,"object expected, ".concat(a," found"))]),o;for(const s in t)o=o.concat(r[s]?e.validateSpec({key:s,value:t[s],valueSpec:r[s],validateSpec:e.validateSpec,style:i,styleSpec:n}):[new Me(s,t[s],'unknown property "'.concat(s,'"'))]);return o}function Zi(e){let t=[];const n=e.value,r=e.key;if(Array.isArray(n)){const i=[],o=[];for(const a in n)n[a].id&&i.includes(n[a].id)&&t.push(new Me(r,n,"all the sprites' ids must be unique, but ".concat(n[a].id," is duplicated"))),i.push(n[a].id),n[a].url&&o.includes(n[a].url)&&t.push(new Me(r,n,"all the sprites' URLs must be unique, but ".concat(n[a].url," is duplicated"))),o.push(n[a].url),t=t.concat(ki({key:"".concat(r,"[").concat(a,"]"),value:n[a],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return t}return Bi({key:r,value:n})}function Wi(e){return t=e.value,Boolean(t)&&t.constructor===Object?[]:[new Me(e.key,e.value,"object expected, ".concat(Wr(e.value)," found"))];var t}const Hi={"*":()=>[],array:Pi,boolean:function(e){const t=e.value,n=e.key,r=Wr(t);return"boolean"!==r?[new Me(n,t,"boolean expected, ".concat(r," found"))]:[]},number:Ci,color:Mi,constants:Si,enum:Ri,filter:Di,function:Ii,layer:Fi,object:ki,source:Ui,light:Vi,sky:Gi,terrain:qi,projection:function(e){const t=e.value,n=e.styleSpec,r=n.projection,i=e.style,o=Wr(t);if(void 0===t)return[];if("object"!==o)return[new Me("projection",t,"object expected, ".concat(o," found"))];let a=[];for(const s in t)a=a.concat(r[s]?e.validateSpec({key:s,value:t[s],valueSpec:r[s],style:i,styleSpec:n}):[new Me(s,t[s],'unknown property "'.concat(s,'"'))]);return a},projectionDefinition:function(e){const t=e.key;let n=e.value;n=n instanceof String?n.valueOf():n;const r=Wr(n);return"array"!==r||function(e){return Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]}(n)||function(e){return!!["interpolate","step","literal"].includes(e[0])}(n)?["array","string"].includes(r)?[]:[new Me(t,n,'projection expected, invalid type "'.concat(r,'" found'))]:[new Me(t,n,"projection expected, invalid array ".concat(JSON.stringify(n)," found"))]},string:Bi,formatted:function(e){return 0===Bi(e).length?[]:Ai(e)},resolvedImage:function(e){return 0===Bi(e).length?[]:Ai(e)},padding:function(e){const t=e.key,n=e.value;if("array"===Wr(n)){if(n.length<1||n.length>4)return[new Me(t,n,"padding requires 1 to 4 values; ".concat(n.length," values found"))];const r={type:"number"};let i=[];for(let o=0;o<n.length;o++)i=i.concat(e.validateSpec({key:"".concat(t,"[").concat(o,"]"),value:n[o],validateSpec:e.validateSpec,valueSpec:r}));return i}return Ci({key:t,value:n,valueSpec:{}})},numberArray:function(e){const t=e.key,n=e.value;if("array"===Wr(n)){const r={type:"number"};if(n.length<1)return[new Me(t,n,"array length at least 1 expected, length 0 found")];let i=[];for(let o=0;o<n.length;o++)i=i.concat(e.validateSpec({key:"".concat(t,"[").concat(o,"]"),value:n[o],validateSpec:e.validateSpec,valueSpec:r}));return i}return Ci({key:t,value:n,valueSpec:{}})},colorArray:function(e){const t=e.key,n=e.value;if("array"===Wr(n)){if(n.length<1)return[new Me(t,n,"array length at least 1 expected, length 0 found")];let e=[];for(let r=0;r<n.length;r++)e=e.concat(Mi({key:"".concat(t,"[").concat(r,"]"),value:n[r]}));return e}return Mi({key:t,value:n})},variableAnchorOffsetCollection:function(e){const t=e.key,n=e.value,r=Wr(n),i=e.styleSpec;if("array"!==r||n.length<1||n.length%2!=0)return[new Me(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let a=0;a<n.length;a+=2)o=o.concat(Ri({key:"".concat(t,"[").concat(a,"]"),value:n[a],valueSpec:i.layout_symbol["text-anchor"]})),o=o.concat(Pi({key:"".concat(t,"[").concat(a+1,"]"),value:n[a+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:i}));return o},sprite:Zi,state:Wi};function Xi(e){const t=e.value,n=e.valueSpec,r=e.styleSpec;return e.validateSpec=Xi,n.expression&&Hr(Ti(t))?Ii(e):n.expression&&ni(Ei(t))?Ai(e):n.type&&Hi[n.type]?Hi[n.type](e):ki(Re({},e,{valueSpec:n.type?r[n.type]:n}))}function Ki(e){const t=e.value,n=e.key,r=Bi(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Me(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Me(n,t,'"glyphs" url must include a "{range}" token'))),r}function Yi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ve,n=[];return n=n.concat(Xi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:Xi,objectElementValidators:{glyphs:Ki,"*":()=>[]}})),e.constants&&(n=n.concat(Si({key:"constants",value:e.constants}))),Qi(n)}function Ji(e){return function(t){return e(Object.assign({},t,{validateSpec:Xi}))}}function Qi(e){return[].concat(e).sort((e,t)=>e.line-t.line)}function $i(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Qi(e.apply(this,n))}}Yi.source=$i(Ji(Ui)),Yi.sprite=$i(Ji(Zi)),Yi.glyphs=$i(Ji(Ki)),Yi.light=$i(Ji(Vi)),Yi.sky=$i(Ji(Gi)),Yi.terrain=$i(Ji(qi)),Yi.state=$i(Ji(Wi)),Yi.layer=$i(Ji(Fi)),Yi.filter=$i(Ji(Di)),Yi.paintProperty=$i(Ji(ji)),Yi.layoutProperty=$i(Ji(Oi));const eo=ve,to=Yi,no=to.light,ro=to.sky,io=to.paintProperty,oo=to.layoutProperty;function ao(e,t){let n=!1;if(t&&t.length)for(const r of t)e.fire(new _e(new Error(r.message))),n=!0;return n}class so{constructor(e,t,n){const r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(n=i[2]);for(let e=0;e<this.d*this.d;e++){const t=i[3+e],n=i[3+e+1];r.push(t===n?null:i.subarray(t,n))}const o=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],o),this.bboxes=i.subarray(o),this.insert=this._insertReadonly}else{this.d=t+2*n;for(let e=0;e<this.d*this.d;e++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;const i=n/t*e;this.min=-i,this.max=e+i}insert(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,n,r,i,o){this.cells[i].push(o)}query(e,t,n,r,i){const o=this.min,a=this.max;if(e<=o&&t<=o&&a<=n&&a<=r&&!i)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(e,t,n,r,this._queryCell,o,{},i),o}}_queryCell(e,t,n,r,i,o,a,s){const l=this.cells[i];if(null!==l){const i=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===a[h]){const l=4*h;(s?s(c[l+0],c[l+1],c[l+2],c[l+3]):e<=c[l+2]&&t<=c[l+3]&&n>=c[l+0]&&r>=c[l+1])?(a[h]=!0,o.push(i[h])):a[h]=!1}}}}_forEachCell(e,t,n,r,i,o,a,s){const l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&i.call(this,e,t,n,r,c,o,a,s))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,t=3+this.cells.length+1+1;let n=0;for(let o=0;o<this.cells.length;o++)n+=this.cells[o].length;const r=new Int32Array(t+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;let i=t;for(let o=0;o<e.length;o++){const t=e[o];r[3+o]=i,r.set(t,i),i+=t.length}return r[3+e.length]=i,r.set(this.keys,i),i+=this.keys.length,r[3+e.length+1]=i,r.set(this.bboxes,i),i+=this.bboxes.length,r.buffer}static serialize(e,t){const n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}}static deserialize(e){return new so(e.buffer)}}const lo={};function co(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(lo[e])throw new Error("".concat(e," is already registered."));Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),lo[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}co("Object",Object),co("Set",Set),co("TransferableGridIndex",so),co("Color",Pt),co("Error",Error),co("AJAXError",ue),co("ResolvedImage",Ft),co("StylePropertyFunction",si),co("StyleExpression",ti,{omit:["_evaluator"]}),co("ZoomDependentExpression",oi),co("ZoomConstantExpression",ii),co("CompoundExpression",Rr,{omit:["_evaluate"]});for(const r in Mr)Mr[r]._classRegistryKey||co("Expression_".concat(r),Mr[r]);function uo(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function ho(e){return e.$name||e.constructor._classRegistryKey}function po(e){return!function(e){if(null===e||"object"!=typeof e)return!1;const t=ho(e);return!(!t||"Object"===t)}(e)&&(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error||uo(e)||K(e)||ArrayBuffer.isView(e)||e instanceof ImageData)}function fo(e,t){if(po(e))return(uo(e)||K(e))&&t&&t.push(e),ArrayBuffer.isView(e)&&t&&t.push(e.buffer),e instanceof ImageData&&t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const r of e)n.push(fo(r,t));return n}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);const n=ho(e);if(!n)throw new Error("can't serialize object of unregistered class ".concat(e.constructor.name));if(!lo[n])throw new Error("".concat(n," is not registered."));const{klass:r}=lo[n],i=r.serialize?r.serialize(e,t):{};if(r.serialize){if(t&&i===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const r in e){if(!e.hasOwnProperty(r))continue;if(lo[n].omit.indexOf(r)>=0)continue;const o=e[r];i[r]=lo[n].shallow.indexOf(r)>=0?o:fo(o,t)}e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}function mo(e){if(po(e))return e;if(Array.isArray(e))return e.map(mo);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);const t=ho(e)||"Object";if(!lo[t])throw new Error("can't deserialize unregistered class ".concat(t));const{klass:n}=lo[t];if(!n)throw new Error("can't deserialize unregistered class ".concat(t));if(n.deserialize)return n.deserialize(e);const r=Object.create(n.prototype);for(const i of Object.keys(e)){if("$name"===i)continue;const n=e[i];r[i]=lo[t].shallow.indexOf(i)>=0?n:mo(n)}return r}class go{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}function _o(e){return/[\u02EA\u02EB\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(e))}function yo(e){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD806[\uDEB0-\uDEBF]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(e))}function vo(e){for(const t of e)if(yo(t.charCodeAt(0)))return!0;return!1}function bo(e){for(const t of e)if(!So(t.charCodeAt(0)))return!1;return!0}function xo(e){const t=e.map(e=>{try{return new RegExp("\\p{sc=".concat(e,"}"),"u").source}catch(e){return null}}).filter(e=>e);return new RegExp(t.join("|"),"u")}const wo=xo(["Arab","Dupl","Mong","Ougr","Syrc"]);function So(e){return!wo.test(String.fromCodePoint(e))}function To(e){return!(yo(e)||(t=e,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]/gim.test(String.fromCodePoint(t))));var t}const Eo=xo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ko(e){return Eo.test(String.fromCodePoint(e))}function Po(e,t){return!(!t&&ko(e)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(e)))}function Co(e){for(const t of e)if(ko(t.charCodeAt(0)))return!0;return!1}const Io=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(e){this.pluginStatus=e.pluginStatus,this.pluginURL=e.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(e){if(Io.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=e.applyArabicShaping,this.processBidirectionalText=e.processBidirectionalText,this.processStyledBidirectionalText=e.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(e,n){return t(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if("loading"!==e.pluginStatus)return this.setState(e),e;const t=e.pluginURL,r=new Promise(e=>{this.loadScriptResolve=e});n(t);const i=new Promise(e=>setTimeout(()=>e(),this.TIMEOUT));if(yield Promise.race([r,i]),this.isParsed()){const e={pluginStatus:"loaded",pluginURL:t};return this.setState(e),e}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error("RTL Text Plugin failed to import scripts from ".concat(t))})}};class Ao{constructor(e,t){this.isSupportedScript=Mo,this.zoom=e,t?(this.now=t.now||0,this.fadeDuration=t.fadeDuration||0,this.zoomHistory=t.zoomHistory||new go,this.transition=t.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new go,this.transition={})}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}function Mo(e){return function(e,t){for(const n of e)if(!Po(n.charCodeAt(0),t))return!1;return!0}(e,"loaded"===Io.getRTLTextPluginStatus())}class Ro{constructor(e,t,n){this.property=e,this.value=t,this.expression=function(e,t,n){if(Hr(e))return new si(e,t);if(ni(e)){const r=ai(e,t,n);if("error"===r.result)throw new Error(r.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));return r.value}{let n=e;return"color"===t.type&&"string"==typeof e?n=Pt.parse(e):"padding"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"numberArray"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"colorArray"!==t.type||"string"!=typeof e&&!Array.isArray(e)?"variableAnchorOffsetCollection"===t.type&&Array.isArray(e)?n=Ot.parse(e):"projectionDefinition"===t.type&&"string"==typeof e&&(n=Bt.parse(e)):n=zt.parse(e):n=Dt.parse(e):n=Rt.parse(e),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class Do{constructor(e,t){this.property=e,this.value=new Ro(e,void 0,t)}transitioned(e,t){return new Lo(this.property,this.value,t,B({},e.transition,this.transition),e.now)}untransitioned(){return new Lo(this.property,this.value,null,{},0)}}class zo{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=t}getValue(e){return G(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Do(this._values[e].property,this._globalState)),this._values[e].value=new Ro(this._values[e].property,null===t?void 0:G(t),this._globalState)}getTransition(e){return G(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Do(this._values[e].property,this._globalState)),this._values[e].transition=G(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const r=this.getTransition(t);void 0!==r&&(e["".concat(t,"-transition")]=r)}return e}transitioned(e,t){const n=new jo(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].transitioned(e,t._values[r]);return n}untransitioned(){const e=new jo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Lo{constructor(e,t,n,r,i){this.property=e,this.value=t,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,e.specification.transition&&(r.delay||r.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const r=e.now||0,i=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(e,t,n);{const a=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),i,z(a))}}return i}}class jo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const r=new Bo(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Oo{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=t}hasValue(e){return void 0!==this._values[e].value}getValue(e){return G(this._values[e].value)}setValue(e,t){this._values[e]=new Ro(this._values[e].property,null===t?void 0:G(t),this._globalState)}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const r=new Bo(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}}class Fo{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,r){return this.property.evaluate(this.value,this.parameters,e,t,n,r)}}class Bo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class No{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,n){const r=gn[this.specification.type];return r?r(e,t,n):e}}class Uo{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,r){return new Fo(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,r)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Fo(this,{kind:"constant",value:void 0},e.parameters);const r=gn[this.specification.type];if(r){const i=r(e.value.value,t.value.value,n);return new Fo(this,{kind:"constant",value:i},e.parameters)}return e}evaluate(e,t,n,r,i,o){return"constant"===e.kind?e.value:e.evaluate(t,n,r,i,o)}}class Vo extends Uo{possiblyEvaluate(e,t,n,r){if(void 0===e.value)return new Fo(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const i=e.expression.evaluate(t,null,{},n,r),o="resolvedImage"===e.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,t);return new Fo(this,{kind:"constant",value:a},t)}if("camera"===e.expression.kind){const n=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Fo(this,{kind:"constant",value:n},t)}return new Fo(this,e.expression,t)}evaluate(e,t,n,r,i,o){if("source"===e.kind){const a=e.evaluate(t,n,r,i,o);return this._calculate(a,a,a,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,r),e.evaluate({zoom:Math.floor(t.zoom)},n,r),e.evaluate({zoom:Math.floor(t.zoom)+1},n,r),t):e.value}_calculate(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class Go{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,r){if(void 0!==e.value){if("constant"===e.expression.kind){const i=e.expression.evaluate(t,null,{},n,r);return this._calculate(i,i,i,t)}return this._calculate(e.expression.evaluate(new Ao(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Ao(Math.floor(t.zoom),t)),e.expression.evaluate(new Ao(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class qo{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,r){return!!e.expression.evaluate(t,null,{},n,r)}interpolate(){return!1}}class Zo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const n=e[t];n.specification.overridable&&this.overridableProperties.push(t);const r=this.defaultPropertyValues[t]=new Ro(n,void 0,void 0),i=this.defaultTransitionablePropertyValues[t]=new Do(n,void 0);this.defaultTransitioningPropertyValues[t]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=r.possiblyEvaluate({})}}}co("DataDrivenProperty",Uo),co("DataConstantProperty",No),co("CrossFadedDataDrivenProperty",Vo),co("CrossFadedProperty",Go),co("ColorRampProperty",qo);const Wo="-transition";class Ho extends ye{constructor(e,t,n){if(super(),this.id=e.id,this.type=e.type,this._globalState=n,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=pi(e.filter,n)),t.layout&&(this._unevaluatedLayout=new Oo(t.layout,n)),t.paint)){this._transitionablePaint=new zo(t.paint,n);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bo(t.paint)}}setFilter(e){this.filter=e,this._featureFilter=pi(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const t in this._unevaluatedLayout._values){const n=this._unevaluatedLayout._values[t];for(const t of n.getGlobalStateRefs())e.add(t)}for(const t of this._featureFilter.getGlobalStateRefs())e.add(t);return e}getPaintAffectingGlobalStateRefs(){var e;const t=new globalThis.Map;if(this._transitionablePaint)for(const n in this._transitionablePaint._values){const r=this._transitionablePaint._values[n].value;for(const i of r.getGlobalStateRefs()){const o=null!==(e=t.get(i))&&void 0!==e?e:[];o.push({name:n,value:r.value}),t.set(i,o)}}return t}setLayoutProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null!=t&&this._validate(oo,"layers.".concat(this.id,".layout.").concat(e),e,t,n)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return e.endsWith(Wo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(io,"layers.".concat(this.id,".paint.").concat(e),e,t,n))return!1;if(e.endsWith(Wo))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const n=this._transitionablePaint._values[e],r="cross-faded-data-driven"===n.property.specification["property-type"],i=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const a=this._transitionablePaint._values[e].value;return a.isDataDriven()||i||r||this._handleOverridablePaintPropertyUpdate(e,o,a)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!!(this.minzoom&&e<(t?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),V(e,(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}_validate(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!i||!1!==i.validate)&&ao(this,e.call(to,{key:t,layerType:this.type,objectKey:n,value:r,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Fo&&Gr(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}let Xo;var Ko={get paint(){return Xo=Xo||new Zo({"raster-opacity":new No(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new No(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new No(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new No(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new No(ve.paint_raster["raster-saturation"]),"raster-contrast":new No(ve.paint_raster["raster-contrast"]),"raster-resampling":new No(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new No(ve.paint_raster["raster-fade-duration"])})}};class Yo extends Ho{constructor(e,t){super(e,Ko,t)}}const Jo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qo{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $o{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ea(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,r=0;return{members:e.map(e=>{const i=Jo[e.type].BYTES_PER_ELEMENT,o=n=ta(n,Math.max(t,i)),a=e.components||1;return r=Math.max(r,i),n+=i*a,{name:e.name,type:e.type,components:a,offset:o}}),size:ta(n,Math.max(r,t)),alignment:t}}function ta(e,t){return Math.ceil(e/t)*t}class na extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,e}}na.prototype.bytesPerElement=4,co("StructArrayLayout2i4",na);class ra extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.int16[i+2]=r,e}}ra.prototype.bytesPerElement=6,co("StructArrayLayout3i6",ra);class ia extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,e}}ia.prototype.bytesPerElement=8,co("StructArrayLayout4i8",ia);class oa extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,a){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,e}}oa.prototype.bytesPerElement=12,co("StructArrayLayout2i4i12",oa);class aa extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,a){const s=4*e,l=8*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.uint8[l+4]=r,this.uint8[l+5]=i,this.uint8[l+6]=o,this.uint8[l+7]=a,e}}aa.prototype.bytesPerElement=8,co("StructArrayLayout2i4ub8",aa);class sa extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=n,e}}sa.prototype.bytesPerElement=8,co("StructArrayLayout2f8",sa);class la extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,a,s,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,r,i,o,a,s,l,c)}emplace(e,t,n,r,i,o,a,s,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}la.prototype.bytesPerElement=20,co("StructArrayLayout10ui20",la);class ca extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,a,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,r,i,o,a,s)}emplace(e,t,n,r,i,o,a,s,l){const c=8*e;return this.uint16[c+0]=t,this.uint16[c+1]=n,this.uint16[c+2]=r,this.uint16[c+3]=i,this.uint16[c+4]=o,this.uint16[c+5]=a,this.uint16[c+6]=s,this.uint16[c+7]=l,e}}ca.prototype.bytesPerElement=16,co("StructArrayLayout8ui16",ca);class ua extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,a,s,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,r,i,o,a,s,l,c,u,h)}emplace(e,t,n,r,i,o,a,s,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=r,this.int16[p+3]=i,this.uint16[p+4]=o,this.uint16[p+5]=a,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}ua.prototype.bytesPerElement=24,co("StructArrayLayout4i4ui4i24",ua);class ha extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e}}ha.prototype.bytesPerElement=12,co("StructArrayLayout3f12",ha);class da extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}da.prototype.bytesPerElement=4,co("StructArrayLayout1ul4",da);class pa extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,a,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,r,i,o,a,s,l)}emplace(e,t,n,r,i,o,a,s,l,c){const u=10*e,h=5*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=r,this.int16[u+3]=i,this.int16[u+4]=o,this.int16[u+5]=a,this.uint32[h+3]=s,this.uint16[u+8]=l,this.uint16[u+9]=c,e}}pa.prototype.bytesPerElement=20,co("StructArrayLayout6i1ul2ui20",pa);class fa extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,a){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,e}}fa.prototype.bytesPerElement=12,co("StructArrayLayout2i2i2i12",fa);class ma extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)}emplace(e,t,n,r,i,o){const a=4*e,s=8*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=r,this.int16[s+6]=i,this.int16[s+7]=o,e}}ma.prototype.bytesPerElement=16,co("StructArrayLayout2f1f2i16",ma);class ga extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,a){const s=16*e,l=4*e,c=8*e;return this.uint8[s+0]=t,this.uint8[s+1]=n,this.float32[l+1]=r,this.float32[l+2]=i,this.int16[c+6]=o,this.int16[c+7]=a,e}}ga.prototype.bytesPerElement=16,co("StructArrayLayout2ub2f2i16",ga);class _a extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,this.uint16[i+2]=r,e}}_a.prototype.bytesPerElement=6,co("StructArrayLayout3ui6",_a);class ya extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,a,s,l,c,u,h,d,p,f,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,t,n,r,i,o,a,s,l,c,u,h,d,p,f,m,g)}emplace(e,t,n,r,i,o,a,s,l,c,u,h,d,p,f,m,g,_){const y=24*e,v=12*e,b=48*e;return this.int16[y+0]=t,this.int16[y+1]=n,this.uint16[y+2]=r,this.uint16[y+3]=i,this.uint32[v+2]=o,this.uint32[v+3]=a,this.uint32[v+4]=s,this.uint16[y+10]=l,this.uint16[y+11]=c,this.uint16[y+12]=u,this.float32[v+7]=h,this.float32[v+8]=d,this.uint8[b+36]=p,this.uint8[b+37]=f,this.uint8[b+38]=m,this.uint32[v+10]=g,this.int16[y+22]=_,e}}ya.prototype.bytesPerElement=48,co("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ya);class va extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,a,s,l,c,u,h,d,p,f,m,g,_,y,v,b,x,w,S,T,E,k,P){const C=this.length;return this.resize(C+1),this.emplace(C,e,t,n,r,i,o,a,s,l,c,u,h,d,p,f,m,g,_,y,v,b,x,w,S,T,E,k,P)}emplace(e,t,n,r,i,o,a,s,l,c,u,h,d,p,f,m,g,_,y,v,b,x,w,S,T,E,k,P,C){const I=32*e,A=16*e;return this.int16[I+0]=t,this.int16[I+1]=n,this.int16[I+2]=r,this.int16[I+3]=i,this.int16[I+4]=o,this.int16[I+5]=a,this.int16[I+6]=s,this.int16[I+7]=l,this.uint16[I+8]=c,this.uint16[I+9]=u,this.uint16[I+10]=h,this.uint16[I+11]=d,this.uint16[I+12]=p,this.uint16[I+13]=f,this.uint16[I+14]=m,this.uint16[I+15]=g,this.uint16[I+16]=_,this.uint16[I+17]=y,this.uint16[I+18]=v,this.uint16[I+19]=b,this.uint16[I+20]=x,this.uint16[I+21]=w,this.uint16[I+22]=S,this.uint32[A+12]=T,this.float32[A+13]=E,this.float32[A+14]=k,this.uint16[I+30]=P,this.uint16[I+31]=C,e}}va.prototype.bytesPerElement=64,co("StructArrayLayout8i15ui1ul2f2ui64",va);class ba extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ba.prototype.bytesPerElement=4,co("StructArrayLayout1f4",ba);class xa extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.uint16[6*e+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e}}xa.prototype.bytesPerElement=12,co("StructArrayLayout1ui2f12",xa);class wa extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=4*e;return this.uint32[2*e+0]=t,this.uint16[i+2]=n,this.uint16[i+3]=r,e}}wa.prototype.bytesPerElement=8,co("StructArrayLayout1ul2ui8",wa);class Sa extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,e}}Sa.prototype.bytesPerElement=4,co("StructArrayLayout2ui4",Sa);class Ta extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Ta.prototype.bytesPerElement=2,co("StructArrayLayout1ui2",Ta);class Ea extends $o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,e}}Ea.prototype.bytesPerElement=16,co("StructArrayLayout4f16",Ea);class ka extends Qo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new n(this.anchorPointX,this.anchorPointY)}}ka.prototype.size=20;class Pa extends pa{get(e){return new ka(this,e)}}co("CollisionBoxArray",Pa);class Ca extends Qo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ca.prototype.size=48;class Ia extends ya{get(e){return new Ca(this,e)}}co("PlacedSymbolArray",Ia);class Aa extends Qo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Aa.prototype.size=64;class Ma extends va{get(e){return new Aa(this,e)}}co("SymbolInstanceArray",Ma);class Ra extends ba{getoffsetX(e){return this.float32[1*e+0]}}co("GlyphOffsetArray",Ra);class Da extends ra{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}co("SymbolLineVertexArray",Da);class za extends Qo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}za.prototype.size=12;class La extends xa{get(e){return new za(this,e)}}co("TextAnchorOffsetArray",La);class ja extends Qo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ja.prototype.size=8;class Oa extends wa{get(e){return new ja(this,e)}}co("FeatureIndexArray",Oa);class Fa extends na{}class Ba extends na{}class Na extends na{}class Ua extends oa{}class Va extends aa{}class Ga extends sa{}class qa extends la{}class Za extends ca{}class Wa extends ua{}class Ha extends ha{}class Xa extends da{}class Ka extends fa{}class Ya extends ga{}class Ja extends _a{}class Qa extends Sa{}const $a=ea([{name:"a_pos",components:2,type:"Int16"}],4),{members:es}=$a;class ts{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,t,n,r){const i=this.segments[this.segments.length-1];return e>ts.MAX_VERTEX_ARRAY_LENGTH&&Z("Max vertices per segment is ".concat(ts.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(e,". Consider using the `fillLargeMeshArrays` function if you require meshes with more than ").concat(ts.MAX_VERTEX_ARRAY_LENGTH," vertices.")),this._forceNewSegmentOnNextPrepare||!i||i.vertexLength+e>ts.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r?this.createNewSegment(t,n,r):i}createNewSegment(e,t,n){const r={vertexOffset:e.length,primitiveOffset:t.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==n&&(r.sortKey=n),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(r),r}getOrCreateLatestSegment(e,t,n){return this.prepareSegment(0,e,t,n)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,r){return new ts([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])}}function ns(e,t){return 256*(e=O(Math.floor(e),0,255))+O(Math.floor(t),0,255)}ts.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,co("SegmentVector",ts);const rs=ea([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),is=ea([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var os,as,ss,ls={exports:{}},cs={exports:{}},us={exports:{}},hs=function(){if(ss)return ls.exports;ss=1;var e=(os||(os=1,cs.exports=function(e,t){var n,r,i,o,a,s,l,c;for(r=e.length-(n=3&e.length),i=t,a=3432918353,s=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}),cs.exports),t=(as||(as=1,us.exports=function(e,t){for(var n,r=e.length,i=t^r,o=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&e.charCodeAt(o+2))<<16;case 2:i^=(255&e.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}),us.exports);return ls.exports=e,ls.exports.murmur3=e,ls.exports.murmur2=t,ls.exports}(),ds=i(hs);class ps{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,r){this.ids.push(fs(e)),this.positions.push(t,n,r)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const t=fs(e);let n=0,r=this.ids.length-1;for(;n<r;){const e=n+r>>1;this.ids[e]>=t?r=e:n=e+1}const i=[];for(;this.ids[n]===t;)i.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return i}static serialize(e,t){const n=new Float64Array(e.ids),r=new Uint32Array(e.positions);return ms(n,r,0,n.length-1),t&&t.push(n.buffer,r.buffer),{ids:n,positions:r}}static deserialize(e){const t=new ps;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function fs(e){const t=+e;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ds(String(e))}function ms(e,t,n,r){for(;n<r;){const i=e[n+r>>1];let o=n-1,a=r+1;for(;;){do{o++}while(e[o]<i);do{a--}while(e[a]>i);if(o>=a)break;gs(e,o,a),gs(t,3*o,3*a),gs(t,3*o+1,3*a+1),gs(t,3*o+2,3*a+2)}a-n<r-a?(ms(e,t,n,a),n=a+1):(ms(e,t,a+1,r),r=a)}}function gs(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}co("FeaturePositionMap",ps);class _s{constructor(e,t){this.gl=e.gl,this.location=t}}class ys extends _s{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class vs extends _s{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class bs extends _s{constructor(e,t){super(e,t),this.current=Pt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const xs=new Float32Array(16);function ws(e){return[ns(255*e.r,255*e.g),ns(255*e.b,255*e.a)]}class Ss{constructor(e,t,n){this.value=e,this.uniformNames=t.map(e=>"u_".concat(e)),this.type=n}setUniform(e,t,n){e.set(n.constantOr(this.value))}getBinding(e,t,n){return"color"===this.type?new bs(e,t):new ys(e,t)}}class Ts{constructor(e,t){this.uniformNames=t.map(e=>"u_".concat(e)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,t){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,t.y,t.height,t.width]}setUniform(e,t,n,r){let i=null;"u_pattern_to"===r?i=this.patternTo:"u_pattern_from"===r?i=this.patternFrom:"u_dasharray_to"===r?i=this.dashTo:"u_dasharray_from"===r?i=this.dashFrom:"u_pixel_ratio_to"===r?i=this.pixelRatioTo:"u_pixel_ratio_from"===r&&(i=this.pixelRatioFrom),null!==i&&e.set(i)}getBinding(e,t,n){return"u_pattern"===n.substr(0,9)||"u_dasharray_"===n.substr(0,12)?new vs(e,t):new ys(e,t)}}class Es{constructor(e,t,n,r){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new r}populatePaintArray(e,t,n){const r=this.paintVertexArray.length,i=this.expression.evaluate(new Ao(0,n),t,{},n.canonical,[],n.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(r,e,i)}updatePaintArray(e,t,n,r,i){const o=this.expression.evaluate(new Ao(0,i),n,r);this._setPaintValue(e,t,o)}_setPaintValue(e,t,n){if("color"===this.type){const r=ws(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ks{constructor(e,t,n,r,i,o){this.expression=e,this.uniformNames=t.map(e=>"u_".concat(e,"_t")),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,t,n){const r=this.expression.evaluate(new Ao(this.zoom,n),t,{},n.canonical,[],n.formattedSection),i=this.expression.evaluate(new Ao(this.zoom+1,n),t,{},n.canonical,[],n.formattedSection),o=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(o,e,r,i)}updatePaintArray(e,t,n,r,i){const o=this.expression.evaluate(new Ao(this.zoom,i),n,r),a=this.expression.evaluate(new Ao(this.zoom+1,i),n,r);this._setPaintValue(e,t,o,a)}_setPaintValue(e,t,n,r){if("color"===this.type){const i=ws(n),o=ws(r);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1],o[0],o[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=O(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(r)}getBinding(e,t,n){return new ys(e,t)}}class Ps{constructor(e,t,n,r,i,o){this.expression=e,this.type=t,this.useIntegerZoom=n,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i}populatePaintArray(e,t,n){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,this.getPositionIds(t),n)}updatePaintArray(e,t,n,r,i){this._setPaintValues(e,t,this.getPositionIds(n),i)}_setPaintValues(e,t,n,r){const i=this.getPositions(r);if(!i||!n)return;const o=i[n.min],a=i[n.mid],s=i[n.max];if(o&&a&&s)for(let l=e;l<t;l++)this.emplace(this.zoomInPaintVertexArray,l,a,o),this.emplace(this.zoomOutPaintVertexArray,l,a,s)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const t=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,t,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,t,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Cs extends Ps{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return rs.members}emplace(e,t,n,r){e.emplace(t,n.tlbr[0],n.tlbr[1],n.tlbr[2],n.tlbr[3],r.tlbr[0],r.tlbr[1],r.tlbr[2],r.tlbr[3],n.pixelRatio,r.pixelRatio)}}class Is extends Ps{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return is.members}emplace(e,t,n,r){e.emplace(t,0,n.y,n.height,n.width,0,r.y,r.height,r.width)}}class As{constructor(e,t,n){this.binders={},this._buffers=[];const r=[];for(const i in e.paint._values){if(!n(i))continue;const o=e.paint.get(i);if(!(o instanceof Fo&&Gr(o.property.specification)))continue;const a=Rs(i,e.type),s=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===s.kind)this.binders[i]=h?new Ts(s.value,a):new Ss(s.value,a,l),r.push("/u_".concat(i));else if("source"===s.kind||h){const n=Ds(i,l,"source");this.binders[i]=h?"line-dasharray"===i?new Is(s,l,c,t,n,e.id):new Cs(s,l,c,t,n,e.id):new Es(s,a,l,n),r.push("/a_".concat(i))}else{const e=Ds(i,l,"composite");this.binders[i]=new ks(s,a,l,c,t,e),r.push("/z_".concat(i))}}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Es||t instanceof ks?t.maxValue:0}populatePaintArrays(e,t,n){for(const r in this.binders){const i=this.binders[r];(i instanceof Es||i instanceof ks||i instanceof Ps)&&i.populatePaintArray(e,t,n)}}setConstantPatternPositions(e,t){for(const n in this.binders){const r=this.binders[n];r instanceof Ts&&r.setConstantPatternPositions(e,t)}}setConstantDashPositions(e,t){for(const n in this.binders){const r=this.binders[n];r instanceof Ts&&r.setConstantDashPositions(e,t)}}updatePaintArrays(e,t,n,r,i){let o=!1;for(const a in e){const s=t.getPositions(a);for(const t of s){const s=n.feature(t.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof Es||l instanceof ks||l instanceof Ps)&&!0===l.expression.isStateDependent){const c=r.paint.get(n);l.expression=c.value,l.updatePaintArray(t.start,t.end,s,e[a],i),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Ss||n instanceof Ts)&&e.push(...n.uniformNames.map(e=>"#define HAS_UNIFORM_".concat(e)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Es||n instanceof ks)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name);else if(n instanceof Ps){const t=n.getVertexAttributes();for(const n of t)e.push(n.name)}}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Ss||n instanceof Ts||n instanceof ks)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const n=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof Ss||i instanceof Ts||i instanceof ks)for(const o of i.uniformNames)if(t[o]){const a=i.getBinding(e,t[o],o);n.push({name:o,property:r,binding:a})}}return n}setUniforms(e,t,n,r){for(const{name:i,property:o,binding:a}of t)this.binders[o].setUniform(a,r,n.get(o),i)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof Ps){const t=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(n instanceof Es||n instanceof ks)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Es||n instanceof ks||n instanceof Ps)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Es||t instanceof ks||t instanceof Ps)&&t.destroy()}}}class Ms{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new As(r,t,n);this.needsUpload=!1,this._featureMap=new ps,this._bufferOffset=0}populatePaintArrays(e,t,n,r){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,r);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,r){for(const i of n)this.needsUpload=this.programConfigurations[i.id].updatePaintArrays(e,this._featureMap,t,i,r)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Rs(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}function Ds(e,t,n){const r={color:{source:sa,composite:Ea},number:{source:ba,composite:sa}},i=function(e){return{"line-pattern":{source:qa,composite:qa},"fill-pattern":{source:qa,composite:qa},"fill-extrusion-pattern":{source:qa,composite:qa},"line-dasharray":{source:Za,composite:Za}}[e]}(e);return i&&i[n]||r[t][n]}co("ConstantBinder",Ss),co("CrossFadedConstantBinder",Ts),co("SourceExpressionBinder",Es),co("CrossFadedPatternBinder",Cs),co("CrossFadedDasharrayBinder",Is),co("CompositeExpressionBinder",ks),co("ProgramConfiguration",As,{omit:["_buffers"]}),co("ProgramConfigurationSet",Ms);const zs=Math.pow(2,14)-1,Ls=-zs-1;function js(e){const t=A/e.extent,n=e.loadGeometry();for(let r=0;r<n.length;r++){const e=n[r];for(let n=0;n<e.length;n++){const r=e[n],i=Math.round(r.x*t),o=Math.round(r.y*t);r.x=O(i,Ls,zs),r.y=O(o,Ls,zs),(i<r.x||i>r.x+1||o<r.y||o>r.y+1)&&Z("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Os(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?js(e):[]}}const Fs=-32768;function Bs(e,t,n,r,i){e.emplaceBack(Fs+8*t+r,Fs+8*n+i)}class Ns{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Ba,this.indexArray=new Ja,this.segments=new ts,this.programConfigurations=new Ms(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n){const r=this.layers[0],i=[];let o=null,a=!1,s="heatmap"===r.type;if("circle"===r.type){const e=r;o=e.layout.get("circle-sort-key"),a=!o.isConstant(),s=s||"map"===e.paint.get("circle-pitch-alignment")}const l=s?t.subdivisionGranularity.circle:1;for(const{feature:c,id:u,index:h,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Os(c,e);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom),t,n))continue;const r=a?o.evaluate(t,{},n):void 0,s={id:u,properties:c.properties,type:c.type,sourceLayerIndex:d,index:h,geometry:e?t.geometry:js(c),patterns:{},sortKey:r};i.push(s)}a&&i.sort((e,t)=>e.sortKey-t.sortKey);for(const c of i){const{geometry:r,index:i,sourceLayerIndex:o}=c,a=e[i].feature;this.addFeature(c,r,i,n,l),t.featureIndex.insert(a,r,i,o,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,{imagePositions:n})}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,es),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,r){let i,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;switch(o){case 1:i=[0,7];break;case 3:i=[0,2,5,7];break;case 5:i=[0,1,3,4,6,7];break;case 7:i=[0,1,2,3,4,5,6,7];break;default:throw new Error("Invalid circle bucket granularity: ".concat(o,"; valid values are 1, 3, 5, 7."))}const a=i.length;for(const s of t)for(const t of s){const n=t.x,r=t.y;if(n<0||n>=A||r<0||r>=A)continue;const o=this.segments.prepareSegment(a*a,this.layoutVertexArray,this.indexArray,e.sortKey),s=o.vertexLength;for(let e=0;e<a;e++)for(let t=0;t<a;t++)Bs(this.layoutVertexArray,n,r,i[t],i[e]);for(let e=0;e<a-1;e++)for(let t=0;t<a-1;t++){const n=s+e*a+t,r=s+(e+1)*a+t;this.indexArray.emplaceBack(n,r+1,n+1),this.indexArray.emplaceBack(n,r,r+1)}o.vertexLength+=a*a,o.primitiveLength+=(a-1)*(a-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{imagePositions:{},canonical:r})}}function Us(e,t){for(let n=0;n<e.length;n++)if(Ys(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Ys(e,t[n]))return!0;return!!Zs(e,t)}function Vs(e,t,n){return!!Ys(e,t)||!!Hs(t,e,n)}function Gs(e,t){if(1===e.length)return Ks(t,e[0]);for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<r.length;t++)if(Ys(e,r[t]))return!0}for(let n=0;n<e.length;n++)if(Ks(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Zs(e,t[n]))return!0;return!1}function qs(e,t,n){if(e.length>1){if(Zs(e,t))return!0;for(let r=0;r<t.length;r++)if(Hs(t[r],e,n))return!0}for(let r=0;r<e.length;r++)if(Hs(e[r],t,n))return!0;return!1}function Zs(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1];for(let e=0;e<t.length-1;e++)if(Ws(r,i,t[e],t[e+1]))return!0}return!1}function Ws(e,t,n,r){return W(e,n,r)!==W(t,n,r)&&W(e,t,n)!==W(e,t,r)}function Hs(e,t,n){const r=n*n;if(1===t.length)return e.distSqr(t[0])<r;for(let i=1;i<t.length;i++)if(Xs(e,t[i-1],t[i])<r)return!0;return!1}function Xs(e,t,n){const r=t.distSqr(n);if(0===r)return e.distSqr(t);const i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;return e.distSqr(i<0?t:i>1?n:n.sub(t)._mult(i)._add(t))}function Ks(e,t){let n,r,i,o=!1;for(let a=0;a<e.length;a++){n=e[a];for(let e=0,a=n.length-1;e<n.length;a=e++)r=n[e],i=n[a],r.y>t.y!=i.y>t.y&&t.x<(i.x-r.x)*(t.y-r.y)/(i.y-r.y)+r.x&&(o=!o)}return o}function Ys(e,t){let n=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){const o=e[r],a=e[i];o.y>t.y!=a.y>t.y&&t.x<(a.x-o.x)*(t.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function Js(e,t,n){const r=n[0],i=n[2];if(e.x<r.x&&t.x<r.x||e.x>i.x&&t.x>i.x||e.y<r.y&&t.y<r.y||e.y>i.y&&t.y>i.y)return!1;const o=W(e,t,n[0]);return o!==W(e,t,n[1])||o!==W(e,t,n[2])||o!==W(e,t,n[3])}function Qs(e,t,n){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:n.programConfigurations.get(t.id).getMaxValue(e)}function $s(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function el(e,t,r,i,o){if(!t[0]&&!t[1])return e;const a=n.convert(t)._mult(o);"viewport"===r&&a._rotate(-i);const s=[];for(let n=0;n<e.length;n++)s.push(e[n].sub(a));return s}function tl(e,t){let{queryGeometry:n,size:r}=e;return Vs(n,t,r)}function nl(e,t){let{queryGeometry:n,size:r,transform:i,unwrappedTileID:o,getElevation:a}=e;return Vs(n,t,r*(i.projectTileCoordinates(t.x,t.y,o,a).signedDistanceFromCamera/i.cameraToCenterDistance))}function rl(e,t){let{queryGeometry:n,size:r,transform:i,unwrappedTileID:o,getElevation:a}=e;const s=i.projectTileCoordinates(t.x,t.y,o,a).signedDistanceFromCamera,l=r*(i.cameraToCenterDistance/s);return Vs(n,al(t,i,o,a),l)}function il(e,t){let{queryGeometry:n,size:r,transform:i,unwrappedTileID:o,getElevation:a}=e;return Vs(n,al(t,i,o,a),r)}function ol(e,t){let{queryGeometry:n,size:r,transform:i,unwrappedTileID:o,getElevation:a,pitchAlignment:s="map",pitchScale:l="map"}=e;const c="map"===s?"map"===l?tl:nl:"map"===l?rl:il,u={queryGeometry:n,size:r,transform:i,unwrappedTileID:o,getElevation:a};for(const h of t)for(const e of h)if(c(u,e))return!0;return!1}function al(e,t,r,i){const o=t.projectTileCoordinates(e.x,e.y,r,i).point;return new n((.5*o.x+.5)*t.width,(.5*-o.y+.5)*t.height)}let sl,ll;co("CircleBucket",Ns,{omit:["layers"]});var cl={get paint(){return ll=ll||new Zo({"circle-radius":new Uo(ve.paint_circle["circle-radius"]),"circle-color":new Uo(ve.paint_circle["circle-color"]),"circle-blur":new Uo(ve.paint_circle["circle-blur"]),"circle-opacity":new Uo(ve.paint_circle["circle-opacity"]),"circle-translate":new No(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new No(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new No(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new No(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Uo(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Uo(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Uo(ve.paint_circle["circle-stroke-opacity"])})},get layout(){return sl=sl||new Zo({"circle-sort-key":new Uo(ve.layout_circle["circle-sort-key"])})}};class ul extends Ho{constructor(e,t){super(e,cl,t)}createBucket(e){return new Ns(e)}queryRadius(e){const t=e;return Qs("circle-radius",this,t)+Qs("circle-stroke-width",this,t)+$s(this.paint.get("circle-translate"))}queryIntersectsFeature(e){let{queryGeometry:t,feature:n,featureState:r,geometry:i,transform:o,pixelsToTileUnits:a,unwrappedTileID:s,getElevation:l}=e;const c=el(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-o.bearingInRadians,a),u=this.paint.get("circle-radius").evaluate(n,r)+this.paint.get("circle-stroke-width").evaluate(n,r),h=this.paint.get("circle-pitch-scale"),d=this.paint.get("circle-pitch-alignment");let p,f;return"map"===d?(p=c,f=u*a):(p=function(e,t,n,r){return e.map(e=>al(e,t,n,r))}(c,o,s,l),f=u),ol({queryGeometry:p,size:f,transform:o,unwrappedTileID:s,getElevation:l,pitchAlignment:d,pitchScale:h},i)}}class hl extends Ns{}let dl;co("HeatmapBucket",hl,{omit:["layers"]});var pl={get paint(){return dl=dl||new Zo({"heatmap-radius":new Uo(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Uo(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new No(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qo(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new No(ve.paint_heatmap["heatmap-opacity"])})}};function fl(e,t,n,r){let{width:i,height:o}=t;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*o*n)throw new RangeError("mismatched image size. expected: ".concat(r.length," but got: ").concat(i*o*n))}else r=new Uint8Array(i*o*n);return e.width=i,e.height=o,e.data=r,e}function ml(e,t,n){let{width:r,height:i}=t;if(r===e.width&&i===e.height)return;const o=fl({},{width:r,height:i},n);gl(e,o,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},n),e.width=r,e.height=i,e.data=o.data}function gl(e,t,n,r,i,o){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,s=t.data;if(a===s)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<i.height;l++){const c=((n.y+l)*e.width+n.x)*o,u=((r.y+l)*t.width+r.x)*o;for(let e=0;e<i.width*o;e++)s[u+e]=a[c+e]}return t}class _l{constructor(e,t){fl(this,e,1,t)}resize(e){ml(this,e,1)}clone(){return new _l({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i){gl(e,t,n,r,i,1)}}class yl{constructor(e,t){fl(this,e,4,t)}resize(e){ml(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new yl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i){gl(e,t,n,r,i,4)}setPixel(e,t,n){const r=4*(e*this.width+t);this.data[r+0]=Math.round(255*n.r/n.a),this.data[r+1]=Math.round(255*n.g/n.a),this.data[r+2]=Math.round(255*n.b/n.a),this.data[r+3]=Math.round(255*n.a)}}function vl(e){const t={},n=e.resolution||256,r=e.clips?e.clips.length:1,i=e.image||new yl({width:n,height:r});if(Math.log(n)/Math.LN2%1!=0)throw new Error("width is not a power of 2 - ".concat(n));const o=(r,o,a)=>{t[e.evaluationKey]=a;const s=e.expression.evaluate(t);i.setPixel(r/4/n,o/4,s)};if(e.clips)for(let a=0,s=0;a<r;++a,s+=4*n)for(let t=0,r=0;t<n;t++,r+=4){const i=t/(n-1),{start:l,end:c}=e.clips[a];o(s,r,l*(1-i)+c*i)}else for(let a=0,s=0;a<n;a++,s+=4)o(0,s,a/(n-1));return i}co("AlphaImage",_l),co("RGBAImage",yl);const bl="big-fb";class xl extends Ho{createBucket(e){return new hl(e)}constructor(e,t){super(e,pl,t),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(bl)&&this.heatmapFbos.delete(bl)}queryRadius(e){return Qs("heatmap-radius",this,e)}queryIntersectsFeature(e){let{queryGeometry:t,feature:n,featureState:r,geometry:i,transform:o,pixelsToTileUnits:a,unwrappedTileID:s,getElevation:l}=e;return ol({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(n,r)*a,transform:o,unwrappedTileID:s,getElevation:l},i)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let wl;var Sl={get paint(){return wl=wl||new Zo({"hillshade-illumination-direction":new No(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new No(ve.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new No(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new No(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new No(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new No(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new No(ve.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new No(ve.paint_hillshade["hillshade-method"])})}};class Tl extends Ho{constructor(e,t){super(e,Sl,t),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,t=this.paint.get("hillshade-illumination-altitude").values,n=this.paint.get("hillshade-highlight-color").values,r=this.paint.get("hillshade-shadow-color").values;const i=Math.max(e.length,t.length,n.length,r.length);e=e.concat(Array(i-e.length).fill(e.at(-1))),t=t.concat(Array(i-t.length).fill(t.at(-1))),n=n.concat(Array(i-n.length).fill(n.at(-1))),r=r.concat(Array(i-r.length).fill(r.at(-1)));const o=t.map(te);return{directionRadians:e.map(te),altitudeRadians:o,shadowColor:r,highlightColor:n}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}let El;var kl={get paint(){return El=El||new Zo({"color-relief-opacity":new No(ve["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new qo(ve["paint_color-relief"]["color-relief-color"])})}};class Pl{constructor(e,t,n,r){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,r)}update(e,t,n){const{width:r,height:i}=e,o=!(this.size&&this.size[0]===r&&this.size[1]===i||n),{context:a}=this,{gl:s}=a;if(this.useMipmap=Boolean(t&&t.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!t||!1!==t.premultiply)),o)this.size=[r,i],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||K(e)?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,e):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,e.data);else{const{x:t,y:o}=n||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||K(e)?s.texSubImage2D(s.TEXTURE_2D,0,t,o,s.RGBA,s.UNSIGNED_BYTE,e):s.texSubImage2D(s.TEXTURE_2D,0,t,o,r,i,s.RGBA,s.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D),a.pixelStoreUnpackFlipY.setDefault(),a.pixelStoreUnpack.setDefault(),a.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,t,n){const{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_2D,this.texture),n!==i.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=i.LINEAR),e!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Cl{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void Z('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".'));this.stride=t.height;const s=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=r,this.greenFactor=i,this.blueFactor=o,this.baseShift=a;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let l=0;l<s;l++)this.data[this._idx(-1,l)]=this.data[this._idx(0,l)],this.data[this._idx(s,l)]=this.data[this._idx(s-1,l)],this.data[this._idx(l,-1)]=this.data[this._idx(l,0)],this.data[this._idx(l,s)]=this.data[this._idx(l,s-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(s,-1)]=this.data[this._idx(s-1,0)],this.data[this._idx(-1,s)]=this.data[this._idx(0,s-1)],this.data[this._idx(s,s)]=this.data[this._idx(s-1,s-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let l=0;l<s;l++)for(let e=0;e<s;e++){const t=this.get(l,e);t>this.max&&(this.max=t),t<this.min&&(this.min=t)}}get(e,t){const n=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return this.unpack(n[r],n[r+1],n[r+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}unpack(e,t,n){return e*this.redFactor+t*this.greenFactor+n*this.blueFactor-this.baseShift}pack(e){return Il(e,this.getUnpackVector())}getPixels(){return new yl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,i=t*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(t){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}const s=-t*this.dim,l=-n*this.dim;for(let c=o;c<a;c++)for(let t=r;t<i;t++)this.data[this._idx(t,c)]=e.data[this._idx(t+s,c+l)]}}function Il(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],a=Math.min(n,r,i),s=Math.round((e+o)/a);return{r:Math.floor(s*a/n)%256,g:Math.floor(s*a/r)%256,b:Math.floor(s*a/i)%256}}co("DEMData",Cl);class Al extends Ho{constructor(e,t){super(e,kl,t)}_createColorRamp(e){const t={elevationStops:[],colorStops:[]},n=this._transitionablePaint._values["color-relief-color"].value.expression;if(n instanceof ii&&n._styleExpression.expression instanceof fn){this.colorRampExpression=n;const e=n._styleExpression.expression;t.elevationStops=e.labels,t.colorStops=[];for(const n of t.elevationStops)t.colorStops.push(e.evaluate({globals:{elevation:n}}))}if(t.elevationStops.length<1&&(t.elevationStops=[0],t.colorStops=[Pt.transparent]),t.elevationStops.length<2&&(t.elevationStops.push(t.elevationStops[0]+1),t.colorStops.push(t.colorStops[0])),t.elevationStops.length<=e)return t;const r={elevationStops:[],colorStops:[]},i=(t.elevationStops.length-1)/(e-1);for(let o=0;o<t.elevationStops.length-.5;o+=i)r.elevationStops.push(t.elevationStops[Math.round(o)]),r.colorStops.push(t.colorStops[Math.round(o)]);return Z("Too many colors in specification of ".concat(this.id," color-relief layer, may not render properly. Max possible colors: ").concat(e,", provided: ").concat(t.elevationStops.length)),r}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,t,n){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const r=this._createColorRamp(t),i=new yl({width:r.colorStops.length,height:1}),o=new yl({width:r.colorStops.length,height:1});for(let a=0;a<r.elevationStops.length;a++){const e=Il(r.elevationStops[a],n);o.setPixel(0,a,new Pt(e.r/255,e.g/255,e.b/255,1)),i.setPixel(0,a,r.colorStops[a])}return this.colorRampTextures={elevationTexture:new Pl(e,o,e.gl.RGBA),colorTexture:new Pl(e,i,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return"none"!==this.visibility&&!!this.colorRampTextures}}const Ml=ea([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rl}=Ml;function Dl(e,t,n){const r=n.patternDependencies;let i=!1;for(const o of t){const t=o.paint.get("".concat(e,"-pattern"));t.isConstant()||(i=!0);const n=t.constantOr(null);n&&(i=!0,r[n.to]=!0,r[n.from]=!0)}return i}function zl(e,t,n,r,i){const{zoom:o}=r,a=i.patternDependencies;for(const s of t){const t=s.paint.get("".concat(e,"-pattern")).value;if("constant"!==t.kind){let e=t.evaluate({zoom:o-1},n,{},i.availableImages),r=t.evaluate({zoom:o},n,{},i.availableImages),l=t.evaluate({zoom:o+1},n,{},i.availableImages);e=e&&e.name?e.name:e,r=r&&r.name?r.name:r,l=l&&l.name?l.name:l,a[e]=!0,a[r]=!0,a[l]=!0,n.patterns[s.id]={min:e,mid:r,max:l}}}return n}function Ll(e,t,n,r,i){let o;if(i===function(e,t,n,r){let i=0;for(let o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,n,r)>0)for(let a=t;a<n;a+=r)o=rc(a/r|0,e[a],e[a+1],o);else for(let a=n-r;a>=t;a-=r)o=rc(a/r|0,e[a],e[a+1],o);return o&&Jl(o,o.next)&&(ic(o),o=o.next),o}function jl(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Jl(r,r.next)&&0!==Yl(r.prev,r,r.next))r=r.next;else{if(ic(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Ol(e,t,n,r,i,o,a){if(!e)return;!a&&o&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=Zl(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n=1;do{let r,i=e;e=null;let o=null;for(t=0;i;){t++;let a=i,s=0;for(let e=0;e<n&&(s++,a=a.nextZ,a);e++);let l=n;for(;s>0||l>0&&a;)0!==s&&(0===l||!a||i.z<=a.z)?(r=i,i=i.nextZ,s--):(r=a,a=a.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=a}o.nextZ=null,n*=2}while(t>1)}(i)}(e,r,i,o);let s=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(o?Bl(e,r,i,o):Fl(e))t.push(l.i,e.i,c.i),ic(e),e=c.next,s=c.next;else if((e=c)===s){a?1===a?Ol(e=Nl(jl(e),t),t,n,r,i,o,2):2===a&&Ul(e,t,n,r,i,o):Ol(jl(e),t,n,r,i,o,1);break}}}function Fl(e){const t=e.prev,n=e,r=e.next;if(Yl(t,n,r)>=0)return!1;const i=t.x,o=n.x,a=r.x,s=t.y,l=n.y,c=r.y,u=Math.min(i,o,a),h=Math.min(s,l,c),d=Math.max(i,o,a),p=Math.max(s,l,c);let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Xl(i,s,o,l,a,c,f.x,f.y)&&Yl(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Bl(e,t,n,r){const i=e.prev,o=e,a=e.next;if(Yl(i,o,a)>=0)return!1;const s=i.x,l=o.x,c=a.x,u=i.y,h=o.y,d=a.y,p=Math.min(s,l,c),f=Math.min(u,h,d),m=Math.max(s,l,c),g=Math.max(u,h,d),_=Zl(p,f,t,n,r),y=Zl(m,g,t,n,r);let v=e.prevZ,b=e.nextZ;for(;v&&v.z>=_&&b&&b.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==i&&v!==a&&Xl(s,u,l,h,c,d,v.x,v.y)&&Yl(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==a&&Xl(s,u,l,h,c,d,b.x,b.y)&&Yl(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==i&&v!==a&&Xl(s,u,l,h,c,d,v.x,v.y)&&Yl(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==a&&Xl(s,u,l,h,c,d,b.x,b.y)&&Yl(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Nl(e,t){let n=e;do{const r=n.prev,i=n.next.next;!Jl(r,i)&&Ql(r,n,n.next,i)&&tc(r,i)&&tc(i,r)&&(t.push(r.i,n.i,i.i),ic(n),ic(n.next),n=e=i),n=n.next}while(n!==e);return jl(n)}function Ul(e,t,n,r,i,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Kl(a,e)){let s=nc(a,e);return a=jl(a,a.next),s=jl(s,s.next),Ol(a,t,n,r,i,o,0),void Ol(s,t,n,r,i,o,0)}e=e.next}a=a.next}while(a!==e)}function Vl(e,t){let n=e.x-t.x;return 0===n&&(n=e.y-t.y,0===n)&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Gl(e,t){const n=function(e,t){let n=t;const r=e.x,i=e.y;let o,a=-1/0;if(Jl(e,n))return n;do{if(Jl(e,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>a&&(a=e,o=n.x<n.next.x?n:n.next,e===r))return o}n=n.next}while(n!==t);if(!o)return null;const s=o,l=o.x,c=o.y;let u=1/0;n=o;do{if(r>=n.x&&n.x>=l&&r!==n.x&&Hl(i<c?r:a,i,l,c,i<c?a:r,i,n.x,n.y)){const t=Math.abs(i-n.y)/(r-n.x);tc(n,e)&&(t<u||t===u&&(n.x>o.x||n.x===o.x&&ql(o,n)))&&(o=n,u=t)}n=n.next}while(n!==s);return o}(e,t);if(!n)return t;const r=nc(n,e);return jl(r,r.next),jl(n,n.next)}function ql(e,t){return Yl(e.prev,e,t.prev)<0&&Yl(t.next,e,e.next)<0}function Zl(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Wl(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Hl(e,t,n,r,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function Xl(e,t,n,r,i,o,a,s){return!(e===a&&t===s)&&Hl(e,t,n,r,i,o,a,s)}function Kl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ql(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(tc(e,t)&&tc(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Yl(e.prev,e,t.prev)||Yl(e,t.prev,t))||Jl(e,t)&&Yl(e.prev,e,e.next)>0&&Yl(t.prev,t,t.next)>0)}function Yl(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Jl(e,t){return e.x===t.x&&e.y===t.y}function Ql(e,t,n,r){const i=ec(Yl(e,t,n)),o=ec(Yl(e,t,r)),a=ec(Yl(n,r,e)),s=ec(Yl(n,r,t));return i!==o&&a!==s||!(0!==i||!$l(e,n,t))||!(0!==o||!$l(e,r,t))||!(0!==a||!$l(n,e,r))||!(0!==s||!$l(n,t,r))}function $l(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function ec(e){return e>0?1:e<0?-1:0}function tc(e,t){return Yl(e.prev,e,e.next)<0?Yl(e,t,e.next)>=0&&Yl(e,e.prev,t)>=0:Yl(e,t,e.prev)<0||Yl(e,e.next,t)<0}function nc(e,t){const n=oc(e.i,e.x,e.y),r=oc(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function rc(e,t,n,r){const i=oc(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ic(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function oc(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ac{constructor(e,t){if(t>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=t}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class sc{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}sc.noSubdivision=new sc({fill:new ac(0,0),line:new ac(0,0),tile:new ac(0,0),stencil:new ac(0,0),circle:1}),co("SubdivisionGranularityExpression",ac),co("SubdivisionGranularitySetting",sc);const lc=-32768,cc=32767;class uc{constructor(e,t){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=A/e,this._canonical=t}_getKey(e,t){return(e+=32768)<<16|t+32768}_vertexToIndex(e,t){if(e<-32768||t<-32768||e>32767||t>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const n=0|Math.round(e),r=0|Math.round(t),i=this._getKey(n,r);if(this._vertexDictionary.has(i))return this._vertexDictionary.get(i);const o=this._vertexBuffer.length/2;return this._vertexDictionary.set(i,o),this._vertexBuffer.push(n,r),o}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(e,t){const n=[];for(let r=0;r<t.length;r+=3){const i=t[r],o=t[r+1],a=t[r+2],s=e[2*i],l=e[2*i+1];(e[2*o]-s)*(e[2*a+1]-l)-(e[2*o+1]-l)*(e[2*a]-s)>0?(n.push(i),n.push(a),n.push(o)):(n.push(i),n.push(o),n.push(a))}return n}(this._vertexBuffer,e);const t=[],n=e.length;for(let r=0;r<n;r+=3){const n=[e[r+0],e[r+1],e[r+2]],i=[this._vertexBuffer[2*e[r+0]+0],this._vertexBuffer[2*e[r+0]+1],this._vertexBuffer[2*e[r+1]+0],this._vertexBuffer[2*e[r+1]+1],this._vertexBuffer[2*e[r+2]+0],this._vertexBuffer[2*e[r+2]+1]];let o=1/0,a=1/0,s=-1/0,l=-1/0;for(let e=0;e<3;e++){const t=i[2*e],n=i[2*e+1];o=Math.min(o,t),s=Math.max(s,t),a=Math.min(a,n),l=Math.max(l,n)}if(o===s||a===l)continue;const c=Math.floor(o/this._granularityCellSize),u=Math.ceil(s/this._granularityCellSize),h=Math.floor(a/this._granularityCellSize),d=Math.ceil(l/this._granularityCellSize);if(c!==u||h!==d)for(let e=h;e<d;e++){const r=this._scanlineGenerateVertexRingForCellRow(e,i,n);pc(this._vertexBuffer,r,t)}else t.push(...n)}return t}_scanlineGenerateVertexRingForCellRow(e,t,n){const r=e*this._granularityCellSize,i=r+this._granularityCellSize,o=[];for(let a=0;a<3;a++){const e=t[2*a],s=t[2*a+1],l=t[2*(a+1)%6],c=t[(2*(a+1)+1)%6],u=t[2*(a+2)%6],h=t[(2*(a+2)+1)%6],d=l-e,p=c-s,f=0===d,m=0===p,g=(r-s)/p,_=(i-s)/p,y=Math.min(g,_),v=Math.max(g,_);if(!m&&(y>=1||v<=0)||m&&(s<r||s>i)){c>=r&&c<=i&&o.push(n[(a+1)%3]);continue}!m&&y>0&&o.push(this._vertexToIndex(e+d*y,s+p*y));const b=e+d*Math.max(y,0),x=e+d*Math.min(v,1);f||this._generateIntraEdgeVertices(o,e,s,l,c,b,x),!m&&v<1&&o.push(this._vertexToIndex(e+d*v,s+p*v)),(m||c>=r&&c<=i)&&o.push(n[(a+1)%3]),!m&&(c<=r||c>=i)&&this._generateInterEdgeVertices(o,e,s,l,c,u,h,x,r,i)}return o}_generateIntraEdgeVertices(e,t,n,r,i,o,a){const s=r-t,l=i-n,c=0===l,u=c?Math.min(t,r):Math.min(o,a),h=c?Math.max(t,r):Math.max(o,a),d=Math.floor(u/this._granularityCellSize)+1,p=Math.ceil(h/this._granularityCellSize)-1;if(c?t<r:o<a)for(let f=d;f<=p;f++){const r=f*this._granularityCellSize;e.push(this._vertexToIndex(r,n+l*(r-t)/s))}else for(let f=p;f>=d;f--){const r=f*this._granularityCellSize;e.push(this._vertexToIndex(r,n+l*(r-t)/s))}}_generateInterEdgeVertices(e,t,n,r,i,o,a,s,l,c){const u=i-n,h=o-r,d=a-i,p=(l-i)/d,f=(c-i)/d,m=Math.min(p,f),g=Math.max(p,f),_=r+h*m;let y=Math.floor(Math.min(_,s)/this._granularityCellSize)+1,v=Math.ceil(Math.max(_,s)/this._granularityCellSize)-1,b=s<_;const x=0===d;if(x&&(a===l||a===c))return;if(x||m>=1||g<=0){const e=n-a,r=o+(t-o)*Math.min((l-a)/e,(c-a)/e);y=Math.floor(Math.min(r,s)/this._granularityCellSize)+1,v=Math.ceil(Math.max(r,s)/this._granularityCellSize)-1,b=s<r}const w=u>0?c:l;if(b)for(let S=y;S<=v;S++)e.push(this._vertexToIndex(S*this._granularityCellSize,w));else for(let S=v;S>=y;S--)e.push(this._vertexToIndex(S*this._granularityCellSize,w))}_generateOutline(e){const t=[];for(const n of e){const e=dc(n,this._granularity,!0),r=this._pointArrayToIndices(e),i=[];for(let t=1;t<r.length;t++)i.push(r[t-1]),i.push(r[t]);t.push(i)}return t}_handlePoles(e){let t=!1,n=!1;this._canonical&&(0===this._canonical.y&&(t=!0),this._canonical.y===(1<<this._canonical.z)-1&&(n=!0)),(t||n)&&this._fillPoles(e,t,n)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let t=0;t<e.length;t+=2){const n=e[t+1];n===lc&&(e[t+1]=-32767),n===cc&&(e[t+1]=32766)}}_generatePoleQuad(e,t,n,r,i,o){r>i!=(o===lc)?(e.push(t),e.push(n),e.push(this._vertexToIndex(r,o)),e.push(n),e.push(this._vertexToIndex(i,o)),e.push(this._vertexToIndex(r,o))):(e.push(n),e.push(t),e.push(this._vertexToIndex(r,o)),e.push(this._vertexToIndex(i,o)),e.push(n),e.push(this._vertexToIndex(r,o)))}_fillPoles(e,t,n){const r=this._vertexBuffer,i=A,o=e.length;for(let a=2;a<o;a+=3){const o=e[a-2],s=e[a-1],l=e[a],c=r[2*o],u=r[2*o+1],h=r[2*s],d=r[2*s+1],p=r[2*l],f=r[2*l+1];t&&(0===u&&0===d&&this._generatePoleQuad(e,o,s,c,h,lc),0===d&&0===f&&this._generatePoleQuad(e,s,l,h,p,lc),0===f&&0===u&&this._generatePoleQuad(e,l,o,p,c,lc)),n&&(u===i&&d===i&&this._generatePoleQuad(e,o,s,c,h,cc),d===i&&f===i&&this._generatePoleQuad(e,s,l,h,p,cc),f===i&&u===i&&this._generatePoleQuad(e,l,o,p,c,cc))}}_initializeVertices(e){for(let t=0;t<e.length;t+=2)this._vertexToIndex(e[t],e[t+1])}subdividePolygonInternal(e,t){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:n,holeIndices:r}=function(e){const t=[],n=[];for(const r of e)if(0!==r.length){r!==e[0]&&t.push(n.length/2);for(let e=0;e<r.length;e++)n.push(r[e].x),n.push(r[e].y)}return{flattened:n,holeIndices:t}}(e);let i;this._initializeVertices(n);try{const e=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const r=t&&t.length,i=r?t[0]*n:e.length;let o=Ll(e,0,i,n,!0);const a=[];if(!o||o.next===o.prev)return a;let s,l,c;if(r&&(o=function(e,t,n,r){const i=[];for(let o=0,a=t.length;o<a;o++){const n=Ll(e,t[o]*r,o<a-1?t[o+1]*r:e.length,r,!1);n===n.next&&(n.steiner=!0),i.push(Wl(n))}i.sort(Vl);for(let o=0;o<i.length;o++)n=Gl(i[o],n);return n}(e,t,o,n)),e.length>80*n){s=e[0],l=e[1];let t=s,r=l;for(let o=n;o<i;o+=n){const n=e[o],i=e[o+1];n<s&&(s=n),i<l&&(l=i),n>t&&(t=n),i>r&&(r=i)}c=Math.max(t-s,r-l),c=0!==c?32767/c:0}return Ol(o,a,n,s,l,c,0),a}(n,r),t=this._convertIndices(n,e);i=this._subdivideTrianglesScanline(t)}catch(e){console.error(e)}let o=[];return t&&(o=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(i),{verticesFlattened:this._vertexBuffer,indicesTriangles:i,indicesLineList:o}}_convertIndices(e,t){const n=[];for(let r=0;r<t.length;r++)n.push(this._vertexToIndex(e[2*t[r]],e[2*t[r]+1]));return n}_pointArrayToIndices(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];t.push(this._vertexToIndex(r.x,r.y))}return t}}function hc(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new uc(n,t).subdividePolygonInternal(e,r)}function dc(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||e.length<1)return[];if(e.length<2)return[];const i=e[0],o=e[e.length-1],a=r&&(i.x!==o.x||i.y!==o.y);if(t<2)return a?[...e,e[0]]:[...e];const s=Math.floor(A/t),l=[];l.push(new n(e[0].x,e[0].y));const c=e.length,u=a?c:c-1;for(let h=0;h<u;h++){const t=e[h],r=h<c-1?e[h+1]:e[0],i=t.x,o=t.y,a=r.x,u=r.y,d=i!==a,p=o!==u;if(!d&&!p)continue;const f=a-i,m=u-o,g=Math.abs(f),_=Math.abs(m);let y=i,v=o;for(;;){const e=f>0?(Math.floor(y/s)+1)*s:(Math.ceil(y/s)-1)*s,t=m>0?(Math.floor(v/s)+1)*s:(Math.ceil(v/s)-1)*s,r=Math.abs(y-e),i=Math.abs(v-t),o=Math.abs(y-a),c=Math.abs(v-u),h=d?r/g:Number.POSITIVE_INFINITY,b=p?i/_:Number.POSITIVE_INFINITY;if((o<=r||!d)&&(c<=i||!p))break;if(h<b&&d||!p){y=e,v+=m*h;const t=new n(y,Math.round(v));l[l.length-1].x===t.x&&l[l.length-1].y===t.y||l.push(t)}else{y+=f*b,v=t;const e=new n(Math.round(y),v);l[l.length-1].x===e.x&&l[l.length-1].y===e.y||l.push(e)}}const b=new n(a,u);l[l.length-1].x===b.x&&l[l.length-1].y===b.y||l.push(b)}return l}function pc(e,t,n){if(0===t.length)throw new Error("Subdivision vertex ring is empty.");let r=0,i=e[2*t[0]];for(let l=1;l<t.length;l++){const n=e[2*t[l]];n<i&&(i=n,r=l)}const o=t.length;let a=r,s=(a+1)%o;for(;;){const r=a-1>=0?a-1:o-1,i=(s+1)%o,l=e[2*t[r]],c=e[2*t[i]],u=e[2*t[a]],h=e[2*t[a]+1],d=e[2*t[s]+1];let p=!1;if(l<c)p=!0;else if(l>c)p=!1;else{const n=d-h,o=-(e[2*t[s]]-u),a=h<d?1:-1;((l-u)*n+(e[2*t[r]+1]-h)*o)*a>((c-u)*n+(e[2*t[i]+1]-h)*o)*a&&(p=!0)}if(p){const e=t[r],i=t[a],l=t[s];e!==i&&e!==l&&i!==l&&n.push(l,i,e),a--,a<0&&(a=o-1)}else{const e=t[i],r=t[a],l=t[s];e!==r&&e!==l&&r!==l&&n.push(l,r,e),s++,s>=o&&(s=0)}if(r===i)break}}function fc(e,t,n,r,i,o,a,s,l){const c=i.length/2,u=a&&s&&l;if(c<ts.MAX_VERTEX_ARRAY_LENGTH){const h=t.prepareSegment(c,n,r),d=h.vertexLength;for(let e=0;e<o.length;e+=3)r.emplaceBack(d+o[e],d+o[e+1],d+o[e+2]);let p,f;h.vertexLength+=c,h.primitiveLength+=o.length/3,u&&(f=a.prepareSegment(c,n,s),p=f.vertexLength,f.vertexLength+=c);for(let t=0;t<i.length;t+=2)e(i[t],i[t+1]);if(u)for(let e=0;e<l.length;e++){const t=l[e];for(let e=1;e<t.length;e+=2)s.emplaceBack(p+t[e-1],p+t[e]);f.primitiveLength+=t.length/2}}else!function(e,t,n,r,i,o){const a=[];for(let h=0;h<r.length/2;h++)a.push(-1);const s={count:0};let l=0,c=e.getOrCreateLatestSegment(t,n),u=c.vertexLength;for(let h=2;h<i.length;h+=3){const d=i[h-2],p=i[h-1],f=i[h];let m=a[d]<l,g=a[p]<l,_=a[f]<l;c.vertexLength+((m?1:0)+(g?1:0)+(_?1:0))>ts.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,n),l=s.count,m=!0,g=!0,_=!0,u=0);const y=mc(a,r,o,s,d,m,c),v=mc(a,r,o,s,p,g,c),b=mc(a,r,o,s,f,_,c);n.emplaceBack(u+y-l,u+v-l,u+b-l),c.primitiveLength++}}(t,n,r,i,o,e),u&&function(e,t,n,r,i,o){const a=[];for(let h=0;h<r.length/2;h++)a.push(-1);const s={count:0};let l=0,c=e.getOrCreateLatestSegment(t,n),u=c.vertexLength;for(let h=0;h<i.length;h++){const d=i[h];for(let p=1;p<i[h].length;p+=2){const i=d[p-1],h=d[p];let f=a[i]<l,m=a[h]<l;c.vertexLength+((f?1:0)+(m?1:0))>ts.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,n),l=s.count,f=!0,m=!0,u=0);const g=mc(a,r,o,s,i,f,c),_=mc(a,r,o,s,h,m,c);n.emplaceBack(u+g-l,u+_-l),c.primitiveLength++}}}(a,n,s,i,l,e),t.forceNewSegmentOnNextPrepare(),null==a||a.forceNewSegmentOnNextPrepare()}function mc(e,t,n,r,i,o,a){if(o){const o=r.count;return n(t[2*i],t[2*i+1]),e[i]=r.count,r.count++,a.vertexLength++,o}return e[i]}class gc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Na,this.indexArray=new Ja,this.indexArray2=new Qa,this.programConfigurations=new Ms(e.layers,e.zoom),this.segments=new ts,this.segments2=new ts,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n){this.hasDependencies=Dl("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),i=!r.isConstant(),o=[];for(const{feature:a,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Os(a,e);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom),u,n))continue;const h=i?r.evaluate(u,{},n,t.availableImages):void 0,d={id:s,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:js(a),patterns:{},sortKey:h};o.push(d)}i&&o.sort((e,t)=>e.sortKey-t.sortKey);for(const a of o){const{geometry:r,index:i,sourceLayerIndex:o}=a;if(this.hasDependencies){const e=zl("fill",this.layers,a,{zoom:this.zoom},t);this.patternFeatures.push(e)}else this.addFeature(a,r,i,n,{},t.subdivisionGranularity);t.featureIndex.insert(e[i].feature,r,i,o,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,{imagePositions:n})}addFeatures(e,t,n){for(const r of this.patternFeatures)this.addFeature(r,r.geometry,r.index,t,n,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rl),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,r,i,o){for(const a of tr(t,500)){const e=hc(a,r,o.fill.getGranularityForZoomLevel(r.z)),t=this.layoutVertexArray;fc((e,n)=>{t.emplaceBack(e,n)},this.segments,this.layoutVertexArray,this.indexArray,e.verticesFlattened,e.indicesTriangles,this.segments2,this.indexArray2,e.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{imagePositions:i,canonical:r})}}let _c,yc;co("FillBucket",gc,{omit:["layers","patternFeatures"]});var vc={get paint(){return yc=yc||new Zo({"fill-antialias":new No(ve.paint_fill["fill-antialias"]),"fill-opacity":new Uo(ve.paint_fill["fill-opacity"]),"fill-color":new Uo(ve.paint_fill["fill-color"]),"fill-outline-color":new Uo(ve.paint_fill["fill-outline-color"]),"fill-translate":new No(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new No(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vo(ve.paint_fill["fill-pattern"])})},get layout(){return _c=_c||new Zo({"fill-sort-key":new Uo(ve.layout_fill["fill-sort-key"])})}};class bc extends Ho{constructor(e,t){super(e,vc,t)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new gc(e)}queryRadius(){return $s(this.paint.get("fill-translate"))}queryIntersectsFeature(e){let{queryGeometry:t,geometry:n,transform:r,pixelsToTileUnits:i}=e;return Gs(el(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-r.bearingInRadians,i),n)}isTileClipped(){return!0}}const xc=ea([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),wc=ea([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Sc}=xc;class Tc{constructor(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(Ec,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos,r=[];let i,o=1,a=0,s=0,l=0;for(;e.pos<t;){if(a<=0){const t=e.readVarint();o=7&t,a=t>>3}if(a--,1===o||2===o)s+=e.readSVarint(),l+=e.readSVarint(),1===o&&(i&&r.push(i),i=[]),i&&i.push(new n(s,l));else{if(7!==o)throw new Error("unknown command ".concat(o));i&&i.push(i[0].clone())}}return i&&r.push(i),r}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let n=1,r=0,i=0,o=0,a=1/0,s=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(r<=0){const t=e.readVarint();n=7&t,r=t>>3}if(r--,1===n||2===n)i+=e.readSVarint(),o+=e.readSVarint(),i<a&&(a=i),i>s&&(s=i),o<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command ".concat(n))}return[a,l,s,c]}toGeoJSON(e,t,n){const r=this.extent*Math.pow(2,n),i=this.extent*e,o=this.extent*t,a=this.loadGeometry();function s(e){return[360*(e.x+i)/r-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/r)*Math.PI))-90]}function l(e){return e.map(s)}let c;if(1===this.type){const e=[];for(const n of a)e.push(n[0]);const t=l(e);c=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t}}else if(2===this.type){const e=a.map(l);c=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=function(e){const t=e.length;if(t<=1)return[e];const n=[];let r,i;for(let o=0;o<t;o++){const t=kc(e[o]);0!==t&&(void 0===i&&(i=t<0),i===t<0?(r&&n.push(r),r=[e[o]]):r&&r.push(e[o]))}return r&&n.push(r),n}(a),t=[];for(const n of e)t.push(n.map(l));c=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}}}const u={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function Ec(e,t,n){1===e?t.id=n.readVarint():2===e?function(e,t){const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[n]=r}}(n,t):3===e?t.type=n.readVarint():4===e&&(t._geometry=n.pos)}function kc(e){let t=0;for(let n,r,i=0,o=e.length,a=o-1;i<o;a=i++)n=e[i],r=e[a],t+=(r.x-n.x)*(n.y+r.y);return t}Tc.types=["Unknown","Point","LineString","Polygon"];class Pc{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Cc,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new Tc(this._pbf,t,this.extent,this._keys,this._values)}}function Cc(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){let t=null;const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}if(null==t)throw new Error("unknown feature value");return t}(n))}class Ic{constructor(e,t){this.layers=e.readFields(Ac,{},t)}}function Ac(e,t,n){if(3===e){const e=new Pc(n,n.readVarint()+n.pos);e.length&&(t[e.name]=e)}}const Mc=Math.pow(2,13);function Rc(e,t,n,r,i,o,a,s){e.emplaceBack(t,n,2*Math.floor(r*Mc)+a,i*Mc*2,o*Mc*2,Math.round(s))}class Dc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Ua,this.centroidVertexArray=new Fa,this.indexArray=new Ja,this.programConfigurations=new Ms(e.layers,e.zoom),this.segments=new ts,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n){this.features=[],this.hasDependencies=Dl("fill-extrusion",this.layers,t);for(const{feature:r,id:i,index:o,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,s=Os(r,e);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom),s,n))continue;const l={id:i,sourceLayerIndex:a,index:o,geometry:e?s.geometry:js(r),properties:r.properties,type:r.type,patterns:{}};this.hasDependencies?this.features.push(zl("fill-extrusion",this.layers,l,{zoom:this.zoom},t)):this.addFeature(l,l.geometry,o,n,{},t.subdivisionGranularity),t.featureIndex.insert(r,l.geometry,o,a,this.index,!0)}}addFeatures(e,t,n){for(const r of this.features){const{geometry:i}=r;this.addFeature(r,i,r.index,t,n,e.subdivisionGranularity)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,{imagePositions:n})}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sc),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,wc.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,t,n,r,i,o){for(const a of tr(t,500)){const t={x:0,y:0,sampleCount:0},n=this.layoutVertexArray.length;this.processPolygon(t,r,e,a,o);const i=this.layoutVertexArray.length-n,s=Math.floor(t.x/t.sampleCount),l=Math.floor(t.y/t.sampleCount);for(let e=0;e<i;e++)this.centroidVertexArray.emplaceBack(s,l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{imagePositions:i,canonical:r})}processPolygon(e,t,n,r,i){if(r.length<1)return;if(jc(r[0]))return;for(const u of r)0!==u.length&&zc(e,u);const o={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},a=i.fill.getGranularityForZoomLevel(t.z),s="Polygon"===Tc.types[n.type];for(const u of r){if(0===u.length)continue;if(jc(u))continue;const e=dc(u,a,s);this._generateSideFaces(e,o)}if(!s)return;const l=hc(r,t,a,!1),c=this.layoutVertexArray;fc((e,t)=>{Rc(c,e,t,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,l.verticesFlattened,l.indicesTriangles)}_generateSideFaces(e,t){let n=0;for(let r=1;r<e.length;r++){const i=e[r],o=e[r-1];if(Lc(i,o))continue;t.segment.vertexLength+4>ts.MAX_VERTEX_ARRAY_LENGTH&&(t.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const a=i.sub(o)._perp()._unit(),s=o.dist(i);n+s>32768&&(n=0),Rc(this.layoutVertexArray,i.x,i.y,a.x,a.y,0,0,n),Rc(this.layoutVertexArray,i.x,i.y,a.x,a.y,0,1,n),n+=s,Rc(this.layoutVertexArray,o.x,o.y,a.x,a.y,0,0,n),Rc(this.layoutVertexArray,o.x,o.y,a.x,a.y,0,1,n);const l=t.segment.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),t.segment.vertexLength+=4,t.segment.primitiveLength+=2}}}function zc(e,t){for(let n=0;n<t.length;n++){const r=t[n];n===t.length-1&&t[0].x===r.x&&t[0].y===r.y||(e.x+=r.x,e.y+=r.y,e.sampleCount++)}}function Lc(e,t){return e.x===t.x&&(e.x<0||e.x>A)||e.y===t.y&&(e.y<0||e.y>A)}function jc(e){return e.every(e=>e.x<0)||e.every(e=>e.x>A)||e.every(e=>e.y<0)||e.every(e=>e.y>A)}let Oc;co("FillExtrusionBucket",Dc,{omit:["layers","features"]});var Fc={get paint(){return Oc=Oc||new Zo({"fill-extrusion-opacity":new No(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Uo(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new No(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new No(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vo(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Uo(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Uo(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new No(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Bc extends Ho{constructor(e,t){super(e,Fc,t)}createBucket(e){return new Dc(e)}queryRadius(){return $s(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e){let{queryGeometry:t,feature:r,featureState:i,geometry:o,transform:a,pixelsToTileUnits:s,pixelPosMatrix:l}=e;const c=el(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-a.bearingInRadians,s),u=this.paint.get("fill-extrusion-height").evaluate(r,i),h=this.paint.get("fill-extrusion-base").evaluate(r,i),d=function(e,t){const r=[];for(const i of e){const e=[i.x,i.y,0,1];E(e,e,t),r.push(new n(e[0]/e[3],e[1]/e[3]))}return r}(c,l),p=function(e,t,r,i){const o=[],a=[],s=i[8]*t,l=i[9]*t,c=i[10]*t,u=i[11]*t,h=i[8]*r,d=i[9]*r,p=i[10]*r,f=i[11]*r;for(const m of e){const e=[],t=[];for(const r of m){const o=r.x,a=r.y,m=i[0]*o+i[4]*a+i[12],g=i[1]*o+i[5]*a+i[13],_=i[2]*o+i[6]*a+i[14],y=i[3]*o+i[7]*a+i[15],v=_+c,b=y+u,x=m+h,w=g+d,S=_+p,T=y+f,E=new n((m+s)/b,(g+l)/b);E.z=v/b,e.push(E);const k=new n(x/T,w/T);k.z=S/T,t.push(k)}o.push(e),a.push(t)}return[o,a]}(o,h,u,l);return function(e,t,n){let r=1/0;Gs(n,t)&&(r=Uc(n,t[0]));for(let i=0;i<t.length;i++){const o=t[i],a=e[i];for(let e=0;e<o.length-1;e++){const t=o[e],i=[t,o[e+1],a[e+1],a[e],t];Us(n,i)&&(r=Math.min(r,Uc(n,i)))}}return r!==1/0&&r}(p[0],p[1],d)}}function Nc(e,t){return e.x*t.x+e.y*t.y}function Uc(e,t){if(1===e.length){let n=0;const r=t[n++];let i;for(;!i||r.equals(i);)if(i=t[n++],!i)return 1/0;for(;n<t.length;n++){const o=t[n],a=e[0],s=i.sub(r),l=o.sub(r),c=a.sub(r),u=Nc(s,s),h=Nc(s,l),d=Nc(l,l),p=Nc(c,s),f=Nc(c,l),m=u*d-h*h,g=(d*p-h*f)/m,_=(u*f-h*p)/m,y=r.z*(1-g-_)+i.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}const Vc=ea([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Gc}=Vc,qc=ea([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Zc}=qc,Wc=Math.cos(Math.PI/180*37.5),Hc=Math.pow(2,14)/.5;class Xc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new Va,this.layoutVertexArray2=new Ga,this.indexArray=new Ja,this.programConfigurations=new Ms(e.layers,e.zoom),this.segments=new ts,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n){this.hasDependencies=Dl("line",this.layers,t)||this.hasLineDasharray(this.layers);const r=this.layers[0].layout.get("line-sort-key"),i=!r.isConstant(),o=[];for(const{feature:a,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Os(a,e);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom),t,n))continue;const u=i?r.evaluate(t,{},n):void 0,h={id:s,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:e?t.geometry:js(a),patterns:{},dashes:{},sortKey:u};o.push(h)}i&&o.sort((e,t)=>e.sortKey-t.sortKey);for(const a of o){const{geometry:r,index:i,sourceLayerIndex:o}=a;this.hasDependencies?(Dl("line",this.layers,t)?zl("line",this.layers,a,{zoom:this.zoom},t):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,a,this.zoom,t),this.patternFeatures.push(a)):this.addFeature(a,r,i,n,{},{},t.subdivisionGranularity),t.featureIndex.insert(e[i].feature,r,i,o,this.index)}}update(e,t,n,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,{imagePositions:n,dashPositions:r})}addFeatures(e,t,n,r){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,n,r,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Zc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,r,i,o,a){const s=this.layers[0].layout,l=s.get("line-join").evaluate(e,{}),c=s.get("line-cap"),u=s.get("line-miter-limit"),h=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const d of t)this.addLine(d,e,l,c,u,h,r,a);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{imagePositions:i,dashPositions:o,canonical:r})}addLine(e,t,n,r,i,o,a,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=dc(e,a?s.line.getGranularityForZoomLevel(a.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===Tc.types[t.type];let c=e.length;for(;c>=2&&e[c-1].equals(e[c-2]);)c--;let u=0;for(;u<c-1&&e[u].equals(e[u+1]);)u++;if(c<(l?3:2))return;"bevel"===n&&(i=1.05);const h=this.overscaling<=16?122880/(512*this.overscaling):0,d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let p,f,m,g,_;this.e1=this.e2=-1,l&&(p=e[c-2],_=e[u].sub(p)._unit()._perp());for(let y=u;y<c;y++){if(m=y===c-1?l?e[u+1]:void 0:e[y+1],m&&e[y].equals(m))continue;_&&(g=_),p&&(f=p),p=e[y],_=m?m.sub(p)._unit()._perp():g,g=g||_;let t=g.add(_);0===t.x&&0===t.y||t._unit();const a=g.x*_.x+g.y*_.y,s=t.x*_.x+t.y*_.y,v=0!==s?1/s:1/0,b=2*Math.sqrt(2-2*s),x=s<Wc&&f&&m,w=g.x*_.y-g.y*_.x>0;if(x&&y>u){const e=p.dist(f);if(e>2*h){const t=p.sub(p.sub(f)._mult(h/e)._round());this.updateDistance(f,t),this.addCurrentVertex(t,g,0,0,d),f=t}}const S=f&&m;let T=S?n:l?"butt":r;if(S&&"round"===T&&(v<o?T="miter":v<=2&&(T="fakeround")),"miter"===T&&v>i&&(T="bevel"),"bevel"===T&&(v>2&&(T="flipbevel"),v<i&&(T="miter")),f&&this.updateDistance(f,p),"miter"===T)t._mult(v),this.addCurrentVertex(p,t,0,0,d);else if("flipbevel"===T){if(v>100)t=_.mult(-1);else{const e=v*g.add(_).mag()/g.sub(_).mag();t._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(p,t,0,0,d),this.addCurrentVertex(p,t.mult(-1),0,0,d)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(v*v-1),t=w?e:0,n=w?0:e;if(f&&this.addCurrentVertex(p,g,t,n,d),"fakeround"===T){const e=Math.round(180*b/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+a*(a*(3.55645-1.43519*a)-3.2452))*e*e+(.848013+a*(.215638*a-1.06021)))}const r=_.sub(g)._mult(n)._add(g)._unit()._mult(w?-1:1);this.addHalfVertex(p,r.x,r.y,!1,w,0,d)}}m&&this.addCurrentVertex(p,_,-t,-n,d)}else if("butt"===T)this.addCurrentVertex(p,t,0,0,d);else if("square"===T){const e=f?1:-1;this.addCurrentVertex(p,t,e,e,d)}else"round"===T&&(f&&(this.addCurrentVertex(p,g,0,0,d),this.addCurrentVertex(p,g,1,1,d,!0)),m&&(this.addCurrentVertex(p,_,-1,-1,d,!0),this.addCurrentVertex(p,_,0,0,d)));if(x&&y<c-1){const e=p.dist(m);if(e>2*h){const t=p.add(m.sub(p)._mult(h/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,_,0,0,d),p=t}}}}addCurrentVertex(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=t.y*r-t.x,s=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,i),this.addHalfVertex(e,a,s,o,!0,-r,i),this.distance>Hc/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,n,r,i,o))}addHalfVertex(e,t,n,r,i,o,a){let{x:s,y:l}=e;const c=.5*(this.lineClips?this.scaledDistance*(Hc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(r?1:0),(l<<1)+(i?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1)|(63&c)<<2,c>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,u,this.e2),a.primitiveLength++),i?this.e2=u:this.e1=u}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}hasLineDasharray(e){for(const t of e){const e=t.paint.get("line-dasharray");if(e&&!e.isConstant())return!0}return!1}addLineDashDependencies(e,t,n,r){for(const i of e){const e=i.paint.get("line-dasharray");if(!e||"constant"===e.value.kind)continue;const o="round"===i.layout.get("line-cap"),a={dasharray:e.value.evaluate({zoom:n-1},t,{}),round:o},s={dasharray:e.value.evaluate({zoom:n},t,{}),round:o},l={dasharray:e.value.evaluate({zoom:n+1},t,{}),round:o},c="".concat(a.dasharray.join(","),",").concat(a.round),u="".concat(s.dasharray.join(","),",").concat(s.round),h="".concat(l.dasharray.join(","),",").concat(l.round);r.dashDependencies[c]=a,r.dashDependencies[u]=s,r.dashDependencies[h]=l,t.dashes[i.id]={min:c,mid:u,max:h}}}}let Kc,Yc;co("LineBucket",Xc,{omit:["layers","patternFeatures"]});var Jc={get paint(){return Yc=Yc||new Zo({"line-opacity":new Uo(ve.paint_line["line-opacity"]),"line-color":new Uo(ve.paint_line["line-color"]),"line-translate":new No(ve.paint_line["line-translate"]),"line-translate-anchor":new No(ve.paint_line["line-translate-anchor"]),"line-width":new Uo(ve.paint_line["line-width"]),"line-gap-width":new Uo(ve.paint_line["line-gap-width"]),"line-offset":new Uo(ve.paint_line["line-offset"]),"line-blur":new Uo(ve.paint_line["line-blur"]),"line-dasharray":new Vo(ve.paint_line["line-dasharray"]),"line-pattern":new Vo(ve.paint_line["line-pattern"]),"line-gradient":new qo(ve.paint_line["line-gradient"])})},get layout(){return Kc=Kc||new Zo({"line-cap":new No(ve.layout_line["line-cap"]),"line-join":new Uo(ve.layout_line["line-join"]),"line-miter-limit":new No(ve.layout_line["line-miter-limit"]),"line-round-limit":new No(ve.layout_line["line-round-limit"]),"line-sort-key":new Uo(ve.layout_line["line-sort-key"])})}};class Qc extends Uo{possiblyEvaluate(e,t){return t=new Ao(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,r){return t=B({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,r)}}let $c;class eu extends Ho{constructor(e,t){super(e,Jc,t),this.gradientVersion=0,$c||($c=new Qc(Jc.paint.properties["line-width"].specification),$c.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this.gradientExpression();this.stepInterpolant=!!function(e){return void 0!==e._styleExpression}(e)&&e._styleExpression.expression instanceof ln,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=$c.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Xc(e)}queryRadius(e){const t=e,n=tu(Qs("line-width",this,t),Qs("line-gap-width",this,t)),r=Qs("line-offset",this,t);return n/2+Math.abs(r)+$s(this.paint.get("line-translate"))}queryIntersectsFeature(e){let{queryGeometry:t,feature:r,featureState:i,geometry:o,transform:a,pixelsToTileUnits:s}=e;const l=el(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-a.bearingInRadians,s),c=s/2*tu(this.paint.get("line-width").evaluate(r,i),this.paint.get("line-gap-width").evaluate(r,i)),u=this.paint.get("line-offset").evaluate(r,i);return u&&(o=function(e,t){const r=[];for(let i=0;i<e.length;i++){const o=e[i],a=[];for(let e=0;e<o.length;e++){const r=o[e-1],i=o[e],s=o[e+1],l=0===e?new n(0,0):i.sub(r)._unit()._perp(),c=e===o.length-1?new n(0,0):s.sub(i)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),a.push(u._mult(t)._add(i))}r.push(a)}return r}(o,u*s)),function(e,t,n){for(let r=0;r<t.length;r++){const i=t[r];if(e.length>=3)for(let t=0;t<i.length;t++)if(Ys(e,i[t]))return!0;if(qs(e,i,n))return!0}return!1}(l,o,c)}isTileClipped(){return!0}}function tu(e,t){return t>0?t+2*e:e}const nu=ea([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ru=ea([{name:"a_projected_pos",components:3,type:"Float32"}],4);ea([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const iu=ea([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ea([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ou=ea([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),au=ea([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function su(e,t,n){return e.sections.forEach(e=>{e.text=function(e,t,n){const r=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Io.applyArabicShaping&&(e=Io.applyArabicShaping(e)),e}(e.text,t,n)}),e}ea([{name:"triangle",components:3,type:"Uint16"}]),ea([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ea([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ea([{type:"Float32",name:"offsetX"}]),ea([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ea([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const lu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var cu=24;const uu=4294967296,hu=1/uu,du="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");class pu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array(16);this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length;for(;this.pos<n;){const n=this.readVarint(),r=n>>3,i=this.pos;this.type=7&n,e(r,t,this),this.pos===i&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*uu;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*uu;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let n,r;return r=t[this.pos++],n=127&r,r<128?n:(r=t[this.pos++],n|=(127&r)<<7,r<128?n:(r=t[this.pos++],n|=(127&r)<<14,r<128?n:(r=t[this.pos++],n|=(127&r)<<21,r<128?n:(r=t[this.pos],n|=(15&r)<<28,function(e,t,n){const r=n.buf;let i,o;if(o=r[n.pos++],i=(112&o)>>4,o<128)return fu(e,i,t);if(o=r[n.pos++],i|=(127&o)<<3,o<128)return fu(e,i,t);if(o=r[n.pos++],i|=(127&o)<<10,o<128)return fu(e,i,t);if(o=r[n.pos++],i|=(127&o)<<17,o<128)return fu(e,i,t);if(o=r[n.pos++],i|=(127&o)<<24,o<128)return fu(e,i,t);if(o=r[n.pos++],i|=(1&o)<<31,o<128)return fu(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(n,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&du?du.decode(this.buf.subarray(t,e)):function(e,t,n){let r="",i=t;for(;i<n;){const t=e[i];let o,a,s,l=null,c=t>239?4:t>223?3:t>191?2:1;if(i+c>n)break;1===c?t<128&&(l=t):2===c?(o=e[i+1],128==(192&o)&&(l=(31&t)<<6|63&o,l<=127&&(l=null))):3===c?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(l=(15&t)<<12|(63&o)<<6|63&a,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&t)<<18|(63&o)<<12|(63&a)<<6|63&s,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readVarint(t));return e}readPackedSVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const t=7&e;if(0===t)for(;this.buf[this.pos++]>127;);else if(2===t)this.pos=this.readVarint()+this.pos;else if(5===t)this.pos+=4;else{if(1!==t)throw new Error("Unimplemented type: ".concat(t));this.pos+=8}}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*hu),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*hu),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,t){let n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(n=~(-e%4294967296),r=~(-e/4294967296),4294967295^n?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){const n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const t=this.pos;this.pos=function(e,t,n){for(let r,i,o=0;o<t.length;o++){if(r=t.charCodeAt(o),r>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);const n=this.pos-t;n>=128&&mu(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let n=0;n<t;n++)this.buf[this.pos++]=e[n]}writeRawMessage(e,t){this.pos++;const n=this.pos;e(t,this);const r=this.pos-n;r>=128&&mu(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r}writeMessage(e,t,n){this.writeTag(e,2),this.writeRawMessage(t,n)}writePackedVarint(e,t){t.length&&this.writeMessage(e,gu,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,_u,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,bu,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,yu,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,vu,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,xu,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,wu,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,Su,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,Tu,t)}writeBytesField(e,t){this.writeTag(e,2),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,5),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,5),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,1),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,1),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,0),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,0),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,2),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,5),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,1),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}}function fu(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function mu(e,t,n){const r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(let i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function gu(e,t){for(let n=0;n<e.length;n++)t.writeVarint(e[n])}function _u(e,t){for(let n=0;n<e.length;n++)t.writeSVarint(e[n])}function yu(e,t){for(let n=0;n<e.length;n++)t.writeFloat(e[n])}function vu(e,t){for(let n=0;n<e.length;n++)t.writeDouble(e[n])}function bu(e,t){for(let n=0;n<e.length;n++)t.writeBoolean(e[n])}function xu(e,t){for(let n=0;n<e.length;n++)t.writeFixed32(e[n])}function wu(e,t){for(let n=0;n<e.length;n++)t.writeSFixed32(e[n])}function Su(e,t){for(let n=0;n<e.length;n++)t.writeFixed64(e[n])}function Tu(e,t){for(let n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Eu(e,t,n){1===e&&n.readMessage(ku,t)}function ku(e,t,n){if(3===e){const{id:e,bitmap:r,width:i,height:o,left:a,top:s,advance:l}=n.readMessage(Pu,{});t.push({id:e,bitmap:new _l({width:i+6,height:o+6},r),metrics:{width:i,height:o,left:a,top:s,advance:l}})}}function Pu(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}function Cu(e){let t=0,n=0;for(const a of e)t+=a.w*a.h,n=Math.max(n,a.w);e.sort((e,t)=>t.h-e.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let i=0,o=0;for(const a of e)for(let e=r.length-1;e>=0;e--){const t=r[e];if(!(a.w>t.w||a.h>t.h)){if(a.x=t.x,a.y=t.y,o=Math.max(o,a.y+a.h),i=Math.max(i,a.x+a.w),a.w===t.w&&a.h===t.h){const t=r.pop();t&&e<r.length&&(r[e]=t)}else a.h===t.h?(t.x+=a.w,t.w-=a.w):a.w===t.w?(t.y+=a.h,t.h-=a.h):(r.push({x:t.x+a.w,y:t.y,w:t.w-a.w,h:a.h}),t.y+=a.h,t.h-=a.h);break}}return{w:i,h:o,fill:t/(i*o)||0}}class Iu{constructor(e,t){let{pixelRatio:n,version:r,stretchX:i,stretchY:o,content:a,textFitWidth:s,textFitHeight:l}=t;this.paddedRect=e,this.pixelRatio=n,this.stretchX=i,this.stretchY=o,this.content=a,this.version=r,this.textFitWidth=s,this.textFitHeight=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Au{constructor(e,t){const n={},r={};this.haveRenderCallbacks=[];const i=[];this.addImages(e,n,i),this.addImages(t,r,i);const{w:o,h:a}=Cu(i),s=new yl({width:o||1,height:a||1});for(const l in e){const t=e[l],r=n[l].paddedRect;yl.copy(t.data,s,{x:0,y:0},{x:r.x+1,y:r.y+1},t.data)}for(const l in t){const e=t[l],n=r[l].paddedRect,i=n.x+1,o=n.y+1,a=e.data.width,c=e.data.height;yl.copy(e.data,s,{x:0,y:0},{x:i,y:o},e.data),yl.copy(e.data,s,{x:0,y:c-1},{x:i,y:o-1},{width:a,height:1}),yl.copy(e.data,s,{x:0,y:0},{x:i,y:o+c},{width:a,height:1}),yl.copy(e.data,s,{x:a-1,y:0},{x:i-1,y:o},{width:1,height:c}),yl.copy(e.data,s,{x:0,y:0},{x:i+a,y:o},{width:1,height:c})}this.image=s,this.iconPositions=n,this.patternPositions=r}addImages(e,t,n){for(const r in e){const i=e[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),t[r]=new Iu(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,i]=e.tl;n.update(t.data,void 0,{x:r,y:i})}}var Mu;co("ImagePosition",Iu),co("ImageAtlas",Au),e.at=void 0,(Mu=e.at||(e.at={}))[Mu.none=0]="none",Mu[Mu.horizontal=1]="horizontal",Mu[Mu.vertical=2]="vertical",Mu[Mu.horizontalOnly=3]="horizontalOnly";class Ru{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(e,t,n){const r=new Ru;return r.scale=e||1,r.fontStack=t,r.verticalAlign=n||"bottom",r}static forImage(e,t){const n=new Ru;return n.imageName=e,n.verticalAlign=t||"bottom",n}}class Du{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new Du;for(let r=0;r<e.sections.length;r++){const i=e.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let n=0;n<e.length;n++){const r=e.charCodeAt(n+1)||null,i=e.charCodeAt(n-1)||null;t+=r&&To(r)&&!lu[e[n+1]]||i&&To(i)&&!lu[e[n-1]]||!lu[e[n]]?e[n]:lu[e[n]]}return t}(this.text)}trim(){let e=0;for(let n=0;n<this.text.length&&Lu[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Lu[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new Du;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}getMaxImageSize(e){let t=0,n=0;for(let r=0;r<this.length();r++){const i=this.getSection(r);if(i.imageName){const r=e[i.imageName];if(!r)continue;const o=r.displaySize;t=Math.max(t,o[0]),n=Math.max(n,o[1])}}return{maxImageWidth:t,maxImageHeight:n}}addTextSection(e,t){this.text+=e.text,this.sections.push(Ru.forText(e.scale,e.fontStack||t,e.verticalAlign));const n=this.sections.length-1;for(let r=0;r<e.text.length;++r)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void Z("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Ru.forImage(t,e.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Z("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zu(t,n,r,i,o,a,s,l,c,u,h,d,p,f,m){const g=Du.fromFeature(t,o);let _;d===e.at.vertical&&g.verticalizePunctuation();const{processBidirectionalText:y,processStyledBidirectionalText:v}=Io;if(y&&1===g.sections.length){_=[];const e=y(g.toString(),Gu(g,u,a,n,i,f));for(const t of e){const e=new Du;e.text=t,e.sections=g.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);_.push(e)}}else if(v){_=[];const e=v(g.text,g.sectionIndex,Gu(g,u,a,n,i,f));for(const t of e){const e=new Du;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,_.push(e)}}else _=function(e,t){const n=[],r=e.text;let i=0;for(const o of t)n.push(e.substring(i,o)),i=o;return i<r.length&&n.push(e.substring(i,r.length)),n}(g,Gu(g,u,a,n,i,f));const b=[],x={positionedLines:b,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,t,n,r,i,o,a,s,l,c,u,h){let d=0,p=0,f=0,m=0;const g="right"===s?1:"left"===s?0:.5,_=cu/h;let y=0;for(const x of i){x.trim();const i=x.getMaxScale(),a={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=a;const s=a.positionedGlyphs;let h=0;if(!x.length()){p+=o,++y;continue}const v=Zu(r,x,_);for(let o=0;o<x.length();o++){const a=x.getSection(o),f=x.getSectionIndex(o),m=x.getCharCode(o),g=Hu(l,u,m);let y;if(a.imageName){if(e.iconsInText=!0,a.scale=a.scale*_,y=Ku(a,g,i,v,r),!y)continue;h=Math.max(h,y.imageOffset)}else if(y=Xu(a,m,g,v,t,n),!y)continue;const{rect:b,metrics:w,baselineOffset:S}=y;s.push({glyph:m,imageName:a.imageName,x:d,y:p+S+-17,vertical:g,scale:a.scale,fontStack:a.fontStack,sectionIndex:f,metrics:w,rect:b}),g?(e.verticalizable=!0,d+=(a.imageName?w.advance:cu)*a.scale+c):d+=w.advance*a.scale+c}0!==s.length&&(f=Math.max(d-c,f),Yu(s,0,s.length-1,g)),d=0,a.lineOffset=Math.max(h,(i-1)*cu);const b=o*i+h;p+=b,m=Math.max(b,m),++y}const{horizontalAlign:v,verticalAlign:b}=qu(a);(function(e,t,n,r,i,o,a,s,l){const c=(t-n)*i;let u=0;u=o!==a?-s*r- -17:-r*l*a+.5*a;for(const h of e)for(const e of h.positionedGlyphs)e.x+=c,e.y+=u})(e.positionedLines,g,v,b,f,m,o,p,i.length),e.top+=-b*p,e.bottom=e.top+p,e.left+=-v*f,e.right=e.left+f}(x,n,r,i,_,s,l,c,d,u,p,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b)&&x}const Lu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ju={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ou={40:!0};function Fu(e,t,n,r,i,o){if(t.imageName){const e=r[t.imageName];return e?e.displaySize[0]*t.scale*cu/o+i:0}{const r=n[t.fontStack],o=r&&r[e];return o?o.metrics.advance*t.scale+i:0}}function Bu(e,t,n,r){const i=Math.pow(e-t,2);return r?e<t?i/2:2*i:i+Math.abs(n)*n}function Nu(e,t,n){let r=0;return 10===e&&(r-=1e4),n&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function Uu(e,t,n,r,i,o){let a=null,s=Bu(t,n,i,o);for(const l of r){const e=Bu(t-l.x,n,i,o)+l.badness;e<=s&&(a=l,s=e)}return{index:e,x:t,priorBreak:a,badness:s}}function Vu(e){return e?Vu(e.priorBreak).concat(e.index):[]}function Gu(e,t,n,r,i,o){if(!e)return[];const a=[],s=function(e,t,n,r,i,o){let a=0;for(let s=0;s<e.length();s++){const n=e.getSection(s);a+=Fu(e.getCharCode(s),n,r,i,t,o)}return a/Math.max(1,Math.ceil(a/n))}(e,t,n,r,i,o),l=e.text.indexOf("\u200b")>=0;let c=0;for(let u=0;u<e.length();u++){const n=e.getSection(u),h=e.getCharCode(u);if(Lu[h]||(c+=Fu(h,n,r,i,t,o)),u<e.length()-1){const t=_o(h);(ju[h]||t||n.imageName||u!==e.length()-2&&Ou[e.getCharCode(u+1)])&&a.push(Uu(u+1,c,s,a,Nu(h,e.getCharCode(u+1),t&&l),!1))}}return Vu(Uu(e.length(),c,s,a,0,!0))}function qu(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Zu(e,t,n){const r=t.getMaxScale()*cu,{maxImageWidth:i,maxImageHeight:o}=t.getMaxImageSize(e),a=Math.max(r,o*n);return{verticalLineContentWidth:Math.max(r,i*n),horizontalLineContentHeight:a}}function Wu(e){switch(e){case"top":return 0;case"center":return.5;default:return 1}}function Hu(t,n,r){return!(t===e.at.horizontal||!n&&!yo(r)||n&&(Lu[r]||(i=r,/(?:[\u0600-\u0604\u0606-\u060B\u060D-\u061A\u061C-\u061E\u0620-\u063F\u0641-\u064A\u0656-\u066F\u0671-\u06DC\u06DE-\u06FF\u0750-\u077F\u0870-\u0891\u0897-\u08E1\u08E3-\u08FF\uFB50-\uFD3D\uFD40-\uFDCF\uFDF0-\uFDFF\uFE70-\uFE74\uFE76-\uFEFC]|\uD803[\uDE60-\uDE7E\uDEC2-\uDEC7\uDED0-\uDED8\uDEFA-\uDEFF]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB\uDEF0\uDEF1])/.test(String.fromCodePoint(i)))));var i}function Xu(e,t,n,r,i,o){const a=o[e.fontStack],s=function(e,t,n,r){if(e&&e.rect)return e;const i=t[n.fontStack],o=i&&i[r];return o?{rect:null,metrics:o.metrics}:null}(a&&a[t],i,e,t);if(null===s)return null;let l;if(n)l=r.verticalLineContentWidth-e.scale*cu;else{const t=Wu(e.verticalAlign);l=(r.horizontalLineContentHeight-e.scale*cu)*t}return{rect:s.rect,metrics:s.metrics,baselineOffset:l}}function Ku(e,t,n,r,i){const o=i[e.imageName];if(!o)return null;const a=o.paddedRect,s=o.displaySize,l={width:s[0],height:s[1],left:1,top:-3,advance:t?s[1]:s[0]};let c;if(t)c=r.verticalLineContentWidth-s[1]*e.scale;else{const t=Wu(e.verticalAlign);c=(r.horizontalLineContentHeight-s[1]*e.scale)*t}return{rect:a,metrics:l,baselineOffset:c,imageOffset:(t?s[0]:s[1])*e.scale-cu*n}}function Yu(e,t,n,r){if(0===r)return;const i=e[n],o=(e[n].x+i.metrics.advance*i.scale)*r;for(let a=t;a<=n;a++)e[a].x-=o}function Ju(e,t,n){const{horizontalAlign:r,verticalAlign:i}=qu(n),o=t[0]-e.displaySize[0]*r,a=t[1]-e.displaySize[1]*i;return{image:e,top:a,bottom:a+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Qu(e){var t,n;let r=e.left,i=e.top,o=e.right-r,a=e.bottom-i;const s=null!==(t=e.image.textFitWidth)&&void 0!==t?t:"stretchOrShrink",l=null!==(n=e.image.textFitHeight)&&void 0!==n?n:"stretchOrShrink",c=(e.image.content[2]-e.image.content[0])/(e.image.content[3]-e.image.content[1]);if("proportional"===l){if("stretchOnly"===s&&o/a<c||"proportional"===s){const e=Math.ceil(a*c);r*=e/o,o=e}}else if("proportional"===s&&"stretchOnly"===l&&0!==c&&o/a>c){const e=Math.ceil(o/c);i*=e/a,a=e}return{x1:r,y1:i,x2:r+o,y2:i+a}}function $u(e,t,n,r,i,o){const a=e.image;let s;if(a.content){const e=a.content,t=a.pixelRatio||1;s=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===n||"both"===n?(p=i[0]+l-r[3],h=i[0]+c+r[1]):(p=i[0]+(l+c-a.displaySize[0])/2,h=p+a.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===n||"both"===n?(u=i[1]+f-r[0],d=i[1]+m+r[2]):(u=i[1]+(f+m-a.displaySize[1])/2,d=u+a.displaySize[1]),{image:a,top:u,right:h,bottom:d,left:p,collisionPadding:s}}const eh=128,th=32640;function nh(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ao(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=n;let i=0;for(;i<t.length&&t[i]<=e;)i++;i=Math.max(0,i-1);let o=i;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const a=t[i],s=t[o];return"composite"===n.kind?{kind:"composite",minZoom:a,maxZoom:s,interpolationType:r}:{kind:"camera",minZoom:a,maxZoom:s,minSize:n.evaluate(new Ao(a)),maxSize:n.evaluate(new Ao(s)),interpolationType:r}}}function rh(e,t,n){let r="never";const i=e.get(t);return i?r=i:e.get(n)&&(r="always"),r}const ih=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function oh(e,t,n,r,i,o,a,s,l,c,u,h,d){const p=s?Math.min(th,Math.round(s[0])):0,f=s?Math.min(th,Math.round(s[1])):0;e.emplaceBack(t,n,Math.round(32*r),Math.round(32*i),o,a,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function ah(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function sh(e){for(const t of e.sections)if(Co(t.text))return!0;return!1}class lh{constructor(e){this.layoutVertexArray=new Wa,this.indexArray=new Ja,this.programConfigurations=e,this.segments=new ts,this.dynamicLayoutVertexArray=new Ha,this.opacityVertexArray=new Xa,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ia}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ru.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ih,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}co("SymbolBuffers",lh);class ch{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new ts,this.collisionVertexArray=new Ya}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,iu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}co("CollisionBuffers",ch);class uh{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(e=>e.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=nh(this.zoom,n["text-size"]),this.iconSizeData=nh(this.zoom,n["icon-size"]);const r=this.layers[0].layout,i=r.get("symbol-sort-key"),o=r.get("symbol-z-order");this.canOverlap="never"!==rh(r,"text-overlap","text-allow-overlap")||"never"!==rh(r,"icon-overlap","icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!i.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map(t=>e.at[t])),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=t.sourceID}createArrays(){this.text=new lh(new Ms(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new lh(new Ms(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ra,this.lineVertexArray=new Da,this.symbolInstances=new Ma,this.textAnchorOffsets=new La}calculateGlyphDependencies(e,t,n,r,i){for(let o=0;o<e.length;o++)if(t[e.charCodeAt(o)]=!0,(n||r)&&i){const n=lu[e.charAt(o)];n&&(t[n.charCodeAt(0)]=!0)}}populate(t,n,r){const i=this.layers[0],o=i.layout,a=o.get("text-font"),s=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==s.value.kind||s.value.value instanceof Mt&&!s.value.value.isEmpty()||s.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=n.iconDependencies,p=n.glyphDependencies,f=n.availableImages,m=new Ao(this.zoom);for(const{feature:g,id:_,index:y,sourceLayerIndex:v}of t){const t=i._featureFilter.needGeometry,n=Os(g,t);if(!i._featureFilter.filter(m,n,r))continue;let s,l;if(t||(n.geometry=js(g)),c){const e=i.getValueAndResolveTokens("text-field",n,r,f),t=Mt.factory(e),o=this.hasRTLText=this.hasRTLText||sh(t);(!o||"unavailable"===Io.getRTLTextPluginStatus()||o&&Io.isParsed())&&(s=su(t,i,n))}if(u){const e=i.getValueAndResolveTokens("icon-image",n,r,f);l=e instanceof Ft?e:Ft.fromString(e)}if(!s&&!l)continue;const b=this.sortFeaturesByKey?h.evaluate(n,{},r):void 0;if(this.features.push({id:_,text:s,icon:l,index:y,sourceLayerIndex:v,geometry:n.geometry,properties:g.properties,type:Tc.types[g.type],sortKey:b}),l&&(d[l.name]=!0),s){const t=a.evaluate(n,{},r).join(","),i="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(e.at.vertical)>=0;for(const e of s.sections)if(e.image)d[e.image.name]=!0;else{const n=vo(s.toString()),r=e.fontStack||t,o=p[r]=p[r]||{};this.calculateGlyphDependencies(e.text,o,i,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},n={},r=[];let i=0;function o(t){r.push(e[t]),i++}function a(e,t,i){const o=n[e];return delete n[e],n[t]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function s(e,n,i){const o=t[n];return delete t[n],t[e]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function l(e,t,n){const r=n?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(r.x,":").concat(r.y)}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in t&&n[p]!==t[f]){const e=s(p,f,h),i=a(p,f,r[e].geometry);delete t[p],delete n[f],n[l(d,r[i].geometry,!0)]=i,r[e].geometry=null}else p in n?a(p,f,h):f in t?s(p,f,h):(o(c),t[p]=i-1,n[f]=i-1)}return r.filter(e=>e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}update(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,{imagePositions:n}),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,{imagePositions:n}))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment){let n=e.dist(t[e.segment+1]),r=e.dist(t[e.segment]);const i={};for(let o=e.segment+1;o<t.length;o++)i[o]={x:t[o].x,y:t[o].y,tileUnitDistanceFromAnchor:n},o<t.length-1&&(n+=t[o+1].dist(t[o]));for(let o=e.segment||0;o>=0;o--)i[o]={x:t[o].x,y:t[o].y,tileUnitDistanceFromAnchor:r},o>0&&(r+=t[o-1].dist(t[o]));for(let e=0;e<t.length;e++){const t=i[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,n,r,i,o,a,s,l,c,u,h,d){const p=t.indexArray,f=t.layoutVertexArray,m=t.segments.prepareSegment(4*n.length,f,p,this.canOverlap?a.sortKey:void 0),g=this.glyphOffsetArray.length,_=m.vertexLength,y=this.allowVerticalPlacement&&s===e.at.vertical?Math.PI/2:0,v=a.text&&a.text.sections;for(let e=0;e<n.length;e++){const{tl:i,tr:o,bl:s,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:_,minFontScaleY:b,glyphOffset:x,isSDF:w,sectionIndex:S}=n[e],T=m.vertexLength,E=x[1];oh(f,l.x,l.y,i.x,E+i.y,u.x,u.y,r,w,h.x,h.y,_,b),oh(f,l.x,l.y,o.x,E+o.y,u.x+u.w,u.y,r,w,g.x,h.y,_,b),oh(f,l.x,l.y,s.x,E+s.y,u.x,u.y+u.h,r,w,h.x,g.y,_,b),oh(f,l.x,l.y,c.x,E+c.y,u.x+u.w,u.y+u.h,r,w,g.x,g.y,_,b),ah(t.dynamicLayoutVertexArray,l,y),p.emplaceBack(T,T+2,T+1),p.emplaceBack(T+1,T+2,T+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),e!==n.length-1&&S===n[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,a,a.index,{imagePositions:{},canonical:d,formattedSection:v&&v[S]})}t.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,_,c,u,l.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],s,0,!1,0,h)}_addCollisionDebugVertex(e,t,n,r,i,o){return t.emplaceBack(0,0),e.emplaceBack(n.x,n.y,r,i,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(e,t,r,i,o,a,s){const l=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),c=l.vertexLength,u=o.layoutVertexArray,h=o.collisionVertexArray,d=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(u,h,a,d,p,new n(e,t)),this._addCollisionDebugVertex(u,h,a,d,p,new n(r,t)),this._addCollisionDebugVertex(u,h,a,d,p,new n(r,i)),this._addCollisionDebugVertex(u,h,a,d,p,new n(e,i)),l.vertexLength+=4;const f=o.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(e,t,n,r){for(let i=e;i<t;i++){const e=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,r?this.textCollisionBox:this.iconCollisionBox,e.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ch(Ka,ou.members,Qa),this.iconCollisionBox=new ch(Ka,ou.members,Qa);for(let e=0;e<this.symbolInstances.length;e++){const t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(e,t,n,r,i,o,a,s,l){const c={};for(let u=t;u<n;u++){const t=e.get(u);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.textFeatureIndex=t.featureIndex;break}for(let u=r;u<i;u++){const t=e.get(u);c.verticalTextBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.verticalTextFeatureIndex=t.featureIndex;break}for(let u=o;u<a;u++){const t=e.get(u);c.iconBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.iconFeatureIndex=t.featureIndex;break}for(let u=s;u<l;u++){const t=e.get(u);c.verticalIconBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.verticalIconFeatureIndex=t.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),r=n.vertexStartIndex+4*n.numGlyphs;for(let i=n.vertexStartIndex;i<r;i+=4)e.indexArray.emplaceBack(i,i+2,i+1),e.indexArray.emplaceBack(i+1,i+2,i+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),r=[],i=[],o=[];for(let a=0;a<this.symbolInstances.length;++a){o.push(a);const e=this.symbolInstances.get(a);r.push(0|Math.round(t*e.anchorX+n*e.anchorY)),i.push(e.featureIndex)}return o.sort((e,t)=>r[e]-r[t]||i[t]-i[e]),o}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach((e,t,n)=>{e>=0&&n.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)}),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let hh,dh;co("SymbolBucket",uh,{omit:["layers","collisionBoxArray","features","compareText"]}),uh.MAX_GLYPHS=65535,uh.addDynamicAttributes=ah;var ph={get paint(){return dh=dh||new Zo({"icon-opacity":new Uo(ve.paint_symbol["icon-opacity"]),"icon-color":new Uo(ve.paint_symbol["icon-color"]),"icon-halo-color":new Uo(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new Uo(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Uo(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new No(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new No(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new Uo(ve.paint_symbol["text-opacity"]),"text-color":new Uo(ve.paint_symbol["text-color"],{runtimeType:Be,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Uo(ve.paint_symbol["text-halo-color"]),"text-halo-width":new Uo(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new Uo(ve.paint_symbol["text-halo-blur"]),"text-translate":new No(ve.paint_symbol["text-translate"]),"text-translate-anchor":new No(ve.paint_symbol["text-translate-anchor"])})},get layout(){return hh=hh||new Zo({"symbol-placement":new No(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new No(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new No(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Uo(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new No(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new No(ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new No(ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new No(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new No(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new No(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new Uo(ve.layout_symbol["icon-size"]),"icon-text-fit":new No(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new No(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new Uo(ve.layout_symbol["icon-image"]),"icon-rotate":new Uo(ve.layout_symbol["icon-rotate"]),"icon-padding":new Uo(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new No(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new Uo(ve.layout_symbol["icon-offset"]),"icon-anchor":new Uo(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new No(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new No(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new No(ve.layout_symbol["text-rotation-alignment"]),"text-field":new Uo(ve.layout_symbol["text-field"]),"text-font":new Uo(ve.layout_symbol["text-font"]),"text-size":new Uo(ve.layout_symbol["text-size"]),"text-max-width":new Uo(ve.layout_symbol["text-max-width"]),"text-line-height":new No(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new Uo(ve.layout_symbol["text-letter-spacing"]),"text-justify":new Uo(ve.layout_symbol["text-justify"]),"text-radial-offset":new Uo(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new No(ve.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Uo(ve.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Uo(ve.layout_symbol["text-anchor"]),"text-max-angle":new No(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new No(ve.layout_symbol["text-writing-mode"]),"text-rotate":new Uo(ve.layout_symbol["text-rotate"]),"text-padding":new No(ve.layout_symbol["text-padding"]),"text-keep-upright":new No(ve.layout_symbol["text-keep-upright"]),"text-transform":new Uo(ve.layout_symbol["text-transform"]),"text-offset":new Uo(ve.layout_symbol["text-offset"]),"text-allow-overlap":new No(ve.layout_symbol["text-allow-overlap"]),"text-overlap":new No(ve.layout_symbol["text-overlap"]),"text-ignore-placement":new No(ve.layout_symbol["text-ignore-placement"]),"text-optional":new No(ve.layout_symbol["text-optional"])})}};class fh{constructor(e){if(void 0===e.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Le,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}co("FormatSectionOverride",fh,{omit:["defaultValue"]});class mh extends Ho{constructor(e,t){super(e,ph,t)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const t=[];for(const n of e)t.indexOf(n)<0&&t.push(n);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,r){const i=this.layout.get(e).evaluate(t,{},n,r),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||ni(o.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,(t,n)=>e&&n in e?String(e[n]):"")}(t.properties,i)}createBucket(e){return new uh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of ph.paint.overridableProperties){if(!mh.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new fh(t),r=new ti(n,t.property.specification);let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new ii("source",r):new oi("composite",r,t.value.zoomStops),this.paint._values[e]=new Fo(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&mh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),r=ph.paint.properties[t];let i=!1;const o=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof Mt)o(n.value.value.sections);else if("source"===n.value.kind||"composite"===n.value.kind){const e=t=>{i||(t instanceof qt&&Vt(t.value)===qe?o(t.value.sections):t instanceof In?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return i}}let gh;var _h={get paint(){return gh=gh||new Zo({"background-color":new No(ve.paint_background["background-color"]),"background-pattern":new Go(ve.paint_background["background-pattern"]),"background-opacity":new No(ve.paint_background["background-opacity"])})}};class yh extends Ho{constructor(e,t){super(e,_h,t)}}class vh extends Ho{constructor(e,t){super(e,{},t),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class bh{constructor(e){this._methodToThrottle=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const xh={once:!0},wh=6371008.8;class Sh{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(t,")"));if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sh(F(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(e){const t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return wh*Math.acos(Math.min(i,1))}static convert(e){if(e instanceof Sh)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Sh(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Sh(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Th=2*Math.PI*wh;function Eh(e){return Th*Math.cos(e*Math.PI/180)}function kh(e){return(180+e)/360}function Ph(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Ch(e,t){return e/Eh(t)}function Ih(e){return 360*e-180}function Ah(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Mh(e,t){return e*Eh(Ah(t))}class Rh{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Sh.convert(e);return new Rh(kh(n.lng),Ph(n.lat),Ch(t,n.lat))}toLngLat(){return new Sh(Ih(this.x),Ah(this.y))}toAltitude(){return Mh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Th*(e=Ah(this.y),1/Math.cos(e*Math.PI/180));var e}}function Dh(e,t,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}class zh{constructor(e,t,n){if(!function(e,t,n){return!(e<0||e>25||n<0||n>=Math.pow(2,e)||t<0||t>=Math.pow(2,e))}(e,t,n))throw new Error("x=".concat(t,", y=").concat(n,", z=").concat(e," outside of bounds. 0<=x<").concat(Math.pow(2,e),", 0<=y<").concat(Math.pow(2,e)," 0<=z<=25 "));this.z=e,this.x=t,this.y=n,this.key=Oh(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,n){const r=(o=this.y,a=this.z,s=Dh(256*(i=this.x),256*(o=Math.pow(2,a)-o-1),a),l=Dh(256*(i+1),256*(o+1),a),s[0]+","+s[1]+","+l[0]+","+l[1]);var i,o,a,s,l;const c=function(e,t,n){let r,i="";for(let o=e;o>0;o--)r=1<<o-1,i+=(t&r?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,t>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,r)}isChildOf(e){const t=this.z-e.z;return t>0&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){const t=Math.pow(2,this.z);return new n((e.x*t-this.x)*A,(e.y*t-this.y)*A)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class Lh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Oh(e,t.z,t.z,t.x,t.y)}}class jh{constructor(e,t,n,r,i){if(this.terrainRttPosMatrix32f=null,e<n)throw new Error("overscaledZ should be >= z; overscaledZ = ".concat(e,"; z = ").concat(n));this.overscaledZ=e,this.wrap=t,this.canonical=new zh(n,+r,+i),this.key=Oh(t,e,n,r,i)}clone(){return new jh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error("targetZ > this.overscaledZ; targetZ = ".concat(e,"; overscaledZ = ").concat(this.overscaledZ));const t=this.canonical.z-e;return e>this.canonical.z?new jh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,t){if(e>this.overscaledZ)throw new Error("targetZ > this.overscaledZ; targetZ = ".concat(e,"; overscaledZ = ").concat(this.overscaledZ));const n=this.canonical.z-e;return e>this.canonical.z?Oh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Oh(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(e){if(e.wrap!==this.wrap)return!1;if(this.overscaledZ-e.overscaledZ<=0)return!1;if(0===e.overscaledZ)return this.overscaledZ>0;const t=this.canonical.z-e.canonical.z;return!(t<0)&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new jh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new jh(t,this.wrap,t,n,r),new jh(t,this.wrap,t,n+1,r),new jh(t,this.wrap,t,n,r+1),new jh(t,this.wrap,t,n+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new jh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new jh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Lh(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}getTilePoint(e){return this.canonical.getTilePoint(new Rh(e.x-this.wrap,e.y))}}function Oh(e,t,n,r,i){(e*=2)<0&&(e=-1*e-1);const o=1<<n;return(o*o*e+o*i+r).toString(36)+n.toString(36)+t.toString(36)}function Fh(e,t){return t?e.properties[t]:e.id}co("CanonicalTileID",zh),co("OverscaledTileID",jh,{omit:["terrainRttPosMatrix32f"]});class Bh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const t=new Bh;return t.extend(e(new n(this.minX,this.minY))),t.extend(e(new n(this.maxX,this.minY))),t.extend(e(new n(this.minX,this.maxY))),t.extend(e(new n(this.maxX,this.maxY))),t}static fromPoints(e){const t=new Bh;for(const n of e)t.extend(n);return t}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Nh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error("Out of bounds. Index requested n=".concat(e," can't be >= this._numberToString.length ").concat(this._numberToString.length));return this._numberToString[e]}}class Uh{constructor(e,t,n,r,i){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=n,e._y=r,this.properties=e.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class Vh{constructor(e,t,n){r(this,"_name",void 0),r(this,"dataBuffer",void 0),r(this,"nullabilityBuffer",void 0),r(this,"_size",void 0),this._name=e,this.dataBuffer=t,"number"==typeof n?this._size=n:(this.nullabilityBuffer=n,this._size=n.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Gh extends Vh{}class qh extends Gh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Zh extends Gh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Wh extends Vh{constructor(e,t,n,i){super(e,t,i),r(this,"delta",void 0),this.delta=n}}class Hh extends Wh{constructor(e,t,n,r){super(e,Int32Array.of(t),n,r)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Xh extends Vh{constructor(e,t,n){super(e,Int32Array.of(t),n)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Kh{constructor(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4096;r(this,"_name",void 0),r(this,"_geometryVector",void 0),r(this,"_idVector",void 0),r(this,"_propertyVectors",void 0),r(this,"_extent",void 0),r(this,"propertyVectorsMap",void 0),this._name=e,this._geometryVector=t,this._idVector=n,this._propertyVectors=i,this._extent=o}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(e=>[e.name,e]))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let t=0;for(;t<this.numFeatures;){let n;this.idVector&&(n=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(t)):this.idVector.getValue(t));const r=null===e||void 0===e?void 0:e.next().value,i={};for(const e of this.propertyVectors){if(!e)continue;const n=e.name,r=e.getValue(t);null!==r&&(i[n]=r)}t++,yield{id:n,geometry:r,properties:i}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],t=this.geometryVector.getGeometries();for(let n=0;n<this.numFeatures;n++){let r;this.idVector&&(r=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const i={coordinates:t[n],type:this.geometryVector.geometryType(n)},o={};for(const e of this.propertyVectors){if(!e)continue;const t=e.name,r=e.getValue(n);null!==r&&(o[t]=r)}e.push({id:r,geometry:i,properties:o})}return e}containsMaxSaveIntegerValues(e){return e instanceof qh||e instanceof Xh&&e instanceof Hh||e instanceof Zh}}class Yh{constructor(e){r(this,"value",void 0),this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Jh,Qh,$h,ed,td,nd,rd,id,od,ad;!function(e){e.PRESENT="PRESENT",e.DATA="DATA",e.OFFSET="OFFSET",e.LENGTH="LENGTH"}(Jh||(Jh={}));class sd{constructor(e,t,n){r(this,"_dictionaryType",void 0),r(this,"_offsetType",void 0),r(this,"_lengthType",void 0),this._dictionaryType=e,this._offsetType=t,this._lengthType=n}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function ld(e,t,n){const r=new Int32Array(n);let i=0,o=t.get();for(let a=0;a<r.length;a++){let t=e[o++],n=127&t;t<128||(t=e[o++],n|=(127&t)<<7,t<128||(t=e[o++],n|=(127&t)<<14,t<128||(t=e[o++],n|=(127&t)<<21,t<128||(t=e[o++],n|=(15&t)<<28)))),r[i++]=n}return t.set(o),r}function cd(e,t,n){const r=new BigInt64Array(n);for(let i=0;i<r.length;i++)r[i]=fd(e,t);return r}function ud(e,t){let n,r;return r=e[t.get()],t.increment(),n=127&r,r<128?n:(r=e[t.get()],t.increment(),n|=(127&r)<<7,r<128?n:(r=e[t.get()],t.increment(),n|=(127&r)<<14,r<128?n:(r=e[t.get()],t.increment(),n|=(127&r)<<21,r<128?n:(r=e[t.get()],n|=(15&r)<<28,function(e,t,n){let r,i;if(i=t[n.get()],n.increment(),r=(112&i)>>4,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(127&i)<<3,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(127&i)<<10,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(127&i)<<17,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(127&i)<<24,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(1&i)<<31,i<128)return 4294967296*r+(e>>>0);throw new Error("Expected varint not more than 10 bytes")}(n,e,t)))))}function hd(e,t,n,r){throw new Error("FastPFor is not implemented yet.")}function dd(e){return e>>>1^-(1&e)}function pd(e){return e>>1n^-(1n&e)}function fd(e,t){let n=0n,r=0,i=t.get();for(;i<e.length;){const t=e[i++];if(n|=BigInt(127&t)<<BigInt(r),!(128&t))break;if(r+=7,r>=64)throw new Error("Varint too long")}return t.set(i),n}function md(e,t,n){const r=new Int32Array(n);let i=0;for(let o=0;o<t;o++){const n=e[o];r.fill(e[o+t],i,i+n),i+=n}return r}function gd(e,t,n){const r=new BigInt64Array(n);let i=0;for(let o=0;o<t;o++){const n=Number(e[o]);r.fill(e[o+t],i,i+n),i+=n}return r}function _d(e,t,n){const r=new Float64Array(n);let i=0;for(let o=0;o<t;o++){const n=e[o];r.fill(e[o+t],i,i+n),i+=n}return r}function yd(e){const t=e.length/4*4;let n=1;if(t>=4)for(let r=e[0];n<t-4;n+=4)r=e[n]+=r,r=e[n+1]+=r,r=e[n+2]+=r,r=e[n+3]+=r;for(;n!=e.length;)e[n]+=e[n-1],++n}function vd(e){e[0]=e[0]>>>1^-(1&e[0]),e[1]=e[1]>>>1^-(1&e[1]);const t=e.length/4*4;let n=2;if(t>=4)for(;n<t-4;n+=4){const t=e[n],r=e[n+1],i=e[n+2],o=e[n+3];e[n]=(t>>>1^-(1&t))+e[n-2],e[n+1]=(r>>>1^-(1&r))+e[n-1],e[n+2]=(i>>>1^-(1&i))+e[n],e[n+3]=(o>>>1^-(1&o))+e[n+1]}for(;n!=e.length;n+=2)e[n]=(e[n]>>>1^-(1&e[n]))+e[n-2],e[n+1]=(e[n+1]>>>1^-(1&e[n+1]))+e[n-1]}function bd(e,t,n){return Math.min(n,Math.max(t,e))}!function(e){e.NONE="NONE",e.DELTA="DELTA",e.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",e.RLE="RLE",e.MORTON="MORTON",e.PDE="PDE"}(Qh||(Qh={})),function(e){e.NONE="NONE",e.FAST_PFOR="FAST_PFOR",e.VARINT="VARINT",e.ALP="ALP"}($h||($h={})),function(e){e.NONE="NONE",e.SINGLE="SINGLE",e.SHARED="SHARED",e.VERTEX="VERTEX",e.MORTON="MORTON",e.FSST="FSST"}(ed||(ed={})),function(e){e.VERTEX="VERTEX",e.INDEX="INDEX",e.STRING="STRING",e.KEY="KEY"}(td||(td={})),function(e){e.VAR_BINARY="VAR_BINARY",e.GEOMETRIES="GEOMETRIES",e.PARTS="PARTS",e.RINGS="RINGS",e.TRIANGLES="TRIANGLES",e.SYMBOL="SYMBOL",e.DICTIONARY="DICTIONARY"}(nd||(nd={}));class xd{constructor(e,t,n,i,o,a,s){r(this,"_physicalStreamType",void 0),r(this,"_logicalStreamType",void 0),r(this,"_logicalLevelTechnique1",void 0),r(this,"_logicalLevelTechnique2",void 0),r(this,"_physicalLevelTechnique",void 0),r(this,"_numValues",void 0),r(this,"_byteLength",void 0),this._physicalStreamType=e,this._logicalStreamType=t,this._logicalLevelTechnique1=n,this._logicalLevelTechnique2=i,this._physicalLevelTechnique=o,this._numValues=a,this._byteLength=s}static decode(e,t){const n=e[t.get()],r=Object.values(Jh)[n>>4];let i=null;switch(r){case Jh.DATA:i=new sd(Object.values(ed)[15&n]);break;case Jh.OFFSET:i=new sd(null,Object.values(td)[15&n]);break;case Jh.LENGTH:i=new sd(null,null,Object.values(nd)[15&n])}t.increment();const o=e[t.get()],a=Object.values(Qh)[o>>5],s=Object.values(Qh)[o>>2&7],l=Object.values($h)[3&o];t.increment();const c=ld(e,t,2);return new xd(r,i,a,s,l,c[0],c[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class wd extends xd{constructor(e,t,n,i,o,a,s,l,c){super(e,t,n,i,o,a,s),r(this,"num_bits",void 0),r(this,"coordinate_shift",void 0),this.num_bits=l,this.coordinate_shift=c}static decode(e,t){const n=xd.decode(e,t),r=ld(e,t,2);return new wd(n.physicalStreamType,n.logicalStreamType,n.logicalLevelTechnique1,n.logicalLevelTechnique2,n.physicalLevelTechnique,n.numValues,n.byteLength,r[0],r[1])}static decodePartial(e,t,n){const r=ld(t,n,2);return new wd(e.physicalStreamType,e.logicalStreamType,e.logicalLevelTechnique1,e.logicalLevelTechnique2,e.physicalLevelTechnique,e.numValues,e.byteLength,r[0],r[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class Sd extends xd{constructor(e,t,n,i,o,a,s,l,c){super(e,t,n,i,o,a,s),r(this,"_runs",void 0),r(this,"_numRleValues",void 0),this._runs=l,this._numRleValues=c}static decode(e,t){const n=xd.decode(e,t),r=ld(e,t,2);return new Sd(n.physicalStreamType,n.logicalStreamType,n.logicalLevelTechnique1,n.logicalLevelTechnique2,n.physicalLevelTechnique,n.numValues,n.byteLength,r[0],r[1])}static decodePartial(e,t,n){const r=ld(t,n,2);return new Sd(e.physicalStreamType,e.logicalStreamType,e.logicalLevelTechnique1,e.logicalLevelTechnique2,e.physicalLevelTechnique,e.numValues,e.byteLength,r[0],r[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class Td{static decode(e,t){const n=xd.decode(e,t);return n.logicalLevelTechnique1===Qh.MORTON?wd.decodePartial(n,e,t):Qh.RLE!==n.logicalLevelTechnique1&&Qh.RLE!==n.logicalLevelTechnique2||$h.NONE===n.physicalLevelTechnique?n:Sd.decodePartial(n,e,t)}}!function(e){e[e.FLAT=0]="FLAT",e[e.CONST=1]="CONST",e[e.SEQUENCE=2]="SEQUENCE",e[e.DICTIONARY=3]="DICTIONARY",e[e.FSST_DICTIONARY=4]="FSST_DICTIONARY"}(rd||(rd={}));class Ed{constructor(e,t){r(this,"values",void 0),r(this,"_size",void 0),this.values=e,this._size=t}get(e){const t=Math.floor(e/8);return 1==(this.values[t]>>e%8&1)}set(e,t){const n=Math.floor(e/8);this.values[n]=this.values[n]|(t?1:0)<<e%8}getInt(e){const t=Math.floor(e/8);return this.values[t]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}class kd{constructor(){}static decodeIntStream(e,t,n,r,i){const o=kd.decodePhysicalLevelTechnique(e,t,n);return this.decodeIntBuffer(o,n,r,i)}static decodeLengthStreamToOffsetBuffer(e,t,n){const r=kd.decodePhysicalLevelTechnique(e,t,n);return this.decodeLengthToOffsetBuffer(r,n)}static decodePhysicalLevelTechnique(e,t,n){const r=n.physicalLevelTechnique;if(r===$h.FAST_PFOR)return hd();if(r===$h.VARINT)return ld(e,t,n.numValues);if(r===$h.NONE){const r=t.get();t.add(n.byteLength);const i=e.subarray(r,t.get());return new Int32Array(i)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(e,t,n,r){const i=kd.decodePhysicalLevelTechnique(e,t,n);if(1===i.length){const e=i[0];return r?dd(e):e}return r?function(e){return dd(e[1])}(i):function(e){return e[1]}(i)}static decodeSequenceIntStream(e,t,n){return function(e){if(2==e.length){const t=dd(e[1]);return[t,t]}return[dd(e[2]),dd(e[3])]}(kd.decodePhysicalLevelTechnique(e,t,n))}static decodeSequenceLongStream(e,t,n){return function(e){if(2==e.length){const t=pd(e[1]);return[t,t]}return[pd(e[2]),pd(e[3])]}(cd(e,t,n.numValues))}static decodeLongStream(e,t,n,r){const i=cd(e,t,n.numValues);return this.decodeLongBuffer(i,n,r)}static decodeLongFloat64Stream(e,t,n,r){const i=function(e,t,n){const r=new Float64Array(t);for(let i=0;i<t;i++)r[i]=ud(e,n);return r}(e,n.numValues,t);return this.decodeFloat64Buffer(i,n,r)}static decodeConstLongStream(e,t,n,r){const i=cd(e,t,n.numValues);if(1===i.length){const e=i[0];return r?pd(e):e}return r?function(e){return pd(e[1])}(i):function(e){return e[1]}(i)}static decodeIntBuffer(e,t,n,r){switch(t.logicalLevelTechnique1){case Qh.DELTA:return t.logicalLevelTechnique2===Qh.RLE?function(e,t,n){const r=new Int32Array(n);let i=0,o=0;for(let a=0;a<t;a++){const n=e[a],s=dd(e[a+t]);for(let e=0;e<n;e++)o+=s,r[i++]=o}return r}(e,t.runs,t.numRleValues):(function(e){e[0]=e[0]>>>1^-(1&e[0]);const t=e.length/4*4;let n=1;if(t>=4)for(;n<t-4;n+=4){const t=e[n],r=e[n+1],i=e[n+2],o=e[n+3];e[n]=(t>>>1^-(1&t))+e[n-1],e[n+1]=(r>>>1^-(1&r))+e[n],e[n+2]=(i>>>1^-(1&i))+e[n+1],e[n+3]=(o>>>1^-(1&o))+e[n+2]}for(;n!=e.length;++n)e[n]=(e[n]>>>1^-(1&e[n]))+e[n-1]}(e),e);case Qh.RLE:return function(e,t,n){return n?function(e,t,n){const r=new Int32Array(n);let i=0;for(let o=0;o<t;o++){const n=e[o];let a=e[o+t];a=a>>>1^-(1&a),r.fill(a,i,i+n),i+=n}return r}(e,t.runs,t.numRleValues):md(e,t.runs,t.numRleValues)}(e,t,n);case Qh.MORTON:return yd(e),e;case Qh.COMPONENTWISE_DELTA:return r?(function(e,t,n,r){let i=e[0]>>>1^-(1&e[0]),o=e[1]>>>1^-(1&e[1]);e[0]=bd(Math.round(i*t),n,r),e[1]=bd(Math.round(o*t),n,r);const a=e.length/16;let s=2;if(a>=4)for(;s<a-4;s+=4){const a=e[s],l=e[s+1],c=(a>>>1^-(1&a))+i,u=(l>>>1^-(1&l))+o;e[s]=bd(Math.round(c*t),n,r),e[s+1]=bd(Math.round(u*t),n,r);const h=e[s+2],d=e[s+3];i=(h>>>1^-(1&h))+c,o=(d>>>1^-(1&d))+u,e[s+2]=bd(Math.round(i*t),n,r),e[s+3]=bd(Math.round(o*t),n,r)}for(;s!=e.length;s+=2)i+=e[s]>>>1^-(1&e[s]),o+=e[s+1]>>>1^-(1&e[s+1]),e[s]=bd(Math.round(i*t),n,r),e[s+1]=bd(Math.round(o*t),n,r)}(e,r.scale,r.min,r.max),e):(vd(e),e);case Qh.NONE:return n&&function(e){for(let t=0;t<e.length;t++){const n=e[t];e[t]=n>>>1^-(1&n)}}(e),e;default:throw new Error("The specified Logical level technique is not supported: ".concat(t.logicalLevelTechnique1))}}static decodeLongBuffer(e,t,n){switch(t.logicalLevelTechnique1){case Qh.DELTA:return t.logicalLevelTechnique2===Qh.RLE?function(e,t,n){const r=new BigInt64Array(n);let i=0,o=0n;for(let a=0;a<t;a++){const n=Number(e[a]),s=pd(e[a+t]);for(let e=0;e<n;e++)o+=s,r[i++]=o}return r}(e,t.runs,t.numRleValues):(function(e){e[0]=e[0]>>1n^-(1n&e[0]);const t=e.length/4*4;let n=1;if(t>=4)for(;n<t-4;n+=4){const t=e[n],r=e[n+1],i=e[n+2],o=e[n+3];e[n]=(t>>1n^-(1n&t))+e[n-1],e[n+1]=(r>>1n^-(1n&r))+e[n],e[n+2]=(i>>1n^-(1n&i))+e[n+1],e[n+3]=(o>>1n^-(1n&o))+e[n+2]}for(;n!=e.length;++n)e[n]=(e[n]>>1n^-(1n&e[n]))+e[n-1]}(e),e);case Qh.RLE:return function(e,t,n){return n?function(e,t,n){const r=new BigInt64Array(n);let i=0;for(let o=0;o<t;o++){const n=Number(e[o]);let a=e[o+t];a=a>>1n^-(1n&a),r.fill(a,i,i+n),i+=n}return r}(e,t.runs,t.numRleValues):gd(e,t.runs,t.numRleValues)}(e,t,n);case Qh.NONE:return n&&function(e){for(let t=0;t<e.length;t++){const n=e[t];e[t]=n>>1n^-(1n&n)}}(e),e;default:throw new Error("The specified Logical level technique is not supported: ".concat(t.logicalLevelTechnique1))}}static decodeFloat64Buffer(e,t,n){switch(t.logicalLevelTechnique1){case Qh.DELTA:return t.logicalLevelTechnique2===Qh.RLE&&(e=_d(e,t.runs,t.numRleValues)),function(e){e[0]=e[0]%2==1?(e[0]+1)/-2:e[0]/2;const t=e.length/4*4;let n=1;if(t>=4)for(;n<t-4;n+=4){const t=e[n],r=e[n+1],i=e[n+2],o=e[n+3];e[n]=(t%2==1?(t+1)/-2:t/2)+e[n-1],e[n+1]=(r%2==1?(r+1)/-2:r/2)+e[n],e[n+2]=(i%2==1?(i+1)/-2:i/2)+e[n+1],e[n+3]=(o%2==1?(o+1)/-2:o/2)+e[n+2]}for(;n!=e.length;++n)e[n]=(e[n]%2==1?(e[n]+1)/-2:e[n]/2)+e[n-1]}(e),e;case Qh.RLE:return function(e,t,n){return n?function(e,t,n){const r=new Float64Array(n);let i=0;for(let o=0;o<t;o++){const n=e[o];let a=e[o+t];a=a%2==1?(a+1)/-2:a/2,r.fill(a,i,i+n),i+=n}return r}(e,t.runs,t.numRleValues):_d(e,t.runs,t.numRleValues)}(e,t,n);case Qh.NONE:return n&&function(e){for(let t=0;t<e.length;t++){const n=e[t];e[t]=n%2==1?(n+1)/-2:n/2}}(e),e;default:throw new Error("The specified Logical level technique is not supported: ".concat(t.logicalLevelTechnique1))}}static decodeLengthToOffsetBuffer(e,t){if(t.logicalLevelTechnique1===Qh.DELTA&&t.logicalLevelTechnique2===Qh.NONE)return function(e){const t=new Int32Array(e.length+1);t[0]=0,t[1]=dd(e[0]);let n=t[1],r=2;for(;r!=t.length;++r){const i=e[r-1];n+=i>>>1^-(1&i),t[r]=t[r-1]+n}return t}(e);if(t.logicalLevelTechnique1===Qh.RLE&&t.logicalLevelTechnique2===Qh.NONE)return function(e,t,n){const r=new Int32Array(n+1);r[0]=0;let i=1,o=r[0];for(let a=0;a<t;a++){const n=e[a],s=e[a+t];for(let e=i;e<i+n;e++)r[e]=s+o,o=r[e];i+=n}return r}(e,t.runs,t.numRleValues);if(t.logicalLevelTechnique1===Qh.NONE&&t.logicalLevelTechnique2===Qh.NONE){!function(e){let t=0;for(let n=0;n<e.length;n++)e[n]+=t,t=e[n]}(e);const n=new Int32Array(t.numValues+1);return n[0]=0,n.set(e,1),n}if(t.logicalLevelTechnique1===Qh.DELTA&&t.logicalLevelTechnique2===Qh.RLE){const n=function(e,t,n){const r=new Int32Array(n+1);r[0]=0;let i=1,o=r[0];for(let a=0;a<t;a++){const n=e[a];let s=e[a+t];s=s>>>1^-(1&s);for(let e=i;e<i+n;e++)r[e]=s+o,o=r[e];i+=n}return r}(e,t.runs,t.numRleValues);return yd(n),n}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(e,t,n,r,i){const o=n.physicalLevelTechnique===$h.FAST_PFOR?hd():ld(e,t,n.numValues);return this.decodeNullableIntBuffer(o,n,r,i)}static decodeNullableLongStream(e,t,n,r,i){const o=cd(e,t,n.numValues);return this.decodeNullableLongBuffer(o,n,r,i)}static decodeNullableIntBuffer(e,t,n,r){switch(t.logicalLevelTechnique1){case Qh.DELTA:return t.logicalLevelTechnique2===Qh.RLE&&(e=md(e,t.runs,t.numRleValues)),function(e,t){const n=new Int32Array(e.size());let r=0;e.get(0)?(n[0]=e.get(0)?t[0]>>>1^-(1&t[0]):0,r=1):n[0]=0;let i=1;for(;i!=n.length;++i)n[i]=e.get(i)?n[i-1]+(t[r]>>>1^-(1&t[r++])):n[i-1];return n}(r,e);case Qh.RLE:return function(e,t,n,r){const i=t;return n?function(e,t,n){const r=new Int32Array(e.size());let i=0;for(let o=0;o<n;o++){const a=t[o];let s=t[o+n];s=s>>>1^-(1&s);for(let t=i;t<i+a;t++)e.get(t)?r[t]=s:(r[t]=0,i++);i+=a}return r}(r,e,i.runs):function(e,t,n){const r=new Int32Array(e.size());let i=0;for(let o=0;o<n;o++){const a=t[o],s=t[o+n];for(let t=i;t<i+a;t++)e.get(t)?r[t]=s:(r[t]=0,i++);i+=a}return r}(r,e,i.runs)}(e,t,n,r);case Qh.MORTON:return yd(e),e;case Qh.COMPONENTWISE_DELTA:return vd(e),e;case Qh.NONE:return e=n?function(e,t){const n=new Int32Array(e.size());let r=0,i=0;for(;i!=n.length;++i)if(e.get(i)){const e=t[r++];n[i]=e>>>1^-(1&e)}else n[i]=0;return n}(r,e):function(e,t){const n=new Int32Array(e.size());let r=0,i=0;for(;i!=n.length;++i)n[i]=e.get(i)?t[r++]:0;return n}(r,e),e;default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(e,t,n,r){switch(t.logicalLevelTechnique1){case Qh.DELTA:return t.logicalLevelTechnique2===Qh.RLE&&(e=gd(e,t.runs,t.numRleValues)),function(e,t){const n=new BigInt64Array(e.size());let r=0;e.get(0)?(n[0]=e.get(0)?t[0]>>1n^-(1n&t[0]):0n,r=1):n[0]=0n;let i=1;for(;i!=n.length;++i)n[i]=e.get(i)?n[i-1]+(t[r]>>1n^-(1n&t[r++])):n[i-1];return n}(r,e);case Qh.RLE:return function(e,t,n,r){const i=t;return n?function(e,t,n){const r=new BigInt64Array(e.size());let i=0;for(let o=0;o<n;o++){const a=Number(t[o]);let s=t[o+n];s=s>>1n^-(1n&s);for(let t=i;t<i+a;t++)e.get(t)?r[t]=s:(r[t]=0n,i++);i+=a}return r}(r,e,i.runs):function(e,t,n){const r=new BigInt64Array(e.size());let i=0;for(let o=0;o<n;o++){const a=Number(t[o]),s=t[o+n];for(let t=i;t<i+a;t++)e.get(t)?r[t]=s:(r[t]=0n,i++);i+=a}return r}(r,e,i.runs)}(e,t,n,r);case Qh.NONE:return e=n?function(e,t){const n=new BigInt64Array(e.size());let r=0,i=0;for(;i!=n.length;++i)if(e.get(i)){const e=t[r++];n[i]=e>>1n^-(1n&e)}else n[i]=0n;return n}(r,e):function(e,t){const n=new BigInt64Array(e.size());let r=0,i=0;for(;i!=n.length;++i)n[i]=e.get(i)?t[r++]:0n;return n}(r,e),e;default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(e,t,n,r){const i=e.logicalLevelTechnique1;if(i===Qh.RLE)return 1===e.runs?rd.CONST:rd.FLAT;const o=t instanceof Ed?t.size():t;if(i===Qh.DELTA&&e.logicalLevelTechnique2===Qh.RLE){const t=e.runs,i=2;if(e.numRleValues!==o)return rd.FLAT;if(1===t)return rd.SEQUENCE;if(2===t){const t=r.get();let o;if(e.physicalLevelTechnique===$h.VARINT)o=ld(n,r,4);else{const e=r.get();o=new Int32Array(n.buffer,n.byteOffset+e,4)}if(r.set(t),o[2]===i&&o[3]===i)return rd.SEQUENCE}}return 1===e.numValues?rd.CONST:rd.FLAT}}class Pd extends Gh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Cd extends Wh{constructor(e,t,n,r){super(e,BigInt64Array.of(t),n,r)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Id{constructor(e,t,n){r(this,"_geometryOffsets",void 0),r(this,"_partOffsets",void 0),r(this,"_ringOffsets",void 0),this._geometryOffsets=e,this._partOffsets=t,this._ringOffsets=n}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class Ad{constructor(e,t){r(this,"tileExtent",void 0),r(this,"_numBits",void 0),r(this,"_coordinateShift",void 0),r(this,"minBound",void 0),r(this,"maxBound",void 0),this._coordinateShift=e<0?Math.abs(e):0,this.tileExtent=t+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=e,this.maxBound=t}validateCoordinates(e){if(e.x<this.minBound||e.y<this.minBound||e.x>this.maxBound||e.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class Md extends Ad{encode(e){this.validateCoordinates(e);const t=e.x+this._coordinateShift,n=e.y+this._coordinateShift;let r=0;for(let i=0;i<this._numBits;i++)r|=(t&1<<i)<<i|(n&1<<i)<<i+1;return r}decode(e){return{x:this.decodeMorton(e)-this._coordinateShift,y:this.decodeMorton(e>>1)-this._coordinateShift}}decodeMorton(e){let t=0;for(let n=0;n<this._numBits;n++)t|=(e&1<<2*n)>>n;return t}static decode(e,t,n){return{x:Md.decodeMorton(e,t)-n,y:Md.decodeMorton(e>>1,t)-n}}static decodeMorton(e,t){let n=0;for(let r=0;r<t;r++)n|=(e&1<<2*r)>>r;return n}}!function(e){e[e.POINT=0]="POINT",e[e.LINESTRING=1]="LINESTRING",e[e.POLYGON=2]="POLYGON",e[e.MULTIPOINT=3]="MULTIPOINT",e[e.MULTILINESTRING=4]="MULTILINESTRING",e[e.MULTIPOLYGON=5]="MULTIPOLYGON"}(id||(id={})),function(e){e[e.POINT=0]="POINT",e[e.LINESTRING=1]="LINESTRING",e[e.POLYGON=2]="POLYGON"}(od||(od={})),function(e){e[e.MORTON=0]="MORTON",e[e.VEC_2=1]="VEC_2",e[e.VEC_3=2]="VEC_3"}(ad||(ad={}));class Rd{createPoint(e){return[[e]]}createMultiPoint(e){return e.map(e=>[e])}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,t){return[e,...t]}createMultiPolygon(e){return e.flat()}}function Dd(e){const t=new Array(e.numGeometries);let r=1,i=1,o=1,a=0;const s=new Rd;let l=0,c=0;const u=e.mortonSettings,h=e.topologyVector,d=h.geometryOffsets,p=h.partOffsets,f=h.ringOffsets,m=e.vertexOffsets,g=e.containsPolygonGeometry(),_=e.vertexBuffer;for(let y=0;y<e.numGeometries;y++){const h=e.geometryType(y);if(h===id.POINT){if(m&&0!==m.length)if(e.vertexBufferType===ad.VEC_2){const e=2*m[c++],r=new n(_[e],_[e+1]);t[a++]=s.createPoint(r)}else{const e=m[c++],r=Md.decode(_[e],u.numBits,u.coordinateShift),i=new n(r.x,r.y);t[a++]=s.createPoint(i)}else{const e=new n(_[l++],_[l++]);t[a++]=s.createPoint(e)}d&&o++,p&&r++,f&&i++}else if(h===id.MULTIPOINT){const e=d[o]-d[o-1];o++;const r=new Array(e);if(m&&0!==m.length){for(let t=0;t<e;t++){const e=2*m[c++];r[t]=new n(_[e],_[e+1])}t[a++]=s.createMultiPoint(r)}else{for(let t=0;t<e;t++){const e=_[l++],i=_[l++];r[t]=new n(e,i)}t[a++]=s.createMultiPoint(r)}}else if(h===id.LINESTRING){let n,h=0;g?(h=f[i]-f[i-1],i++):h=p[r]-p[r-1],r++,m&&0!==m.length?(n=e.vertexBufferType===ad.VEC_2?Fd(_,m,c,h,!1):Bd(_,m,c,h,!1,u),c+=h):(n=Od(_,l,h,!1),l+=2*h),t[a++]=s.createLineString(n),d&&o++}else if(h===id.POLYGON){const n=p[r]-p[r-1];r++;const h=new Array(n-1);let g=f[i]-f[i-1];if(i++,m&&0!==m.length){const n=e.vertexBufferType===ad.VEC_2?Ld(_,m,c,g):jd(_,m,c,g,0,u);c+=g;for(let t=0;t<h.length;t++)g=f[i]-f[i-1],i++,h[t]=e.vertexBufferType===ad.VEC_2?Ld(_,m,c,g):jd(_,m,c,g,0,u),c+=g;t[a++]=s.createPolygon(n,h)}else{const e=zd(_,l,g);l+=2*g;for(let t=0;t<h.length;t++)g=f[i]-f[i-1],i++,h[t]=zd(_,l,g),l+=2*g;t[a++]=s.createPolygon(e,h)}d&&o++}else if(h===id.MULTILINESTRING){const n=d[o]-d[o-1];o++;const h=new Array(n);if(m&&0!==m.length){for(let t=0;t<n;t++){let n=0;g?(n=f[i]-f[i-1],i++):n=p[r]-p[r-1],r++;const o=e.vertexBufferType===ad.VEC_2?Fd(_,m,c,n,!1):Bd(_,m,c,n,!1,u);h[t]=o,c+=n}t[a++]=s.createMultiLineString(h)}else{for(let e=0;e<n;e++){let t=0;g?(t=f[i]-f[i-1],i++):t=p[r]-p[r-1],r++,h[e]=Od(_,l,t,!1),l+=2*t}t[a++]=s.createMultiLineString(h)}}else{if(h!==id.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const n=d[o]-d[o-1];o++;const h=new Array(n);let g=0;if(m&&0!==m.length){for(let t=0;t<n;t++){const n=p[r]-p[r-1];r++;const o=new Array(n-1);g=f[i]-f[i-1],i++;const a=e.vertexBufferType===ad.VEC_2?Ld(_,m,c,g):jd(_,m,c,g,0,u);c+=g;for(let t=0;t<o.length;t++)g=f[i]-f[i-1],i++,o[t]=e.vertexBufferType===ad.VEC_2?Ld(_,m,c,g):jd(_,m,c,g,0,u),c+=g;h[t]=s.createPolygon(a,o)}t[a++]=s.createMultiPolygon(h)}else{for(let e=0;e<n;e++){const t=p[r]-p[r-1];r++;const n=new Array(t-1);g=f[i]-f[i-1],i++;const o=zd(_,l,g);l+=2*g;for(let e=0;e<n.length;e++){const t=f[i]-f[i-1];i++,n[e]=zd(_,l,t),l+=2*t}h[e]=s.createPolygon(o,n)}t[a++]=s.createMultiPolygon(h)}}}}return t}function zd(e,t,n){return Od(e,t,n,!0)}function Ld(e,t,n,r){return Fd(e,t,n,r,!0)}function jd(e,t,n,r,i,o){return Bd(e,t,n,r,!0,o)}function Od(e,t,r,i){const o=new Array(i?r+1:r);for(let a=0;a<2*r;a+=2)o[a/2]=new n(e[t+a],e[t+a+1]);return i&&(o[o.length-1]=o[0]),o}function Fd(e,t,r,i,o){const a=new Array(o?i+1:i);for(let s=0;s<2*i;s+=2){const i=2*t[r+s/2];a[s/2]=new n(e[i],e[i+1])}return o&&(a[a.length-1]=a[0]),a}function Bd(e,t,r,i,o,a){const s=new Array(o?i+1:i);for(let l=0;l<i;l++){const i=Md.decode(e[t[r+l]],a.numBits,a.coordinateShift);s[l]=new n(i.x,i.y)}return o&&(s[s.length-1]=s[0]),s}class Nd{constructor(e,t,n,i,o){r(this,"_vertexBufferType",void 0),r(this,"_topologyVector",void 0),r(this,"_vertexOffsets",void 0),r(this,"_vertexBuffer",void 0),r(this,"_mortonSettings",void 0),this._vertexBufferType=e,this._topologyVector=t,this._vertexOffsets=n,this._vertexBuffer=i,this._mortonSettings=o}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Dd(this);let t=0;for(;t<this.numGeometries;)yield{coordinates:e[t],type:this.geometryType(t)},t++}getSimpleEncodedVertex(e){const t=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[t],this.vertexBuffer[t+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const t=Md.decode(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[t.x,t.y]}const t=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[t],this.vertexBuffer[t+1]]}getGeometries(){return Dd(this)}get mortonSettings(){return this._mortonSettings}}class Ud extends Nd{constructor(e,t,n,i,o,a,s){super(n,i,o,a,s),r(this,"_numGeometries",void 0),r(this,"_geometryType",void 0),this._numGeometries=e,this._geometryType=t}static createMortonEncoded(e,t,n,r,i,o){return new Ud(e,t,ad.MORTON,n,r,i,o)}static create(e,t,n,r,i){return new Ud(e,t,ad.VEC_2,n,r,i)}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===id.POLYGON||this._geometryType===id.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Vd extends Nd{constructor(e,t,n,i,o,a){super(e,n,i,o,a),r(this,"_geometryTypes",void 0),this._geometryTypes=t}static createMortonEncoded(e,t,n,r,i){return new Vd(ad.MORTON,e,t,n,r,i)}static create(e,t,n,r){return new Vd(ad.VEC_2,e,t,n,r)}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===id.POLYGON||this.geometryType(e)===id.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Gd{constructor(e,t,n,i){r(this,"_triangleOffsets",void 0),r(this,"_indexBuffer",void 0),r(this,"_vertexBuffer",void 0),r(this,"_topologyVector",void 0),this._triangleOffsets=e,this._indexBuffer=t,this._vertexBuffer=n,this._topologyVector=i}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),t=this._topologyVector,r=t.partOffsets,i=t.ringOffsets,o=t.geometryOffsets;let a=0,s=1,l=1,c=1;for(let u=0;u<this.numGeometries;u++)switch(this.geometryType(u)){case id.POLYGON:{const t=r[s]-r[s-1];s++;const h=[];for(let e=0;e<t;e++){const e=i[l]-i[l-1];l++;const t=[];for(let r=0;r<e;r++){const e=this._vertexBuffer[a++],r=this._vertexBuffer[a++];t.push(new n(e,r))}t.length>0&&t.push(t[0]),h.push(t)}e[u]=h,o&&c++}break;case id.MULTIPOLYGON:{const t=o[c]-o[c-1];c++;const h=[];for(let e=0;e<t;e++){const e=r[s]-r[s-1];s++;for(let t=0;t<e;t++){const e=i[l]-i[l-1];l++;const t=[];for(let r=0;r<e;r++){const e=this._vertexBuffer[a++],r=this._vertexBuffer[a++];t.push(new n(e,r))}t.length>0&&t.push(t[0]),h.push(t)}}e[u]=h}}return e}[Symbol.iterator](){return null}}class qd extends Gd{constructor(e,t,n,i,o,a){super(n,i,o,a),r(this,"_numGeometries",void 0),r(this,"_geometryType",void 0),this._numGeometries=e,this._geometryType=t}static create(e,t,n,r,i,o){return new qd(e,t,n,r,i,o)}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class Zd extends Gd{constructor(e,t,n,i,o){super(t,n,i,o),r(this,"_geometryTypes",void 0),this._geometryTypes=e}static create(e,t,n,r,i){return new Zd(e,t,n,r,i)}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Wd(e,t,n,r,i){const o=Td.decode(e,n);let a=null,s=null,l=null,c=null,u=null,h=null,d=null,p=null;if(kd.getVectorType(o,r,e,n)===rd.CONST){const f=kd.decodeConstIntStream(e,n,o,!1);for(let r=0;r<t-1;r++){const t=Td.decode(e,n);switch(t.physicalStreamType){case Jh.LENGTH:switch(t.logicalStreamType.lengthType){case nd.GEOMETRIES:a=kd.decodeLengthStreamToOffsetBuffer(e,n,t);break;case nd.PARTS:s=kd.decodeLengthStreamToOffsetBuffer(e,n,t);break;case nd.RINGS:l=kd.decodeLengthStreamToOffsetBuffer(e,n,t);break;case nd.TRIANGLES:d=kd.decodeLengthStreamToOffsetBuffer(e,n,t)}break;case Jh.OFFSET:switch(t.logicalStreamType.offsetType){case td.VERTEX:c=kd.decodeIntStream(e,n,t,!1);break;case td.INDEX:p=kd.decodeIntStream(e,n,t,!1)}break;case Jh.DATA:if(ed.VERTEX===t.logicalStreamType.dictionaryType)u=kd.decodeIntStream(e,n,t,!0,i);else{const r=t;h={numBits:r.numBits(),coordinateShift:r.coordinateShift()},u=kd.decodeIntStream(e,n,t,!1,i)}}}if(null!==p){if(null!=a||null!=s){const e=new Id(a,s,l);return qd.create(r,f,d,p,u,e)}return qd.create(r,f,d,p,u)}return null===h?Ud.create(r,f,new Id(a,s,l),c,u):Ud.createMortonEncoded(r,f,new Id(a,s,l),c,u,h)}const f=kd.decodeIntStream(e,n,o,!1);for(let m=0;m<t-1;m++){const t=Td.decode(e,n);switch(t.physicalStreamType){case Jh.LENGTH:switch(t.logicalStreamType.lengthType){case nd.GEOMETRIES:a=kd.decodeIntStream(e,n,t,!1);break;case nd.PARTS:s=kd.decodeIntStream(e,n,t,!1);break;case nd.RINGS:l=kd.decodeIntStream(e,n,t,!1);break;case nd.TRIANGLES:d=kd.decodeLengthStreamToOffsetBuffer(e,n,t)}break;case Jh.OFFSET:switch(t.logicalStreamType.offsetType){case td.VERTEX:c=kd.decodeIntStream(e,n,t,!1);break;case td.INDEX:p=kd.decodeIntStream(e,n,t,!1)}break;case Jh.DATA:if(ed.VERTEX===t.logicalStreamType.dictionaryType)u=kd.decodeIntStream(e,n,t,!0,i);else{const r=t;h={numBits:r.numBits(),coordinateShift:r.coordinateShift()},u=kd.decodeIntStream(e,n,t,!1,i)}}}return null!==p&&null===s?Zd.create(f,d,p,u):(null!==a?(a=Hd(f,a,2),null!==s&&null!==l?(s=Xd(f,a,s,!1),l=function(e,t,n,r){const i=new Int32Array(n[n.length-1]+1);let o=0;i[0]=o;let a=1,s=1,l=0;for(let c=0;c<e.length;c++){const u=e[c],h=t[c+1]-t[c];if(0!==u&&3!==u)for(let e=0;e<h;e++){const e=n[a]-n[a-1];a++;for(let t=0;t<e;t++)o=i[s++]=o+r[l++]}else for(let e=0;e<h;e++)i[s++]=++o,a++}return i}(f,a,s,l)):null!==s&&(s=function(e,t,n){const r=new Int32Array(t[t.length-1]+1);let i=0;r[0]=i;let o=1,a=0;for(let s=0;s<e.length;s++){const l=e[s],c=t[s+1]-t[s];if(4===l||1===l)for(let e=0;e<c;e++)i=r[o++]=i+n[a++];else for(let e=0;e<c;e++)r[o++]=++i}return r}(f,a,s))):null!==s&&null!==l?(s=Hd(f,s,1),l=Xd(f,s,l,!0)):null!==s&&(s=Hd(f,s,0)),null!==p?Zd.create(f,d,p,u,new Id(a,s,l)):null===h?Vd.create(f,new Id(a,s,l),c,u):Vd.createMortonEncoded(f,new Id(a,s,l),c,u,h))}function Hd(e,t,n){const r=new Int32Array(e.length+1);let i=0;r[0]=i;let o=0;for(let a=0;a<e.length;a++)i=r[a+1]=i+(e[a]>n?t[o++]:1);return r}function Xd(e,t,n,r){const i=new Int32Array(t[t.length-1]+1);let o=0;i[0]=o;let a=1,s=0;for(let l=0;l<e.length;l++){const c=e[l],u=t[l+1]-t[l];if(5===c||2===c||r&&(4===c||1===c))for(let e=0;e<u;e++)o=i[a++]=o+n[s++];else for(let e=0;e<u;e++)i[a++]=++o}return i}class Kd extends Vh{constructor(e,t,n){super(e,t.getBuffer(),n),r(this,"dataVector",void 0),this.dataVector=t}getValueFromBuffer(e){return this.dataVector.get(e)}}class Yd extends Gh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Jd extends Vh{constructor(e,t,n){super(e,BigInt64Array.of(t),n)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Qd(e,t,n){for(let r=0;r<e;r++){const e=Td.decode(t,n);n.add(e.byteLength)}}function $d(e,t,n){return ep(e,Math.ceil(t/8),n)}function ep(e,t,n){const r=new Uint8Array(t);let i=0;for(;i<t;){const t=e[n.increment()];if(t<=127){const o=t+3,a=e[n.increment()],s=i+o;r.fill(a,i,s),i=s}else{const o=256-t;for(let t=0;t<o;t++)r[i++]=e[n.increment()]}}return r}const tp=new TextDecoder;function np(e,t,n){return n-t>=12?tp.decode(e.subarray(t,n)):function(e,t,n){let r="",i=t;for(;i<n;){const t=e[i];let o,a,s,l=null,c=t>239?4:t>223?3:t>191?2:1;if(i+c>n)break;1===c?t<128&&(l=t):2===c?(o=e[i+1],128==(192&o)&&(l=(31&t)<<6|63&o,l<=127&&(l=null))):3===c?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(l=(15&t)<<12|(63&o)<<6|63&a,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&t)<<18|(63&o)<<12|(63&a)<<6|63&s,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(e,t,n)}class rp extends Vh{constructor(e,t,n,i){super(e,n,i),r(this,"offsetBuffer",void 0),this.offsetBuffer=t}}class ip extends rp{constructor(e,t,n,i){super(e,t,n,null!==i&&void 0!==i?i:t.length-1),r(this,"textEncoder",void 0),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return np(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class op extends rp{constructor(e,t,n,i,o){super(e,n,i,null!==o&&void 0!==o?o:t.length),r(this,"indexBuffer",void 0),r(this,"textEncoder",void 0),this.indexBuffer=t,this.indexBuffer=t,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const t=this.indexBuffer[e];return np(this.dataBuffer,this.offsetBuffer[t],this.offsetBuffer[t+1])}}class ap extends rp{constructor(e,t,n,i,o,a,s){super(e,n,i,s),r(this,"indexBuffer",void 0),r(this,"symbolOffsetBuffer",void 0),r(this,"symbolTableBuffer",void 0),r(this,"textEncoder",void 0),r(this,"symbolLengthBuffer",void 0),r(this,"lengthBuffer",void 0),r(this,"decodedDictionary",void 0),this.indexBuffer=t,this.symbolOffsetBuffer=o,this.symbolTableBuffer=a,this.textEncoder=new TextEncoder}getValueFromBuffer(e){null==this.decodedDictionary&&(null==this.symbolLengthBuffer&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=function(e,t,n){const r=[],i=new Array(t.length).fill(0);for(let o=1;o<t.length;o++)i[o]=i[o-1]+t[o-1];for(let o=0;o<n.length;o++)if(255===n[o])r.push(n[++o]);else{const a=t[n[o]],s=i[n[o]];for(let t=0;t<a;t++)r.push(e[s+t])}return new Uint8Array(r)}(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const t=this.indexBuffer[e];return np(this.decodedDictionary,this.offsetBuffer[t],this.offsetBuffer[t+1])}offsetToLengthBuffer(e){const t=new Uint32Array(e.length-1);let n=e[0];for(let r=1;r<e.length;r++){const i=e[r];t[r-1]=i-n,n=i}return t}}class sp{constructor(){}static decode(e,t,n,r,i){var o,a;let s=null,l=null,c=null,u=null,h=null,d=null,p=null,f=null;for(let m=0;m<r;m++){const e=Td.decode(t,n);if(0!==e.byteLength)switch(e.physicalStreamType){case Jh.PRESENT:{const r=$d(t,e.numValues,n);d=new Ed(r,e.numValues);break}case Jh.OFFSET:l=null!=i||null!=d?kd.decodeNullableIntStream(t,n,e,!1,null!==i&&void 0!==i?i:d):kd.decodeIntStream(t,n,e,!1);break;case Jh.LENGTH:{const r=kd.decodeLengthStreamToOffsetBuffer(t,n,e);nd.DICTIONARY===e.logicalStreamType.lengthType?s=r:nd.SYMBOL===e.logicalStreamType.lengthType?u=r:p=r;break}case Jh.DATA:{const r=t.subarray(n.get(),n.get()+e.byteLength);n.add(e.byteLength);const i=e.logicalStreamType.dictionaryType;ed.FSST===i?h=r:ed.SINGLE===i||ed.SHARED===i?c=r:ed.NONE===i&&(f=r);break}}}return null!==(o=null!==(a=this.decodeFsstDictionaryVector(e,h,l,s,c,u,null!==i&&void 0!==i?i:d))&&void 0!==a?a:this.decodeDictionaryVector(e,c,l,s,null!==i&&void 0!==i?i:d))&&void 0!==o?o:this.decodePlainStringVector(e,p,f,l,null!==i&&void 0!==i?i:d)}static decodeFsstDictionaryVector(e,t,n,r,i,o,a){return t?new ap(e,n,r,i,o,t,a):null}static decodeDictionaryVector(e,t,n,r,i){return t?i?new op(e,n,r,t,i):new op(e,n,r,t):null}static decodePlainStringVector(e,t,n,r,i){if(!t||!n)return null;if(r)return i?new op(e,r,t,n,i):new op(e,r,t,n);if(i&&i.size()!==t.length-1){const r=new Int32Array(i.size());let o=0;for(let e=0;e<i.size();e++)r[e]=i.get(e)?o++:0;return new op(e,r,t,n,i)}return i?new ip(e,t,n,i):new ip(e,t,n)}static decodeSharedDictionary(e,t,n,r,i){let o=null,a=null,s=null,l=null,c=!1;for(;!c;){const n=Td.decode(e,t);switch(n.physicalStreamType){case Jh.LENGTH:nd.DICTIONARY===n.logicalStreamType.lengthType?o=kd.decodeLengthStreamToOffsetBuffer(e,t,n):s=kd.decodeLengthStreamToOffsetBuffer(e,t,n);break;case Jh.DATA:ed.SINGLE===n.logicalStreamType.dictionaryType||ed.SHARED===n.logicalStreamType.dictionaryType?(a=e.subarray(t.get(),t.get()+n.byteLength),c=!0):l=e.subarray(t.get(),t.get()+n.byteLength),t.add(n.byteLength)}}const u=n.complexType.children,h=[];let d=0;for(const p of u){const c=ld(e,t,1)[0];if(0==c)continue;const u="".concat(n.name).concat(p.name===sp.ROOT_COLUMN_NAME?"":sp.NESTED_COLUMN_SEPARATOR+p.name);if(i&&!i.has(u)){Qd(c,e,t);continue}if(2!==c||"scalarField"!==p.type||9!==p.scalarField.physicalType)throw new Error("Currently only optional string fields are implemented for a struct.");const f=Td.decode(e,t),m=$d(e,f.numValues,t),g=Td.decode(e,t),_=(g instanceof Sd?g.numRleValues:g.numValues)!==r?kd.decodeNullableIntStream(e,t,g,!1,new Ed(m,f.numValues)):kd.decodeIntStream(e,t,g,!1);h[d++]=l?new ap(u,_,o,a,s,l,new Ed(m,f.numValues)):new op(u,_,o,a,new Ed(m,f.numValues))}return h}}function lp(e,t,n,r,i,o){return"scalarType"===n.type?function(e,t,n,r,i,o){let a=null,s=0;if(0===e)return null;if(o.nullable){const e=Td.decode(t,n);s=e.numValues;const r=n.get(),i=$d(t,s,n);n.set(r+e.byteLength),a=new Ed(i,e.numValues)}const l=null!==a&&void 0!==a?a:r;switch(i.physicalType){case 4:case 3:return function(e,t,n,r,i){const o=Td.decode(e,t),a=kd.getVectorType(o,i,e,t),s=3===r.physicalType;if(a===rd.FLAT){const r=cp(i)?kd.decodeNullableIntStream(e,t,o,s,i):kd.decodeIntStream(e,t,o,s);return new qh(n.name,r,i)}if(a===rd.SEQUENCE){const r=kd.decodeSequenceIntStream(e,t,o);return new Hh(n.name,r[0],r[1],o.numRleValues)}{const r=kd.decodeConstIntStream(e,t,o,s);return new Xh(n.name,r,i)}}(t,n,o,i,l);case 9:return sp.decode(o.name,t,n,o.nullable?e-1:e,a);case 0:return function(e,t,n,r,i){const o=Td.decode(e,t),a=o.numValues,s=t.get(),l=cp(i)?function(e,t,n,r){const i=ep(e,Math.ceil(t/8),n),o=new Ed(i,t),a=r.size(),s=new Ed(new Uint8Array(a),a);let l=0;for(let c=0;c<r.size();c++){const e=!!r.get(c)&&o.get(l++);s.set(c,e)}return s.getBuffer()}(e,a,t,i):$d(e,a,t);t.set(s+o.byteLength);const c=new Ed(l,a);return new Kd(n.name,c,i)}(t,n,o,0,l);case 6:case 5:return function(e,t,n,r,i){const o=Td.decode(e,t),a=kd.getVectorType(o,r,e,t),s=5===i.physicalType;if(a===rd.FLAT){const i=cp(r)?kd.decodeNullableLongStream(e,t,o,s,r):kd.decodeLongStream(e,t,o,s);return new Pd(n.name,i,r)}if(a===rd.SEQUENCE){const r=kd.decodeSequenceLongStream(e,t,o);return new Cd(n.name,r[0],r[1],o.numRleValues)}{const i=kd.decodeConstLongStream(e,t,o,s);return new Jd(n.name,i,r)}}(t,n,o,l,i);case 7:return function(e,t,n,r){const i=Td.decode(e,t),o=cp(r)?function(e,t,n,r){const i=t.get(),o=i+r*Float32Array.BYTES_PER_ELEMENT,a=new Uint8Array(e.subarray(i,o)).buffer,s=new Float32Array(a);t.set(o);const l=n.size(),c=new Float32Array(l);let u=0;for(let h=0;h<l;h++)c[h]=n.get(h)?s[u++]:0;return c}(e,t,r,i.numValues):function(e,t,n){const r=t.get(),i=r+n*Float32Array.BYTES_PER_ELEMENT,o=new Uint8Array(e.subarray(r,i)).buffer,a=new Float32Array(o);return t.set(i),a}(e,t,i.numValues);return new Yd(n.name,o,r)}(t,n,o,l);case 8:return function(e,t,n,r){const i=Td.decode(e,t),o=cp(r)?function(e,t,n,r){const i=t.get(),o=i+r*Float64Array.BYTES_PER_ELEMENT,a=new Uint8Array(e.subarray(i,o)).buffer,s=new Float64Array(a);t.set(o);const l=n.size(),c=new Float64Array(l);let u=0;for(let h=0;h<l;h++)c[h]=n.get(h)?s[u++]:0;return c}(e,t,r,i.numValues):function(e,t,n){const r=t.get(),i=r+n*Float64Array.BYTES_PER_ELEMENT,o=new Uint8Array(e.subarray(r,i)).buffer,a=new Float64Array(o);return t.set(i),a}(e,t,i.numValues);return new Zh(n.name,o,r)}(t,n,o,l);default:throw new Error("The specified data type for the field is currently not supported: ".concat(i))}}(r,e,t,i,n.scalarType,n):1!=r?null:sp.decodeSharedDictionary(e,t,n,i,o)}function cp(e){return e instanceof Ed}r(sp,"ROOT_COLUMN_NAME","default"),r(sp,"NESTED_COLUMN_SEPARATOR",":");class up{static decodeColumnType(e){switch(e){case 0:case 1:case 2:case 3:{const t={};t.nullable=!!(1&e),t.columnScope=0;const n={};return n.physicalType=e>1?6:4,n.type="physicalType",t.scalarType=n,t.type="scalarType",t}case 4:{const e={nullable:!1,columnScope:0},t={type:"physicalType",physicalType:0};return e.type="complexType",e.complexType=t,e}case 30:{const e={nullable:!1,columnScope:0},t={type:"physicalType",physicalType:1};return e.type="complexType",e.complexType=t,e}default:return this.mapScalarType(e)}}static columnTypeHasName(e){return e>=10}static columnTypeHasChildren(e){return 30===e}static hasStreamCount(e){if("id"===e.name)return!1;if("scalarType"===e.type){const t=e.scalarType;if("physicalType"===t.type)switch(t.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if("logicalType"===t.type)return!1}else if("complexType"===e.type){const t=e.complexType;if("physicalType"===t.type)switch(t.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",e),!1}static mapScalarType(e){let t=null;switch(e){case 10:case 11:t=0;break;case 12:case 13:t=1;break;case 14:case 15:t=2;break;case 16:case 17:t=3;break;case 18:case 19:t=4;break;case 20:case 21:t=5;break;case 22:case 23:t=6;break;case 24:case 25:t=7;break;case 26:case 27:t=8;break;case 28:case 29:t=9;break;default:return null}const n={};n.nullable=!!(1&e),n.columnScope=0;const r={type:"physicalType"};return r.physicalType=t,n.type="scalarType",n.scalarType=r,n}}const hp=new TextDecoder;function dp(e,t){const n=ld(e,t,1)[0];if(0===n)return"";const r=t.get(),i=e.subarray(r,r+n);return t.add(n),hp.decode(i)}function pp(e,t){const n=ld(e,t,1)[0]>>>0,r=!!(4&n),i=!!(2&n),o=ld(e,t,1)[0]>>>0,a={};if(1&n&&(a.nullable=!0),i){const i={};if(r?(i.type="logicalType",i.logicalType=o):(i.type="physicalType",i.physicalType=o),8&n){const n=ld(e,t,1)[0]>>>0;i.children=new Array(n);for(let r=0;r<n;r++)i.children[r]=pp(e,t)}a.type="complexField",a.complexField=i}else{const e={};r?(e.type="logicalType",e.logicalType=o):(e.type="physicalType",e.physicalType=o),a.type="scalarField",a.scalarField=e}return a}function fp(e,t){const n=ld(e,t,1)[0]>>>0,r=up.decodeColumnType(n);if(!r)throw new Error("Unsupported column type code: ".concat(n));if(up.columnTypeHasName(n)?r.name=dp(e,t):n>=0&&n<=3?r.name="id":4===n&&(r.name="geometry"),up.columnTypeHasChildren(n)){const n=ld(e,t,1)[0]>>>0,i=r.complexType;i.children=new Array(n);for(let r=0;r<n;r++)i.children[r]=pp(e,t)}return r}function mp(e,t){const n={featureTables:[]},r={};r.name=dp(e,t);const i=ld(e,t,1)[0]>>>0,o=ld(e,t,1)[0]>>>0;r.columns=new Array(o);for(let a=0;a<o;a++)r.columns[a]=fp(e,t);return n.featureTables.push(r),[n,i]}function gp(e,t,n,r,i,o){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const s=t.scalarType.physicalType,l=kd.getVectorType(i,o,e,n);if(4===s)switch(l){case rd.FLAT:{const t=kd.decodeIntStream(e,n,i,!1);return new qh(r,t,o)}case rd.SEQUENCE:{const t=kd.decodeSequenceIntStream(e,n,i);return new Hh(r,t[0],t[1],i.numRleValues)}case rd.CONST:{const t=kd.decodeConstIntStream(e,n,i,!1);return new Xh(r,t,o)}}else switch(l){case rd.FLAT:{if(a){const t=kd.decodeLongFloat64Stream(e,n,i,!1);return new Zh(r,t,o)}const t=kd.decodeLongStream(e,n,i,!1);return new Pd(r,t,o)}case rd.SEQUENCE:{const t=kd.decodeSequenceLongStream(e,n,i);return new Cd(r,t[0],t[1],i.numRleValues)}case rd.CONST:{const t=kd.decodeConstLongStream(e,n,i,!1);return new Jd(r,t,o)}}throw new Error("Vector type not supported for id column.")}class _p{constructor(e,t){var n;switch(this._featureData=e,this.properties=this._featureData.properties||{},null===(n=this._featureData.geometry)||void 0===n?void 0:n.type){case id.POINT:case id.MULTIPOINT:this.type=1;break;case id.LINESTRING:case id.MULTILINESTRING:this.type=2;break;case id.POLYGON:case id.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=t,this.id=Number(this._featureData.id)}projectPoint(e,t,n,r){return[360*(e.x+t)/r-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+n)/r)*Math.PI))-90]}projectLine(e,t,n,r){return e.map(e=>this.projectPoint(e,t,n,r))}toGeoJSON(e,t,n){const r=this.extent*Math.pow(2,n),i=this.extent*e,o=this.extent*t,a=this.loadGeometry();let s;switch(this.type){case 1:{const e=[];for(const n of a)e.push(n[0]);const t=this.projectLine(e,i,o,r);s=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t};break}case 2:{const e=a.map(e=>this.projectLine(e,i,o,r));s=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e};break}case 3:{const e=tr(a),t=[];for(const n of e)t.push(n.map(e=>this.projectLine(e,i,o,r)));s=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t};break}default:throw new Error("unknown feature type: ".concat(this.type))}const l={type:"Feature",geometry:s,properties:this.properties};return null!=this.id&&(l.id=this.id),l}loadGeometry(){const e=[];for(const t of this._featureData.geometry.coordinates){const r=[];for(const e of t)r.push(new n(e.x,e.y));e.push(r)}return e}bbox(){return[0,0,0,0]}}class yp{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new _p(this.features[e],this.extent)}}class vp{constructor(e){this.layers={};const t=function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=new Yh(0),i=[];for(;r.get()<e.length;){const o=ld(e,r,1)[0]>>>0,a=r.get()+o;if(a>e.length)throw new Error("Block overruns tile: ".concat(a," > ").concat(e.length));if(1!=ld(e,r,1)[0]>>>0){r.set(a);continue}const s=mp(e,r),l=s[1],c=s[0].featureTables[0];let u=null,h=null;const d=[];let p=0;for(const i of c.columns){const o=i.name;if("id"===o){let t=null;if(i.nullable){const n=Td.decode(e,r),i=r.get(),o=$d(e,n.numValues,r);r.set(i+n.byteLength),t=new Ed(o,n.numValues)}const a=Td.decode(e,r);p=a.getDecompressedCount(),u=gp(e,i,r,o,a,null!==t&&void 0!==t?t:p,n)}else if("geometry"===o){const n=ld(e,r,1)[0];if(0===p){const t=r.get();p=Td.decode(e,r).getDecompressedCount(),r.set(t)}h=Wd(e,n,r,p,t)}else{const t=up.hasStreamCount(i)?ld(e,r,1)[0]:1;if(0===t&&"scalarType"===i.type)continue;const n=lp(e,r,i,t,p,void 0);n&&(Array.isArray(n)?d.push(...n):d.push(n))}}const f=new Kh(c.name,h,u,d,l);i.push(f),r.set(a)}return i}(new Uint8Array(e));this.layers=t.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:new yp(t)}),{})}}class bp{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new so(A,16,0),this.grid3D=new so(A,16,0),this.featureIndexArray=new Oa,this.promoteId=t}insert(e,t,n,r,i,o){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);const s=o?this.grid3D:this.grid;for(let l=0;l<t.length;l++){const e=t[l],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const r=e[t];n[0]=Math.min(n[0],r.x),n[1]=Math.min(n[1],r.y),n[2]=Math.max(n[2],r.x),n[3]=Math.max(n[3],r.y)}n[0]<A&&n[1]<A&&n[2]>=0&&n[3]>=0&&s.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers="mlt"!==this.encoding?new Ic(new pu(this.rawTileData)).layers:new vp(this.rawTileData).layers,this.sourceLayerCoder=new Nh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,r,i){this.loadVTLayers();const o=e.params,a=A/e.tileSize/e.scale,s=pi(o.filter,o.globalState),l=e.queryGeometry,c=e.queryPadding*a,u=Bh.fromPoints(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=Bh.fromPoints(e.cameraQueryGeometry).expandBy(c),p=this.grid3D.query(d.minX,d.minY,d.maxX,d.maxY,(t,r,i,o)=>function(e,t,r,i,o){for(const n of e)if(t<=n.x&&r<=n.y&&i>=n.x&&o>=n.y)return!0;const a=[new n(t,r),new n(t,o),new n(i,o),new n(i,r)];if(e.length>2)for(const n of a)if(Ys(e,n))return!0;for(let n=0;n<e.length-1;n++)if(Js(e[n],e[n+1],a))return!0;return!1}(e.cameraQueryGeometry,t-c,r-c,i+c,o+c));for(const n of p)h.push(n);h.sort(wp);const f={};let m;for(let n=0;n<h.length;n++){const c=h[n];if(c===m)continue;m=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,s,o.layers,o.availableImages,t,r,i,(t,n,r)=>(d||(d=js(t)),n.queryIntersectsFeature({queryGeometry:l,feature:t,featureState:r,geometry:d,zoom:this.z,transform:e.transform,pixelsToTileUnits:a,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation})))}return f}loadMatchingFeature(e,t,n,r,i,o,a,s,l,c,u){const h=this.bucketLayerIDs[t];if(o&&!h.some(e=>o.has(e)))return;const d=this.sourceLayerCoder.decode(n),p=this.vtLayers[d].feature(r);if(i.needGeometry){const e=Os(p,!0);if(!i.filter(new Ao(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new Ao(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let m=0;m<h.length;m++){const t=h[m];if(o&&!o.has(t))continue;const n=s[t];if(!n)continue;let i={};f&&c&&(i=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const d=B({},l[t]);d.paint=xp(d.paint,n.paint,p,i,a),d.layout=xp(d.layout,n.layout,p,i,a);const g=!u||u(p,n,i);if(!g)continue;const _=new Uh(p,this.z,this.x,this.y,f);_.layer=d;let y=e[t];void 0===y&&(y=e[t]=[]),y.push({featureIndex:r,feature:_,intersectionZ:g})}}lookupSymbolFeatures(e,t,n,r,i,o,a,s){const l={};this.loadVTLayers();const c=pi(i.filterSpec,i.globalState);for(const u of e)this.loadMatchingFeature(l,n,r,u,c,o,a,s,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){var n;let r=e.id;return this.promoteId&&(r=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof r&&(r=Number(r)),void 0===r&&(null===(n=e.properties)||void 0===n?void 0:n.cluster)&&this.promoteId&&(r=Number(e.properties.cluster_id))),r}}function xp(e,t,n,r,i){return U(e,(e,o)=>{const a=t instanceof Bo?t.get(o):null;return a&&a.evaluate?a.evaluate(n,r,i):a})}function wp(e,t){return t-e}function Sp(e,t,r,i,o){const a=[];for(let s=0;s<e.length;s++){const l=e[s];let c;for(let e=0;e<l.length-1;e++){let s=l[e],u=l[e+1];s.x<t&&u.x<t||(s.x<t?s=new n(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<t&&(u=new n(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<r&&u.y<r||(s.y<r?s=new n(s.x+(r-s.y)/(u.y-s.y)*(u.x-s.x),r)._round():u.y<r&&(u=new n(s.x+(r-s.y)/(u.y-s.y)*(u.x-s.x),r)._round()),s.x>=i&&u.x>=i||(s.x>=i?s=new n(i,s.y+(i-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=i&&(u=new n(i,s.y+(i-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=o&&u.y>=o||(s.y>=o?s=new n(s.x+(o-s.y)/(u.y-s.y)*(u.x-s.x),o)._round():u.y>=o&&(u=new n(s.x+(o-s.y)/(u.y-s.y)*(u.x-s.x),o)._round()),c&&s.equals(c[c.length-1])||(c=[s],a.push(c)),c.push(u)))))}}return a}function Tp(e,t,n,r,i){switch(t){case 1:return function(e,t,n,r){const i=[];for(const o of e)for(const e of o){const o=0===r?e.x:e.y;o>=t&&o<=n&&i.push([e])}return i}(e,n,r,i);case 2:return kp(e,n,r,i,!1);case 3:return kp(e,n,r,i,!0)}return[]}function Ep(e,t,r,i,o){const a=0===i?Pp:Cp;let s=[];const l=[];for(let n=0;n<e.length-1;n++){const c=e[n],u=e[n+1],h=0===i?c.x:c.y,d=0===i?u.x:u.y;let p=!1;h<t?d>t&&s.push(a(c,u,t)):h>r?d<r&&s.push(a(c,u,r)):s.push(c),d<t&&h>=t&&(s.push(a(c,u,t)),p=!0),d>r&&h<=r&&(s.push(a(c,u,r)),p=!0),!o&&p&&(l.push(s),s=[])}const c=e.length-1,u=0===i?e[c].x:e[c].y;return u>=t&&u<=r&&s.push(e[c]),o&&s.length>0&&!s[0].equals(s[s.length-1])&&s.push(new n(s[0].x,s[0].y)),s.length>0&&l.push(s),l}function kp(e,t,n,r,i){const o=[];for(const a of e){const e=Ep(a,t,n,r,i);e.length>0&&o.push(...e)}return o}function Pp(e,t,r){return new n(r,e.y+(r-e.x)/(t.x-e.x)*(t.y-e.y))}function Cp(e,t,r){return new n(e.x+(r-e.y)/(t.y-e.y)*(t.x-e.x),r)}co("FeatureIndex",bp,{omit:["rawTileData","sourceLayerCoder"]});class Ip extends n{constructor(e,t,n,r){super(e,t),this.angle=n,void 0!==r&&(this.segment=r)}clone(){return new Ip(this.x,this.y,this.angle,this.segment)}}function Ap(e,t,n,r,i){if(void 0===t.segment||0===n)return!0;let o=t,a=t.segment+1,s=0;for(;s>-n/2;){if(a--,a<0)return!1;s-=e[a].dist(o),o=e[a]}s+=e[a].dist(e[a+1]),a++;const l=[];let c=0;for(;s<n/2;){const t=e[a],n=e[a+1];if(!n)return!1;let o=e[a-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:o}),c+=o;s-l[0].distance>r;)c-=l.shift().angleDelta;if(c>i)return!1;a++,s+=t.dist(n)}return!0}function Mp(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Rp(e,t,n){return e?.6*t*n:0}function Dp(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function zp(e,t,n,r,i,o){const a=Rp(n,i,o),s=Dp(n,r)*o;let l=0;const c=Mp(e)/2;for(let u=0;u<e.length-1;u++){const n=e[u],r=e[u+1],i=n.dist(r);if(l+i>c){const o=(c-l)/i,h=gn.number(n.x,r.x,o),d=gn.number(n.y,r.y,o),p=new Ip(h,d,r.angleTo(n),u);return p._round(),!a||Ap(e,p,s,a,t)?p:void 0}l+=i}}function Lp(e,t,n,r,i,o,a,s,l){const c=Rp(r,o,a),u=Dp(r,i),h=u*a,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),jp(e,d?t/2*s%t:(u/2+2*o)*a*s%t,t,c,n,h,d,!1,l)}function jp(e,t,n,r,i,o,a,s,l){const c=o/2,u=Mp(e);let h=0,d=t-n,p=[];for(let f=0;f<e.length-1;f++){const t=e[f],a=e[f+1],s=t.dist(a),m=a.angleTo(t);for(;d+n<h+s;){d+=n;const g=(d-h)/s,_=gn.number(t.x,a.x,g),y=gn.number(t.y,a.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const t=new Ip(_,y,m,f);t._round(),r&&!Ap(e,t,o,r,i)||p.push(t)}}h+=s}return s||p.length||a||(p=jp(e,h/2,n,r,i,o,a,!0,l)),p}function Op(e,t,r,i){const o=[],a=e.image,s=a.pixelRatio,l=a.paddedRect.w-2,c=a.paddedRect.h-2;let u={x1:e.left,y1:e.top,x2:e.right,y2:e.bottom};const h=a.stretchX||[[0,l]],d=a.stretchY||[[0,c]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),g=l-f,_=c-m;let y=0,v=f,b=0,x=m,w=0,S=g,T=0,E=_;if(a.content&&i){const t=a.content,n=t[2]-t[0],r=t[3]-t[1];(a.textFitWidth||a.textFitHeight)&&(u=Qu(e)),y=Fp(h,0,t[0]),b=Fp(d,0,t[1]),v=Fp(h,t[0],t[2]),x=Fp(d,t[1],t[3]),w=t[0]-y,T=t[1]-b,S=n-v,E=r-x}const k=u.x1,P=u.y1,C=u.x2-k,I=u.y2-P,A=(e,i,o,l)=>{const c=Np(e.stretch-y,v,C,k),u=Up(e.fixed-w,S,e.stretch,f),h=Np(i.stretch-b,x,I,P),d=Up(i.fixed-T,E,i.stretch,m),p=Np(o.stretch-y,v,C,k),g=Up(o.fixed-w,S,o.stretch,f),_=Np(l.stretch-b,x,I,P),A=Up(l.fixed-T,E,l.stretch,m),M=new n(c,h),R=new n(p,h),D=new n(p,_),z=new n(c,_),L=new n(u/s,d/s),j=new n(g/s,A/s),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),n=[t,-e,e,t];M._matMult(n),R._matMult(n),z._matMult(n),D._matMult(n)}const F=e.stretch+e.fixed,B=i.stretch+i.fixed;return{tl:M,tr:R,bl:z,br:D,tex:{x:a.paddedRect.x+1+F,y:a.paddedRect.y+1+B,w:o.stretch+o.fixed-F,h:l.stretch+l.fixed-B},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:j,minFontScaleX:S/s/C,minFontScaleY:E/s/I,isSDF:r}};if(i&&(a.stretchX||a.stretchY)){const e=Bp(h,g,f),t=Bp(d,_,m);for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1];for(let e=0;e<t.length-1;e++)o.push(A(r,t[e],i,t[e+1]))}}else o.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function Fp(e,t,n){let r=0;for(const i of e)r+=Math.max(t,Math.min(n,i[1]))-Math.max(t,Math.min(n,i[0]));return r}function Bp(e,t,n){const r=[{fixed:-1,stretch:0}];for(const[i,o]of e){const e=r[r.length-1];r.push({fixed:i-e.stretch,stretch:e.stretch}),r.push({fixed:i-e.stretch,stretch:e.stretch+(o-i)})}return r.push({fixed:t+1,stretch:n}),r}function Np(e,t,n,r){return e/t*n+r}function Up(e,t,n,r){return e-t*n/r}co("Anchor",Ip);class Vp{constructor(e,t,r,i,o,a,s,l,c,u){var h;if(this.boxStartIndex=e.length,c){let e=a.top,t=a.bottom;const n=a.collisionPadding;n&&(e-=n[1],t+=n[3]);let r=t-e;r>0&&(r=Math.max(10,r),this.circleDiameter=r)}else{const c=(null===(h=a.image)||void 0===h?void 0:h.content)&&(a.image.textFitWidth||a.image.textFitHeight)?Qu(a):{x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};c.y1=c.y1*s-l[0],c.y2=c.y2*s+l[2],c.x1=c.x1*s-l[3],c.x2=c.x2*s+l[1];const d=a.collisionPadding;if(d&&(c.x1-=d[0]*s,c.y1-=d[1]*s,c.x2+=d[2]*s,c.y2+=d[3]*s),u){const e=new n(c.x1,c.y1),t=new n(c.x2,c.y1),r=new n(c.x1,c.y2),i=new n(c.x2,c.y2),o=u*Math.PI/180;e._rotate(o),t._rotate(o),r._rotate(o),i._rotate(o),c.x1=Math.min(e.x,t.x,r.x,i.x),c.x2=Math.max(e.x,t.x,r.x,i.x),c.y1=Math.min(e.y,t.y,r.y,i.y),c.y2=Math.max(e.y,t.y,r.y,i.y)}e.emplaceBack(t.x,t.y,c.x1,c.y1,c.x2,c.y2,r,i,o)}this.boxEndIndex=e.length}}class Gp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,r=t[e];for(;e>0;){const i=e-1>>1,o=t[i];if(n(r,o)>=0)break;t[e]=o,e=i}t[e]=r}_down(e){const{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;e<r;){let r=1+(e<<1);const o=r+1;if(o<this.length&&n(t[o],t[r])<0&&(r=o),n(t[r],i)>=0)break;t[e]=t[r],e=r}t[e]=i}}function qp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Bh.fromPoints(e[0]),o=Math.min(i.width(),i.height());let a=o/2;const s=new Gp([],Zp),{minX:l,minY:c,maxX:u,maxY:h}=i;if(0===o)return new n(l,c);for(let n=l;n<u;n+=o)for(let t=c;t<h;t+=o)s.push(new Wp(n+a,t+a,a,e));let d=function(e){let t=0,n=0,r=0;const i=e[0];for(let o=0,a=i.length,s=a-1;o<a;s=o++){const e=i[o],a=i[s],l=e.x*a.y-a.x*e.y;n+=(e.x+a.x)*l,r+=(e.y+a.y)*l,t+=3*l}return new Wp(n/t,r/t,0,e)}(e),p=s.length;for(;s.length;){const n=s.pop();(n.d>d.d||!d.d)&&(d=n,r&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-d.d<=t||(a=n.h/2,s.push(new Wp(n.p.x-a,n.p.y-a,a,e)),s.push(new Wp(n.p.x+a,n.p.y-a,a,e)),s.push(new Wp(n.p.x-a,n.p.y+a,a,e)),s.push(new Wp(n.p.x+a,n.p.y+a,a,e)),p+=4)}return r&&(console.log("num probes: ".concat(p)),console.log("best distance: ".concat(d.d))),d.p}function Zp(e,t){return t.max-e.max}function Wp(e,t,r,i){this.p=new n(e,t),this.h=r,this.d=function(e,t){let n=!1,r=1/0;for(let i=0;i<t.length;i++){const o=t[i];for(let t=0,i=o.length,a=i-1;t<i;a=t++){const i=o[t],s=o[a];i.y>e.y!=s.y>e.y&&e.x<(s.x-i.x)*(e.y-i.y)/(s.y-i.y)+i.x&&(n=!n),r=Math.min(r,Xs(e,i,s))}}return(n?1:-1)*Math.sqrt(r)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}var Hp;e.aJ=void 0,(Hp=e.aJ||(e.aJ={}))[Hp.center=1]="center",Hp[Hp.left=2]="left",Hp[Hp.right=3]="right",Hp[Hp.top=4]="top",Hp[Hp.bottom=5]="bottom",Hp[Hp["top-left"]=6]="top-left",Hp[Hp["top-right"]=7]="top-right",Hp[Hp["bottom-left"]=8]="bottom-left",Hp[Hp["bottom-right"]=9]="bottom-right";const Xp=Number.POSITIVE_INFINITY;function Kp(e,t){return t[1]!==Xp?function(e,t,n){let r=0,i=0;switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}return[r,i]}(e,t[0],t[1]):function(e,t){let n=0,r=0;t<0&&(t=0);const i=t/Math.SQRT2;switch(e){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=t;break;case"right":n=-t}return[n,r]}(e,t[0])}function Yp(e,t,n){var r;const i=e.layout,o=null===(r=i.get("text-variable-anchor-offset"))||void 0===r?void 0:r.evaluate(t,{},n);if(o){const e=o.values,t=[];for(let n=0;n<e.length;n+=2){const r=t[n]=e[n],i=e[n+1].map(e=>e*cu);r.startsWith("top")?i[1]-=7:r.startsWith("bottom")&&(i[1]+=7),t[n+1]=i}return new Ot(t)}const a=i.get("text-variable-anchor");if(a){let r;r=void 0!==e._unevaluatedLayout.getValue("text-radial-offset")?[i.get("text-radial-offset").evaluate(t,{},n)*cu,Xp]:i.get("text-offset").evaluate(t,{},n).map(e=>e*cu);const o=[];for(const e of a)o.push(e,Kp(e,r));return new Ot(o)}return null}function Jp(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Qp(t,n,r,i,o,a,s,l,c,u,h,d){let p=a.textMaxSize.evaluate(n,{});void 0===p&&(p=s);const f=t.layers[0].layout,m=f.get("icon-offset").evaluate(n,{},h),g=ef(r.horizontal),_=s/24,y=t.tilePixelRatio*_,v=t.tilePixelRatio*p/24,b=t.tilePixelRatio*l,x=t.tilePixelRatio*f.get("symbol-spacing"),w=f.get("text-padding")*t.tilePixelRatio,S=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const i=e.get("icon-padding").evaluate(t,{},n),o=i&&i.values;return[o[0]*r,o[1]*r,o[2]*r,o[3]*r]}(f,n,h,t.tilePixelRatio),T=f.get("text-max-angle")/180*Math.PI,E="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),k="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),P=f.get("symbol-placement"),C=x/2,I=f.get("icon-text-fit");let M;i&&"none"!==I&&(t.allowVerticalPlacement&&r.vertical&&(M=$u(i,r.vertical,I,f.get("icon-text-fit-padding"),m,_)),g&&(i=$u(i,g,I,f.get("icon-text-fit-padding"),m,_)));const R=h?d.line.getGranularityForZoomLevel(h.z):1,D=(l,d)=>{d.x<0||d.x>=A||d.y<0||d.y>=A||function(t,n,r,i,o,a,s,l,c,u,h,d,p,f,m,g,_,y,v,b,x,w,S,T,E){const k=t.addToLineVertexArray(n,r);let P,C,I,A,M=0,R=0,D=0,z=0,L=-1,j=-1;const O={};let F=ds("");if(t.allowVerticalPlacement&&i.vertical){const e=l.layout.get("text-rotate").evaluate(x,{},T)+90;I=new Vp(c,n,u,h,d,i.vertical,p,f,m,e),s&&(A=new Vp(c,n,u,h,d,s,_,y,m,e))}if(o){const r=l.layout.get("icon-rotate").evaluate(x,{}),i="none"!==l.layout.get("icon-text-fit"),a=Op(o,r,S,i),p=s?Op(s,r,S,i):void 0;C=new Vp(c,n,u,h,d,o,_,y,!1,r),M=4*a.length;const f=t.iconSizeData;let m=null;"source"===f.kind?(m=[eh*l.layout.get("icon-size").evaluate(x,{})],m[0]>th&&Z("".concat(t.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".'))):"composite"===f.kind&&(m=[eh*w.compositeIconSizes[0].evaluate(x,{},T),eh*w.compositeIconSizes[1].evaluate(x,{},T)],(m[0]>th||m[1]>th)&&Z("".concat(t.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".'))),t.addSymbols(t.icon,a,m,b,v,x,e.at.none,n,k.lineStartIndex,k.lineLength,-1,T),L=t.icon.placedSymbolArray.length-1,p&&(R=4*p.length,t.addSymbols(t.icon,p,m,b,v,x,e.at.vertical,n,k.lineStartIndex,k.lineLength,-1,T),j=t.icon.placedSymbolArray.length-1)}const B=Object.keys(i.horizontal);for(const Z of B){const r=i.horizontal[Z];if(!P){F=ds(r.text);const e=l.layout.get("text-rotate").evaluate(x,{},T);P=new Vp(c,n,u,h,d,r,p,f,m,e)}const o=1===r.positionedLines.length;if(D+=$p(t,n,r,a,l,m,x,g,k,i.vertical?e.at.horizontal:e.at.horizontalOnly,o?B:[Z],O,L,w,T),o)break}i.vertical&&(z+=$p(t,n,i.vertical,a,l,m,x,g,k,e.at.vertical,["vertical"],O,j,w,T));const N=P?P.boxStartIndex:t.collisionBoxArray.length,U=P?P.boxEndIndex:t.collisionBoxArray.length,V=I?I.boxStartIndex:t.collisionBoxArray.length,G=I?I.boxEndIndex:t.collisionBoxArray.length,q=C?C.boxStartIndex:t.collisionBoxArray.length,W=C?C.boxEndIndex:t.collisionBoxArray.length,H=A?A.boxStartIndex:t.collisionBoxArray.length,X=A?A.boxEndIndex:t.collisionBoxArray.length;let K=-1;const Y=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t;K=Y(P,K),K=Y(I,K),K=Y(C,K),K=Y(A,K);const J=K>-1?1:0;J&&(K*=E/cu),t.glyphOffsetArray.length>=uh.MAX_GLYPHS&&Z("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey);const Q=Yp(l,x,T),[$,ee]=function(t,n){const r=t.length,i=null==n?void 0:n.values;if((null==i?void 0:i.length)>0)for(let o=0;o<i.length;o+=2){const n=i[o+1];t.emplaceBack(e.aJ[i[o]],n[0],n[1])}return[r,t.length]}(t.textAnchorOffsets,Q);t.symbolInstances.emplaceBack(n.x,n.y,O.right>=0?O.right:-1,O.center>=0?O.center:-1,O.left>=0?O.left:-1,O.vertical||-1,L,j,F,N,U,V,G,q,W,H,X,u,D,z,M,R,J,0,p,K,$,ee)}(t,d,l,r,i,o,M,t.layers[0],t.collisionBoxArray,n.index,n.sourceLayerIndex,t.index,y,[w,w,w,w],E,c,b,S,k,m,n,a,u,h,s)};if("line"===P)for(const e of Sp(n.geometry,0,0,A,A)){const n=dc(e,R),o=Lp(n,x,T,r.vertical||g,i,24,v,t.overscaling,A);for(const e of o)g&&tf(t,g.text,C,e)||D(n,e)}else if("line-center"===P){for(const e of n.geometry)if(e.length>1){const t=dc(e,R),n=zp(t,T,r.vertical||g,i,24,v);n&&D(t,n)}}else if("Polygon"===n.type)for(const e of tr(n.geometry,0)){const t=qp(e,16);D(dc(e[0],R,!0),new Ip(t.x,t.y,0))}else if("LineString"===n.type)for(const e of n.geometry){const t=dc(e,R);D(t,new Ip(t[0].x,t[0].y,0))}else if("Point"===n.type)for(const e of n.geometry)for(const t of e)D([t],new Ip(t.x,t.y,0))}function $p(e,t,r,i,o,a,s,l,c,u,h,d,p,f,m){const g=function(e,t,r,i,o,a,s,l){const c=i.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,u=[];for(const h of t.positionedLines)for(const e of h.positionedGlyphs){if(!e.rect)continue;const i=e.rect||{};let a=4,d=!0,p=1,f=0;const m=(o||l)&&e.vertical,g=e.metrics.advance*e.scale/2;if(l&&t.verticalizable&&(f=h.lineOffset/2-(e.imageName?-(cu-e.metrics.width*e.scale)/2:(e.scale-1)*cu)),e.imageName){const t=s[e.imageName];d=t.sdf,p=t.pixelRatio,a=1/p}const _=o?[e.x+g,e.y]:[0,0];let y=o?[0,0]:[e.x+g+r[0],e.y+r[1]-f],v=[0,0];m&&(v=y,y=[0,0]);const b=e.metrics.isDoubleResolution?2:1,x=(e.metrics.left-a)*e.scale-g+y[0],w=(-e.metrics.top-a)*e.scale+y[1],S=x+i.w/b*e.scale/p,T=w+i.h/b*e.scale/p,E=new n(x,w),k=new n(S,w),P=new n(x,T),C=new n(S,T);if(m){const t=new n(-g,g- -17),r=-Math.PI/2,i=12-g,o=new n(22-i,-(e.imageName?i:0)),a=new n(...v);E._rotateAround(r,t)._add(o)._add(a),k._rotateAround(r,t)._add(o)._add(a),P._rotateAround(r,t)._add(o)._add(a),C._rotateAround(r,t)._add(o)._add(a)}if(c){const e=Math.sin(c),t=Math.cos(c),n=[t,-e,e,t];E._matMult(n),k._matMult(n),P._matMult(n),C._matMult(n)}const I=new n(0,0),A=new n(0,0);u.push({tl:E,tr:k,bl:P,br:C,tex:i,writingMode:t.writingMode,glyphOffset:_,sectionIndex:e.sectionIndex,isSDF:d,pixelOffsetTL:I,pixelOffsetBR:A,minFontScaleX:0,minFontScaleY:0})}return u}(0,r,l,o,a,s,i,e.allowVerticalPlacement),_=e.textSizeData;let y=null;"source"===_.kind?(y=[eh*o.layout.get("text-size").evaluate(s,{})],y[0]>th&&Z("".concat(e.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".'))):"composite"===_.kind&&(y=[eh*f.compositeTextSizes[0].evaluate(s,{},m),eh*f.compositeTextSizes[1].evaluate(s,{},m)],(y[0]>th||y[1]>th)&&Z("".concat(e.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".'))),e.addSymbols(e.text,g,y,l,a,s,u,t,c.lineStartIndex,c.lineLength,p,m);for(const n of h)d[n]=e.text.placedSymbolArray.length-1;return 4*g.length}function ef(e){for(const t in e)return e[t];return null}function tf(e,t,n,r){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<n)return!0}else i[t]=[];return i[t].push(r),!1}const nf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class rf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const r=n>>4;if(1!==r)throw new Error("Got v".concat(r," data when expected v1."));const i=nf[15&n];if(!i)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new rf(a,o,i,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,r=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const i=nf.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-a%8)%8;if(i<0)throw new Error("Unexpected typed array class: ".concat(n,"."));r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+a+s),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return of(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:a}=this,s=[0,i.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=a){for(let a=h;a<=u;a++){const s=o[2*a],c=o[2*a+1];s>=e&&s<=n&&c>=t&&c<=r&&l.push(i[a])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=n&&f>=t&&f<=r&&l.push(i[d]),(0===c?e<=p:t<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?n>=p:r>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:i,nodeSize:o}=this,a=[0,r.length-1,0],s=[],l=n*n;for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)cf(i[2*n],i[2*n+1],e,t)<=l&&s.push(r[n]);continue}const d=h+u>>1,p=i[2*d],f=i[2*d+1];cf(p,f,e,t)<=l&&s.push(r[d]),(0===c?e-n<=p:t-n<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return s}}function of(e,t,n,r,i,o){if(i-r<=n)return;const a=r+i>>1;af(e,t,a,r,i,o),of(e,t,n,r,a-1,1-o),of(e,t,n,a+1,i,1-o)}function af(e,t,n,r,i,o){for(;i>r;){if(i-r>600){const a=i-r+1,s=n-r+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);af(e,t,n,Math.max(r,Math.floor(n-s*c/a+u)),Math.min(i,Math.floor(n+(a-s)*c/a+u)),o)}const a=t[2*n+o];let s=r,l=i;for(sf(e,t,r,n),t[2*i+o]>a&&sf(e,t,r,i);s<l;){for(sf(e,t,s,l),s++,l--;t[2*s+o]<a;)s++;for(;t[2*l+o]>a;)l--}t[2*r+o]===a?sf(e,t,r,l):(l++,sf(e,t,l,i)),l<=n&&(r=l+1),n<=l&&(i=l-1)}}function sf(e,t,n,r){lf(e,n,r),lf(t,2*n,2*r),lf(t,2*n+1,2*r+1)}function lf(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function cf(e,t,n,r){const i=e-n,o=t-r;return i*i+o*o}var uf;e.cB=void 0,(uf=e.cB||(e.cB={})).create="create",uf.load="load",uf.fullLoad="fullLoad";let hf=null,df=[];const pf=1e3/60,ff="loadTime",mf="fullLoadTime",gf={mark(e){performance.mark(e)},frame(e){const t=e;null!=hf&&df.push(t-hf),hf=t},clearMetrics(){hf=null,df=[],performance.clearMeasures(ff),performance.clearMeasures(mf);for(const t in e.cB)performance.clearMarks(e.cB[t])},getPerformanceMetrics(){performance.measure(ff,e.cB.create,e.cB.load),performance.measure(mf,e.cB.create,e.cB.fullLoad);const t=performance.getEntriesByName(ff)[0].duration,n=performance.getEntriesByName(mf)[0].duration,r=df.length,i=1/(df.reduce((e,t)=>e+t,0)/r/1e3),o=df.filter(e=>e>pf).reduce((e,t)=>e+(t-pf)/pf,0);return{loadTime:t,fullLoadTime:n,fps:i,percentDroppedFrames:o/(r+o)*100,totalFrames:r}}};e.$=J,e.A=f,e.B=to,e.C=function(e){let[t,n,r]=e;return n+=90,n*=Math.PI/180,r*=Math.PI/180,{x:t*Math.cos(n)*Math.sin(r),y:t*Math.sin(n)*Math.sin(r),z:t*Math.cos(r)}},e.D=No,e.E=ye,e.F=gn,e.G=Ao,e.H=ro,e.I=Iu,e.J=function(e){if(null==X){const t=e.navigator?e.navigator.userAgent:null;X=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return X},e.K=class{constructor(e,t){this.target=e,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new bh(()=>this.process()),this.subscription=ee(this.target,"message",e=>this.receive(e),!1),this.globalScope=H(self)?e:window}registerMessageHandler(e,t){this.messageHandlers[e]=t}unregisterMessageHandler(e){delete this.messageHandlers[e]}sendAsync(e,t){return new Promise((n,r)=>{const i=Math.round(1e18*Math.random()).toString(36).substring(0,10),o=t?ee(t.signal,"abort",()=>{null==o||o.unsubscribe(),delete this.resolveRejects[i];const t={id:i,type:"<cancel>",origin:location.origin,targetMapId:e.targetMapId,sourceMapId:this.mapId};this.target.postMessage(t)},xh):null;this.resolveRejects[i]={resolve:e=>{null==o||o.unsubscribe(),n(e)},reject:e=>{null==o||o.unsubscribe(),r(e)}};const a=[],s=Object.assign(Object.assign({},e),{id:i,sourceMapId:this.mapId,origin:location.origin,data:fo(e.data,a)});this.target.postMessage(s,{transfer:a})})}receive(e){const t=e.data,n=t.id;if(!("file://"!==t.origin&&"file://"!==location.origin&&"resource://android"!==t.origin&&"resource://android"!==location.origin&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if("<cancel>"===t.type){delete this.tasks[n];const e=this.abortControllers[n];return delete this.abortControllers[n],void(e&&e.abort())}if(H(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(0===this.taskQueue.length)return;const e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(e,t)}processTask(e,n){return t(this,void 0,void 0,function*(){if("<response>"===n.type){const t=this.resolveRejects[e];if(delete this.resolveRejects[e],!t)return;return void(n.error?t.reject(mo(n.error)):t.resolve(mo(n.data)))}if(!this.messageHandlers[n.type])return void this.completeTask(e,new Error("Could not find a registered handler for ".concat(n.type,", map ID: ").concat(this.mapId,", available handlers: ").concat(Object.keys(this.messageHandlers).join(", "))));const t=mo(n.data),r=new AbortController;this.abortControllers[e]=r;try{const i=yield this.messageHandlers[n.type](n.sourceMapId,t,r);this.completeTask(e,null,i)}catch(t){this.completeTask(e,t)}})}completeTask(e,t,n){const r=[];delete this.abortControllers[e];const i={id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?fo(t):null,data:fo(n,r)};this.target.postMessage(i,{transfer:r})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},e.L=ce,e.M=function(){var e=new f(16);return f!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.N=function(e,t,n){var r,i,o,a,s,l,c,u,h,d,p,f,m=n[0],g=n[1],_=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+s*g+h*_+t[12],e[13]=i*m+l*g+d*_+t[13],e[14]=o*m+c*g+p*_+t[14],e[15]=a*m+u*g+f*_+t[15]),e},e.O=function(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.P=n,e.Q=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],y=t[15],v=n[0],b=n[1],x=n[2],w=n[3];return e[0]=v*r+b*s+x*h+w*m,e[1]=v*i+b*l+x*d+w*g,e[2]=v*o+b*c+x*p+w*_,e[3]=v*a+b*u+x*f+w*y,e[4]=(v=n[4])*r+(b=n[5])*s+(x=n[6])*h+(w=n[7])*m,e[5]=v*i+b*l+x*d+w*g,e[6]=v*o+b*c+x*p+w*_,e[7]=v*a+b*u+x*f+w*y,e[8]=(v=n[8])*r+(b=n[9])*s+(x=n[10])*h+(w=n[11])*m,e[9]=v*i+b*l+x*d+w*g,e[10]=v*o+b*c+x*p+w*_,e[11]=v*a+b*u+x*f+w*y,e[12]=(v=n[12])*r+(b=n[13])*s+(x=n[14])*h+(w=n[15])*m,e[13]=v*i+b*l+x*d+w*g,e[14]=v*o+b*c+x*p+w*_,e[15]=v*a+b*u+x*f+w*y,e},e.R=yl,e.S=function(e,t){const n={};for(let r=0;r<t.length;r++){const i=t[r];i in e&&(n[i]=e[i])}return n},e.T=Pl,e.U=Sh,e.V=F,e.W=Ph,e.X=kh,e.Y=h,e.Z=d,e._=t,e.a=se,e.a$=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.a0=jh,e.a1=Ih,e.a2=Ah,e.a3=A,e.a4=function(e,t){var n,r,i,o,a;if(!e)return null!=t?t:{};if(!t)return e;let s=Object.assign({},e);if(t.removeAll&&(s={removeAll:!0}),t.remove){const r=new Set(t.remove);s.add&&(s.add=s.add.filter(e=>!r.has(e.id))),s.update&&(s.update=s.update.filter(e=>!r.has(e.id)));const i=new Set((null!==(n=e.add)&&void 0!==n?n:[]).map(e=>e.id));t.remove=t.remove.filter(e=>!i.has(e))}if(t.remove){const e=new Set(s.remove?s.remove.concat(t.remove):t.remove);s.remove=Array.from(e.values())}if(t.add){const e=s.add?s.add.concat(t.add):t.add,n=new Map(e.map(e=>[e.id,e]));s.add=Array.from(n.values())}if(t.update){const e=new Map(null===(r=s.update)||void 0===r?void 0:r.map(e=>[e.id,e]));for(const n of t.update){const t=null!==(i=e.get(n.id))&&void 0!==i?i:{id:n.id};n.newGeometry&&(t.newGeometry=n.newGeometry),n.addOrUpdateProperties&&(t.addOrUpdateProperties=(null!==(o=t.addOrUpdateProperties)&&void 0!==o?o:[]).concat(n.addOrUpdateProperties)),n.removeProperties&&(t.removeProperties=(null!==(a=t.removeProperties)&&void 0!==a?a:[]).concat(n.removeProperties)),n.removeAllProperties&&(t.removeAllProperties=!0),e.set(n.id,t)}s.update=Array.from(e.values())}return s.remove&&s.add&&(s.remove=s.remove.filter(e=>-1===s.add.findIndex(t=>t.id===e))),s},e.a5=Rh,e.a6=Bh,e.a7=25,e.a8=zh,e.a9=e=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const r of e){const e=window.document.createElement("source");pe(r)||(t.crossOrigin="Anonymous"),e.src=r,t.appendChild(e)}})},e.aA=ah,e.aB=E,e.aC=function(e,t,r,i){const o=t.y-e.y,a=t.x-e.x,s=i.y-r.y,l=i.x-r.x,c=s*a-l*o;if(0===c)return null;const u=(l*(e.y-r.y)-s*(e.x-r.x))/c;return new n(e.x+u*a,e.y+u*o)},e.aD=Sp,e.aE=Us,e.aF=function(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),r=Math.max(r,o.x),i=Math.max(i,o.y);return[t,n,r,i]},e.aG=cu,e.aH=M,e.aI=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!n[0]&&!n[1])return[0,0];const o=i?"map"===r?-e.bearingInRadians:0:"viewport"===r?e.bearingInRadians:0;if(o){const e=Math.sin(o),t=Math.cos(o);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}return[i?n[0]:M(t,n[0],e.zoom),i?n[1]:M(t,n[1],e.zoom)]},e.aK=rh,e.aL=Jp,e.aM=qu,e.aN=rf,e.aO=ea,e.aP=sc,e.aQ=Fa,e.aR=ts,e.aS=Ja,e.aT=ne,e.aU=Mh,e.aV=x,e.aW=b,e.aX=function(e){var t=new f(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.aY=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},e.aZ=function(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},e.a_=w,e.aa=Me,e.ab=function(){return N++},e.ac=Pa,e.ad=uh,e.ae=pi,e.af=Os,e.ag=Uh,e.ah=function(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,n,r,i)=>{const o=r||i;return t[n]=!o||o.toLowerCase(),""}),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t},e.ai=O,e.aj=85.051129,e.ak=te,e.al=function(e){return Math.pow(2,e)},e.am=g,e.an=Ch,e.ao=function(e){return Math.log(e)/Math.LN2},e.ap=function(e){var t=e[0],n=e[1];return t*t+n*n},e.aq=class{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const i={value:t,timeout:void 0};if(void 0!==n&&(i.timeout=setTimeout(()=>{this.remove(e,i)},n)),this.data[r].push(i),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,r=void 0===t?0:this.data[n].indexOf(t),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const r of this.data[n])e(r.value)||t.push(r);for(const n of t)this.remove(n.value.tileID,n)}},e.ar=function(e){if(!e.length)return new Set;const t=Math.max(...e.map(e=>e.canonical.z));let n=1/0,r=-1/0,i=1/0,o=-1/0;const a=[];for(const l of e){const{x:e,y:s,z:c}=l.canonical,u=Math.pow(2,t-c),h=e*u,d=s*u;a.push({id:l,x:h,y:d}),h<n&&(n=h),h>r&&(r=h),d<i&&(i=d),d>o&&(o=d)}const s=new Set;for(const l of a)l.x!==n&&l.x!==r&&l.y!==i&&l.y!==o||s.add(l.id);return s},e.as=function(e,t){let n=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){const{interpolationType:i,minZoom:o,maxZoom:a}=e,s=i?O(fn.interpolationFactor(i,t,o,a),0,1):0;"camera"===e.kind?r=gn.number(e.minSize,e.maxSize,s):n=s}return{uSizeT:n,uSize:r}},e.au=function(e,t,n){let{uSize:r,uSizeT:i}=t,{lowerSize:o,upperSize:a}=n;return"source"===e.kind?o/eh:"composite"===e.kind?gn.number(o/eh,a/eh,i):r},e.av=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=n*s-r*a,v=n*l-i*a,b=n*c-o*a,x=r*l-i*s,w=r*c-o*s,S=i*c-o*l,T=u*m-h*f,E=u*g-d*f,k=u*_-p*f,P=h*g-d*m,C=h*_-p*m,I=d*_-p*g,A=y*I-v*C+b*P+x*k-w*E+S*T;return A?(e[0]=(s*I-l*C+c*P)*(A=1/A),e[1]=(i*C-r*I-o*P)*A,e[2]=(m*S-g*w+_*x)*A,e[3]=(d*w-h*S-p*x)*A,e[4]=(l*k-a*I-c*E)*A,e[5]=(n*I-i*k+o*E)*A,e[6]=(g*b-f*S-_*v)*A,e[7]=(u*S-d*b+p*v)*A,e[8]=(a*C-s*k+c*T)*A,e[9]=(r*k-n*C-o*T)*A,e[10]=(f*w-m*b+_*y)*A,e[11]=(h*b-u*w-p*y)*A,e[12]=(s*E-a*P-l*T)*A,e[13]=(n*P-r*E+i*T)*A,e[14]=(m*v-f*x-g*y)*A,e[15]=(u*x-h*v+d*y)*A,e):null},e.aw=C,e.ax=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},e.ay=function(e){return e[0]=0,e[1]=0,e},e.az=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},e.b=K,e.b$=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.b0=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},e.b1=y,e.b2=function(e,t,n){const r=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return 0===r?null:(-(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])-n[3])/r},e.b3=T,e.b4=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},e.b5=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},e.b6=Lh,e.b7=Oh,e.b8=function(e,t,n,r,i){var o=1/Math.tan(t/2);if(e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0){var a=1/(r-i);e[10]=(i+r)*a,e[14]=2*i*r*a}else e[10]=-1,e[14]=-2*r;return e},e.b9=function(e){var t=new f(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.bA=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},e.bB=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},e.bC=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},e.bD=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=a*i-u*r,e[2]=s*i-h*r,e[3]=l*i-d*r,e[8]=o*r+c*i,e[9]=a*r+u*i,e[10]=s*r+h*i,e[11]=l*r+d*i,e},e.bE=function(e,t){const n=R(e,360),r=R(t,360),i=r-n,o=r>n?i-360:i+360;return Math.abs(i)<Math.abs(o)?i:o},e.bF=function(e){return e[0]=0,e[1]=0,e[2]=0,e},e.bG=function(e,t,n,r){const i=Math.sqrt(e*e+t*t),o=Math.sqrt(n*n+r*r);e/=i,t/=i,n/=o,r/=o;const a=Math.acos(e*n+t*r);return-t*n+e*r>0?a:-a},e.bH=function(e,t){const n=R(e,2*Math.PI),r=R(t,2*Math.PI);return Math.min(Math.abs(n-r),Math.abs(n-r+2*Math.PI),Math.abs(n-r-2*Math.PI))},e.bI=function(){const e={},t=ve.$version;for(const n in ve.$root){const r=ve.$root[n];if(r.required){let i=null;i="version"===n?t:"array"===r.type?[]:{},null!=i&&(e[n]=i)}}return e},e.bJ=he,e.bK=go,e.bL=function e(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(t).length!==Object.keys(n).length)return!1;for(const r in t)if(!e(t[r],n[r]))return!1;return!0}return t===n},e.bM=function(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=xe(e[n],t[e[n].ref]));return e},e.bN=function(e,t){if("custom"===e.type)return new vh(e,t);switch(e.type){case"background":return new yh(e,t);case"circle":return new ul(e,t);case"color-relief":return new Al(e,t);case"fill":return new bc(e,t);case"fill-extrusion":return new Bc(e,t);case"heatmap":return new xl(e,t);case"hillshade":return new Tl(e,t);case"line":return new eu(e,t);case"raster":return new Yo(e,t);case"symbol":return new mh(e,t)}},e.bO=e=>"raster"===e.type,e.bP=G,e.bQ=function(e,t){if(!e)return[{command:"setStyle",args:[t]}];let n=[];try{if(!we(e.version,t.version))return[{command:"setStyle",args:[t]}];we(e.center,t.center)||n.push({command:"setCenter",args:[t.center]}),we(e.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),we(e.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),we(e.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),we(e.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),we(e.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),we(e.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),we(e.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),we(e.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),we(e.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),we(e.light,t.light)||n.push({command:"setLight",args:[t.light]}),we(e.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),we(e.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),we(e.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const r={},i=[];!function(e,t,n,r){let i;for(i in t=t||{},e=e||{})Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)||Ee(i,n,r));for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?we(e[i],t[i])||("geojson"===e[i].type&&"geojson"===t[i].type&&Pe(e,t,i)?Se(n,{command:"setGeoJSONSourceData",args:[i,t[i].data]}):ke(i,t,n,r)):Te(i,t,n))}(e.sources,t.sources,i,r);const o=[];e.layers&&e.layers.forEach(e=>{"source"in e&&r[e.source]?n.push({command:"removeLayer",args:[e.id]}):o.push(e)}),n=n.concat(i),function(e,t,n){t=t||[];const r=(e=e||[]).map(Ie),i=t.map(Ie),o=e.reduce(Ae,{}),a=t.reduce(Ae,{}),s=r.slice(),l=Object.create(null);let c,u,h,d,p;for(let f=0,m=0;f<r.length;f++)c=r[f],Object.prototype.hasOwnProperty.call(a,c)?m++:(Se(n,{command:"removeLayer",args:[c]}),s.splice(s.indexOf(c,m),1));for(let f=0,m=0;f<i.length;f++)c=i[i.length-1-f],s[s.length-1-f]!==c&&(Object.prototype.hasOwnProperty.call(o,c)?(Se(n,{command:"removeLayer",args:[c]}),s.splice(s.lastIndexOf(c,s.length-m),1)):m++,d=s[s.length-f],Se(n,{command:"addLayer",args:[a[c],d]}),s.splice(s.length-f,0,c),l[c]=!0);for(let f=0;f<i.length;f++)if(c=i[f],u=o[c],h=a[c],!l[c]&&!we(u,h))if(we(u.source,h.source)&&we(u["source-layer"],h["source-layer"])&&we(u.type,h.type)){for(p in Ce(u.layout,h.layout,n,c,null,"setLayoutProperty"),Ce(u.paint,h.paint,n,c,null,"setPaintProperty"),we(u.filter,h.filter)||Se(n,{command:"setFilter",args:[c,h.filter]}),we(u.minzoom,h.minzoom)&&we(u.maxzoom,h.maxzoom)||Se(n,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Ce(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):we(u[p],h[p])||Se(n,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Ce(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):we(u[p],h[p])||Se(n,{command:"setLayerProperty",args:[c,p,h[p]]}))}else Se(n,{command:"removeLayer",args:[c]}),d=s[s.lastIndexOf(c)+1],Se(n,{command:"addLayer",args:[h,d]})}(o,t.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:"setStyle",args:[t]}]}return n},e.bR=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(n,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),t},e.bS=U,e.bT=V,e.bU=class extends _s{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.bV=bs,e.bW=class extends _s{constructor(e,t){super(e,t),this.current=xs}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.bX=vs,e.bY=class extends _s{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.bZ=class extends _s{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.b_=m,e.ba=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*r,e[1]=a*i+u*r,e[2]=s*i+h*r,e[3]=l*i+d*r,e[4]=c*i-o*r,e[5]=u*i-a*r,e[6]=h*i-s*r,e[7]=d*i-l*r,e},e.bb=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=a*i+u*r,e[6]=s*i+h*r,e[7]=l*i+d*r,e[8]=c*i-o*r,e[9]=u*i-a*r,e[10]=h*i-s*r,e[11]=d*i-l*r,e},e.bc=function(){const e=new Float32Array(16);return g(e),e},e.bd=function(){const e=new Float64Array(16);return g(e),e},e.be=function(){return new Float64Array(16)},e.bf=function(e,t,n){const r=new Float64Array(4);return P(r,e,t-90,n),r},e.bg=function(e,t,n,r){var i,o,a,s,l,c=t[0],u=t[1],h=t[2],d=t[3],f=n[0],m=n[1],g=n[2],_=n[3];return(o=c*f+u*m+h*g+d*_)<0&&(o=-o,f=-f,m=-m,g=-g,_=-_),1-o>p?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,l=Math.sin(r*i)/a):(s=1-r,l=r),e[0]=s*c+l*f,e[1]=s*u+l*m,e[2]=s*h+l*g,e[3]=s*d+l*_,e},e.bh=function(e){const t=new Float64Array(9);var n,r,i,o,a,s,l,c,u,h,d,p,f,m,g,_,y,v;h=(i=(r=e)[0])*(l=i+i),d=(o=r[1])*l,f=(a=r[2])*l,m=a*(c=o+o),_=(s=r[3])*l,y=s*c,v=s*(u=a+a),(n=t)[0]=1-(p=o*c)-(g=a*u),n[3]=d-v,n[6]=f+y,n[1]=d+v,n[4]=1-h-g,n[7]=m-_,n[2]=f-y,n[5]=m+_,n[8]=1-h-p;const b=ne(-Math.asin(O(t[2],-1,1)));let x,w;return Math.hypot(t[5],t[8])<.001?(x=0,w=-ne(Math.atan2(t[3],t[4]))):(x=ne(0===t[5]&&0===t[8]?0:Math.atan2(t[5],t[8])),w=ne(0===t[1]&&0===t[0]?0:Math.atan2(t[1],t[0]))),{roll:x,pitch:b+90,bearing:w}},e.bi=function(e,t){return e.roll==t.roll&&e.pitch==t.pitch&&e.bearing==t.bearing},e.bj=Pt,e.bk=ys,e.bl=lc,e.bm=cc,e.bn=ac,e.bo=D,e.bp=z,e.bq=Bt,e.br=function(e,t,n,r,i){return D(r,i,O((e-t)/(n-t),0,1))},e.bs=R,e.bt=function(){return new Float64Array(3)},e.bu=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},e.bv=P,e.bw=function(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],l=t[1],c=t[2],u=i*c-o*l,h=o*s-r*c,d=r*l-i*s;return e[0]=s+a*(u+=u)+i*(d+=d)-o*(h+=h),e[1]=l+a*h+o*u-r*d,e[2]=c+a*d+r*h-i*u,e},e.bx=function(e,t,n){const r=(i=[e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((u=i[8])*(a=i[4])-(s=i[5])*(c=i[7]))+i[1]*(-u*(o=i[3])+s*(l=i[6]))+i[2]*(c*o-a*l);var i,o,a,s,l,c,u;if(0===r)return null;const h=w([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),d=w([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),p=w([],[e[0],e[1],e[2]],[t[0],t[1],t[2]]),f=x([],h,-e[3]);return b(f,f,x([],d,-t[3])),b(f,f,x([],p,-n[3])),x(f,f,1/r),f},e.by=wh,e.bz=function(){return new Float64Array(4)},e.c=ae,e.c$=function(e,t){const n=new Map;if(null==e);else if("Feature"===e.type)n.set(Fh(e,t),e);else for(const r of e.features)n.set(Fh(r,t),r);return n},e.c0=function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},e.c1=function(e,t,n,r,i,o,a){var s=1/(t-n),l=1/(r-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*l,e[14]=(a+o)*c,e[15]=1,e},e.c2=class extends _s{constructor(e,t){super(e,t),this.current=new Array}set(e){if(e!=this.current){this.current=e;const t=new Float32Array(4*e.length);for(let n=0;n<e.length;n++)t[4*n]=e[n].r,t[4*n+1]=e[n].g,t[4*n+2]=e[n].b,t[4*n+3]=e[n].a;this.gl.uniform4fv(this.location,t)}}},e.c3=class extends _s{constructor(e,t){super(e,t),this.current=new Array}set(e){if(e!=this.current){this.current=e;const t=new Float32Array(e);this.gl.uniform1fv(this.location,t)}}},e.c4=class extends ma{},e.c5=au,e.c6=class extends _a{},e.c7=bl,e.c8=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.c9=vl,e.cA=gf,e.cC=function(e){return e.message===oe},e.cD=ue,e.cE=function(e,t){se.REGISTERED_PROTOCOLS[e]=t},e.cF=function(e){delete se.REGISTERED_PROTOCOLS[e]},e.cG=function(e,t){const n={};for(let i=0;i<e.length;i++){const r=t&&t[e[i].id]||wi(e[i]);t&&(t[e[i].id]=r);let o=n[r];o||(o=n[r]=[]),o.push(e[i])}const r=[];for(const i in n)r.push(n[i]);return r},e.cH=co,e.cI=Nh,e.cJ=bp,e.cK=Au,e.cL=function(t){t.bucket.createArrays(),t.bucket.tilePixelRatio=A/(512*t.bucket.overscaling),t.bucket.compareText={},t.bucket.iconsNeedLinear=!1;const n=t.bucket.layers[0],r=n.layout,i=n._unevaluatedLayout._values,o={layoutIconSize:i["icon-size"].possiblyEvaluate(new Ao(t.bucket.zoom+1),t.canonical),layoutTextSize:i["text-size"].possiblyEvaluate(new Ao(t.bucket.zoom+1),t.canonical),textMaxSize:i["text-size"].possiblyEvaluate(new Ao(18))};if("composite"===t.bucket.textSizeData.kind){const{minZoom:e,maxZoom:n}=t.bucket.textSizeData;o.compositeTextSizes=[i["text-size"].possiblyEvaluate(new Ao(e),t.canonical),i["text-size"].possiblyEvaluate(new Ao(n),t.canonical)]}if("composite"===t.bucket.iconSizeData.kind){const{minZoom:e,maxZoom:n}=t.bucket.iconSizeData;o.compositeIconSizes=[i["icon-size"].possiblyEvaluate(new Ao(e),t.canonical),i["icon-size"].possiblyEvaluate(new Ao(n),t.canonical)]}const a=r.get("text-line-height")*cu,s="viewport"!==r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),l=r.get("text-keep-upright"),c=r.get("text-size");for(const u of t.bucket.features){const i=r.get("text-font").evaluate(u,{},t.canonical).join(","),h=c.evaluate(u,{},t.canonical),d=o.layoutTextSize.evaluate(u,{},t.canonical),p=o.layoutIconSize.evaluate(u,{},t.canonical),f={horizontal:{},vertical:void 0},m=u.text;let g,_=[0,0];if(m){const o=m.toString(),c=r.get("text-letter-spacing").evaluate(u,{},t.canonical)*cu,p=bo(o)?c:0,g=r.get("text-anchor").evaluate(u,{},t.canonical),y=Yp(n,u,t.canonical);if(!y){const e=r.get("text-radial-offset").evaluate(u,{},t.canonical);_=e?Kp(g,[e*cu,Xp]):r.get("text-offset").evaluate(u,{},t.canonical).map(e=>e*cu)}let v=s?"center":r.get("text-justify").evaluate(u,{},t.canonical);const b="point"===r.get("symbol-placement")?r.get("text-max-width").evaluate(u,{},t.canonical)*cu:1/0,x=()=>{t.bucket.allowVerticalPlacement&&vo(o)&&(f.vertical=zu(m,t.glyphMap,t.glyphPositions,t.imagePositions,i,b,a,g,"left",p,_,e.at.vertical,!0,d,h))};if(!s&&y){const n=new Set;if("auto"===v)for(let e=0;e<y.values.length;e+=2)n.add(Jp(y.values[e]));else n.add(v);let r=!1;for(const o of n)if(!f.horizontal[o])if(r)f.horizontal[o]=f.horizontal[0];else{const n=zu(m,t.glyphMap,t.glyphPositions,t.imagePositions,i,b,a,"center",o,p,_,e.at.horizontal,!1,d,h);n&&(f.horizontal[o]=n,r=1===n.positionedLines.length)}x()}else{"auto"===v&&(v=Jp(g));const n=zu(m,t.glyphMap,t.glyphPositions,t.imagePositions,i,b,a,g,v,p,_,e.at.horizontal,!1,d,h);n&&(f.horizontal[v]=n),x(),vo(o)&&s&&l&&(f.vertical=zu(m,t.glyphMap,t.glyphPositions,t.imagePositions,i,b,a,g,v,p,_,e.at.vertical,!1,d,h))}}let y=!1;if(u.icon&&u.icon.name){const e=t.imageMap[u.icon.name];e&&(g=Ju(t.imagePositions[u.icon.name],r.get("icon-offset").evaluate(u,{},t.canonical),r.get("icon-anchor").evaluate(u,{},t.canonical)),y=!!e.sdf,void 0===t.bucket.sdfIcons?t.bucket.sdfIcons=y:t.bucket.sdfIcons!==y&&Z("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.bucket.pixelRatio||0!==r.get("icon-rotate").constantOr(1))&&(t.bucket.iconsNeedLinear=!0))}const v=ef(f.horizontal)||f.vertical;t.bucket.iconsInText=!!v&&v.iconsInText,(v||g)&&Qp(t.bucket,u,f,g,t.imageMap,o,d,p,_,y,t.canonical,t.subdivisionGranularity)}t.showCollisionBoxes&&t.bucket.generateCollisionDebugBuffers()},e.cM=gc,e.cN=Dc,e.cO=Xc,e.cP=Pc,e.cQ=pu,e.cR=Tc,e.cS=function(e,t,n,r,i,o){let a=Tp(e,t,n,i,0);return a=Tp(a,t,r,o,1),a},e.cT=class{constructor(e){this.maxEntries=e,this.map=new Map}get(e){const t=this.map.get(e);return void 0!==t&&(this.map.delete(e),this.map.set(e,t)),t}set(e,t){if(this.map.has(e))this.map.delete(e);else if(this.map.size>=this.maxEntries){const e=this.map.keys().next().value;this.map.delete(e)}this.map.set(e,t)}clear(){this.map.clear()}},e.cU=Ic,e.cV=vp,e.cW=class{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}},e.cX=function(e,n,r,i,o){return t(this,void 0,void 0,function*(){if(d())try{return yield J(e,n,r,i,o)}catch(e){}return function(e,t,n,r,i){const o=e.width,a=e.height;Q&&$||(Q=new OffscreenCanvas(o,a),$=Q.getContext("2d",{willReadFrequently:!0})),Q.width=o,Q.height=a,$.drawImage(e,0,0,o,a);const s=$.getImageData(t,n,r,i);return $.clearRect(0,0,o,a),s.data}(e,n,r,i,o)})},e.cY=Cl,e.cZ=i,e.c_=ri,e.ca=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/(a=a||1),e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e},e.cb=class extends ia{},e.cc=class extends Ta{},e.cd=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},e.ce=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],m=e[12],g=e[13],_=e[14],y=e[15],v=t[0],b=t[1],x=t[2],w=t[3],S=t[4],T=t[5],E=t[6],k=t[7],P=t[8],C=t[9],I=t[10],A=t[11],M=t[12],R=t[13],D=t[14],z=t[15];return Math.abs(n-v)<=p*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-b)<=p*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-x)<=p*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-w)<=p*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(a-S)<=p*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-T)<=p*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(l-E)<=p*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-k)<=p*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(u-P)<=p*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(h-C)<=p*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-I)<=p*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(f-A)<=p*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(m-M)<=p*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(g-R)<=p*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(_-D)<=p*Math.max(1,Math.abs(_),Math.abs(D))&&Math.abs(y-z)<=p*Math.max(1,Math.abs(y),Math.abs(z))},e.cf=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.cg=e=>"symbol"===e.type,e.ch=e=>"circle"===e.type,e.ci=e=>"heatmap"===e.type,e.cj=e=>"line"===e.type,e.ck=e=>"fill"===e.type,e.cl=e=>"fill-extrusion"===e.type,e.cm=e=>"hillshade"===e.type,e.cn=e=>"color-relief"===e.type,e.co=e=>"background"===e.type,e.cp=e=>"custom"===e.type,e.cq=L,e.cr=function(e,t,n){const r=I(t.x-n.x,t.y-n.y),i=I(e.x-n.x,e.y-n.y);var o,a;return ne(Math.atan2(r[0]*i[1]-r[1]*i[0],(o=r)[0]*(a=i)[0]+o[1]*a[1]))},e.cs=j,e.ct=function(e,t){return ie[t]&&(e instanceof MouseEvent||e instanceof WheelEvent)},e.cu=function(e,t){return re[t]&&"touches"in e},e.cv=function(e){return re[e]||ie[e]},e.cw=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},e.cx=function(e,t){const{x:n,y:r}=Rh.fromLngLat(t);return!(e<0||e>25||r<0||r>=1||n<0||n>=1)},e.cy=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.cz=class extends ra{},e.d=pe,e.d0=function(e,t){if(null==e)return!0;if("Feature"===e.type)return null!=Fh(e,t);if("FeatureCollection"===e.type){const n=new Set;for(const r of e.features){const e=Fh(r,t);if(null==e)return!1;if(n.has(e))return!1;n.add(e)}return!0}return!1},e.d1=function(e,t,n){var r,i,o,a;if(t.removeAll&&e.clear(),t.remove)for(const s of t.remove)e.delete(s);if(t.add)for(const s of t.add){const t=Fh(s,n);null!=t&&e.set(t,s)}if(t.update)for(const s of t.update){let t=e.get(s.id);if(null==t)continue;const n=!s.removeAllProperties&&((null===(r=s.removeProperties)||void 0===r?void 0:r.length)>0||(null===(i=s.addOrUpdateProperties)||void 0===i?void 0:i.length)>0);if((s.newGeometry||s.removeAllProperties||n)&&(t=Object.assign({},t),e.set(s.id,t),n&&(t.properties=Object.assign({},t.properties))),s.newGeometry&&(t.geometry=s.newGeometry),s.removeAllProperties)t.properties={};else if((null===(o=s.removeProperties)||void 0===o?void 0:o.length)>0)for(const e of s.removeProperties)Object.prototype.hasOwnProperty.call(t.properties,e)&&delete t.properties[e];if((null===(a=s.addOrUpdateProperties)||void 0===a?void 0:a.length)>0)for(const{key:e,value:r}of s.addOrUpdateProperties)t.properties[e]=r}},e.d2=Io,e.e=B,e.f=e=>t(void 0,void 0,void 0,function*(){if(0===e.byteLength)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(e)],{type:"image/png"});try{return createImageBitmap(t)}catch(e){throw new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}}),e.g=le,e.h=e=>new Promise((t,n)=>{const r=new Image;r.onload=()=>{t(r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Y})},r.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(i):Y}),e.i=H,e.j=(e,t)=>de(B(e,{type:"json"}),t),e.k=_e,e.l=ge,e.m=de,e.n=(e,t)=>de(B(e,{type:"arrayBuffer"}),t),e.o=function(e){return new pu(e).readFields(Eu,[])},e.p=Cu,e.q=function(e){return/[\u1100-\u11FF\u3000-\u30FF\u3131-\u318E\u31F0-\u321E\u3260-\u327E\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFF\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFF00-\uFFEF]|\uD81B[\uDFE4\uDFF2-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(e))},e.r=_l,e.s=ee,e.t=Zo,e.u=ve,e.v=eo,e.w=Z,e.x=zo,e.y=no,e.z=ao}),n("worker",["./shared"],function(e){class t{constructor(e,t){this.keyCache={},e&&this.replace(e,t)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,n,r){for(const o of t){this._layerConfigs[o.id]=o;const t=this._layers[o.id]=e.bN(o,r);t._featureFilter=e.ae(t.filter,r),this.keyCache[o.id]&&delete this.keyCache[o.id]}for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const i=e.cG(Object.values(this._layerConfigs),this.keyCache);for(const e of i){const t=e.map(e=>this._layers[e.id]),n=t[0];if("none"===n.visibility)continue;const r=n.source||"";let i=this.familiesBySource[r];i||(i=this.familiesBySource[r]={});const o=n.sourceLayer||"_geojsonTileLayer";let a=i[o];a||(a=i[o]=[]),a.push(t)}}}class n{constructor(t){const n={},r=[];for(const e in t){const i=t[e],o=n[e]={};for(const e in i){const t=i[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};r.push(n),o[e]={rect:n,metrics:t.metrics}}}const{w:i,h:o}=e.p(r),a=new e.r({width:i||1,height:o||1});for(const s in t){const r=t[s];for(const t in r){const i=r[+t];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const o=n[s][t].rect;e.r.copy(i.bitmap,a,{x:0,y:0},{x:o.x+1,y:o.y+1},i.bitmap)}}this.image=a,this.positions=n}}e.cH("GlyphAtlas",n);class r{constructor(t){this.tileID=new e.a0(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.inFlightDependencies=[]}parse(t,r,o,a,s){return e._(this,void 0,void 0,function*(){this.status="parsing",this.data=t,this.collisionBoxArray=new e.ac;const l=new e.cI(Object.keys(t.layers).sort()),c=new e.cJ(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:o,subdivisionGranularity:s},d=r.familiesBySource[this.source];for(const n in d){const r=t.layers[n];if(!r)continue;1===r.version&&e.w('Vector tile source "'.concat(this.source,'" layer "').concat(n,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const a=l.encode(n),s=[];for(let e=0;e<r.length;e++){const t=r.feature(e),i=c.getId(t,n);s.push({feature:t,id:i,index:e,sourceLayerIndex:a})}for(const t of d[n]){const n=t[0];n.source!==this.source&&e.w("layer.source = ".concat(n.source," does not equal this.source = ").concat(this.source)),n.isHidden(this.zoom,!0)||(i(t,this.zoom,o),(u[n.id]=n.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:a,sourceID:this.source})).populate(s,h,this.tileID.canonical),c.bucketLayerIDs.push(t.map(e=>e.id)))}}const p=e.bS(h.glyphDependencies,e=>Object.keys(e).map(Number));this.inFlightDependencies.forEach(e=>null==e?void 0:e.abort()),this.inFlightDependencies=[];let f=Promise.resolve({});if(Object.keys(p).length){const e=new AbortController;this.inFlightDependencies.push(e),f=a.sendAsync({type:"GG",data:{stacks:p,source:this.source,tileID:this.tileID,type:"glyphs"}},e)}const m=Object.keys(h.iconDependencies);let g=Promise.resolve({});if(m.length){const e=new AbortController;this.inFlightDependencies.push(e),g=a.sendAsync({type:"GI",data:{icons:m,source:this.source,tileID:this.tileID,type:"icons"}},e)}const _=Object.keys(h.patternDependencies);let y=Promise.resolve({});if(_.length){const e=new AbortController;this.inFlightDependencies.push(e),y=a.sendAsync({type:"GI",data:{icons:_,source:this.source,tileID:this.tileID,type:"patterns"}},e)}const v=h.dashDependencies;let b=Promise.resolve({});if(Object.keys(v).length){const e=new AbortController;this.inFlightDependencies.push(e),b=a.sendAsync({type:"GDA",data:{dashes:v}},e)}const[x,w,S,T]=yield Promise.all([f,g,y,b]),E=new n(x),k=new e.cK(w,S);for(const t in u){const n=u[t];n instanceof e.ad?(i(n.layers,this.zoom,o),e.cL({bucket:n,glyphMap:x,glyphPositions:E.positions,imageMap:w,imagePositions:k.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:h.subdivisionGranularity})):n.hasDependencies&&(n instanceof e.cM||n instanceof e.cN||n instanceof e.cO)&&(i(n.layers,this.zoom,o),n.addFeatures(h,this.tileID.canonical,k.patternPositions,T))}return this.status="done",{buckets:Object.values(u).filter(e=>!e.isEmpty()),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:E.image,imageAtlas:k,dashPositions:T,glyphMap:this.returnDependencies?x:null,iconMap:this.returnDependencies?w:null,glyphPositions:this.returnDependencies?E.positions:null}})}}function i(t,n,r){const i=new e.G(n);for(const e of t)e.recalculate(i,r)}class o extends e.cR{constructor(t,n){super(new e.cQ,0,n,[],[]),this.feature=t,this.type=t.type,this.properties=t.tags?t.tags:{},"id"in t&&("string"==typeof t.id?this.id=parseInt(t.id,10):"number"!=typeof t.id||isNaN(t.id)||(this.id=t.id))}loadGeometry(){const t=[],n=1===this.feature.type?[this.feature.geometry]:this.feature.geometry;for(const r of n){const n=[];for(const t of r)n.push(new e.P(t[0],t[1]));t.push(n)}return t}}class a extends e.cP{constructor(t,n){super(new e.cQ),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=n?n.version:1,this.extent=n?n.extent:4096,this.length=t.length,this.features=t}feature(e){return new o(this.features[e],this.extent)}}function s(e,t){t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let o=0;o<e.length;o++)n.feature=e.feature(o),t.writeMessage(2,l,n);const r=n.keys;for(const o of r)t.writeStringField(3,o);const i=n.values;for(const o of i)t.writeMessage(4,p,o)}function l(e,t){if(!e.feature)return;const n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,c,e),t.writeVarintField(3,n.type),t.writeMessage(4,d,n)}function c(e,t){for(const r in null===(n=e.feature)||void 0===n?void 0:n.properties){var n;let i=e.feature.properties[r],o=e.keycache[r];if(null===i)continue;void 0===o&&(e.keys.push(r),o=e.keys.length-1,e.keycache[r]=o),t.writeVarint(o),"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i&&(i=JSON.stringify(i));const a=typeof i+":"+i;let s=e.valuecache[a];void 0===s&&(e.values.push(i),s=e.values.length-1,e.valuecache[a]=s),t.writeVarint(s)}}function u(e,t){return(t<<3)+(7&e)}function h(e){return e<<1^e>>31}function d(e,t){const n=e.loadGeometry(),r=e.type;let i=0,o=0;for(const a of n){let n=1;1===r&&(n=a.length),t.writeVarint(u(1,n));const s=3===r?a.length-1:a.length;for(let e=0;e<s;e++){1===e&&1!==r&&t.writeVarint(u(2,s-1));const n=a[e].x-i,l=a[e].y-o;t.writeVarint(h(n)),t.writeVarint(h(l)),i+=n,o+=l}3===e.type&&t.writeVarint(u(7,1))}}function p(e,t){const n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}class f extends e.cR{constructor(t,n,r,i,o){super(new e.cQ,0,o,[],[]),this.type=t,this.properties=r||{},this.extent=o,this.pointsArray=n,this.id=i}loadGeometry(){return this.pointsArray.map(t=>t.map(t=>new e.P(t.x,t.y)))}}class m extends e.cP{constructor(t,n,r){super(new e.cQ),this.version=2,this._myFeatures=t,this.name=n,this.length=t.length,this.extent=r}feature(e){return this._myFeatures[e]}}class g{constructor(){this.layers={}}addLayer(e){this.layers[e.name]=e}}function _(t){let n=function(t){const n=new e.cQ;return function(e,t){for(const n in e.layers)t.writeMessage(3,s,e.layers[n])}(t,n),n.finish()}(t);return 0===n.byteOffset&&n.byteLength===n.buffer.byteLength||(n=new Uint8Array(n)),{vectorTile:t,rawData:n.buffer}}function y(t,n,r){const{extent:i}=t,o=Math.pow(2,r.z-n.z),a=(r.x-n.x*o)*i,s=(r.y-n.y*o)*i,l=[];for(let c=0;c<t.length;c++){const n=t.feature(c);let r=n.loadGeometry();for(const e of r)for(const t of e)t.x=t.x*o-a,t.y=t.y*o-s;const u=128;r=e.cS(r,n.type,-u,-u,i+u,i+u),0!==r.length&&l.push(new f(n.type,r,n.properties,n.id,i))}return new m(l,t.name,i)}class v{constructor(t,n,r){this.actor=t,this.layerIndex=n,this.availableImages=r,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new e.cT(1e3)}loadVectorTile(t,n){return e._(this,void 0,void 0,function*(){const r=yield e.n(t.request,n);try{return{vectorTile:"mlt"!==t.encoding?new e.cU(new e.cQ(r.data)):new e.cV(r.data),rawData:r.data,cacheControl:r.cacheControl,expires:r.expires}}catch(e){const i=new Uint8Array(r.data);let o="Unable to parse the tile at ".concat(t.request.url,", ");throw o+=31===i[0]&&139===i[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":"got error: ".concat(e.message),new Error(o)}})}loadTile(t){return e._(this,void 0,void 0,function*(){const{uid:n,overzoomParameters:i}=t;i&&(t.request=i.overzoomRequest);const o=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.cW(t.request),a=new r(t);this.loading[n]=a;const s=new AbortController;a.abort=s;try{const r=yield this.loadVectorTile(t,s);if(delete this.loading[n],!r)return null;if(i){const e=this._getOverzoomTile(t,r.vectorTile);r.rawData=e.rawData,r.vectorTile=e.vectorTile}const l=r.rawData,c={};r.expires&&(c.expires=r.expires),r.cacheControl&&(c.cacheControl=r.cacheControl);const u={};if(o){const e=o.finish();e&&(u.resourceTiming=JSON.parse(JSON.stringify(e)))}a.vectorTile=r.vectorTile;const h=a.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);this.loaded[n]=a,this.fetching[n]={rawTileData:l,cacheControl:c,resourceTiming:u};try{const n=yield h;return e.e({rawTileData:l.slice(0),encoding:t.encoding},n,c,u)}finally{delete this.fetching[n]}}catch(e){throw delete this.loading[n],a.status="done",this.loaded[n]=a,e}})}_getOverzoomTile(e,t){const{tileID:n,source:r,overzoomParameters:i}=e,{maxZoomTileID:o}=i,a="".concat(o.key,"_").concat(n.key),s=this.overzoomedTileResultCache.get(a);if(s)return s;const l=new g,c=this.layerIndex.familiesBySource[r];for(const h in c){const e=t.layers[h];if(!e)continue;const r=y(e,o,n.canonical);r.length>0&&l.addLayer(r)}const u=_(l);return this.overzoomedTileResultCache.set(a,u),u}reloadTile(t){return e._(this,void 0,void 0,function*(){const n=t.uid;if(!this.loaded||!this.loaded[n])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const r=this.loaded[n];if(r.showCollisionBoxes=t.showCollisionBoxes,"parsing"===r.status){const i=yield r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);let o;if(this.fetching[n]){const{rawTileData:r,cacheControl:a,resourceTiming:s}=this.fetching[n];delete this.fetching[n],o=e.e({rawTileData:r.slice(0),encoding:t.encoding},i,a,s)}else o=i;return o}if("done"===r.status&&r.vectorTile)return r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity)})}abortTile(t){return e._(this,void 0,void 0,function*(){const e=this.loading,n=t.uid;e&&e[n]&&e[n].abort&&(e[n].abort.abort(),delete e[n])})}removeTile(t){return e._(this,void 0,void 0,function*(){this.loaded&&this.loaded[t.uid]&&delete this.loaded[t.uid]})}}class b{constructor(){this.loaded={}}loadTile(t){return e._(this,void 0,void 0,function*(){const{uid:n,encoding:r,rawImageData:i,redFactor:o,greenFactor:a,blueFactor:s,baseShift:l}=t,c=i.width+2,u=i.height+2,h=e.b(i)?new e.R({width:c,height:u},yield e.cX(i,-1,-1,c,u)):i,d=new e.cY(n,h,r,o,a,s,l);return this.loaded=this.loaded||{},this.loaded[n]=d,d})}removeTile(e){const t=this.loaded,n=e.uid;t&&t[n]&&delete t[n]}}var x,w,S=function(){if(w)return x;function e(e,n){if(0!==e.length){t(e[0],n);for(var r=1;r<e.length;r++)t(e[r],!n)}}function t(e,t){for(var n=0,r=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),l=n+s;r+=Math.abs(n)>=Math.abs(s)?n-l+s:s-l+n,n=l}n+r>=0!=!!t&&e.reverse()}return w=1,x=function t(n,r){var i,o=n&&n.type;if("FeatureCollection"===o)for(i=0;i<n.features.length;i++)t(n.features[i],r);else if("GeometryCollection"===o)for(i=0;i<n.geometries.length;i++)t(n.geometries[i],r);else if("Feature"===o)t(n.geometry,r);else if("Polygon"===o)e(n.coordinates,r);else if("MultiPolygon"===o)for(i=0;i<n.coordinates.length;i++)e(n.coordinates[i],r);return n}}(),T=e.cZ(S);const E={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},k=Math.fround||(P=new Float32Array(1),e=>(P[0]=+e,P[0]));var P;class C{constructor(e){this.options=Object.assign(Object.create(E),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:r}=this.options;t&&console.time("total time");const i="prepare ".concat(e.length," points");t&&console.time(i),this.points=e;const o=[];for(let s=0;s<e.length;s++){const t=e[s];if(!t.geometry)continue;const[n,r]=t.geometry.coordinates,i=k(M(n)),a=k(R(r));o.push(i,a,1/0,s,-1,1),this.options.reduce&&o.push(0)}let a=this.trees[r+1]=this._createTree(o);t&&console.timeEnd(i);for(let s=r;s>=n;s--){const e=+Date.now();a=this.trees[s]=this._createTree(this._cluster(a,s)),t&&console.log("z%d: %d clusters in %dms",s,a.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){const e=this.getClusters([n,r,180,o],t),a=this.getClusters([-180,r,i,o],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],s=a.range(M(n),R(o),M(i),R(r)),l=a.data,c=[];for(const u of s){const e=this.stride*u;c.push(l[e+5]>1?I(l,e,this.clusterProps):this.points[l[e+3]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);const o=i.data;if(t*this.stride>=o.length)throw new Error(r);const a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=i.within(o[t*this.stride],o[t*this.stride+1],a),l=[];for(const c of s){const t=c*this.stride;o[t+4]===e&&l.push(o[t+5]>1?I(o,t,this.clusterProps):this.points[o[t+3]])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,n){const r=[];return this._appendLeaves(r,e,t=t||10,n=n||0,0),r}getTile(e,t,n){const r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:o,radius:a}=this.options,s=a/o,l=(n-s)/i,c=(n+1+s)/i,u={features:[]};return this._addTileFeatures(r.range((t-s)/i,l,(t+1+s)/i,c),r.data,t,n,i,u),0===t&&this._addTileFeatures(r.range(1-s/i,l,1,c),r.data,i,n,i,u),t===i-1&&this._addTileFeatures(r.range(0,l,s/i,c),r.data,-1,n,i,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,r,i){const o=this.getChildren(t);for(const a of o){const t=a.properties;if(t&&t.cluster?i+t.point_count<=r?i+=t.point_count:i=this._appendLeaves(e,t.cluster_id,n,r,i):i<r?i++:e.push(a),e.length===n)break}return i}_createTree(t){const n=new e.aN(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,r,i,o){for(const a of e){const e=a*this.stride,s=t[e+5]>1;let l,c,u;if(s)l=A(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+3]];l=n.properties;const[r,i]=n.geometry.coordinates;c=M(r),u=R(i)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*i-n)),Math.round(this.options.extent*(u*i-r))]],tags:l};let d;d=s||this.options.generateId?t[e+3]:this.points[t[e+3]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:r,reduce:i,minPoints:o}=this.options,a=n/(r*Math.pow(2,t)),s=e.data,l=[],c=this.stride;for(let u=0;u<s.length;u+=c){if(s[u+2]<=t)continue;s[u+2]=t;const n=s[u],r=s[u+1],h=e.within(s[u],s[u+1],a),d=s[u+5];let p=d;for(const e of h){const n=e*c;s[n+2]>t&&(p+=s[n+5])}if(p>d&&p>=o){let e,o=n*d,a=r*d,f=-1;const m=(u/c<<5)+(t+1)+this.points.length;for(const n of h){const r=n*c;if(s[r+2]<=t)continue;s[r+2]=t;const l=s[r+5];o+=s[r]*l,a+=s[r+1]*l,s[r+4]=m,i&&(e||(e=this._map(s,u,!0),f=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(s,r)))}s[u+4]=m,l.push(o/p,a/p,1/0,m,-1,p),i&&l.push(f)}else{for(let e=0;e<c;e++)l.push(s[u+e]);if(p>1)for(const e of h){const n=e*c;if(!(s[n+2]<=t)){s[n+2]=t;for(let e=0;e<c;e++)l.push(s[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+5]>1){const r=this.clusterProps[e[t+6]];return n?Object.assign({},r):r}const r=this.points[e[t+3]].properties,i=this.options.map(r);return n&&i===r?Object.assign({},i):i}}function I(e,t,n){return{type:"Feature",id:e[t+3],properties:A(e,t,n),geometry:{type:"Point",coordinates:[(r=e[t],360*(r-.5)),D(e[t+1])]}};var r}function A(e,t,n){const r=e[t+5],i=r>=1e4?"".concat(Math.round(r/1e3),"k"):r>=1e3?Math.round(r/100)/10+"k":r,o=e[t+6],a=-1===o?{}:Object.assign({},n[o]);return Object.assign(a,{cluster:!0,cluster_id:e[t+3],point_count:r,point_count_abbreviated:i})}function M(e){return e/360+.5}function R(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function D(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function z(e,t,n,r){let i=r;const o=t+(n-t>>1);let a,s=n-t;const l=e[t],c=e[t+1],u=e[n],h=e[n+1];for(let d=t+3;d<n;d+=3){const t=L(e[d],e[d+1],l,c,u,h);if(t>i)a=d,i=t;else if(t===i){const e=Math.abs(d-o);e<s&&(a=d,s=e)}}i>r&&(a-t>3&&z(e,t,a,r),e[a+2]=i,n-a>3&&z(e,a,n,r))}function L(e,t,n,r,i,o){let a=i-n,s=o-r;if(0!==a||0!==s){const l=((e-n)*a+(t-r)*s)/(a*a+s*s);l>1?(n=i,r=o):l>0&&(n+=a*l,r+=s*l)}return a=e-n,s=t-r,a*a+s*s}function j(e,t,n,r){const i={id:null==e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)O(i,n);else if("Polygon"===t)O(i,n[0]);else if("MultiLineString"===t)for(const o of n)O(i,o);else if("MultiPolygon"===t)for(const o of n)O(i,o[0]);return i}function O(e,t){for(let n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function F(e,t,n,r){if(!t.geometry)return;const i=t.geometry.coordinates;if(i&&0===i.length)return;const o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let s=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=r||0),"Point"===o)B(i,s);else if("MultiPoint"===o)for(const c of i)B(c,s);else if("LineString"===o)N(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(const n of i)s=[],N(n,s,a,!1),e.push(j(l,"LineString",s,t.properties));return}U(i,s,a,!1)}else if("Polygon"===o)U(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const i of t.geometry.geometries)F(e,{id:l,geometry:i,properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of i){const t=[];U(e,t,a,!0),s.push(t)}}e.push(j(l,o,s,t.properties))}function B(e,t){t.push(V(e[0]),G(e[1]),0)}function N(e,t,n,r){let i,o,a=0;for(let l=0;l<e.length;l++){const n=V(e[l][0]),s=G(e[l][1]);t.push(n,s,0),l>0&&(a+=r?(i*s-n*o)/2:Math.sqrt(Math.pow(n-i,2)+Math.pow(s-o,2))),i=n,o=s}const s=t.length-3;t[2]=1,z(t,0,s,n),t[s+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function U(e,t,n,r){for(let i=0;i<e.length;i++){const o=[];N(e[i],o,n,r),t.push(o)}}function V(e){return e/360+.5}function G(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function q(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;const l=[];for(const c of e){const e=c.geometry;let t=c.type;const o=0===i?c.minX:c.minY,a=0===i?c.maxX:c.maxY;if(o>=n&&a<r){l.push(c);continue}if(a<n||o>=r)continue;let u=[];if("Point"===t||"MultiPoint"===t)Z(e,u,n,r,i);else if("LineString"===t)W(e,u,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===t)X(e,u,n,r,i,!1);else if("Polygon"===t)X(e,u,n,r,i,!0);else if("MultiPolygon"===t)for(const s of e){const e=[];X(s,e,n,r,i,!0),e.length&&u.push(e)}if(u.length){if(s.lineMetrics&&"LineString"===t){for(const e of u)l.push(j(c.id,t,e,c.tags));continue}"LineString"!==t&&"MultiLineString"!==t||(1===u.length?(t="LineString",u=u[0]):t="MultiLineString"),"Point"!==t&&"MultiPoint"!==t||(t=3===u.length?"Point":"MultiPoint"),l.push(j(c.id,t,u,c.tags))}}return l.length?l:null}function Z(e,t,n,r,i){for(let o=0;o<e.length;o+=3){const a=e[o+i];a>=n&&a<=r&&K(t,e[o],e[o+1],e[o+2])}}function W(e,t,n,r,i,o,a){let s=H(e);const l=0===i?Y:J;let c,u,h=e.start;for(let g=0;g<e.length-3;g+=3){const d=e[g],p=e[g+1],f=e[g+2],m=e[g+3],_=e[g+4],y=0===i?d:p,v=0===i?m:_;let b=!1;a&&(c=Math.sqrt(Math.pow(d-m,2)+Math.pow(p-_,2))),y<n?v>n&&(u=l(s,d,p,m,_,n),a&&(s.start=h+c*u)):y>r?v<r&&(u=l(s,d,p,m,_,r),a&&(s.start=h+c*u)):K(s,d,p,f),v<n&&y>=n&&(u=l(s,d,p,m,_,n),b=!0),v>r&&y<=r&&(u=l(s,d,p,m,_,r),b=!0),!o&&b&&(a&&(s.end=h+c*u),t.push(s),s=H(e)),a&&(h+=c)}let d=e.length-3;const p=e[d],f=e[d+1],m=0===i?p:f;m>=n&&m<=r&&K(s,p,f,e[d+2]),d=s.length-3,o&&d>=3&&(s[d]!==s[0]||s[d+1]!==s[1])&&K(s,s[0],s[1],s[2]),s.length&&t.push(s)}function H(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function X(e,t,n,r,i,o){for(const a of e)W(a,t,n,r,i,o,!1)}function K(e,t,n,r){e.push(t,n,r)}function Y(e,t,n,r,i,o){const a=(o-t)/(r-t);return K(e,o,n+(i-n)*a,1),a}function J(e,t,n,r,i,o){const a=(o-n)/(i-n);return K(e,t+(r-t)*a,o,1),a}function Q(e,t){const n=[];for(let r=0;r<e.length;r++){const i=e[r],o=i.type;let a;if("Point"===o||"MultiPoint"===o||"LineString"===o)a=$(i.geometry,t);else if("MultiLineString"===o||"Polygon"===o){a=[];for(const e of i.geometry)a.push($(e,t))}else if("MultiPolygon"===o){a=[];for(const e of i.geometry){const n=[];for(const r of e)n.push($(r,t));a.push(n)}}n.push(j(i.id,o,a,i.tags))}return n}function $(e,t){const n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(let r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function ee(e,t){if(e.transformed)return e;const n=1<<e.z,r=e.x,i=e.y;for(const o of e.features){const e=o.geometry,a=o.type;if(o.geometry=[],1===a)for(let s=0;s<e.length;s+=2)o.geometry.push(te(e[s],e[s+1],t,n,r,i));else for(let s=0;s<e.length;s++){const a=[];for(let o=0;o<e[s].length;o+=2)a.push(te(e[s][o],e[s][o+1],t,n,r,i));o.geometry.push(a)}}return e.transformed=!0,e}function te(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function ne(e,t,n,r,i){const o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const s of e)re(a,s,o,i);return a}function re(e,t,n,r){const i=t.geometry,o=t.type,a=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===o||"MultiPoint"===o)for(let s=0;s<i.length;s+=3)a.push(i[s],i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)ie(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let s=0;s<i.length;s++)ie(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(let s=0;s<i.length;s++){const t=i[s];for(let r=0;r<t.length;r++)ie(a,t[r],e,n,!0,0===r)}if(a.length){let n=t.tags||null;if("LineString"===o&&r.lineMetrics){n={};for(const e in t.tags)n[e]=t.tags[e];n.mapbox_clip_start=i.start/i.size,n.mapbox_clip_end=i.end/i.size}const s={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:n};null!==t.id&&(s.id=t.id),e.features.push(s)}}function ie(e,t,n,r,i,o){const a=r*r;if(r>0&&t.size<(i?a:r))return void(n.numPoints+=t.length/3);const s=[];for(let l=0;l<t.length;l+=3)(0===r||t[l+2]>a)&&(n.numSimplified++,s.push(t[l],t[l+1])),n.numPoints++;i&&function(e,t){let n=0;for(let r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(let r=0,i=e.length;r<i/2;r+=2){const t=e[r],n=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=t,e[i-1-r]=n}}(s,o),e.push(s)}const oe={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ae{constructor(e,t){const n=(t=this.options=function(e,t){for(const n in t)e[n]=t[n];return e}(Object.create(oe),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(e,t){const n=[];if("FeatureCollection"===e.type)for(let r=0;r<e.features.length;r++)F(n,e.features[r],t,r);else F(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){const n=t.buffer/t.extent;let r=e;const i=q(e,1,-1-n,n,0,-1,2,t),o=q(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=q(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=Q(i,1).concat(r)),o&&(r=r.concat(Q(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,n,r,i,o,a){const s=[e,t,n,r],l=this.options,c=l.debug;for(;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();const u=1<<t,h=se(t,n,r);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=ne(e,t,n,r,l),this.tileCoords.push({z:t,x:n,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const e="z".concat(t);this.stats[e]=(this.stats[e]||0)+1,this.total++}if(d.source=e,null==i){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===i)continue;if(null!=i){const e=i-t;if(n!==o>>e||r!==a>>e)continue}}if(d.source=null,0===e.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,m=.5+p,g=1+p;let _=null,y=null,v=null,b=null,x=q(e,u,n-p,n+m,0,d.minX,d.maxX,l),w=q(e,u,n+f,n+g,0,d.minX,d.maxX,l);e=null,x&&(_=q(x,u,r-p,r+m,1,d.minY,d.maxY,l),y=q(x,u,r+f,r+g,1,d.minY,d.maxY,l),x=null),w&&(v=q(w,u,r-p,r+m,1,d.minY,d.maxY,l),b=q(w,u,r+f,r+g,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),s.push(_||[],t+1,2*n,2*r),s.push(y||[],t+1,2*n,2*r+1),s.push(v||[],t+1,2*n+1,2*r),s.push(b||[],t+1,2*n+1,2*r+1)}}getTile(e,t,n){e=+e,t=+t,n=+n;const r=this.options,{extent:i,debug:o}=r;if(e<0||e>24)return null;const a=1<<e,s=se(e,t=t+a&a-1,n);if(this.tiles[s])return ee(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);let l,c=e,u=t,h=n;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[se(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?ee(this.tiles[s],i):null):null}}function se(e,t,n){return 32*((1<<e)*n+t)+e}class le extends v{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ce;super(e,t,n),this._dataUpdateable=new Map,this._createGeoJSONIndex=r}loadVectorTile(t,n){return e._(this,void 0,void 0,function*(){const n=t.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const r=this._geoJSONIndex.getTile(n.z,n.x,n.y);return r?_(new a(r.features,{version:2,extent:e.a3})):null})}loadData(t){return e._(this,void 0,void 0,function*(){var n;null===(n=this._pendingRequest)||void 0===n||n.abort();const r=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.cW(t.request);this._pendingRequest=new AbortController;try{(!this._pendingData||t.request||t.data||t.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(t,this._pendingRequest));const e=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(e,t),this.loaded={};const n={data:e};if(r){const e=r.finish();e&&(n.resourceTiming={},n.resourceTiming[t.source]=JSON.parse(JSON.stringify(e)))}return n}catch(t){if(delete this._pendingRequest,e.cC(t))return{abandoned:!0};throw t}})}getData(){return e._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(e){const t=this.loaded;return t&&t[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(t,n){return e._(this,void 0,void 0,function*(){let r=yield this.loadGeoJSON(t,n);if(delete this._pendingRequest,"object"!=typeof r)throw new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object."));if(T(r,!0),t.filter){const n=e.c_(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));const i=r.features.filter(e=>n.value.evaluate({zoom:0},e));r={type:"FeatureCollection",features:i}}return r})}loadGeoJSON(t,n){return e._(this,void 0,void 0,function*(){const{promoteId:r}=t;if(t.request){const i=yield e.j(t.request,n);return this._dataUpdateable=e.d0(i.data,r)?e.c$(i.data,r):void 0,i.data}if("string"==typeof t.data)try{const n=JSON.parse(t.data);return this._dataUpdateable=e.d0(n,r)?e.c$(n,r):void 0,n}catch(e){throw new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object."))}if(!t.dataDiff)throw new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object."));if(!this._dataUpdateable)throw new Error("Cannot update existing geojson data in ".concat(t.source));return e.d1(this._dataUpdateable,t.dataDiff,r),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(t){return e._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}function ce(t,n){return n.cluster?new C(function(t){let{superclusterOptions:n,clusterProperties:r}=t;if(!r||!n)return n;const i={},o={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(r);for(const c of l){const[t,n]=r[c],a=e.c_(n),s=e.c_("string"==typeof t?[t,["accumulated"],["get",c]]:t);i[c]=a.value,o[c]=s.value}return n.map=e=>{s.properties=e;const t={};for(const n of l)t[n]=i[n].evaluate(a,s);return t},n.reduce=(e,t)=>{s.properties=t;for(const n of l)a.accumulated=e[n],e[n]=o[n].evaluate(a,s)},n}(n)).load(t.features):function(e,t){return new ae(e,t)}(t,n.geojsonVtOptions)}class ue{constructor(t){this.self=t,this.actor=new e.K(t),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(e,t)=>{if(this.externalWorkerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));this.externalWorkerSourceTypes[e]=t},this.self.addProtocol=e.cE,this.self.removeProtocol=e.cF,this.self.registerRTLTextPlugin=t=>{e.d2.setMethods(t)},this.actor.registerMessageHandler("LDT",(e,t)=>this._getDEMWorkerSource(e,t.source).loadTile(t)),this.actor.registerMessageHandler("RDT",(t,n)=>e._(this,void 0,void 0,function*(){this._getDEMWorkerSource(t,n.source).removeTile(n)})),this.actor.registerMessageHandler("GCEZ",(t,n)=>e._(this,void 0,void 0,function*(){return this._getWorkerSource(t,n.type,n.source).getClusterExpansionZoom(n)})),this.actor.registerMessageHandler("GCC",(t,n)=>e._(this,void 0,void 0,function*(){return this._getWorkerSource(t,n.type,n.source).getClusterChildren(n)})),this.actor.registerMessageHandler("GCL",(t,n)=>e._(this,void 0,void 0,function*(){return this._getWorkerSource(t,n.type,n.source).getClusterLeaves(n)})),this.actor.registerMessageHandler("LD",(e,t)=>this._getWorkerSource(e,t.type,t.source).loadData(t)),this.actor.registerMessageHandler("GD",(e,t)=>this._getWorkerSource(e,t.type,t.source).getData()),this.actor.registerMessageHandler("LT",(e,t)=>this._getWorkerSource(e,t.type,t.source).loadTile(t)),this.actor.registerMessageHandler("RT",(e,t)=>this._getWorkerSource(e,t.type,t.source).reloadTile(t)),this.actor.registerMessageHandler("AT",(e,t)=>this._getWorkerSource(e,t.type,t.source).abortTile(t)),this.actor.registerMessageHandler("RMT",(e,t)=>this._getWorkerSource(e,t.type,t.source).removeTile(t)),this.actor.registerMessageHandler("RS",(t,n)=>e._(this,void 0,void 0,function*(){if(!this.workerSources[t]||!this.workerSources[t][n.type]||!this.workerSources[t][n.type][n.source])return;const e=this.workerSources[t][n.type][n.source];delete this.workerSources[t][n.type][n.source],void 0!==e.removeSource&&e.removeSource(n)})),this.actor.registerMessageHandler("RM",t=>e._(this,void 0,void 0,function*(){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],this.globalStates.delete(t)})),this.actor.registerMessageHandler("SR",(t,n)=>e._(this,void 0,void 0,function*(){this.referrer=n})),this.actor.registerMessageHandler("SRPS",(e,t)=>this._syncRTLPluginState(e,t)),this.actor.registerMessageHandler("IS",(t,n)=>e._(this,void 0,void 0,function*(){this.self.importScripts(n)})),this.actor.registerMessageHandler("SI",(e,t)=>this._setImages(e,t)),this.actor.registerMessageHandler("UL",(t,n)=>e._(this,void 0,void 0,function*(){this._getLayerIndex(t).update(n.layers,n.removedIds,this._getGlobalState(t))})),this.actor.registerMessageHandler("UGS",(t,n)=>e._(this,void 0,void 0,function*(){const e=this._getGlobalState(t);for(const t in n)e[t]=n[t]})),this.actor.registerMessageHandler("SL",(t,n)=>e._(this,void 0,void 0,function*(){this._getLayerIndex(t).replace(n,this._getGlobalState(t))}))}_getGlobalState(e){let t=this.globalStates.get(e);return t||(t={},this.globalStates.set(e,t)),t}_setImages(t,n){return e._(this,void 0,void 0,function*(){this.availableImages[t]=n;for(const e in this.workerSources[t]){const r=this.workerSources[t][e];for(const e in r)r[e].availableImages=n}})}_syncRTLPluginState(t,n){return e._(this,void 0,void 0,function*(){return yield e.d2.syncState(n,this.self.importScripts)})}_getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}_getLayerIndex(e){let n=this.layerIndexes[e];return n||(n=this.layerIndexes[e]=new t),n}_getWorkerSource(e,t,n){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][n]){const r={sendAsync:(t,n)=>(t.targetMapId=e,this.actor.sendAsync(t,n))};switch(t){case"vector":this.workerSources[e][t][n]=new v(r,this._getLayerIndex(e),this._getAvailableImages(e));break;case"geojson":this.workerSources[e][t][n]=new le(r,this._getLayerIndex(e),this._getAvailableImages(e));break;default:this.workerSources[e][t][n]=new this.externalWorkerSourceTypes[t](r,this._getLayerIndex(e),this._getAvailableImages(e))}}return this.workerSources[e][t][n]}_getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new b),this.demWorkerSources[e][t]}}return e.i(self)&&(self.worker=new ue(self)),ue}),n("index",["exports","./shared"],function(e,t){var n="5.12.0";function r(){var e=new t.A(4);return t.A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}let i,o,a;const s={frame(e,n,r){const i=requestAnimationFrame(e=>{o(),n(e)}),{unsubscribe:o}=t.s(e.signal,"abort",()=>{o(),cancelAnimationFrame(i),r(t.c())},!1)},frameAsync(e){return new Promise((t,n)=>{this.frame(e,t,n)})},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getImageCanvasContext(e).getImageData(-t,-t,e.width+2*t,e.height+2*t)},getImageCanvasContext(e){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height),n},resolveURL:e=>(i||(i=document.createElement("a")),i.href=e,i.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return void 0!==a?a:!!matchMedia&&(null==o&&(o=matchMedia("(prefers-reduced-motion: reduce)")),o.matches)},set prefersReducedMotion(e){a=e}},l=new class{constructor(){this._realTime="undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return null!==this._frozenAt?this._frozenAt:this._realTime()}setNow(e){this._frozenAt=e}restoreNow(){this._frozenAt=null}isFrozen(){return null!==this._frozenAt}};function c(){return l.getCurrentTime()}class u{static testProp(e){if(!u.docStyle)return e[0];for(let t=0;t<e.length;t++)if(e[t]in u.docStyle)return e[t];return e[0]}static create(e,t,n){const r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r}static createNS(e,t){return window.document.createElementNS(e,t)}static disableDrag(){u.docStyle&&u.selectProp&&(u.userSelect=u.docStyle[u.selectProp],u.docStyle[u.selectProp]="none")}static enableDrag(){u.docStyle&&u.selectProp&&(u.docStyle[u.selectProp]=u.userSelect)}static setTransform(e,t){e.style[u.transformProp]=t}static addEventListener(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.addEventListener(t,n,"passive"in r?r:r.capture)}static removeEventListener(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.removeEventListener(t,n,"passive"in r?r:r.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",u.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",u.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",u.suppressClickInternal,!0)},0)}static getScale(e){const t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}static getPoint(e,n,r){const i=n.boundingClientRect;return new t.P((r.clientX-i.left)/n.x-e.clientLeft,(r.clientY-i.top)/n.y-e.clientTop)}static mousePos(e,t){const n=u.getScale(e);return u.getPoint(e,n,t)}static touchPos(e,t){const n=[],r=u.getScale(e);for(let i=0;i<t.length;i++)n.push(u.getPoint(e,r,t[i]));return n}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const t=(new DOMParser).parseFromString(e,"text/html").body||document.createElement("body"),n=t.querySelectorAll("script");for(const r of n)r.remove();return u.clean(t),t.innerHTML}static isPossiblyDangerous(e,t){const n=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!n.includes("javascript:")&&!n.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const t=e.children;for(const n of t)u.removeAttributes(n),u.clean(n)}static removeAttributes(e){for(const{name:t,value:n}of e.attributes)u.isPossiblyDangerous(t,n)&&e.removeAttribute(t)}}u.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,u.selectProp=u.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),u.transformProp=u.testProp(["transform","WebkitTransform"]);const h={supported:!1,testSupport:function(e){!f&&p&&(m?g(e):d=e)}};let d,p,f=!1,m=!1;function g(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,p),e.isContextLost())return;h.supported=!0}catch(e){}e.deleteTexture(t),f=!0}var _;"undefined"!=typeof document&&(p=document.createElement("img"),p.onload=()=>{d&&g(d),d=null,m=!0},p.onerror=()=>{f=!0,d=null},p.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(e){let n,r,i,o;e.resetRequestQueue=()=>{n=[],r=0,i=0,o={}},e.addThrottleControl=e=>{const t=i++;return o[t]=e,t},e.removeThrottleControl=e=>{delete o[e],s()},e.getImage=function(e,r){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise((o,a)=>{h.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),t.e(e,{type:"image"}),n.push({abortController:r,requestParameters:e,supportImageRefresh:i,state:"queued",onError:e=>{a(e)},onSuccess:e=>{o(e)}}),s()})};const a=e=>t._(this,void 0,void 0,function*(){e.state="running";const{requestParameters:n,supportImageRefresh:i,onError:o,onSuccess:a,abortController:c}=e,u=!1===i&&!t.i(self)&&!t.g(n.url)&&(!n.headers||Object.keys(n.headers).reduce((e,t)=>e&&"accept"===t,!0));r++;const h=u?l(n,c):t.m(n,c);try{const n=yield h;delete e.abortController,e.state="completed",n.data instanceof HTMLImageElement||t.b(n.data)?a(n):n.data&&a({data:yield(d=n.data,"function"==typeof createImageBitmap?t.f(d):t.h(d)),cacheControl:n.cacheControl,expires:n.expires})}catch(t){delete e.abortController,o(t)}finally{r--,s()}var d}),s=()=>{const e=(()=>{for(const e of Object.keys(o))if(o[e]())return!0;return!1})()?t.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let t=r;t<e&&n.length>0;t++){const e=n.shift();e.abortController.signal.aborted?t--:a(e)}},l=(e,n)=>new Promise((r,i)=>{const o=new Image,a=e.url,s=e.credentials;s&&"include"===s?o.crossOrigin="use-credentials":(s&&"same-origin"===s||!t.d(a))&&(o.crossOrigin="anonymous"),n.signal.addEventListener("abort",()=>{o.src="",i(t.c())}),o.fetchPriority="high",o.onload=()=>{o.onerror=o.onload=null,r({data:o})},o.onerror=()=>{o.onerror=o.onload=null,n.signal.aborted||i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},o.src=a})}(_||(_={})),_.resetRequestQueue();class y{constructor(e){this._transformRequestFn=null!=e?e:null}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function v(e){const t=[];if("string"==typeof e)t.push({id:"default",url:e});else if(e&&e.length>0){const n=[];for(const{id:r,url:i}of e){const e="".concat(r).concat(i);-1===n.indexOf(e)&&(n.push(e),t.push({id:r,url:i}))}}return t}function b(e,t,n){try{const r=new URL(e);return r.pathname+="".concat(t).concat(n),r.toString()}catch(t){throw new Error('Invalid sprite URL "'.concat(e,'", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically'))}}function x(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class w extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,promiseResolve:t}of this.requestors)t(this._getImagesForIds(e));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const e=n.spriteData;n.data=new t.R({width:e.width,height:e.height},e.context.getImageData(e.x,e.y,e.width,e.height).data),n.spriteData=null}return n}addImage(e,t){if(this.images[e])throw new Error("Image id ".concat(e," already exist, use updateImage instead"));this._validate(e,t)&&(this.images[e]=t)}_validate(e,n){let r=!0;const i=n.data||n.spriteData;return this._validateStretch(n.stretchX,i&&i.width)||(this.fire(new t.k(new Error('Image "'.concat(e,'" has invalid "stretchX" value')))),r=!1),this._validateStretch(n.stretchY,i&&i.height)||(this.fire(new t.k(new Error('Image "'.concat(e,'" has invalid "stretchY" value')))),r=!1),this._validateContent(n.content,n)||(this.fire(new t.k(new Error('Image "'.concat(e,'" has invalid "content" value')))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let n=0;for(const r of e){if(r[0]<n||r[1]<r[0]||t<r[1])return!1;n=r[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;const n=t.spriteData,r=n&&n.width||t.data.width,i=n&&n.height||t.data.height;return!(e[0]<0||r<e[0]||e[1]<0||i<e[1]||e[2]<0||r<e[2]||e[3]<0||i<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=this.getImage(e);if(n&&(r.data.width!==t.data.width||r.data.height!==t.data.height))throw new Error("size mismatch between old image (".concat(r.data.width,"x").concat(r.data.height,") and new image (").concat(t.data.width,"x").concat(t.data.height,")."));t.version=r.version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((t,n)=>{let r=!0;if(!this.isLoaded())for(const i of e)this.images[i]||(r=!1);this.isLoaded()||r?t(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:t})})}_getImagesForIds(e){const n={};for(const r of e){let e=this.getImage(r);e||(this.fire(new t.l("styleimagemissing",{id:r})),e=this.getImage(r)),e?n[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,textFitWidth:e.textFitWidth,textFitHeight:e.textFitHeight,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w('Image "'.concat(r,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}return n}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(e){const n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{const n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},i=new t.I(n,r);this.patterns[e]={bin:n,position:i}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.T(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:n,h:r}=t.p(e),i=this.atlasImage;i.resize({width:n||1,height:r||1});for(const o in this.patterns){const{bin:e}=this.patterns[o],n=e.x+1,r=e.y+1,a=this.getImage(o).data,s=a.width,l=a.height;t.R.copy(a,i,{x:0,y:0},{x:n,y:r},{width:s,height:l}),t.R.copy(a,i,{x:0,y:l-1},{x:n,y:r-1},{width:s,height:1}),t.R.copy(a,i,{x:0,y:0},{x:n,y:r+l},{width:s,height:1}),t.R.copy(a,i,{x:s-1,y:0},{x:n-1,y:r},{width:1,height:l}),t.R.copy(a,i,{x:0,y:0},{x:n+s,y:r},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const e=this.getImage(n);e||t.w('Image with ID: "'.concat(n,'" was not found')),x(e)&&this.updateImage(n,e)}}cloneImages(){const e={};for(const t in this.images){const n=this.images[t];e[t]=Object.assign(Object.assign({},n),{data:n.data?n.data.clone():null})}return e}}const S=1e20;function T(e,t,n,r,i,o,a,s,l){for(let c=t;c<t+r;c++)E(e,n*o+c,o,i,a,s,l);for(let c=n;c<n+i;c++)E(e,c*o+t,1,r,a,s,l)}function E(e,t,n,r,i,o,a){o[0]=0,a[0]=-S,a[1]=S,i[0]=e[t];for(let s=1,l=0,c=0;s<r;s++){i[s]=e[t+s*n];const r=s*s;do{const e=o[l];c=(i[s]-i[e]+r-e*e)/(s-e)/2}while(c<=a[l]&&--l>-1);l++,o[l]=s,a[l]=c,a[l+1]=S}for(let s=0,l=0;s<r;s++){for(;a[l+1]<s;)l++;const r=o[l],c=s-r;e[t+s*n]=i[r]+c*c}}const k=t.v.layout_symbol["text-font"].default.join(",");class P{constructor(e,t,n){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={},this.lang=n}setURL(e){this.url=e}getGlyphs(e){return t._(this,void 0,void 0,function*(){const t=[];for(const i in e)for(const n of e[i])t.push(this._getAndCacheGlyphsPromise(i,n));const n=yield Promise.all(t),r={};for(const{stack:e,id:i,glyph:o}of n)r[e]||(r[e]={}),r[e][i]=o&&{id:o.id,bitmap:o.bitmap.clone(),metrics:o.metrics};return r})}_getAndCacheGlyphsPromise(e,n){return t._(this,void 0,void 0,function*(){let t=this.entries[e];t||(t=this.entries[e]={glyphs:{},requests:{},ranges:{}});let r=t.glyphs[n];return void 0!==r?{stack:e,id:n,glyph:r}:!this.url||this._charUsesLocalIdeographFontFamily(n)?(r=t.glyphs[n]=this._drawGlyph(t,e,n),{stack:e,id:n,glyph:r}):yield this._downloadAndCacheRangePromise(e,n)})}_downloadAndCacheRangePromise(e,n){return t._(this,void 0,void 0,function*(){const t=Math.floor(n/256);if(256*t>65535)throw new Error("glyphs > 65535 not supported");const r=this.entries[e];if(r.ranges[t])return{stack:e,id:n,glyph:null};if(!r.requests[t]){const n=P.loadGlyphRange(e,t,this.url,this.requestManager);r.requests[t]=n}try{const i=yield r.requests[t];for(const e in i)r.glyphs[+e]=i[+e];return r.ranges[t]=!0,{stack:e,id:n,glyph:i[n]||null}}catch(i){const a=r.glyphs[n]=this._drawGlyph(r,e,n);return this._warnOnMissingGlyphRange(a,t,n,i),{stack:e,id:n,glyph:a}}})}_warnOnMissingGlyphRange(e,n,r,i){const o=256*n,a=o+255,s=r.toString(16).padStart(4,"0").toUpperCase();t.w("Unable to load glyph range ".concat(n,", ").concat(o,"-").concat(a,". Rendering codepoint U+").concat(s," locally instead. ").concat(i))}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&t.q(e)}_drawGlyph(e,n,r){const i=n===k&&""!==this.localIdeographFontFamily&&this._charUsesLocalIdeographFontFamily(r),o=i?"ideographTinySDF":"tinySDF";e[o]||(e[o]=this._createTinySDF(i?this.localIdeographFontFamily:n));const a=e[o].draw(String.fromCharCode(r));return{id:r,bitmap:new t.r({width:a.width||60,height:a.height||60},a.data),metrics:{width:a.glyphWidth/2||24,height:a.glyphHeight/2||24,left:a.glyphLeft/2+.5||0,top:a.glyphTop/2-27.5||-8,advance:a.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){const t=e?e.split(","):[];t.push("sans-serif");const n=t.map(e=>/[-\w]+/.test(e)?e:"'".concat(CSS.escape(e),"'")).join(",");return new P.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:n,fontWeight:this._fontWeight(t[0]),fontStyle:this._fontStyle(t[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){const t={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let n;for(const[r,i]of Object.entries(t))new RegExp("\\b".concat(r,"\\b"),"i").test(e)&&(n="".concat(i));return n}destroy(){for(const e in this.entries){const t=this.entries[e];t.tinySDF&&(t.tinySDF=null),t.ideographTinySDF&&(t.ideographTinySDF=null),t.glyphs={},t.requests={},t.ranges={}}this.entries={}}}P.loadGlyphRange=function(e,n,r,i){return t._(this,void 0,void 0,function*(){const o=256*n,a=o+255,s=i.transformRequest(r.replace("{fontstack}",e).replace("{range}","".concat(o,"-").concat(a)),"Glyphs"),l=yield t.n(s,new AbortController);if(!l||!l.data)throw new Error("Could not load glyph range. range: ".concat(n,", ").concat(o,"-").concat(a));const c={};for(const e of t.o(l.data))c[e.id]=e;return c})},P.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:n=8,cutoff:r=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:a="normal",lang:s=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=r,this.radius=n,this.lang=s;const l=this.size=e+4*t,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font="".concat(a," ").concat(o," ").concat(e,"px ").concat(i),u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(n),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),l=Math.min(this.size-this.buffer,a+Math.ceil(r)),c=s+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0===s||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;this.lang&&(f.lang=this.lang),f.clearRect(m,m,s,l),f.fillText(e,m,m+a);const y=f.getImageData(m,m,s,l);_.fill(S,0,h),g.fill(0,0,h);for(let v=0;v<l;v++)for(let e=0;e<s;e++){const t=y.data[4*(v*s+e)+3]/255;if(0===t)continue;const n=(v+m)*c+e+m;if(1===t)_[n]=0,g[n]=S;else{const e=.5-t;_[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}T(_,0,0,c,u,c,this.f,this.v,this.z),T(g,m,m,s,l,c,this.f,this.v,this.z);for(let v=0;v<h;v++){const e=Math.sqrt(_[v])-Math.sqrt(g[v]);d[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};class C{constructor(){this.specification=t.u.light.position}possiblyEvaluate(e,n){return t.C(e.expression.evaluate(n))}interpolate(e,n,r){return{x:t.F.number(e.x,n.x,r),y:t.F.number(e.y,n.y,r),z:t.F.number(e.z,n.z,r)}}}let I;class A extends t.E{constructor(e){super(),I=I||new t.t({anchor:new t.D(t.u.light.anchor),position:new C,color:new t.D(t.u.light.color),intensity:new t.D(t.u.light.intensity)}),this._transitionable=new t.x(I,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._validate(t.y,e,n))for(const t in e){const n=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),n):this._transitionable.setValue(t,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,r){return(!r||!1!==r.validate)&&t.z(this,e.call(t.B,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.u}))}}const M=new t.t({"sky-color":new t.D(t.u.sky["sky-color"]),"horizon-color":new t.D(t.u.sky["horizon-color"]),"fog-color":new t.D(t.u.sky["fog-color"]),"fog-ground-blend":new t.D(t.u.sky["fog-ground-blend"]),"horizon-fog-blend":new t.D(t.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new t.D(t.u.sky["sky-horizon-blend"]),"atmosphere-blend":new t.D(t.u.sky["atmosphere-blend"])});class R extends t.E{constructor(e){super(),this._transitionable=new t.x(M,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.G(0))}setSky(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._validate(t.H,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const t in e){const n=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),n):this._transitionable.setValue(t,n)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return!1!==(null==r?void 0:r.validate)&&t.z(this,e.call(t.B,t.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class D{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,t){const n=e.join(",")+String(t);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,t)),this.dashEntry[n]}getDashRanges(e,t,n){const r=[];let i=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,a=!0;r.push({left:i,right:o,isDash:a,zeroLength:0===e[0]});let s=e[0];for(let l=1;l<e.length;l++){a=!a;const t=e[l];i=s*n,s+=t,o=s*n,r.push({left:i,right:o,isDash:a,zeroLength:0===t})}return r}addRoundDash(e,t,n){const r=t/2;for(let i=-n;i<=n;i++){const t=this.width*(this.nextRow+n+i);let o=0,a=e[o];for(let s=0;s<this.width;s++){s/a.right>1&&(a=e[++o]);const l=Math.abs(s-a.left),c=Math.abs(s-a.right),u=Math.min(l,c);let h;const d=i/n*(r+1);if(a.isDash){const e=r-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=r-Math.sqrt(u*u+d*d);this.data[t+s]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e){for(let a=e.length-1;a>=0;--a){const t=e[a],n=e[a+1];t.zeroLength?e.splice(a,1):n&&n.isDash===t.isDash&&(n.left=t.left,e.splice(a,1))}const t=e[0],n=e[e.length-1];t.isDash===n.isDash&&(t.left=n.left-this.width,n.right=t.right+this.width);const r=this.width*this.nextRow;let i=0,o=e[i];for(let a=0;a<this.width;a++){a/o.right>1&&(o=e[++i]);const t=Math.abs(a-o.left),n=Math.abs(a-o.right),s=Math.min(t,n);this.data[r+a]=Math.max(0,Math.min(255,(o.isDash?s:-s)+128))}}addDash(e,n){const r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return t.w("LineAtlas out of space"),null;let o=0;for(let t=0;t<e.length;t++)o+=e[t];if(0!==o){const t=this.width/o,i=this.getDashRanges(e,this.width,t);n?this.addRoundDash(i,t,r):this.addRegularDash(i)}const a={y:this.nextRow+r,height:2*r,width:o};return this.nextRow+=i,this.dirty=!0,a}bind(e){const t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}const z="maplibre_preloaded_worker_pool";class L{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<L.workerCount;)this.workers.push(new Worker(t.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[z]}numActive(){return Object.keys(this.active).length}}const j=Math.floor(s.hardwareConcurrency/2);let O,F;function B(){return O||(O=new L),O}L.workerCount=t.J(globalThis)?Math.max(Math.min(j,3),1):1;class N{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const r=this.workerPool.acquire(n);for(let i=0;i<r.length;i++){const e=new t.K(r[i],n);e.name="Worker ".concat(i),this.actors.push(e)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,t){const n=[];for(const r of this.actors)n.push(r.sendAsync({type:e,data:t}));return Promise.all(n)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.actors.forEach(e=>{e.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,t){for(const n of this.actors)n.registerMessageHandler(e,t)}unregisterMessageHandler(e){for(const t of this.actors)t.unregisterMessageHandler(e)}}function U(){return F||(F=new N(B(),t.L),F.registerMessageHandler("GR",(e,n,r)=>t.m(n,r))),F}function V(e,n){const r=t.M();return t.N(r,r,[1,1,0]),t.O(r,r,[.5*e.width,.5*e.height,1]),e.calculatePosMatrix?t.Q(r,r,e.calculatePosMatrix(n.toUnwrapped())):r}function G(e,t,n,r,i,o,a){var s;const l=function(e,t,n){if(e)for(const r of e){const e=t[r];if(e&&e.source===n&&"fill-extrusion"===e.type)return!0}else for(const r in t){const e=t[r];if(e.source===n&&"fill-extrusion"===e.type)return!0}return!1}(null!==(s=null==i?void 0:i.layers)&&void 0!==s?s:null,t,e.id),c=o.maxPitchScaleFactor(),u=e.tilesIn(r,c,l);u.sort(q);const h=[];for(const d of u)h.push({wrappedTileID:d.tileID.wrapped().key,queryResults:d.tile.queryRenderedFeatures(t,n,e.getState(),d.queryGeometry,d.cameraQueryGeometry,d.scale,i,o,c,V(o,d.tileID),a?(e,t)=>a(d.tileID,e,t):void 0)});return function(e,t){for(const n in e)for(const r of e[n])Z(r,t);return e}(function(e){const t={},n={};for(const r of e){const e=r.queryResults,i=r.wrappedTileID,o=n[i]=n[i]||{};for(const n in e){const r=e[n],i=o[n]=o[n]||{},a=t[n]=t[n]||[];for(const e of r)i[e.featureIndex]||(i[e.featureIndex]=!0,a.push(e))}}return t}(h),e)}function q(e,t){const n=e.tileID,r=t.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}function Z(e,t){const n=e.feature,r=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}function W(e,n,r){return t._(this,void 0,void 0,function*(){let i=e;if(e.url?i=(yield t.j(n.transformRequest(e.url,"Source"),r)).data:yield s.frameAsync(r),!i)return null;const o=t.S(t.e(i,e),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in i&&i.vector_layers&&(o.vectorLayerIds=i.vector_layers.map(e=>e.id)),o})}class H{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&(4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof t.U?new t.U(e.lng,e.lat):t.U.convert(e),this}setSouthWest(e){return this._sw=e instanceof t.U?new t.U(e.lng,e.lat):t.U.convert(e),this}extend(e){const n=this._sw,r=this._ne;let i,o;if(e instanceof t.U)i=e,o=e;else{if(!(e instanceof H))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(H.convert(e)):this.extend(t.U.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(t.U.convert(e)):this;if(i=e._sw,o=e._ne,!i||!o)return this}return n||r?(n.lng=Math.min(i.lng,n.lng),n.lat=Math.min(i.lat,n.lat),r.lng=Math.max(o.lng,r.lng),r.lat=Math.max(o.lat,r.lat)):(this._sw=new t.U(i.lng,i.lat),this._ne=new t.U(o.lng,o.lat)),this}getCenter(){return new t.U((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.U(this.getWest(),this.getNorth())}getSouthEast(){return new t.U(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:r}=t.U.convert(e);let i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i}intersects(e){if((e=H.convert(e)).getNorth()<this.getSouth()||e.getSouth()>this.getNorth())return!1;const n=t.V(this.getWest(),-180,180),r=t.V(this.getEast(),-180,180),i=t.V(e.getWest(),-180,180),o=t.V(e.getEast(),-180,180),a=n>r,s=i>o;return!(!a||!s)||(a?o>=n||i<=r:s?r>=i||n<=o:!(i>r||o<n))}static convert(e){return e instanceof H?e:e?new H(e):e}static fromLngLat(e){const n=360*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/40075017,r=n/Math.cos(Math.PI/180*e.lat);return new H(new t.U(e.lng-r,e.lat-n),new t.U(e.lng+r,e.lat+n))}adjustAntiMeridian(){const e=new t.U(this._sw.lng,this._sw.lat),n=new t.U(this._ne.lng,this._ne.lat);return new H(e,e.lng>n.lng?new t.U(n.lng+360,n.lat):n)}}class X{constructor(e,t,n){this.bounds=H.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),r=Math.floor(t.X(this.bounds.getWest())*n),i=Math.floor(t.W(this.bounds.getNorth())*n),o=Math.ceil(t.X(this.bounds.getEast())*n),a=Math.ceil(t.W(this.bounds.getSouth())*n);return e.x>=r&&e.x<o&&e.y>=i&&e.y<a}}class K extends t.E{constructor(e,n,r,i){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.S(n,["url","scheme","tileSize","promoteId","encoding"])),this._options=t.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i)}load(){return t._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield W(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(t.e(this,e),e.bounds&&(this.tileBounds=new X(e.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new t.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return t.e({},this._options)}loadTile(e){return t._(this,void 0,void 0,function*(){const t=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n={request:this.map._requestManager.transformRequest(t,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};n.request.collectResourceTiming=this._collectResourceTiming;let r="RT";if(e.actor&&"expired"!==e.state){if("loading"===e.state)return new Promise((t,n)=>{e.reloadPromise={resolve:t,reject:n}})}else e.actor=this.dispatcher.getActor(),r="LT";e.abortController=new AbortController;try{const t=yield e.actor.sendAsync({type:r,data:n},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,t)}catch(t){if(delete e.abortController,e.aborted)return;if(t&&404!==t.status)throw t;this._afterTileLoadWorkerResponse(e,null)}})}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom)return;if(void 0===this.map._zoomLevelsToOverscale)return;const t=e.tileID.scaledTo(this.maxzoom).canonical,n=t.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:t,overzoomRequest:this.map._requestManager.transformRequest(n,"Tile")}}_afterTileLoadWorkerResponse(e,t){if(t&&t.resourceTiming&&(e.resourceTiming=t.resourceTiming),t&&this.map._refreshExpiredTiles&&e.setExpiryData(t),e.loadVectorData(t,this.map.painter),e.reloadPromise){const t=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(t.resolve).catch(t.reject)}}abortTile(e){return t._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return t._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Y extends t.E{constructor(e,n,r,i){super(),this.id=e,this.dispatcher=r,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},n),t.e(this,t.S(n,["url","scheme","tileSize"]))}load(){return t._(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function*(){e._loaded=!1,e.fire(new t.l("dataloading",{dataType:"source"})),e._tileJSONRequest=new AbortController;try{const r=yield W(e._options,e.map._requestManager,e._tileJSONRequest);e._tileJSONRequest=null,e._loaded=!0,r&&(t.e(e,r),r.bounds&&(e.tileBounds=new X(r.bounds,e.minzoom,e.maxzoom)),e.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:n})))}catch(n){e._tileJSONRequest=null,e._loaded=!0,e.fire(new t.k(n))}}()})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return t.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return t._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const r=yield _.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(r&&r.data){this.map._refreshExpiredTiles&&(r.cacheControl||r.expires)&&e.setExpiryData({cacheControl:r.cacheControl,expires:r.expires});const n=this.map.painter.context,i=n.gl,o=r.data;e.texture=this.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.T(n,o,i.RGBA,{useMipmap:!0}),e.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE,i.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}})}abortTile(e){return t._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return t._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class J extends Y{constructor(e,n,r,i){super(e,n,r,i),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return t._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),r=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const n=yield _.getImage(r,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(n&&n.data){const r=n.data;this.map._refreshExpiredTiles&&(n.cacheControl||n.expires)&&e.setExpiryData({cacheControl:n.cacheControl,expires:n.expires});const i=t.b(r)&&t.Y()?r:yield this.readImageNow(r),o={type:this.type,uid:e.uid,source:this.id,rawImageData:i,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||"expired"===e.state){e.actor=this.dispatcher.getActor();const t=yield e.actor.sendAsync({type:"LDT",data:o});e.dem=t,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}})}readImageNow(e){return t._(this,void 0,void 0,function*(){if("undefined"!=typeof VideoFrame&&t.Z()){const n=e.width+2,r=e.height+2;try{return new t.R({width:n,height:r},yield t.$(e,-1,-1,n,r))}catch(e){}}return s.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?e.wrap-1:e.wrap,a=(n.x+1+r)%r,s=n.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.a0(e.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},l[new t.a0(e.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(l[new t.a0(e.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},l[new t.a0(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new t.a0(e.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<r&&(l[new t.a0(e.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},l[new t.a0(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new t.a0(e.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),l}unloadTile(e){return t._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}function Q(e){return"GeometryCollection"===e.type?e.geometries.map(e=>e.coordinates).flat(1/0):e.coordinates.flat(1/0)}function $(e){const t=new H;let n;switch(e.type){case"FeatureCollection":n=e.features.map(e=>Q(e.geometry)).flat(1/0);break;case"Feature":n=Q(e.geometry);break;default:n=Q(e)}if(0==n.length)return t;for(let r=0;r<n.length-1;r+=2)t.extend([n[r],n[r+1]]);return t}class ee extends t.E{constructor(e,n,r,i){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=r.getActor(),this.setEventedParent(i),this._data=n.data,this._options=t.e({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,void 0!==n.clusterMaxZoom&&this.maxzoom<=n.clusterMaxZoom&&t.w('The maxzoom value "'.concat(this.maxzoom,'" is expected to be greater than the clusterMaxZoom value "').concat(n.clusterMaxZoom,'".')),this.workerOptions=t.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==n.buffer?n.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==n.tolerance?n.tolerance:.375),extent:t.a3,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.a3,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return void 0!==this._pendingWorkerUpdate.data||void 0!==this._pendingWorkerUpdate.diff||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(t.a3/this.tileSize)}_getClusterMaxZoom(e){const n=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||void 0===e||t.w("Integer expected for option 'clusterMaxZoom': provided value \"".concat(e,'" rounded to "').concat(n,'"')),n}load(){return t._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=t.a4(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return t._(this,void 0,void 0,function*(){const e=t.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getBounds(){return t._(this,void 0,void 0,function*(){return $(yield this.getData())})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,void 0!==e.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),void 0!==e.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,t,n){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:t,offset:n}})}_updateWorkerData(){return t._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void t.w("No pending worker updates for GeoJSONSource ".concat(this.id,"."));const{data:e,diff:n}=this._pendingWorkerUpdate,r=t.e({type:this.type},this.workerOptions);e?("string"==typeof e?(r.request=this.map._requestManager.transformRequest(s.resolveURL(e),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):n&&(r.dataDiff=n,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new t.l("dataloading",{dataType:"source"}));try{const e=yield this.actor.sendAsync({type:"LD",data:r});if(this._isUpdatingWorker=!1,this._removed||e.abandoned)return void this.fire(new t.l("dataabort",{dataType:"source"}));this._data=e.data;let i=null;e.resourceTiming&&e.resourceTiming[this.id]&&(i=e.resourceTiming[this.id].slice(0));const o={dataType:"source"};this._collectResourceTiming&&i&&i.length>0&&t.e(o,{resourceTiming:i}),this.fire(new t.l("data",Object.assign(Object.assign({},o),{sourceDataType:"metadata"}))),this.fire(new t.l("data",Object.assign(Object.assign({},o),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(n)})))}catch(e){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new t.l("dataabort",{dataType:"source"}));this.fire(new t.k(e))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_getShouldReloadTileOptions(e){if(!e||e.removeAll)return;const{add:t=[],update:n=[],remove:r=[]}=e||{},i=new Set([...n.map(e=>e.id),...r]);return{nextBounds:[...n.map(e=>e.newGeometry),...t.map(e=>e.geometry)].map(e=>$(e)),prevIds:i}}shouldReloadTile(e,n){let{nextBounds:r,prevIds:i}=n;const o=e.latestFeatureIndex.loadVTLayers();for(let t=0;t<e.latestFeatureIndex.featureIndexArray.length;t++){const n=e.latestFeatureIndex.featureIndexArray.get(t),r=o._geojsonTileLayer.feature(n.featureIndex);if(i.has(r.id))return!0}const{buffer:a,extent:s}=this.workerOptions.geojsonVtOptions,l=function(e){let{x:n,y:r,z:i}=e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=t.a1((n-o)/Math.pow(2,i)),s=t.a2((r+1+o)/Math.pow(2,i)),l=t.a1((n+1+o)/Math.pow(2,i)),c=t.a2((r-o)/Math.pow(2,i));return new H([a,s],[l,c])}(e.tileID.canonical,a/s);for(const t of r)if(l.intersects(t))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return t._(this,void 0,void 0,function*(){const t=e.actor?"RT":"LT";e.actor=this.actor;const n={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const r=yield this.actor.sendAsync({type:t,data:n},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(r,this.map.painter,"RT"===t)})}abortTile(e){return t._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return t._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return t.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class te extends t.E{constructor(e,t,n,r){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=t}load(e){return t._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const t=yield _.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,t&&t.data&&(this.image=t.data,e&&(this.coordinates=e),this._finishLoading())}catch(e){this._request=null,this._loaded=!0,this.fire(new t.k(e))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(t.a5.fromLngLat);var r;return this.tileID=function(e){const n=t.a6.fromPoints(e),r=n.width(),i=n.height(),o=Math.max(r,i),a=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),s=Math.pow(2,a);return new t.a8(a,Math.floor((n.minX+n.maxX)/2*s),Math.floor((n.minY+n.maxY)/2*s))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(e=>this.tileID.getTilePoint(e)._round()),this.flippedWindingOrder=((r=this.tileCoords)[1].x-r[0].x)*(r[2].y-r[0].y)-(r[1].y-r[0].y)*(r[2].x-r[0].x)<0,this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,n=e.gl;this.texture||(this.texture=new t.T(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return t._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:n,minY:r,maxX:i,maxY:o}=t.a6.fromPoints(e),a={};for(let s=0;s<=t.a7;s++){const e=Math.pow(2,s),t=Math.floor(n*e),l=Math.floor(r*e),c=Math.floor(i*e),u=Math.floor(o*e);a[s]={minTileX:t,minTileY:l,maxTileX:c,maxTileY:u}}return a}}class ne extends te{constructor(e,t,n,r){super(e,t,n,r),this.roundZoom=!0,this.type="video",this.options=t}load(){return t._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,"Source").url);try{const e=yield t.a9(this.urls);if(this._loaded=!0,!e)return;this.video=e,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(e){this.fire(new t.k(e))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.k(new t.aa("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(n.start(0)," and ").concat(n.end(0),"-second mark.")))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class re extends te{constructor(e,n,r,i){super(e,n,r,i),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new t.k(new t.aa("sources.".concat(e),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.k(new t.aa("sources.".concat(e),null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.k(new t.aa("sources.".concat(e),null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new t.k(new t.aa("sources.".concat(e),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.k(new t.aa("sources.".concat(e),null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){return t._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,r=n.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(n,this.canvas,r.RGBA,{premultiply:!0});let i=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,i=!0)}i&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ie={},oe=e=>{switch(e){case"geojson":return ee;case"image":return te;case"raster":return Y;case"raster-dem":return J;case"vector":return K;case"video":return ne;case"canvas":return re}return ie[e]},ae="RTLPluginLoaded";class se extends t.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=U()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(e=>{throw this.status="error",e})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return t._(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){if(t.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(t.url=s.resolveURL(e),!t.url)throw new Error("requested url ".concat(e," is invalid"));if("unavailable"===t.status){if(!n)return t._requestImport();t.status="deferred",t._syncState(t.status)}else if("requested"===t.status)return t._requestImport()}()})}_requestImport(){return t._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new t.l(ae))})}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let le=null;function ce(){return le||(le=new se),le}var ue,he;!function(e){e[e.Base=0]="Base",e[e.Parent=1]="Parent"}(ue||(ue={})),function(e){e[e.Departing=0]="Departing",e[e.Incoming=1]="Incoming"}(he||(he={}));class de{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=t.ab(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic(e){let{fadingRole:t,fadingDirection:n,fadingParentID:r,fadeEndTime:i}=e;this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=n,this.fadingParentID=r,this.fadeEndTime=i}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=c(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const r of e){const e=r.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)n[t.id]=r}}return n}(e.buckets,null==n?void 0:n.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.ad){if(this.hasSymbolBuckets=!0,!r)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.ad&&n.hasRTLText){this.hasRTLText=!0,ce().lazyLoad();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(e).queryRadius(t))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new t.ac}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const n=this.buckets[t];n.uploadPending()&&n.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new t.T(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,r,i,o,a,s,l,c,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:s,params:a,queryPadding:this.queryPadding*l,getElevation:u},e,t,n):{}}querySourceFeatures(e,n){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const i=r.loadVTLayers(),o=n&&n.sourceLayer?n.sourceLayer:"",a=i._geojsonTileLayer||i[o];if(!a)return;const s=t.ae(null==n?void 0:n.filter,null==n?void 0:n.globalState),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let d=0;d<a.length;d++){const n=a.feature(d);if(s.needGeometry){const e=t.af(n,!0);if(!s.filter(new t.G(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!s.filter(new t.G(this.tileID.overscaledZ),n))continue;const i=r.getId(n,o),p=new t.ag(n,l,c,u,i);p.tile=h,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const n=t.ah(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(n)if(this.expirationTime<n)t=!0;else{const r=this.expirationTime-n;r?this.expirationTime=e+Math.max(r,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const r in this.buckets){if(!t.style.hasLayer(r))continue;const i=this.buckets[r],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=e[o];if(!a||!s||0===Object.keys(s).length)continue;i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const l=t&&t.style&&t.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(i)))}}holdingForSymbolFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=c()+e}setDependencies(e,t){const n={};for(const r of t)n[r]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}}class pe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,r){const i=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},t.e(this.stateChanges[e][i],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==i&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][i]){this.deletedStates[e][i]={};for(const t in this.state[e][i])r[t]||(this.deletedStates[e][i][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][t]&&delete this.deletedStates[e][i][t]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(n in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][n]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,n){const r=String(n),i=t.e({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][n];if(null===t)return{};for(const e in t)delete i[e]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,n){const r={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const e={};for(const n in this.stateChanges[i])this.state[i][n]||(this.state[i][n]={}),t.e(this.state[i][n],this.stateChanges[i][n]),e[n]=this.state[i][n];r[i]=e}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const e={};if(null===this.deletedStates[i])for(const t in this.state[i])e[t]={},this.state[i][t]={};else for(const t in this.deletedStates[i]){if(null===this.deletedStates[i][t])this.state[i][t]={};else for(const e of Object.keys(this.deletedStates[i][t]))delete this.state[i][t][e];e[t]=this.state[i][t]}r[i]=r[i]||{},t.e(r[i],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const t in e)e[t].setFeatureState(r,n)}}const fe=89.25;function me(e,n){const r=t.ai(n.lat,-t.aj,t.aj);return new t.P(t.X(n.lng)*e,t.W(r)*e)}function ge(e,n){return new t.a5(n.x/e,n.y/e).toLngLat()}function _e(e){return e.cameraToCenterDistance*Math.min(.85*Math.tan(t.ak(90-e.pitch)),Math.tan(t.ak(fe-e.pitch)))}function ye(e,n){const r=e.canonical,i=n/t.al(r.z),o=r.x+Math.pow(2,r.z)*e.wrap,a=t.am(new Float64Array(16));return t.N(a,a,[o*i,r.y*i,0]),t.O(a,a,[i/t.a3,i/t.a3,1]),a}function ve(e,n,r,i,o){const a=t.a5.fromLngLat(e,n),s=o*t.an(1,e.lat),l=s*Math.cos(t.ak(r)),c=Math.sqrt(s*s-l*l),u=c*Math.sin(t.ak(-i)),h=c*Math.cos(t.ak(-i));return new t.a5(a.x+u,a.y+h,a.z+l)}function be(e,t,n){const r=t.intersectsFrustum(e);if(!n||0===r)return r;const i=t.intersectsPlane(n);return 0===i?0:2===r&&2===i?2:1}function xe(e,t,n){let r=0;const i=(n-t)/10;for(let o=0;o<10;o++)r+=i*Math.pow(Math.cos(t+(o+.5)/10*(n-t)),e);return r}function we(e,n){return function(r,i,o,a,s){const l=2*((e-1)/t.ao(Math.cos(t.ak(fe-s))/Math.cos(t.ak(fe)))-1),c=Math.acos(o/a),u=2*xe(l-1,0,t.ak(s/2)),h=Math.min(t.ak(fe),c+t.ak(s/2)),d=xe(l-1,Math.min(h,c-t.ak(s/2)),h),p=Math.atan(i/o),f=Math.hypot(i,o);let m=r;return m+=t.ao(a/f/Math.max(.5,Math.cos(t.ak(s/2)))),m+=l*t.ao(Math.cos(p))/2,m-=t.ao(Math.max(1,d/u/n))/2,m}}const Se=we(9.314,3);function Te(e,n){const r=(n.roundZoom?Math.round:Math.floor)(e.zoom+t.ao(e.tileSize/n.tileSize));return Math.max(0,r)}function Ee(e,n){const r=e.getCameraFrustum(),i=e.getClippingPlane(),o=e.screenPointToMercatorCoordinate(e.getCameraPoint()),a=t.a5.fromLngLat(e.center,e.elevation);o.z=a.z+Math.cos(e.pitchInRadians)*e.cameraToCenterDistance/e.worldSize;const s=e.getCoveringTilesDetailsProvider(),l=s.allowVariableZoom(e,n),c=Te(e,n),u=n.minzoom||0,h=void 0!==n.maxzoom?n.maxzoom:e.maxZoom,d=Math.min(Math.max(0,c),h),p=Math.pow(2,d),f=[p*o.x,p*o.y,0],m=[p*a.x,p*a.y,0],g=Math.hypot(a.x-o.x,a.y-o.y),_=Math.abs(a.z-o.z),y=Math.hypot(g,_),v=e=>({zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),b=[],x=[];if(e.renderWorldCopies&&s.allowWorldCopies())for(let t=1;t<=3;t++)b.push(v(-t)),b.push(v(t));for(b.push(v(0));b.length>0;){const p=b.pop(),g=p.x,v=p.y;let w=p.fullyVisible;const S={x:g,y:v,z:p.zoom},T=s.getTileBoundingVolume(S,p.wrap,e.elevation,n);if(!w){const e=be(r,T,i);if(0===e)continue;w=2===e}const E=s.distanceToTile2d(o.x,o.y,S,T);let k=c;l&&(k=(n.calculateTileZoom||Se)(e.zoom+t.ao(e.tileSize/n.tileSize),E,_,y,e.fov)),k=(n.roundZoom?Math.round:Math.floor)(k),k=Math.max(0,k);const P=Math.min(k,h);if(p.wrap=s.getWrap(a,S,p.wrap),p.zoom>=P){if(p.zoom<u)continue;const e=d-p.zoom,r=f[0]-.5-(g<<e),i=f[1]-.5-(v<<e),o=n.reparseOverscaled?Math.max(p.zoom,k):p.zoom;x.push({tileID:new t.a0(p.zoom===h?o:p.zoom,p.wrap,p.zoom,g,v),distanceSq:t.ap([m[0]-.5-g,m[1]-.5-v]),tileDistanceToCamera:Math.sqrt(r*r+i*i)})}else for(let e=0;e<4;e++)b.push({zoom:p.zoom+1,x:(g<<1)+e%2,y:(v<<1)+(e>>1),wrap:p.wrap,fullyVisible:w})}return x.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}const ke=t.a6.fromPoints([new t.P(0,0),new t.P(t.a3,t.a3)]);class Pe extends t.E{constructor(e,n,r){super(),this.id=e,this.dispatcher=r,this.on("data",e=>this._dataHandler(e)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((e,t,n,r)=>{const i=new(oe(t.type))(e,t,n,r);if(i.id!==e)throw new Error("Expected Source id to be ".concat(e," instead of ").concat(i.id));return i})(e,n,r,this),this._tiles={},this._cache=new t.aq(0,e=>this._unloadTile(e)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new pe,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,r){return t._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,r)}catch(n){e.state="errored",404!==n.status?this._source.fire(new t.k(n,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new t.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Ce).map(e=>e.key)}getRenderableIds(e){const n=[];for(const t in this._tiles)this._isIdRenderable(t,e)&&n.push(this._tiles[t]);return e?n.sort((e,n)=>{const r=e.tileID,i=n.tileID,o=new t.P(r.canonical.x,r.canonical.y)._rotate(-this.transform.bearingInRadians),a=new t.P(i.canonical.x,i.canonical.y)._rotate(-this.transform.bearingInRadians);return r.overscaledZ-i.overscaledZ||a.y-o.y||a.x-o.x}).map(e=>e.tileID.key):n.map(e=>e.tileID).sort(Ce).map(e=>e.key)}hasRenderableParent(e){const t=e.overscaledZ-1;if(t>=this._source.minzoom){const n=this.getLoadedTile(e.scaledTo(t));if(n)return this._isIdRenderable(n.tileID.key)}return!1}_isIdRenderable(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n;return null===(n=this._tiles[e])||void 0===n?void 0:n.isRenderable(t)}reload(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)t&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[n],t)||(e?this._reloadTile(n,"expired"):"errored"!==this._tiles[n].state&&this._reloadTile(n,"reloading"))}}_reloadTile(e,n){return t._(this,void 0,void 0,function*(){const t=this._tiles[e];t&&("loading"!==t.state&&(t.state=n),yield this._loadTile(t,e,n))})}_tileLoaded(e,n,r){e.timeAdded=c(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new t.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const i=t[r];if(e.neighboringTiles&&e.neighboringTiles[i]){const t=this.getTileByID(i);n(e,t),n(t,e)}}function n(e,t){e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,r),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t){const n=Object.values(e),r=this._getLoadedDescendents(n),i={};for(const o of n){const e=r[o.key];if(!(null==e?void 0:e.length)){i[o.key]=o;continue}const n=o.overscaledZ+Pe.maxUnderzooming,a=e.filter(e=>e.tileID.overscaledZ<=n);if(!a.length){i[o.key]=o;continue}const s=Math.min(...a.map(e=>e.tileID.overscaledZ)),l=a.filter(e=>e.tileID.overscaledZ===s).map(e=>e.tileID);for(const r of l)t[r.key]=r;this._areDescendentsComplete(l,s,o.overscaledZ)||(i[o.key]=o)}return i}_getLoadedDescendents(e){var t;const n={};for(const r in this._tiles){const i=this._tiles[r];if(i.hasData())for(const r of e)i.tileID.isChildOf(r)&&(n[t=r.key]||(n[t]=[])).push(i)}return n}_areDescendentsComplete(e,t,n){return 1===e.length&&e[0].isOverscaled()?e[0].overscaledZ===t:Math.pow(4,t-n)===e.length}getLoadedTile(e){const t=this._tiles[e.key];return(null==t?void 0:t.hasData())?t:null}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,r=Math.ceil(e.height/this._source.tileSize)+1,i=Math.floor(n*r*(null===this._maxTileCacheZoomLevels?t.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const r=this._tiles[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e,this._resetTileReloadTimers()}}update(e,n){if(!this._sourceLoaded||this._paused)return;let r;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(e=>new t.a0(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)):(r=Ee(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:"vector"===this._source.type&&void 0!==this.map._zoomLevelsToOverscale?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(r=r.filter(e=>this._source.hasTile(e)))):r=[],this.usedForTerrain&&(r=this._addTerrainIdealTiles(r));const i=0===r.length&&!this._updated&&this._didEmitContent;this._updated=!0,i&&this.fire(new t.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const o=Te(e,this._source),a=this._updateRetainedTiles(r,o),s=Ie(this._source.type);s&&this._rasterFadeDuration>0&&!n&&this._updateFadingTiles(r,a),s?this._cleanUpRasterTiles(a):this._cleanUpVectorTiles(a)}_cleanUpRasterTiles(e){for(const t in this._tiles)e[t]||this._removeTile(t)}_cleanUpVectorTiles(e){for(const t in this._tiles){const n=this._tiles[t];e[t]?n.clearSymbolFadeHold():n.hasSymbolBuckets?n.holdingForSymbolFade()?n.symbolFadeFinished()&&this._removeTile(t):n.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(t)}}_addTerrainIdealTiles(e){const t=[];for(const n of e)if(n.canonical.z>this._source.minzoom){const e=n.scaledTo(n.canonical.z-1);t.push(e);const r=n.scaledTo(Math.max(this._source.minzoom,Math.min(n.canonical.z,5)));t.push(r)}return e.concat(t)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,t){var n;const r={},i={},o=Math.max(t-Pe.maxOverzooming,this._source.minzoom);let a={};for(const s of e){const e=this._addTile(s);r[s.key]=s,e.hasData()||(a[s.key]=s)}a=this._retainLoadedChildren(a,r);for(const s in a){const e=a[s];let t=this._tiles[s],l=null==t?void 0:t.wasRequested();for(let a=e.overscaledZ-1;a>=o;--a){const o=e.scaledTo(a);if(i[o.key])break;if(i[o.key]=!0,t=this.getTile(o),!t&&l&&(t=this._addTile(o)),t){const e=t.hasData();if((e||!(null===(n=this.map)||void 0===n?void 0:n.cancelPendingTileRequestsWhileZooming)||l)&&(r[o.key]=o),l=t.wasRequested(),e)break}}}return r}_updateFadingTiles(e,n){const r=c(),i=t.ar(e);for(const t of e){const e=this._tiles[t.key];e.fadingDirection!==he.Departing&&0!==e.fadeOpacity||e.resetFadeLogic(),this._updateFadingAncestor(e,n,r)||this._updateFadingDescendents(e,n,r)||this._updateFadingEdge(e,i,r)||e.resetFadeLogic()}}_updateFadingAncestor(e,t,n){if(!e.hasData())return!1;const{tileID:r,fadingRole:i,fadingDirection:o,fadingParentID:a}=e;if(i===ue.Base&&o===he.Incoming&&a)return t[a.key]=a,!0;const s=Math.max(r.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let l=r.overscaledZ-1;l>=s;l--){const i=r.scaledTo(l),o=this.getLoadedTile(i);if(o)return e.setCrossFadeLogic({fadingRole:ue.Base,fadingDirection:he.Incoming,fadingParentID:o.tileID,fadeEndTime:n+this._rasterFadeDuration}),o.setCrossFadeLogic({fadingRole:ue.Parent,fadingDirection:he.Departing,fadeEndTime:n+this._rasterFadeDuration}),t[i.key]=i,!0}return!1}_updateFadingDescendents(e,t,n){if(!e.hasData())return!1;const r=e.tileID.children(this._source.maxzoom);let i=this._updateFadingChildren(e,r,t,n);if(i)return!0;for(const o of r){const r=o.children(this._source.maxzoom);this._updateFadingChildren(e,r,t,n)&&(i=!0)}return i}_updateFadingChildren(e,t,n,r){if(t[0].overscaledZ>=this._source.maxzoom)return!1;let i=!1;for(const o of t){const t=this.getLoadedTile(o);if(!t)continue;const{fadingRole:a,fadingDirection:s,fadingParentID:l}=t;a===ue.Base&&s===he.Departing&&l||(t.setCrossFadeLogic({fadingRole:ue.Base,fadingDirection:he.Departing,fadingParentID:e.tileID,fadeEndTime:r+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:ue.Parent,fadingDirection:he.Incoming,fadeEndTime:r+this._rasterFadeDuration})),n[o.key]=o,i=!0}return i}_updateFadingEdge(e,t,n){const r=e.tileID;return!!e.selfFading||!e.hasData()&&!!t.has(r)&&(e.setSelfFadeLogic(n+this._rasterFadeDuration),!0)}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(n.resetFadeLogic(),this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null));const r=n;return n||(n=new de(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,r||this._source.fire(new t.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,t){this._clearTileReloadTimer(e);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_clearTileReloadTimer(e){const t=this._timers[e];t&&(clearTimeout(t),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(const t in this._tiles)(this._isIdRenderable(t)||"errored"==this._tiles[t].state)&&e.some(e=>e.equals(this._tiles[t].tileID.canonical))&&this._reloadTile(t,"expired")}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}_dataHandler(e){"source"===e.dataType&&("metadata"!==e.sourceDataType?"content"===e.sourceDataType&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,r){const i=[],o=this.transform;if(!o)return i;const a=o.getCoveringTilesDetailsProvider().allowWorldCopies(),s=r?o.getCameraQueryGeometry(e):e,l=e=>o.screenPointToMercatorCoordinate(e,this.terrain),c=this.transformBbox(e,l,!a),u=this.transformBbox(s,l,!a),h=this.getIds(),d=t.a6.fromPoints(u);for(let p=0;p<h.length;p++){const e=this._tiles[h[p]];if(e.holdingForSymbolFade())continue;const r=a?[e.tileID]:[e.tileID.unwrapTo(-1),e.tileID.unwrapTo(0)],s=Math.pow(2,o.zoom-e.tileID.overscaledZ),l=n*e.queryPadding*t.a3/e.tileSize/s;for(const n of r){const r=d.map(e=>n.getTilePoint(new t.a5(e.x,e.y)));if(r.expandBy(l),r.intersects(ke)){const t=c.map(e=>n.getTilePoint(e)),r=u.map(e=>n.getTilePoint(e));i.push({tile:e,tileID:a?n:n.unwrapTo(0),queryGeometry:t,cameraQueryGeometry:r,scale:s})}}}return i}transformBbox(e,n,r){let i=e.map(n);if(r){const r=t.a6.fromPoints(e);r.shrinkBy(.001*Math.min(r.width(),r.height()));const o=r.map(n);t.a6.fromPoints(i).covers(o)||(i=i.map(e=>e.x>.5?new t.a5(e.x-1,e.y,e.z):e))}return i}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(e=>this._tiles[e].tileID);return this.transform&&this.transform.populateCache(t),t}hasTransition(){if(this._source.hasTransition())return!0;if(Ie(this._source.type)&&this._rasterFadeDuration>0){const e=c();for(const t in this._tiles)if(this._tiles[t].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const r=this._tiles[e];r&&r.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}}function Ce(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Ie(e){return"raster"===e||"image"===e||"video"===e}Pe.maxOverzooming=10,Pe.maxUnderzooming=3;class Ae{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.ai(e,0,1);let n=1,r=this._distances[n];const i=e*this.paddedLength+this.padding;for(;r<i&&n<this._distances.length;)r=this._distances[++n];const o=n-1,a=this._distances[o],s=r-a,l=s>0?(i-a)/s:0;return this.points[o].mult(1-l).add(this.points[n].mult(l))}}function Me(e,t){let n=!0;return"always"===e||"never"!==e&&"never"!==t||(n=!1),n}class Re{constructor(e,t,n){const r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}insertCircle(e,t,n,r){this._forEachCell(t-r,n-r,t+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(r)}_insertBoxCell(e,t,n,r,i,o){this.boxCells[i].push(o)}_insertCircleCell(e,t,n,r,i,o){this.circleCells[i].push(o)}_query(e,t,n,r,i,o,a){if(n<0||e>this.width||r<0||t>this.height)return[];const s=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return[{key:null,x1:e,y1:t,x2:n,y2:r}];for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],r=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-r,y1:n-r,x2:t+r,y2:n+r})}}else this._forEachCell(e,t,n,r,this._queryCell,s,{hitTest:i,overlapMode:o,seenUids:{box:{},circle:{}}},a);return s}query(e,t,n,r){return this._query(e,t,n,r,!1,null)}hitTest(e,t,n,r,i,o){return this._query(e,t,n,r,!0,i,o).length>0}hitTestCircle(e,t,n,r,i){const o=e-n,a=e+n,s=t-n,l=t+n;if(a<0||o>this.width||l<0||s>this.height)return!1;const c=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:r,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},i),c.length>0}_queryCell(e,t,n,r,i,o,a,s){const{seenUids:l,hitTest:c,overlapMode:u}=a,h=this.boxCells[i];if(null!==h){const i=this.bboxes;for(const a of h)if(!l.box[a]){l.box[a]=!0;const h=4*a,d=this.boxKeys[a];if(e<=i[h+2]&&t<=i[h+3]&&n>=i[h+0]&&r>=i[h+1]&&(!s||s(d))&&(!c||!Me(u,d.overlapMode))&&(o.push({key:d,x1:i[h],y1:i[h+1],x2:i[h+2],y2:i[h+3]}),c))return!0}}const d=this.circleCells[i];if(null!==d){const i=this.circles;for(const a of d)if(!l.circle[a]){l.circle[a]=!0;const h=3*a,d=this.circleKeys[a];if(this._circleAndRectCollide(i[h],i[h+1],i[h+2],e,t,n,r)&&(!s||s(d))&&(!c||!Me(u,d.overlapMode))){const e=i[h],t=i[h+1],n=i[h+2];if(o.push({key:d,x1:e-n,y1:t-n,x2:e+n,y2:t+n}),c)return!0}}}return!1}_queryCellCircle(e,t,n,r,i,o,a,s){const{circle:l,seenUids:c,overlapMode:u}=a,h=this.boxCells[i];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const n=4*t,r=this.boxKeys[t];if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!s||s(r))&&!Me(u,r.overlapMode))return o.push(!0),!0}}const d=this.circleCells[i];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const n=3*t,r=this.circleKeys[t];if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!s||s(r))&&!Me(u,r.overlapMode))return o.push(!0),!0}}}_forEachCell(e,t,n,r,i,o,a,s){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(i.call(this,e,t,n,r,this.xCellCount*l+d,o,a,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,r,i,o){const a=r-e,s=i-t,l=n+o;return l*l>a*a+s*s}_circleAndRectCollide(e,t,n,r,i,o,a){const s=(o-r)/2,l=Math.abs(e-(r+s));if(l>s+n)return!1;const c=(a-i)/2,u=Math.abs(t-(i+c));if(u>c+n)return!1;if(l<=s||u<=c)return!0;const h=l-s,d=u-c;return h*h+d*d<=n*n}}function De(e,n,i){const o=t.M();if(!e){const{vecSouth:e,vecEast:t}=Le(n),i=r();i[0]=t[0],i[1]=t[1],i[2]=e[0],i[3]=e[1],a=i,(d=(l=(s=i)[0])*(h=s[3])-(u=s[2])*(c=s[1]))&&(a[0]=h*(d=1/d),a[1]=-c*d,a[2]=-u*d,a[3]=l*d),o[0]=i[0],o[1]=i[1],o[4]=i[2],o[5]=i[3]}var a,s,l,c,u,h,d;return t.O(o,o,[1/i,1/i,1]),o}function ze(e,n,r,i){if(e){const e=t.M();if(!n){const{vecSouth:t,vecEast:n}=Le(r);e[0]=n[0],e[1]=n[1],e[4]=t[0],e[5]=t[1]}return t.O(e,e,[i,i,1]),e}return r.pixelsToClipSpaceMatrix}function Le(e){const n=Math.cos(e.rollInRadians),r=Math.sin(e.rollInRadians),i=Math.cos(e.pitchInRadians),o=Math.cos(e.bearingInRadians),a=Math.sin(e.bearingInRadians),s=t.aw();s[0]=-o*i*r-a*n,s[1]=-a*i*r+o*n;const l=t.ax(s);l<1e-9?t.ay(s):t.az(s,s,1/l);const c=t.aw();c[0]=o*i*n-a*r,c[1]=a*i*n+o*r;const u=t.ax(c);return u<1e-9?t.ay(c):t.az(c,c,1/u),{vecEast:c,vecSouth:s}}function je(e,n,r,i){let o;i?(o=[e,n,i(e,n),1],t.aB(o,o,r)):(o=[e,n,0,1],$e(o,o,r));const a=o[3];return{point:new t.P(o[0]/a,o[1]/a),signedDistanceFromCamera:a,isOccluded:!1}}function Oe(e,t){return.5+e/t*.5}function Fe(e,t){return e.x>=-t[0]&&e.x<=t[0]&&e.y>=-t[1]&&e.y<=t[1]}function Be(e,n,r,i,o,a,s,l,c,u,h,d,p){const f=r?e.textSizeData:e.iconSizeData,m=t.as(f,n.transform.zoom),g=[256/n.width*2+1,256/n.height*2+1],_=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;_.clear();const y=e.lineVertexArray,v=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,b=n.transform.width/n.transform.height;let x=!1;for(let w=0;w<v.length;w++){const r=v.get(w);if(r.hidden||r.writingMode===t.at.vertical&&!x){Qe(r.numGlyphs,_);continue}x=!1;const S=new t.P(r.anchorX,r.anchorY),T={getElevation:p,pitchedLabelPlaneMatrix:i,lineVertexArray:y,pitchWithMap:a,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:S,unwrappedTileID:c,width:u,height:h,translation:d},E=He(r.anchorX,r.anchorY,T);if(!Fe(E.point,g)){Qe(r.numGlyphs,_);continue}const k=Oe(n.transform.cameraToCenterDistance,E.signedDistanceFromCamera),P=t.au(f,m,r),C=a?P*n.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,c)/k:P*k,I=Ve({projectionContext:T,pitchedLabelPlaneMatrixInverse:o,symbol:r,fontSize:C,flip:!1,keepUpright:s,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:_,aspectRatio:b,rotateToLine:l});x=I.useVertical,(I.notEnoughRoom||x||I.needsFlipping&&Ve({projectionContext:T,pitchedLabelPlaneMatrixInverse:o,symbol:r,fontSize:C,flip:!0,keepUpright:s,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:_,aspectRatio:b,rotateToLine:l}).notEnoughRoom)&&Qe(r.numGlyphs,_)}r?e.text.dynamicLayoutVertexBuffer.updateData(_):e.icon.dynamicLayoutVertexBuffer.updateData(_)}function Ne(e,t,n,r,i,o,a,s){const l=o.glyphStartIndex+o.numGlyphs,c=o.lineStartIndex,u=o.lineStartIndex+o.lineLength,h=t.getoffsetX(o.glyphStartIndex),d=t.getoffsetX(l-1),p=Ye(e*h,n,r,i,o.segment,c,u,s,a);if(!p)return null;const f=Ye(e*d,n,r,i,o.segment,c,u,s,a);return f?s.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function Ue(e,n,r,i){return e===t.at.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(e===t.at.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function Ve(e){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:r,symbol:i,fontSize:o,flip:a,keepUpright:s,glyphOffsetArray:l,dynamicLayoutVertexArray:c,aspectRatio:u,rotateToLine:h}=e,d=o/24,p=i.lineOffsetX*d,f=i.lineOffsetY*d;let m;if(i.numGlyphs>1){const e=i.glyphStartIndex+i.numGlyphs,t=i.lineStartIndex,o=i.lineStartIndex+i.lineLength,c=Ne(d,l,p,f,a,i,h,n);if(!c)return{notEnoughRoom:!0};const g=We(c.first.point.x,c.first.point.y,n,r),_=We(c.last.point.x,c.last.point.y,n,r);if(s&&!a){const e=Ue(i.writingMode,g,_,u);if(e)return e}m=[c.first];for(let r=i.glyphStartIndex+1;r<e-1;r++){const e=Ye(d*l.getoffsetX(r),p,f,a,i.segment,t,o,n,h);if(!e)return{notEnoughRoom:!0};m.push(e)}m.push(c.last)}else{if(s&&!a){const e=Ze(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,o=i.lineStartIndex+i.segment+1,a=new t.P(n.lineVertexArray.getx(o),n.lineVertexArray.gety(o)),s=Ze(a.x,a.y,n),l=s.signedDistanceFromCamera>0?s.point:Ge(n.tileAnchorPoint,a,e,1,n),c=We(e.x,e.y,n,r),h=We(l.x,l.y,n,r),d=Ue(i.writingMode,c,h,u);if(d)return d}const e=Ye(d*l.getoffsetX(i.glyphStartIndex),p,f,a,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,n,h);if(!e||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};m=[e]}for(const g of m)t.aA(c,g.point,g.angle);return{}}function Ge(e,t,n,r,i){const o=e.add(e.sub(t)._unit()),a=Ze(o.x,o.y,i).point,s=n.sub(a);return n.add(s._mult(r/s.mag()))}function qe(e,n,r){const i=n.projectionCache;if(i.projections[e])return i.projections[e];const o=new t.P(n.lineVertexArray.getx(e),n.lineVertexArray.gety(e)),a=Ze(o.x,o.y,n);if(a.signedDistanceFromCamera>0)return i.projections[e]=a.point,i.anyProjectionOccluded=i.anyProjectionOccluded||a.isOccluded,a.point;const s=e-r.direction;return Ge(0===r.distanceFromAnchor?n.tileAnchorPoint:new t.P(n.lineVertexArray.getx(s),n.lineVertexArray.gety(s)),o,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,n)}function Ze(e,t,n){const r=e+n.translation[0],i=t+n.translation[1];let o;return n.pitchWithMap?(o=je(r,i,n.pitchedLabelPlaneMatrix,n.getElevation),o.isOccluded=!1):(o=n.transform.projectTileCoordinates(r,i,n.unwrappedTileID,n.getElevation),o.point.x=(.5*o.point.x+.5)*n.width,o.point.y=(.5*-o.point.y+.5)*n.height),o}function We(e,n,r,i){if(r.pitchWithMap){const o=[e,n,0,1];return t.aB(o,o,i),r.transform.projectTileCoordinates(o[0]/o[3],o[1]/o[3],r.unwrappedTileID,r.getElevation).point}return{x:e/r.width*2-1,y:1-n/r.height*2}}function He(e,t,n){return n.transform.projectTileCoordinates(e,t,n.unwrappedTileID,n.getElevation)}function Xe(e,t,n){return e._unit()._perp()._mult(t*n)}function Ke(e,n,r,i,o,a,s,l,c){if(l.projectionCache.offsets[e])return l.projectionCache.offsets[e];const u=r.add(n);if(e+c.direction<i||e+c.direction>=o)return l.projectionCache.offsets[e]=u,u;const h=qe(e+c.direction,l,c),d=Xe(h.sub(r),s,c.direction),p=r.add(d),f=h.add(d);return l.projectionCache.offsets[e]=t.aC(a,u,p,f)||u,l.projectionCache.offsets[e]}function Ye(e,t,n,r,i,o,a,s,l){const c=r?e-t:e+t;let u=c>0?1:-1,h=0;r&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?o+i:o+i+1;s.projectionCache.cachedAnchorPoint?d=s.projectionCache.cachedAnchorPoint:(d=Ze(s.tileAnchorPoint.x,s.tileAnchorPoint.y,s).point,s.projectionCache.cachedAnchorPoint=d);let f,m,g=d,_=d,y=0,v=0;const b=Math.abs(c),x=[];let w;for(;y+v<=b;){if(p+=u,p<o||p>=a)return null;y+=v,_=g,m=f;const e={absOffsetX:b,direction:u,distanceFromAnchor:y,previousVertex:_};if(g=qe(p,s,e),0===n)x.push(_),w=g.sub(_);else{let t;const r=g.sub(_);t=0===r.mag()?Xe(qe(p+u,s,e).sub(g),n,u):Xe(r,n,u),m||(m=_.add(t)),f=Ke(p,t,g,o,a,m,n,s,e),x.push(m),w=f.sub(m)}v=w.mag()}const S=w._mult((b-y)/v)._add(m||_),T=h+Math.atan2(g.y-_.y,g.x-_.x);return x.push(S),{point:S,angle:l?T:0,path:x}}const Je=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qe(e,t){for(let n=0;n<e;n++){const e=t.length;t.resize(e+4),t.float32.set(Je,3*e)}}function $e(e,t,n){const r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e[3]=n[3]*r+n[7]*i+n[15],e}const et=100;class tt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Re(e.width+200,e.height+200,25),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Re(e.width+200,e.height+200,25);this.transform=e,this.grid=t,this.ignoredGrid=n,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+et,this.screenBottomBoundary=e.height+et,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,t,n,r,i,o,a,s,l,c,u,h){const d=this.projectAndGetPerspectiveRatio(e.anchorPointX+s[0],e.anchorPointY+s[1],i,c,h),p=n*d.perspectiveRatio;let f;if(o||a)f=this._projectCollisionBox(e,p,r,i,o,a,s,d,c,u,h);else{const t=d.x+(u?u.x*p:0),n=d.y+(u?u.y*p:0);f={allPointsOccluded:!1,box:[t+e.x1*p,n+e.y1*p,t+e.x2*p,n+e.y2*p]}}const[m,g,_,y]=f.box,v=o?f.allPointsOccluded:d.isOccluded;let b=v;return b||(b=d.perspectiveRatio<this.perspectiveRatioCutoff),b||(b=!this.isInsideGrid(m,g,_,y)),b||"always"!==t&&this.grid.hitTest(m,g,_,y,t,l)?{box:[m,g,_,y],placeable:!1,offscreen:!1,occluded:v}:{box:[m,g,_,y],placeable:!0,offscreen:this.isOffscreen(m,g,_,y),occluded:v}}placeCollisionCircles(e,n,r,i,o,a,s,l,c,u,h,d,p,f){const m=[],g=new t.P(n.anchorX,n.anchorY),_=this.getPerspectiveRatio(g.x,g.y,a,f),y=(c?o*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,a)/_:o*_)/t.aG,v={getElevation:f,pitchedLabelPlaneMatrix:s,lineVertexArray:r,pitchWithMap:c,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:g,unwrappedTileID:a,width:this.transform.width,height:this.transform.height,translation:p},b=Ne(y,i,n.lineOffsetX*y,n.lineOffsetY*y,!1,n,!1,v);let x=!1,w=!1,S=!0;if(b){const n=.5*h*_+d,r=new t.P(-100,-100),i=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new Ae,a=b.first,s=b.last;let p=[];for(let e=a.path.length-1;e>=1;e--)p.push(a.path[e]);for(let e=1;e<s.path.length;e++)p.push(s.path[e]);const f=2.5*n;if(c){const e=this.projectPathToScreenSpace(p,v);p=e.some(e=>e.signedDistanceFromCamera<=0)?[]:e.map(e=>e.point)}let g=[];if(p.length>0){const e=p[0].clone(),n=p[0].clone();for(let t=1;t<p.length;t++)e.x=Math.min(e.x,p[t].x),e.y=Math.min(e.y,p[t].y),n.x=Math.max(n.x,p[t].x),n.y=Math.max(n.y,p[t].y);g=e.x>=r.x&&n.x<=i.x&&e.y>=r.y&&n.y<=i.y?[p]:n.x<r.x||e.x>i.x||n.y<r.y||e.y>i.y?[]:t.aD([p],r.x,r.y,i.x,i.y)}for(const t of g){o.reset(t,.25*n);let r=0;r=o.length<=.5*n?1:Math.ceil(o.paddedLength/f)+1;for(let t=0;t<r;t++){const i=t/Math.max(r-1,1),a=o.lerp(i),s=a.x+et,c=a.y+et;m.push(s,c,n,0);const h=s-n,d=c-n,p=s+n,f=c+n;if(S=S&&this.isOffscreen(h,d,p,f),w=w||this.isInsideGrid(h,d,p,f),"always"!==e&&this.grid.hitTestCircle(s,c,n,e,u)&&(x=!0,!l))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!l&&x||!w||_<this.perspectiveRatioCutoff?[]:m,offscreen:S,collisionDetected:x}}projectPathToScreenSpace(e,n){const r=function(e,n){const r=t.M();return t.av(r,n.pitchedLabelPlaneMatrix),e.map(e=>{const t=je(e.x,e.y,r,n.getElevation),i=n.transform.projectTileCoordinates(t.point.x,t.point.y,n.unwrappedTileID,n.getElevation);return i.point.x=(.5*i.point.x+.5)*n.width,i.point.y=(.5*-i.point.y+.5)*n.height,i})}(e,n);return function(e){let t=0,n=0,r=0,i=0;for(let o=0;o<e.length;o++)e[o].isOccluded?(r=o+1,i=0):(i++,i>n&&(n=i,t=r));return e.slice(t,t+n)}(r)}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[],r=new t.a6;for(const h of e){const e=new t.P(h.x+et,h.y+et);r.extend(e),n.push(e)}const{minX:i,minY:o,maxX:a,maxY:s}=r,l=this.grid.query(i,o,a,s).concat(this.ignoredGrid.query(i,o,a,s)),c={},u={};for(const h of l){const e=h.key;if(void 0===c[e.bucketInstanceId]&&(c[e.bucketInstanceId]={}),c[e.bucketInstanceId][e.featureIndex])continue;const r=[new t.P(h.x1,h.y1),new t.P(h.x2,h.y1),new t.P(h.x2,h.y2),new t.P(h.x1,h.y2)];t.aE(n,r)&&(c[e.bucketInstanceId][e.featureIndex]=!0,void 0===u[e.bucketInstanceId]&&(u[e.bucketInstanceId]=[]),u[e.bucketInstanceId].push(e.featureIndex))}return u}insertCollisionBox(e,t,n,r,i,o){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:i,collisionGroupID:o,overlapMode:t},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,r,i,o){const a=n?this.ignoredGrid:this.grid,s={bucketInstanceId:r,featureIndex:i,collisionGroupID:o,overlapMode:t};for(let l=0;l<e.length;l+=4)a.insertCircle(s,e[l],e[l+1],e[l+2])}projectAndGetPerspectiveRatio(e,n,r,i,o){if(o){let r;i?(r=[e,n,i(e,n),1],t.aB(r,r,o)):(r=[e,n,0,1],$e(r,r,o));const a=r[3];return{x:(r[0]/a+1)/2*this.transform.width+et,y:(-r[1]/a+1)/2*this.transform.height+et,perspectiveRatio:.5+this.transform.cameraToCenterDistance/a*.5,isOccluded:!1,signedDistanceFromCamera:a}}{const t=this.transform.projectTileCoordinates(e,n,r,i);return{x:(t.point.x+1)/2*this.transform.width+et,y:(1-t.point.y)/2*this.transform.height+et,perspectiveRatio:.5+this.transform.cameraToCenterDistance/t.signedDistanceFromCamera*.5,isOccluded:t.isOccluded,signedDistanceFromCamera:t.signedDistanceFromCamera}}}getPerspectiveRatio(e,t,n,r){const i=this.transform.projectTileCoordinates(e,t,n,r);return.5+this.transform.cameraToCenterDistance/i.signedDistanceFromCamera*.5}isOffscreen(e,t,n,r){return n<et||e>=this.screenRightBoundary||r<et||t>this.screenBottomBoundary}isInsideGrid(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=t.am([]);return t.N(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,r,i,o,a,s,l,c,u,h){let d=1,p=0,f=0,m=1;const g=e.anchorPointX+s[0],_=e.anchorPointY+s[1];if(a&&!o){const e=this.projectAndGetPerspectiveRatio(g+1,_,i,c,h),t=e.x-l.x,n=Math.atan((e.y-l.y)/t)+(t<0?Math.PI:0),r=Math.sin(n),o=Math.cos(n);d=o,p=r,f=-r,m=o}else if(!a&&o){const e=Le(this.transform);d=e.vecEast[0],p=e.vecEast[1],f=e.vecSouth[0],m=e.vecSouth[1]}let y=l.x,v=l.y,b=n;o&&(y=g,v=_,b=Math.pow(2,-(this.transform.zoom-r.overscaledZ)),b*=this.transform.getPitchedTextCorrection(g,_,i),u||(b*=t.ai(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),u&&(y+=d*u.x*b+f*u.y*b,v+=p*u.x*b+m*u.y*b);const x=e.x1*b,w=e.x2*b,S=(x+w)/2,T=e.y1*b,E=e.y2*b,k=(T+E)/2,P=[{offsetX:x,offsetY:T},{offsetX:S,offsetY:T},{offsetX:w,offsetY:T},{offsetX:w,offsetY:k},{offsetX:w,offsetY:E},{offsetX:S,offsetY:E},{offsetX:x,offsetY:E},{offsetX:x,offsetY:k}];let C=[];for(const{offsetX:A,offsetY:M}of P)C.push(new t.P(y+d*A+f*M,v+p*A+m*M));let I=!1;if(o){const e=C.map(e=>this.projectAndGetPerspectiveRatio(e.x,e.y,i,c,h));I=e.some(e=>!e.isOccluded),C=e.map(e=>new t.P(e.x,e.y))}else I=!0;return{box:t.aF(C),allPointsOccluded:!I}}}class nt{constructor(e,t,n,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class rt{constructor(e,t,n,r,i){this.text=new nt(e?e.text:null,t,n,i),this.icon=new nt(e?e.icon:null,t,r,i)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class it{constructor(e,t,n){this.text=e,this.icon=t,this.skipFade=n}}class ot{constructor(e,t,n,r,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i}}class at{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function st(e,n,r,i,o){const{horizontalAlign:a,verticalAlign:s}=t.aM(e);return new t.P(-(a-.5)*n+i[0]*o,-(s-.5)*r+i[1]*o)}class lt{constructor(e,t,n,r,i){this.transform=e.clone(),this.terrain=t,this.collisionIndex=new tt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new at(r),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const t=this.terrain;return t?(n,r)=>t.getElevation(e,n,r):null}getBucketParts(e,n,r,i){const o=r.getBucket(n),a=r.latestFeatureIndex;if(!o||!a||n.id!==o.layerIds[0])return;const s=r.collisionBoxArray,l=o.layers[0].layout,c=o.layers[0].paint,u=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),h=r.tileSize/t.a3,d=r.tileID.toUnwrapped(),p="map"===l.get("text-rotation-alignment"),f=t.aH(r,1,this.transform.zoom),m=t.aI(this.collisionIndex.transform,r,c.get("text-translate"),c.get("text-translate-anchor")),g=t.aI(this.collisionIndex.transform,r,c.get("icon-translate"),c.get("icon-translate-anchor")),_=De(p,this.transform,f);this.retainedQueryData[o.bucketInstanceId]=new ot(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);const y={bucket:o,layout:l,translationText:m,translationIcon:g,unwrappedTileID:d,pitchedLabelPlaneMatrix:_,scale:u,textPixelRatio:h,holdingForFade:r.holdingForSymbolFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.as(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(const t of o.sortKeyRanges){const{sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i}=t;e.push({sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:y})}attemptAnchorPlacement(e,n,r,i,o,a,s,l,c,u,h,d,p,f,m,g,_,y,v,b){const x=t.aJ[e.textAnchor],w=[e.textOffset0,e.textOffset1],S=st(x,r,i,w,o),T=this.collisionIndex.placeCollisionBox(n,d,l,c,u,s,a,g,h.predicate,v,S,b);if((!y||this.collisionIndex.placeCollisionBox(y,d,l,c,u,s,a,_,h.predicate,v,S,b).placeable)&&T.placeable){let e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(e=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:w,width:r,height:i,anchor:x,textBoxScale:o,prevAnchor:e},this.markUsedJustification(f,x,p,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,p),this.placedOrientations[p.crossTileID]=m),{shift:S,placedGlyphBoxes:T}}}placeLayerBucketPart(e,n,r){const{bucket:i,layout:o,translationText:a,translationIcon:s,unwrappedTileID:l,pitchedLabelPlaneMatrix:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,collisionGroup:f}=e.parameters,m=o.get("text-optional"),g=o.get("icon-optional"),_=t.aK(o,"text-overlap","text-allow-overlap"),y="always"===_,v=t.aK(o,"icon-overlap","icon-allow-overlap"),b="always"===v,x="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),S="none"!==o.get("icon-text-fit"),T="viewport-y"===o.get("symbol-z-order"),E=y&&(b||!i.hasIconData()||g),k=b&&(y||!i.hasTextData()||m);!i.collisionArrays&&d&&i.deserializeCollisionBoxes(d);const P=this.retainedQueryData[i.bucketInstanceId].tileID,C=this._getTerrainElevationFunc(P),I=this.transform.getFastPathSimpleProjectionMatrix(P),A=(e,d,b)=>{var T,A;if(n[e.crossTileID])return;if(h)return void(this.placements[e.crossTileID]=new it(!1,!1,!1));let M=!1,R=!1,D=!0,z=null,L={box:null,placeable:!1,offscreen:null,occluded:!1},j={placeable:!1},O=null,F=null,B=null,N=0,U=0,V=0;d.textFeatureIndex?N=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(N=e.featureIndex),d.verticalTextFeatureIndex&&(U=d.verticalTextFeatureIndex);const G=d.textBox;if(G){const n=n=>{let r=t.at.horizontal;if(i.allowVerticalPlacement&&!n&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,r=t,this.markUsedOrientation(i,r,e))}return r},o=(n,r)=>{if(i.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const e of i.writingModes)if(e===t.at.vertical?(L=r(),j=L):L=n(),L&&L.placeable)break}else L=n()},c=e.textAnchorOffsetStartIndex,h=e.textAnchorOffsetEndIndex;if(h===c){const r=(t,n)=>{const r=this.collisionIndex.placeCollisionBox(t,_,u,P,l,w,x,a,f.predicate,C,void 0,I);return r&&r.placeable&&(this.markUsedOrientation(i,n,e),this.placedOrientations[e.crossTileID]=n),r};o(()=>r(G,t.at.horizontal),()=>{const n=d.verticalTextBox;return i.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?r(n,t.at.vertical):{box:null,offscreen:null}}),n(L&&L.placeable)}else{let p=t.aJ[null===(A=null===(T=this.prevPlacement)||void 0===T?void 0:T.variableOffsets[e.crossTileID])||void 0===A?void 0:A.anchor];const m=(t,n,o)=>{const d=t.x2-t.x1,m=t.y2-t.y1,g=e.textBoxScale,y=S&&"never"===v?n:null;let b=null,T="never"===_?1:2,E="never";p&&T++;for(let r=0;r<T;r++){for(let n=c;n<h;n++){const r=i.textAnchorOffsets.get(n);if(p&&r.textAnchor!==p)continue;const c=this.attemptAnchorPlacement(r,t,d,m,g,x,w,u,P,l,f,E,e,i,o,a,s,y,C);if(c&&(b=c.placedGlyphBoxes,b&&b.placeable))return M=!0,z=c.shift,b}p?p=null:E=_}return r&&!b&&(b={box:this.collisionIndex.placeCollisionBox(G,"always",u,P,l,w,x,a,f.predicate,C,void 0,I).box,offscreen:!1,placeable:!1,occluded:!1}),b};o(()=>m(G,d.iconBox,t.at.horizontal),()=>{const n=d.verticalTextBox;return i.allowVerticalPlacement&&(!L||!L.placeable)&&e.numVerticalGlyphVertices>0&&n?m(n,d.verticalIconBox,t.at.vertical):{box:null,occluded:!0,offscreen:null}}),L&&(M=L.placeable,D=L.offscreen);const g=n(L&&L.placeable);if(!M&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(i,t.anchor,e,g))}}}if(O=L,M=O&&O.placeable,D=O&&O.offscreen,e.useRuntimeCollisionCircles&&e.centerJustifiedTextSymbolIndex>=0){const n=i.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),s=t.au(i.textSizeData,p,n),u=o.get("text-padding");F=this.collisionIndex.placeCollisionCircles(_,n,i.lineVertexArray,i.glyphOffsetArray,s,l,c,r,w,f.predicate,e.collisionCircleDiameter,u,a,C),F.circles.length&&F.collisionDetected&&!r&&t.w("Collisions detected, but collision boxes are not shown"),M=y||F.circles.length>0&&!F.collisionDetected,D=D&&F.offscreen}if(d.iconFeatureIndex&&(V=d.iconFeatureIndex),d.iconBox){const e=e=>this.collisionIndex.placeCollisionBox(e,v,u,P,l,w,x,s,f.predicate,C,S&&z?z:void 0,I);j&&j.placeable&&d.verticalIconBox?(B=e(d.verticalIconBox),R=B.placeable):(B=e(d.iconBox),R=B.placeable),D=D&&B.offscreen}const q=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,Z=g||0===e.numIconVertices;q||Z?Z?q||(R=R&&M):M=R&&M:R=M=R&&M;const W=R&&B.placeable;if(M&&O.placeable&&this.collisionIndex.insertCollisionBox(O.box,_,o.get("text-ignore-placement"),i.bucketInstanceId,j&&j.placeable&&U?U:N,f.ID),W&&this.collisionIndex.insertCollisionBox(B.box,v,o.get("icon-ignore-placement"),i.bucketInstanceId,V,f.ID),F&&M&&this.collisionIndex.insertCollisionCircles(F.circles,_,o.get("text-ignore-placement"),i.bucketInstanceId,N,f.ID),r&&this.storeCollisionData(i.bucketInstanceId,b,d,O,B,F),0===e.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===i.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[e.crossTileID]=new it((M||E)&&!(null==O?void 0:O.occluded),(R||k)&&!(null==B?void 0:B.occluded),D||i.justReloaded),n[e.crossTileID]=!0};if(T){if(0!==e.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const t=i.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let e=t.length-1;e>=0;--e){const n=t[e];A(i.symbolInstances.get(n),i.collisionArrays[n],n)}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)A(i.symbolInstances.get(t),i.collisionArrays[t],t);i.justReloaded=!1}storeCollisionData(e,t,n,r,i,o){if(n.textBox||n.iconBox){let o,a;this.collisionBoxArrays.has(e)?o=this.collisionBoxArrays.get(e):(o=new Map,this.collisionBoxArrays.set(e,o)),o.has(t)?a=o.get(t):(a={text:null,icon:null},o.set(t,a)),n.textBox&&(a.text=r.box),n.iconBox&&(a.icon=i.box)}if(o){let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=[]);for(let e=0;e<o.circles.length;e+=4)t.push(o.circles[e+0]-et),t.push(o.circles[e+1]-et),t.push(o.circles[e+2]),t.push(o.collisionDetected?1:0)}}markUsedJustification(e,n,r,i){let o;o=i===t.at.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.aL(n)];const a=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const t of a)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:r.crossTileID)}markUsedOrientation(e,n,r){const i=n===t.at.horizontal||n===t.at.horizontalOnly?n:0,o=n===t.at.vertical?n:0,a=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const t of a)e.text.placedSymbolArray.get(t).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},o=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(const s in this.placements){const e=this.placements[s],t=i[s];t?(this.opacities[s]=new rt(t,r,e.text,e.icon),n=n||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[s]=new rt(null,r,e.text,e.icon,e.skipFade),n=n||e.text||e.icon)}for(const s in i){const e=i[s];if(!this.opacities[s]){const t=new rt(e,r,!1,!1);t.isHidden()||(this.opacities[s]=t,n=n||e.text.placed||e.icon.placed)}}for(const s in o)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=o[s]);for(const s in a)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=a[s]);if(t&&void 0===t.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n={};for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,r.tileID,n,r.collisionBoxArray)}}updateBucketOpacities(e,n,r,i){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const o=e.layers[0],a=o.layout,s=new rt(null,0,!1,!1,!0),l=a.get("text-allow-overlap"),c=a.get("icon-allow-overlap"),u=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===a.get("text-rotation-alignment"),d="map"===a.get("text-pitch-alignment"),p="none"!==a.get("icon-text-fit"),f=new rt(null,0,l&&(c||!e.hasIconData()||a.get("icon-optional")),c&&(l||!e.hasTextData()||a.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);const m=(e,t,n)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(n);e.hasVisibleVertices=e.hasVisibleVertices||n!==yt},g=this.collisionBoxArrays.get(e.bucketInstanceId);for(let _=0;_<e.symbolInstances.length;_++){const n=e.symbolInstances.get(_),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:o,crossTileID:a}=n;let l=this.opacities[a];r[a]?l=s:l||(l=f,this.opacities[a]=l),r[a]=!0;const c=n.numIconVertices>0,y=this.placedOrientations[n.crossTileID],v=y===t.at.vertical,b=y===t.at.horizontal||y===t.at.horizontalOnly;if(i>0||o>0){const t=_t(l.text);m(e.text,i,v?yt:t),m(e.text,o,b?yt:t);const r=l.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=r||v?1:0)}),n.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=r||b?1:0);const a=this.variableOffsets[n.crossTileID];a&&this.markUsedJustification(e,a.anchor,n,y);const s=this.placedOrientations[n.crossTileID];s&&(this.markUsedJustification(e,"left",n,s),this.markUsedOrientation(e,s,n))}if(c){const t=_t(l.icon),r=!(p&&n.verticalPlacedIconSymbolIndex&&v);n.placedIconSymbolIndex>=0&&(m(e.icon,n.numIconVertices,r?t:yt),e.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=l.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(m(e.icon,n.numVerticalIconVertices,r?yt:t),e.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=l.icon.isHidden())}const x=g&&g.has(_)?g.get(_):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const n=e.collisionArrays[_];if(n){let r=new t.P(0,0);if(n.textBox||n.verticalTextBox){let t=!0;if(u){const e=this.variableOffsets[a];e?(r=st(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),h&&r._rotate(d?-this.transform.bearingInRadians:this.transform.bearingInRadians)):t=!1}if(n.textBox||n.verticalTextBox){let i;n.textBox&&(i=v),n.verticalTextBox&&(i=b),ct(e.textCollisionBox.collisionVertexArray,l.text.placed,!t||i,x.text,r.x,r.y)}}if(n.iconBox||n.verticalIconBox){const t=Boolean(!b&&n.verticalIconBox);let i;n.iconBox&&(i=t),n.verticalIconBox&&(i=!t),ct(e.iconCollisionBox.collisionVertexArray,l.icon.placed,i,x.icon,p?r.x:0,p?r.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error("bucket.text.opacityVertexArray.length (= ".concat(e.text.opacityVertexArray.length,") !== bucket.text.layoutVertexArray.length (= ").concat(e.text.layoutVertexArray.length,") / 4"));if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error("bucket.icon.opacityVertexArray.length (= ".concat(e.icon.opacityVertexArray.length,") !== bucket.icon.layoutVertexArray.length (= ").concat(e.icon.layoutVertexArray.length,") / 4"));e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function ct(e,t,n,r,i,o){r&&0!==r.length||(r=[0,0,0,0]);const a=r[0]-et,s=r[1]-et,l=r[2]-et,c=r[3]-et;e.emplaceBack(t?1:0,n?1:0,i||0,o||0,a,s),e.emplaceBack(t?1:0,n?1:0,i||0,o||0,l,s),e.emplaceBack(t?1:0,n?1:0,i||0,o||0,l,c),e.emplaceBack(t?1:0,n?1:0,i||0,o||0,a,c)}const ut=Math.pow(2,25),ht=Math.pow(2,24),dt=Math.pow(2,17),pt=Math.pow(2,16),ft=Math.pow(2,9),mt=Math.pow(2,8),gt=Math.pow(2,1);function _t(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*ut+t*ht+n*dt+t*pt+n*ft+t*mt+n*gt+t}const yt=0;class vt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,n,r,i){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<o.length;)if(t.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1}}class bt{constructor(e,t,n,r,i,o,a,s){this.placement=new lt(e,t,o,a,s),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(e,t,n){const r=c(),i=()=>!this._forceFullPlacement&&c()-r>2;for(;this._currentPlacementIndex>=0;){const r=t[e[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===r.type&&(!r.minzoom||r.minzoom<=o)&&(!r.maxzoom||r.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new vt(r)),this._inProgressLayer.continuePlacement(n[r.source],this.placement,this._showCollisionBoxes,r,i))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const xt=512/t.a3/2;class wt{constructor(e,n,r){this.tileID=e,this.bucketInstanceId=r,this._symbolsByKey={};const i=new Map;for(let t=0;t<n.length;t++){const e=n.get(t),r=e.key,o=i.get(r);o?o.push(e):i.set(r,[e])}for(const[o,a]of i){const e={positions:a.map(e=>({x:Math.floor(e.anchorX*xt),y:Math.floor(e.anchorY*xt)})),crossTileIDs:a.map(e=>e.crossTileID)};if(e.positions.length>128){const n=new t.aN(e.positions.length,16,Uint16Array);for(const{x:t,y:r}of e.positions)n.add(t,r);n.finish(),delete e.positions,e.index=n}this._symbolsByKey[o]=e}}getScaledCoordinates(e,n){const{x:r,y:i,z:o}=this.tileID.canonical,{x:a,y:s,z:l}=n.canonical,c=xt/Math.pow(2,l-o),u=(s*t.a3+e.anchorY)*c,h=i*t.a3*xt;return{x:Math.floor((a*t.a3+e.anchorX)*c-r*t.a3*xt),y:Math.floor(u-h)}}findMatches(e,t,n){const r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let i=0;i<e.length;i++){const o=e.get(i);if(o.crossTileID)continue;const a=this._symbolsByKey[o.key];if(!a)continue;const s=this.getScaledCoordinates(o,t);if(a.index){const e=a.index.range(s.x-r,s.y-r,s.x+r,s.y+r).sort();for(const t of e){const e=a.crossTileIDs[t];if(!n[e]){n[e]=!0,o.crossTileID=e;break}}}else if(a.positions)for(let e=0;e<a.positions.length;e++){const t=a.positions[e],i=a.crossTileIDs[e];if(Math.abs(t.x-s.x)<=r&&Math.abs(t.y-s.y)<=r&&!n[i]){n[i]=!0,o.crossTileID=i;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(e=>{let{crossTileIDs:t}=e;return t})}}class St{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Tt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const n in this.indexes){const e=this.indexes[n],r={};for(const n in e){const i=e[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),r[i.tileID.key]=i}this.indexes[n]=r}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let i=0;i<t.symbolInstances.length;i++)t.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,r)}else{const o=n[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,r)}}for(let i=0;i<t.symbolInstances.length;i++){const e=t.symbolInstances.get(i);e.crossTileID||(e.crossTileID=n.generate(),r[e.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new wt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.getCrossTileIDsLists())for(const t of n)delete this.usedCrossTileIDs[e][t]}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const r=this.indexes[n];for(const i in r)e[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],t=!0)}return t}}class Et{constructor(){this.layerIndexes={},this.crossTileIDs=new St,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n){let r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new Tt);let i=!1;const o={};r.handleWrapJump(n);for(const a of t){const t=a.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(a.tileID,t,this.crossTileIDs)&&(i=!0),o[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(i=!0),i}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const n in this.layerIndexes)t[n]||delete this.layerIndexes[n]}}var kt="void main() {fragColor=vec4(1.0);}";const Pt={prelude:Ct("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:Ct("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Ct("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:Ct("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Ct("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ct("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:Ct(kt,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Ct("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:Ct("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ct("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ct("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Ct("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else\n{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Ct("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Ct(kt,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:Ct("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:Ct("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:Ct("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:Ct("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:Ct("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:Ct("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:Ct("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ct("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Ct("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:Ct("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:Ct("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:Ct("uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nfloat u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}"),lineGradientSDF:Ct("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nfloat u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}"),raster:Ct("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ct("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:Ct("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Ct("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:Ct("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ct("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ct("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Ct("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Ct("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Ct("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ct(e,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=t.match(/in ([\w]+) ([\w]+)/g),i=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(i):i,s={};return{fragmentSource:e=e.replace(n,(e,t,n,r,i)=>(s[i]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\nin ").concat(n," ").concat(r," ").concat(i,";\n#else\nuniform ").concat(n," ").concat(r," u_").concat(i,";\n#endif\n"):"\n#ifdef HAS_UNIFORM_u_".concat(i,"\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n"))),vertexSource:t=t.replace(n,(e,t,n,r,i)=>{const o="float"===r?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\nuniform lowp float u_").concat(i,"_t;\nin ").concat(n," ").concat(o," a_").concat(i,";\nout ").concat(n," ").concat(r," ").concat(i,";\n#else\nuniform ").concat(n," ").concat(r," u_").concat(i,";\n#endif\n"):"vec4"===a?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\n    ").concat(i," = a_").concat(i,";\n#else\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(i,"\n    ").concat(i," = unpack_mix_").concat(a,"(a_").concat(i,", u_").concat(i,"_t);\n#else\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n"):"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\nuniform lowp float u_").concat(i,"_t;\nin ").concat(n," ").concat(o," a_").concat(i,";\n#else\nuniform ").concat(n," ").concat(r," u_").concat(i,";\n#endif\n"):"vec4"===a?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\n    ").concat(n," ").concat(r," ").concat(i," = a_").concat(i,";\n#else\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(i,"\n    ").concat(n," ").concat(r," ").concat(i," = unpack_mix_").concat(a,"(a_").concat(i,", u_").concat(i,"_t);\n#else\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n")}),staticAttributes:r,staticUniforms:a}}class It{constructor(e,t,n){this.vertexBuffer=e,this.indexBuffer=t,this.segments=n}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var At=t.aO([{name:"a_pos",type:"Int16",components:2}]);const Mt="#define PROJECTION_MERCATOR",Rt="mercator";class Dt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Rt}get shaderDefine(){return Mt}get shaderPreludeCode(){return Pt.projectionMercator}get vertexShaderPreludeCode(){return Pt.projectionMercator.vertexSource}get subdivisionGranularity(){return t.aP.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,n,r,i,o){if(this._cachedMesh)return this._cachedMesh;const a=new t.aQ;a.emplaceBack(0,0),a.emplaceBack(t.a3,0),a.emplaceBack(0,t.a3),a.emplaceBack(t.a3,t.a3);const s=e.createVertexBuffer(a,At.members),l=t.aR.simpleSegment(0,0,4,2),c=new t.aS;c.emplaceBack(1,0,2),c.emplaceBack(1,2,3);const u=e.createIndexBuffer(c);return this._cachedMesh=new It(s,u,l),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class zt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=r}interpolate(e,n,r){return null!=n.top&&null!=e.top&&(this.top=t.F.number(e.top,n.top,r)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.F.number(e.bottom,n.bottom,r)),null!=n.left&&null!=e.left&&(this.left=t.F.number(e.left,n.left,r)),null!=n.right&&null!=e.right&&(this.right=t.F.number(e.right,n.right,r)),this}getCenter(e,n){const r=t.ai((this.left+e-this.right)/2,0,e),i=t.ai((this.top+n-this.bottom)/2,0,n);return new t.P(r,i)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new zt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Lt(e,t){if(!e.renderWorldCopies||e.lngRange)return;const n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}function jt(e){return Math.max(0,Math.floor(e))}class Ot{constructor(e,n){var r;this.applyConstrain=(e,t)=>null!==this._constrainOverride?this._constrainOverride(e,t):this._callbacks.defaultConstrain(e,t),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=void 0===(null==n?void 0:n.renderWorldCopies)||!!(null==n?void 0:n.renderWorldCopies),this._minZoom=(null==n?void 0:n.minZoom)||0,this._maxZoom=(null==n?void 0:n.maxZoom)||22,this._minPitch=null==(null==n?void 0:n.minPitch)?0:null==n?void 0:n.minPitch,this._maxPitch=null==(null==n?void 0:n.maxPitch)?60:null==n?void 0:n.maxPitch,this._constrainOverride=null!==(r=null==n?void 0:n.constrainOverride)&&void 0!==r?r:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new t.U(0,0),this._elevation=0,this._zoom=0,this._tileZoom=jt(this._zoom),this._scale=t.al(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new zt,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,n,r){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=jt(this._zoom),this._scale=t.al(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new zt(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!r&&e.autoCalculateNearFarZ,n&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){void 0===e&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const n=t.V(e,-180,180)*Math.PI/180;var i,o,a,s,l,c,u,h,d;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=r(),i=this._rotationMatrix,a=-this._bearingInRadians,s=(o=this._rotationMatrix)[0],l=o[1],c=o[2],u=o[3],h=Math.sin(a),d=Math.cos(a),i[0]=s*d+c*h,i[1]=l*d+u*h,i[2]=s*-h+c*d,i[3]=l*-h+u*d)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const n=t.ai(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const t=e/180*Math.PI;this._rollInRadians!==t&&(this._unmodified=!1,this._rollInRadians=t,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return t.aT(this._fovInRadians)}setFov(e){e=t.ai(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=t.ak(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const n=this.applyConstrain(this._center,e).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=t.al(n),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,t){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=t,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this.constrainInternal(),this._calcMatrices()}resize(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._width=e,this._height=t,n&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new H([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-t.aj,t.aj])}getCameraQueryGeometry(e,n){if(1===n.length)return[n[0],e];{const{minX:r,minY:i,maxX:o,maxY:a}=t.a6.fromPoints(n).extend(e);return[new t.P(r,i),new t.P(o,i),new t.P(o,a),new t.P(r,a),new t.P(r,i)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:t,zoom:n}=this.applyConstrain(this.center,this.zoom);this.setCenter(t),this.setZoom(n),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=t.am(new Float64Array(16));t.O(e,e,[this._width/2,-this._height/2,1]),t.N(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=t.am(new Float64Array(16)),t.O(e,e,[1,-1,1]),t.N(e,e,[-1,-1,0]),t.O(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,n,r,i){const o=void 0!==r?r:this.bearing,a=i=void 0!==i?i:this.pitch,s=t.a5.fromLngLat(e,n),l=-Math.cos(t.ak(a)),c=Math.sin(t.ak(a)),u=c*Math.sin(t.ak(o)),h=-c*Math.cos(t.ak(o));let d=this.elevation;const p=n-d;let f;l*p>=0||Math.abs(l)<.1?(f=1e4,d=n+f*l):f=-p/l;let m,g,_=t.aU(1,s.y),y=0;do{if(y+=1,y>10)break;g=f/_,m=new t.a5(s.x+u*g,s.y+h*g),_=1/m.meterInMercatorCoordinateUnits()}while(Math.abs(f-g*_)>1e-12);return{center:m.toLngLat(),elevation:d,zoom:t.ao(this.height/2/Math.tan(this.fovInRadians/2)/g/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const n=t.an(1,this.center.lat)*this.worldSize,r=this.cameraToCenterDistance/n,i=t.a5.fromLngLat(this.center,this.elevation),o=ve(this.center,this.elevation,this.pitch,this.bearing,r);this._elevation=e;const a=this.calculateCenterFromCameraLngLatAlt(o.toLngLat(),t.aU(o.z,i.y),this.bearing,this.pitch);this._elevation=a.elevation,this._center=a.center,this.setZoom(a.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=t.an(1,this.center.lat)*this.worldSize;return ve(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const n=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/n,e.canonical.y/n,1/n/t.a3,1/n/t.a3]}}class Ft{constructor(e,n){this.min=e,this.max=n,this.center=t.aV([],t.aW([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],r=t.aX(this.min),i=t.aX(this.max);for(let t=0;t<n.length;t++)r[t]=n[t]?this.min[t]:this.center[t],i[t]=n[t]?this.center[t]:this.max[t];return i[2]=this.max[2],new Ft(r,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let t=!0;for(let n=0;n<e.planes.length;n++){const r=this.intersectsPlane(e.planes[n]);if(0===r)return 0;1===r&&(t=!1)}return t?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let t=e[3],n=e[3];for(let r=0;r<3;r++)e[r]>0?(t+=e[r]*this.min[r],n+=e[r]*this.max[r]):(n+=e[r]*this.min[r],t+=e[r]*this.max[r]);return t>=0?2:n<0?0:1}}class Bt{distanceToTile2d(e,t,n,r){const i=r.distanceX([e,t]),o=r.distanceY([e,t]);return Math.hypot(i,o)}getWrap(e,t,n){return n}getTileBoundingVolume(e,n,r,i){var o,a;let s=0,l=0;if(null==i?void 0:i.terrain){const c=new t.a0(e.z,n,e.z,e.x,e.y),u=i.terrain.getMinMaxElevation(c);s=null!==(o=u.minElevation)&&void 0!==o?o:Math.min(0,r),l=null!==(a=u.maxElevation)&&void 0!==a?a:Math.max(0,r)}const c=1<<e.z;return new Ft([n+e.x/c,e.y/c,s],[n+(e.x+1)/c,(e.y+1)/c,l])}allowVariableZoom(e,n){const r=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,i=t.ai(78.5-r/2,0,60);return!!n.terrain||e.pitch>i}allowWorldCopies(){return!0}prepareNextFrame(){}}class Nt{constructor(e,t,n){this.points=e,this.planes=t,this.aabb=n}static fromInvProjectionMatrix(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;const a=o?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],s=Math.pow(2,r),l=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(r=>function(e,n,r,i){const o=t.aB([],e,n),a=1/o[3]/r*i;return t.b0(o,o,[a,a,1/o[3],a])}(r,e,n,s));i&&function(e,n,r,i){const o=i?4:0,a=i?0:4;let s=0;const l=[],c=[];for(let d=0;d<4;d++){const n=t.aY([],e[d+a],e[d+o]),r=t.b1(n);t.aV(n,n,1/r),l.push(r),c.push(n)}for(let d=0;d<4;d++){const n=t.b2(e[d+o],c[d],r);s=null!==n&&n>=0?Math.max(s,n):Math.max(s,l[d])}const u=function(e,n){const r=t.aY([],e[n[0]],e[n[1]]),i=t.aY([],e[n[2]],e[n[1]]),o=[0,0,0,0];return t.aZ(o,t.a_([],r,i)),o[3]=-t.a$(o,e[n[0]]),o}(e,n),h=function(e,n){const r=t.b3(e),i=t.b4([],e,1/r),o=t.aY([],n,t.aV([],i,t.a$(n,i))),a=t.b3(o);if(a>0){const e=Math.sqrt(1-i[3]*i[3]),r=t.aV([],i,-i[3]),s=t.aW([],r,t.aV([],o,e/a));return t.b5(n,s)}return null}(r,u);if(null!==h){const e=h/t.a$(c[0],u);s=Math.min(s,e)}for(let t=0;t<4;t++){const n=Math.min(s,l[t]);e[t+a]=[e[t+o][0]+c[t][0]*n,e[t+o][1]+c[t][1]*n,e[t+o][2]+c[t][2]*n,1]}}(l,a[0],i,o);const c=a.map(e=>{const n=t.aY([],l[e[0]],l[e[1]]),r=t.aY([],l[e[2]],l[e[1]]),i=t.aZ([],t.a_([],n,r)),o=-t.a$(i,l[e[1]]);return i.concat(o)}),u=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],h=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const t of l)for(let e=0;e<3;e++)u[e]=Math.min(u[e],t[e]),h[e]=Math.max(h[e],t[e]);return new Nt(l,c,new Ft(u,h))}}class Ut{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,n){return this._helper.interpolatePadding(e,t,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._helper.resize(e,t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,t){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(e,n)=>{n=t.ai(+n,this.minZoom,this.maxZoom);const r={center:new t.U(e.lng,e.lat),zoom:n};let i=this._helper._lngRange;if(!this._helper._renderWorldCopies&&null===i){const e=180-1e-10;i=[-e,e]}const o=this.tileSize*t.al(r.zoom);let a=0,s=o,l=0,c=o,u=0,h=0;const{x:d,y:p}=this.size;if(this._helper._latRange){const e=this._helper._latRange;a=t.W(e[1])*o,s=t.W(e[0])*o,s-a<p&&(u=p/(s-a))}i&&(l=t.V(t.X(i[0])*o,0,o),c=t.V(t.X(i[1])*o,0,o),c<l&&(c+=o),c-l<d&&(h=d/(c-l)));const{x:f,y:m}=me(o,e);let g,_;const y=Math.max(h||0,u||0);if(y){const e=new t.P(h?(c+l)/2:f,u?(s+a)/2:m);return r.center=ge(o,e).wrap(),r.zoom+=t.ao(y),r}if(this._helper._latRange){const e=p/2;m-e<a&&(_=a+e),m+e>s&&(_=s-e)}if(i){const e=(l+c)/2;let n=f;this._helper._renderWorldCopies&&(n=t.V(f,e-o/2,e+o/2));const r=d/2;n-r<l&&(g=l+r),n+r>c&&(g=c-r)}if(void 0!==g||void 0!==_){const e=new t.P(null!=g?g:f,null!=_?_:m);r.center=ge(o,e).wrap()}return r},this.applyConstrain=(e,t)=>this._helper.applyConstrain(e,t),this._helper=new Ot({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(e,t)=>this.defaultConstrain(e,t)},e),this._coveringTilesDetailsProvider=new Bt}clone(){const e=new Ut;return e.apply(this),e}apply(e,t,n){this._helper.apply(e,t,n)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const n=[new t.b6(0,e)];if(this._helper._renderWorldCopies){const r=this.screenPointToMercatorCoordinate(new t.P(0,0)),i=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,0)),o=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,this._helper._height)),a=this.screenPointToMercatorCoordinate(new t.P(0,this._helper._height)),s=Math.floor(Math.min(r.x,i.x,o.x,a.x)),l=Math.floor(Math.max(r.x,i.x,o.x,a.x)),c=1;for(let u=s-c;u<=l+c;u++)0!==u&&n.push(new t.b6(u,e))}return n}getCameraFrustum(){return Nt.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const t=this.screenPointToLocation(this.centerPoint,e),n=e?e.getElevationForLngLatZoom(t,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(n)}setLocationAtPoint(e,n){const r=t.an(this.elevation,this.center.lat),i=this.screenPointToMercatorCoordinateAtZ(n,r),o=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,r),a=t.a5.fromLngLat(e),s=new t.a5(a.x-(i.x-o.x),a.y-(i.y-o.y));this.setCenter(null==s?void 0:s.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,n){return n?this.coordinatePoint(t.a5.fromLngLat(e),n.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(t.a5.fromLngLat(e))}screenPointToLocation(e,t){var n;return null===(n=this.screenPointToMercatorCoordinate(e,t))||void 0===n?void 0:n.toLngLat()}screenPointToMercatorCoordinate(e,t){if(t){const n=t.pointCoordinate(e);if(null!=n)return n}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,n){const r=n||0,i=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.aB(i,i,this._pixelMatrixInverse),t.aB(o,o,this._pixelMatrixInverse);const a=i[3],s=o[3],l=i[1]/a,c=o[1]/s,u=i[2]/a,h=o[2]/s,d=u===h?0:(r-u)/(h-u);return new t.a5(t.F.number(i[0]/a,o[0]/s,d)/this.worldSize,t.F.number(l,c,d)/this.worldSize,r)}coordinatePoint(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._pixelMatrix;const i=[e.x*this.worldSize,e.y*this.worldSize,n,1];return t.aB(i,i,r),new t.P(i[0]/i[3],i[1]/i[3])}getBounds(){const e=Math.max(0,this._helper._height/2-_e(this));return(new H).extend(this.screenPointToLocation(new t.P(0,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new t.P(0,this._helper._height)))}isPointOnMapSurface(e,t){return t?null!=t.pointCoordinate(e):e.y>this.height/2-_e(this)}calculatePosMatrix(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;var i;const o=null!==(i=e.key)&&void 0!==i?i:t.b7(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),a=n?this._alignedPosMatrixCache:this._posMatrixCache;if(a.has(o)){const e=a.get(o);return r?e.f32:e.f64}const s=ye(e,this.worldSize);t.Q(s,n?this._alignedProjMatrix:this._viewProjMatrix,s);const l={f64:s,f32:new Float32Array(s)};return a.set(o,l),r?l.f32:l.f64}calculateFogMatrix(e){const n=e.key,r=this._fogMatrixCacheF32;if(r.has(n))return r.get(n);const i=ye(e,this.worldSize);return t.Q(i,this._fogMatrix,i),r.set(n,new Float32Array(i)),r.get(n)}calculateCenterFromCameraLngLatAlt(e,t,n,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,n,r)}_calculateNearFarZIfNeeded(e,n,r){if(!this._helper.autoCalculateNearFarZ)return;const i=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),o=e-i*this._helper._pixelPerMeter/Math.cos(n),a=i<0?o:e,s=Math.PI/2+this.pitchInRadians,l=t.ak(this.fov)*(Math.abs(Math.cos(t.ak(this.roll)))*this.height+Math.abs(Math.sin(t.ak(this.roll)))*this.width)/this.height*(.5+r.y/this.height),c=Math.sin(l)*a/Math.sin(t.ai(Math.PI-s-l,.01,Math.PI-.01)),u=_e(this),h=Math.atan(u/this._helper.cameraToCenterDistance),d=t.ak(.75),p=h>d?2*h*(.5+r.y/(2*u)):d,f=Math.sin(p)*a/Math.sin(t.ai(Math.PI-s-p,.01,Math.PI-.01)),m=Math.min(c,f);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*m+a),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,n=me(this.worldSize,this.center),r=n.x,i=n.y;this._helper._pixelPerMeter=t.an(1,this.center.lat)*this.worldSize;const o=t.ak(Math.min(this.pitch,fe)),a=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(o));let s;this._calculateNearFarZIfNeeded(a,o,e),s=new Float64Array(16),t.b8(s,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),t.av(this._invProjMatrix,s),s[8]=2*-e.x/this._helper._width,s[9]=2*e.y/this._helper._height,this._projectionMatrix=t.b9(s),t.O(s,s,[1,-1,1]),t.N(s,s,[0,0,-this._helper.cameraToCenterDistance]),t.ba(s,s,-this.rollInRadians),t.bb(s,s,this.pitchInRadians),t.ba(s,s,-this.bearingInRadians),t.N(s,s,[-r,-i,0]),this._mercatorMatrix=t.O([],s,[this.worldSize,this.worldSize,this.worldSize]),t.O(s,s,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=t.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,s),t.N(s,s,[0,0,-this.elevation]),this._viewProjMatrix=s,this._invViewProjMatrix=t.av([],s);const l=[0,0,-1,1];t.aB(l,l,this._invViewProjMatrix),this._cameraPosition=[l[0]/l[3],l[1]/l[3],l[2]/l[3]],this._fogMatrix=new Float64Array(16),t.b8(this._fogMatrix,this.fovInRadians,this.width/this.height,a,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,t.O(this._fogMatrix,this._fogMatrix,[1,-1,1]),t.N(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),t.ba(this._fogMatrix,this._fogMatrix,-this.rollInRadians),t.bb(this._fogMatrix,this._fogMatrix,this.pitchInRadians),t.ba(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),t.N(this._fogMatrix,this._fogMatrix,[-r,-i,0]),t.O(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),t.N(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=t.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,s);const c=this._helper._width%2/2,u=this._helper._height%2/2,h=Math.cos(this.bearingInRadians),d=Math.sin(-this.bearingInRadians),p=r-Math.round(r)+h*c+d*u,f=i-Math.round(i)+h*u+d*c,m=new Float64Array(s);if(t.N(m,m,[p>.5?p-1:p,f>.5?f-1:f,0]),this._alignedProjMatrix=m,s=t.av(new Float64Array(16),this._pixelMatrix),!s)throw new Error("failed to invert matrix");this._pixelMatrixInverse=s,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new t.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.aB(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=t.an(1,this.center.lat)*this.worldSize;return ve(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,n){const r=t.a5.fromLngLat(e),i=[r.x*this.worldSize,r.y*this.worldSize,n,1];return t.aB(i,i,this._viewProjMatrix),i[2]/i[3]}getProjectionData(e){const{overscaledTileID:n,aligned:r,applyTerrainMatrix:i}=e,o=this._helper.getMercatorTileCoordinates(n),a=n?this.calculatePosMatrix(n,r,!0):null;let s;return s=n&&n.terrainRttPosMatrix32f&&i?n.terrainRttPosMatrix32f:a||t.bc(),{mainMatrix:s,tileMercatorCoords:o,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:s}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,t,n){return 1}transformLightDirection(e){return t.aX(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,n,r,i){const o=this.calculatePosMatrix(r);let a;i?(a=[e,n,i(e,n),1],t.aB(a,a,o)):(a=[e,n,0,1],$e(a,a,o));const s=a[3];return{point:new t.P(a[0]/s,a[1]/s),signedDistanceFromCamera:s,isOccluded:!1}}populateCache(e){for(const t of e)this.calculatePosMatrix(t)}getMatrixForModel(e,n){const r=t.a5.fromLngLat(e,n),i=r.meterInMercatorCoordinateUnits(),o=t.bd();return t.N(o,o,[r.x,r.y,r.z]),t.ba(o,o,Math.PI),t.bb(o,o,Math.PI/2),t.O(o,o,[-i,i,i]),o}getProjectionDataForCustomLayer(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=new t.a0(0,0,0,0,0),r=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:e}),i=ye(n,this.worldSize);t.Q(i,this._viewProjMatrix,i),r.tileMercatorCoords=[0,0,1,1];const o=[t.a3,t.a3,this.worldSize/this._helper.pixelsPerMeter],a=t.be();return t.O(a,i,o),r.fallbackMatrix=a,r.mainMatrix=a,r}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Vt(){t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Gt(e){if(e.useSlerp)if(e.k<1){const n=t.bf(e.startEulerAngles.roll,e.startEulerAngles.pitch,e.startEulerAngles.bearing),r=t.bf(e.endEulerAngles.roll,e.endEulerAngles.pitch,e.endEulerAngles.bearing),i=new Float64Array(4);t.bg(i,n,r,e.k);const o=t.bh(i);e.tr.setRoll(o.roll),e.tr.setPitch(o.pitch),e.tr.setBearing(o.bearing)}else e.tr.setRoll(e.endEulerAngles.roll),e.tr.setPitch(e.endEulerAngles.pitch),e.tr.setBearing(e.endEulerAngles.bearing);else e.tr.setRoll(t.F.number(e.startEulerAngles.roll,e.endEulerAngles.roll,e.k)),e.tr.setPitch(t.F.number(e.startEulerAngles.pitch,e.endEulerAngles.pitch,e.k)),e.tr.setBearing(t.F.number(e.startEulerAngles.bearing,e.endEulerAngles.bearing,e.k))}function qt(e,n,r,i,o){const a=o.padding,s=me(o.worldSize,r.getNorthWest()),l=me(o.worldSize,r.getNorthEast()),c=me(o.worldSize,r.getSouthEast()),u=me(o.worldSize,r.getSouthWest()),h=t.ak(-i),d=s.rotate(h),p=l.rotate(h),f=c.rotate(h),m=u.rotate(h),g=new t.P(Math.max(d.x,p.x,m.x,f.x),Math.max(d.y,p.y,m.y,f.y)),_=new t.P(Math.min(d.x,p.x,m.x,f.x),Math.min(d.y,p.y,m.y,f.y)),y=g.sub(_),v=(o.width-(a.left+a.right+n.left+n.right))/y.x,b=(o.height-(a.top+a.bottom+n.top+n.bottom))/y.y;if(b<0||v<0)return void Vt();const x=Math.min(t.ao(o.scale*Math.min(v,b)),e.maxZoom),w=t.P.convert(e.offset),S=new t.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(t.ak(i)),T=w.add(S).mult(o.scale/t.al(x));return{center:ge(o.worldSize,s.add(c).div(2).sub(T)),zoom:x,bearing:i}}class Zt{get useGlobeControls(){return!1}handlePanInertia(e,t){const n=e.mag(),r=Math.abs(_e(t));return{easingOffset:e.mult(Math.min(.75*r/n,1)),easingCenter:t.center}}handleMapControlsRollPitchBearingZoom(e,t){e.bearingDelta&&t.setBearing(t.bearing+e.bearingDelta),e.pitchDelta&&t.setPitch(t.pitch+e.pitchDelta),e.rollDelta&&t.setRoll(t.roll+e.rollDelta),e.zoomDelta&&t.setZoom(t.zoom+e.zoomDelta)}handleMapControlsPan(e,t,n){e.around.distSqr(t.centerPoint)<.01||t.setLocationAtPoint(n,e.around)}cameraForBoxAndBearing(e,t,n,r,i){return qt(e,t,n,r,i)}handleJumpToCenterZoom(e,n){e.zoom!==(void 0!==n.zoom?+n.zoom:e.zoom)&&e.setZoom(+n.zoom),void 0!==n.center&&e.setCenter(t.U.convert(n.center))}handleEaseTo(e,n){const r=e.zoom,i=e.padding,o={roll:e.roll,pitch:e.pitch,bearing:e.bearing},a={roll:void 0===n.roll?e.roll:n.roll,pitch:void 0===n.pitch?e.pitch:n.pitch,bearing:void 0===n.bearing?e.bearing:n.bearing},s=void 0!==n.zoom,l=!e.isPaddingEqual(n.padding);let c=!1;const u=s?+n.zoom:e.zoom;let h=e.centerPoint.add(n.offsetAsPoint);const d=e.screenPointToLocation(h),{center:p,zoom:f}=e.applyConstrain(t.U.convert(n.center||d),null!=u?u:r);Lt(e,p);const m=me(e.worldSize,d),g=me(e.worldSize,p).sub(m),_=t.al(f-r);return c=f!==r,{easeFunc:s=>{if(c&&e.setZoom(t.F.number(r,f,s)),t.bi(o,a)||Gt({startEulerAngles:o,endEulerAngles:a,tr:e,k:s,useSlerp:o.roll!=a.roll}),l&&(e.interpolatePadding(i,n.padding,s),h=e.centerPoint.add(n.offsetAsPoint)),n.around)e.setLocationAtPoint(n.around,n.aroundPoint);else{const n=t.al(e.zoom-r),i=f>r?Math.min(2,_):Math.max(.5,_),o=Math.pow(i,1-s),a=ge(e.worldSize,m.add(g.mult(s*o)).mult(n));e.setLocationAtPoint(e.renderWorldCopies?a.wrap():a,h)}},isZooming:c,elevationCenter:p}}handleFlyTo(e,n){const r=void 0!==n.zoom,i=e.zoom,o=e.applyConstrain(t.U.convert(n.center||n.locationAtOffset),r?+n.zoom:i),a=o.center,s=o.zoom;Lt(e,a);const l=me(e.worldSize,n.locationAtOffset),c=me(e.worldSize,a).sub(l),u=c.mag(),h=t.al(s-i);let d;if(void 0!==n.minZoom){const r=Math.min(+n.minZoom,i,s),o=e.applyConstrain(a,r).zoom;d=t.al(o-i)}return{easeFunc:(n,r,o,u)=>{e.setZoom(1===n?s:i+t.ao(r));const h=1===n?a:ge(e.worldSize,l.add(c.mult(o)).mult(r));e.setLocationAtPoint(e.renderWorldCopies?h.wrap():h,u)},scaleOfZoom:h,targetCenter:a,scaleOfMinZoom:d,pixelPathLength:u}}}class Wt{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}Wt.Replace=[1,0],Wt.disabled=new Wt(Wt.Replace,t.bj.transparent,[!1,!1,!1,!1]),Wt.unblended=new Wt(Wt.Replace,t.bj.transparent,[!0,!0,!0,!0]),Wt.alphaBlended=new Wt([1,771],t.bj.transparent,[!0,!0,!0,!0]);const Ht=2305;class Xt{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}Xt.disabled=new Xt(!1,1029,Ht),Xt.backCCW=new Xt(!0,1029,Ht),Xt.frontCCW=new Xt(!0,1028,Ht);class Kt{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const Yt=7680;class Jt{constructor(e,t,n,r,i,o){this.test=e,this.ref=t,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o}}Jt.disabled=new Jt({func:519,mask:0},0,0,Yt,Yt,Yt);const Qt=new WeakMap;function $t(e){var t;if(Qt.has(e))return Qt.get(e);{const n=null===(t=e.getParameter(e.VERSION))||void 0===t?void 0:t.startsWith("WebGL 2.0");return Qt.set(e,n),n}}class en{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const n=e.context,r=n.gl;this._texFormat=r.RGBA,this._texType=r.UNSIGNED_BYTE;const i=new t.aQ;i.emplaceBack(-1,-1),i.emplaceBack(2,-1),i.emplaceBack(-1,2);const o=new t.aS;o.emplaceBack(0,1,2),this._fullscreenTriangle=new It(n.createVertexBuffer(i,At.members),n.createIndexBuffer(o),t.aR.simpleSegment(0,0,i.length,o.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(r.TEXTURE1);const a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(a),$t(r)&&(this._pbo=r.createBuffer(),r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.bufferData(r.PIXEL_PACK_BUFFER,4,r.STREAM_READ),r.bindBuffer(r.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,t){const n=this._updateCount;return this._readbackQueue?n>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():n>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,t),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,t=e.gl;e.activeTexture.set(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,n){const r=this._cachedRenderContext.context,i=r.gl;if(this._bindFramebuffer(),r.viewport.set([0,0,this._texWidth,this._texHeight]),r.clear({color:t.bj.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(r,i.TRIANGLES,Kt.disabled,Jt.disabled,Wt.unblended,Xt.disabled,((e,t)=>({u_input:e,u_output_expected:t}))(e,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&$t(i)){i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.readBuffer(i.COLOR_ATTACHMENT0),i.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),i.bindBuffer(i.PIXEL_PACK_BUFFER,null);const e=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);i.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:e}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&$t(e)){const n=e.clientWaitSync(this._readbackQueue.sync,0,0);if(n===e.WAIT_FAILED)return t.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=en._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let t=0;return t+=e[0]/256,t+=e[1]/65536,t+=e[2]/16777216,e[3]<127&&(t=-t),t/128}}const tn=t.a3/128;function nn(e,n){const r=void 0!==e.granularity?Math.max(e.granularity,1):1,i=r+(e.generateBorders?2:0),o=r+(e.extendToNorthPole||e.generateBorders?1:0)+(e.extendToSouthPole||e.generateBorders?1:0),a=i+1,s=o+1,l=e.generateBorders?-1:0,c=e.generateBorders||e.extendToNorthPole?-1:0,u=r+(e.generateBorders?1:0),h=r+(e.generateBorders||e.extendToSouthPole?1:0),d=a*s,p=i*o*6,f=a*s>65536;if(f&&"16bit"===n)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const m=f||"32bit"===n,g=new Int16Array(2*d);let _=0;for(let b=c;b<=h;b++)for(let n=l;n<=u;n++){let i=n/r*t.a3;-1===n&&(i=-tn),n===r+1&&(i=t.a3+tn);let o=b/r*t.a3;-1===b&&(o=e.extendToNorthPole?t.bl:-tn),b===r+1&&(o=e.extendToSouthPole?t.bm:t.a3+tn),g[_++]=i,g[_++]=o}const y=m?new Uint32Array(p):new Uint16Array(p);let v=0;for(let t=0;t<o;t++)for(let e=0;e<i;e++){const n=e+1+t*a,r=e+(t+1)*a,i=e+1+(t+1)*a;y[v++]=e+t*a,y[v++]=r,y[v++]=n,y[v++]=n,y[v++]=r,y[v++]=i}return{vertices:g.buffer.slice(0),indices:y.buffer.slice(0),uses32bitIndices:m}}const rn=new t.aP({fill:new t.bn(128,2),line:new t.bn(512,0),tile:new t.bn(128,32),stencil:new t.bn(128,1),circle:3});class on{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Pt.projectionGlobe}get vertexShaderPreludeCode(){return Pt.projectionMercator.vertexSource}get subdivisionGranularity(){return rn}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new en(e));const n=t.W(this._errorQueryLatitudeDegrees),r=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,i=this._errorMeasurement.updateErrorLoop(n,r),o=c();i!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=i,this._errorMeasurementLastChangeTime=o);const a=Math.min(Math.max((o-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=t.bo(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,t.bp(a))}_getMeshKey(e){return"".concat(e.granularity.toString(36),"_").concat(e.generateBorders?"b":"").concat(e.extendToNorthPole?"n":"").concat(e.extendToSouthPole?"s":"")}getMeshFromTileID(e,t,n,r,i){const o=("stencil"===i?rn.stencil:rn.tile).getGranularityForZoomLevel(t.z);return this._getMesh(e,{granularity:o,generateBorders:n,extendToNorthPole:0===t.y&&r,extendToSouthPole:t.y===(1<<t.z)-1&&r})}_getMesh(e,n){const r=this._getMeshKey(n);if(r in this._tileMeshCache)return this._tileMeshCache[r];const i=function(e,n){const r=nn(n,"16bit"),i=t.aQ.deserialize({arrayBuffer:r.vertices,length:r.vertices.byteLength/2/2}),o=t.aS.deserialize({arrayBuffer:r.indices,length:r.indices.byteLength/2/3});return new It(e.createVertexBuffer(i,At.members),e.createIndexBuffer(o),t.aR.simpleSegment(0,0,i.length,o.length))}(e,n);return this._tileMeshCache[r]=i,i}recalculate(e){}hasTransition(){const e=c();let t=!1;return t=t||(e-this._errorMeasurementLastChangeTime)/1e3<.7,t=t||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,t}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const an=new t.t({type:new t.D(t.u.projection.type)});class sn extends t.E{constructor(e){super(),this._transitionable=new t.x(an,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.G(0)),this._mercatorProjection=new Dt,this._verticalPerspectiveProjection=new on}get transitionState(){const e=this.properties.get("type");if("string"==typeof e&&"mercator"===e)return 0;if("string"==typeof e&&"vertical-perspective"===e)return 1;if(e instanceof t.bq){if("vertical-perspective"===e.from&&"mercator"===e.to)return 1-e.transition;if("mercator"===e.from&&"vertical-perspective"===e.to)return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,t,n,r,i){return this.currentProjection.getMeshFromTileID(e,t,n,r,i)}setProjection(e){this._transitionable.setValue("type",(null==e?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function ln(e){const t=hn(e.worldSize,e.center.lat);return 2*Math.PI*t}function cn(e,n,r,i,o){const a=1/(1<<o),s=n/t.a3*a+i*a,l=t.bs((e/t.a3*a+r*a)*Math.PI*2+Math.PI,2*Math.PI),c=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,u=Math.cos(c),h=new Float64Array(3);return h[0]=Math.sin(l)*u,h[1]=Math.sin(c),h[2]=Math.cos(l)*u,h}function un(e){return function(e,t){const n=Math.cos(t),r=new Float64Array(3);return r[0]=Math.sin(e)*n,r[1]=Math.sin(t),r[2]=Math.cos(e)*n,r}(e.lng*Math.PI/180,e.lat*Math.PI/180)}function hn(e,t){return e/(2*Math.PI)/Math.cos(t*Math.PI/180)}function dn(e){const n=Math.asin(e[1])/Math.PI*180,r=Math.sqrt(e[0]*e[0]+e[2]*e[2]);if(r>1e-6){const i=e[0]/r,o=Math.acos(e[2]/r),a=(i>0?o:-o)/Math.PI*180;return new t.U(t.V(a,-180,180),n)}return new t.U(0,n)}function pn(e){return Math.cos(e*Math.PI/180)}function fn(e,n){const r=pn(e),i=pn(n);return t.ao(i/r)}function mn(e,n){const r=e.rotate(n.bearingInRadians),i=n.zoom+fn(n.center.lat,0),o=t.bo(1/pn(n.center.lat),1/pn(Math.min(Math.abs(n.center.lat),60)),t.br(i,7,3,0,1)),a=360/ln({worldSize:n.worldSize,center:{lat:n.center.lat}});return new t.U(n.center.lng-r.x*a*o,t.ai(n.center.lat+r.y*a,-t.aj,t.aj))}function gn(e){const t=.5*e,n=Math.sin(t),r=Math.cos(t);return Math.log(n+r)-Math.log(r-n)}function _n(e,n,r,i){const o=e.lat+r*i;if(Math.abs(r)>1){const a=(Math.sign(e.lat+r)!==Math.sign(e.lat)?-Math.abs(e.lat):Math.abs(e.lat))*Math.PI/180,s=Math.abs(e.lat+r)*Math.PI/180,l=gn(a+i*(s-a)),c=gn(a),u=gn(s);return new t.U(e.lng+n*((l-c)/(u-c)),o)}return new t.U(e.lng+n*i,o)}class yn{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,t,n,r){const i="".concat(e.z,"_").concat(e.x,"_").concat(e.y,"_").concat((null==r?void 0:r.terrain)?"t":""),o=this._cache.get(i);if(o)return o;const a=this._cachePrevious.get(i);if(a)return this._cache.set(i,a),a;const s=this._boundingVolumeFactory(e,t,n,r);return this._cache.set(i,s),this._hadAnyChanges=!0,s}}class vn{constructor(e,t,n,r){this.min=n,this.max=r,this.points=e,this.planes=t}static fromAabb(e,t){const n=[];for(let r=0;r<8;r++)n.push([1&~r?e[0]:t[0],1==(r>>1&1)?t[1]:e[1],1==(r>>2&1)?t[2]:e[2]]);return new vn(n,[[-1,0,0,t[0]],[1,0,0,-e[0]],[0,-1,0,t[1]],[0,1,0,-e[1]],[0,0,-1,t[2]],[0,0,1,-e[2]]],e,t)}static fromCenterSizeAngles(e,n,r){const i=t.bv([],r[0],r[1],r[2]),o=t.bw([],[n[0],0,0],i),a=t.bw([],[0,n[1],0],i),s=t.bw([],[0,0,n[2]],i),l=[...e],c=[...e];for(let t=0;t<8;t++)for(let n=0;n<3;n++){const r=e[n]+o[n]*(1&~t?-1:1)+a[n]*(1==(t>>1&1)?1:-1)+s[n]*(1==(t>>2&1)?1:-1);l[n]=Math.min(l[n],r),c[n]=Math.max(c[n],r)}const u=[];for(let h=0;h<8;h++){const n=[...e];t.aW(n,n,t.aV([],o,1&~h?-1:1)),t.aW(n,n,t.aV([],a,1==(h>>1&1)?1:-1)),t.aW(n,n,t.aV([],s,1==(h>>2&1)?1:-1)),u.push(n)}return new vn(u,[[...o,-t.a$(o,u[0])],[...a,-t.a$(a,u[0])],[...s,-t.a$(s,u[0])],[-o[0],-o[1],-o[2],-t.a$(o,u[7])],[-a[0],-a[1],-a[2],-t.a$(a,u[7])],[-s[0],-s[1],-s[2],-t.a$(s,u[7])]],l,c)}intersectsFrustum(e){let t=!0;const n=this.points.length,r=this.planes.length,i=e.planes.length,o=e.points.length;for(let a=0;a<i;a++){const r=e.planes[a];let i=0;for(let e=0;e<n;e++){const t=this.points[e];r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=0&&i++}if(0===i)return 0;i<n&&(t=!1)}if(t)return 2;for(let a=0;a<r;a++){const t=this.planes[a];let n=0;for(let r=0;r<o;r++){const i=e.points[r];t[0]*i[0]+t[1]*i[1]+t[2]*i[2]+t[3]>=0&&n++}if(0===n)return 0}return 1}intersectsPlane(e){const t=this.points.length;let n=0;for(let r=0;r<t;r++){const t=this.points[r];e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]>=0&&n++}return n===t?2:0===n?0:1}}function bn(e,t,n){const r=e-t;return r<0?-r:Math.max(0,r-n)}function xn(e,t,n,r,i){const o=e-n;let a;return a=o<0?Math.min(-o,1+o-i):o>1?Math.min(Math.max(o-i,0),1-o):0,Math.max(a,bn(t,r,i))}class wn{constructor(){this._boundingVolumeCache=new yn(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,t,n,r){const i=1<<n.z,o=1/i,a=n.x/i,s=n.y/i;let l=2;return l=Math.min(l,xn(e,t,a,s,o)),l=Math.min(l,xn(e,t,a+.5,-s-o,o)),l=Math.min(l,xn(e,t,a+.5,2-s-o,o)),l}getWrap(e,t,n){const r=1<<t.z,i=1/r,o=t.x/r,a=bn(e.x,o,i),s=bn(e.x,o-1,i),l=bn(e.x,o+1,i),c=Math.min(a,s,l);return c===l?1:c===s?-1:0}allowVariableZoom(e,t){return Te(e,t)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,t,n,r){return this._boundingVolumeCache.getTileBoundingVolume(e,t,n,r)}_computeTileBoundingVolume(e,n,r,i){var o,a;let s=0,l=0;if(null==i?void 0:i.terrain){const c=new t.a0(e.z,n,e.z,e.x,e.y),u=i.terrain.getMinMaxElevation(c);s=null!==(o=u.minElevation)&&void 0!==o?o:Math.min(0,r),l=null!==(a=u.maxElevation)&&void 0!==a?a:Math.max(0,r)}if(s/=t.by,l/=t.by,s+=1,l+=1,e.z<=0)return vn.fromAabb([-l,-l,-l],[l,l,l]);if(1===e.z)return vn.fromAabb([0===e.x?-l:0,0===e.y?0:-l,-l],[0===e.x?0:l,0===e.y?l:0,l]);{const n=[cn(0,0,e.x,e.y,e.z),cn(t.a3,0,e.x,e.y,e.z),cn(t.a3,t.a3,e.x,e.y,e.z),cn(0,t.a3,e.x,e.y,e.z)],r=[];for(const e of n)r.push(t.aV([],e,l));if(l!==s)for(const e of n)r.push(t.aV([],e,s));0===e.y&&r.push([0,1,0]),e.y===(1<<e.z)-1&&r.push([0,-1,0]);const i=[1,1,1],o=[-1,-1,-1];for(const e of r)for(let t=0;t<3;t++)i[t]=Math.min(i[t],e[t]),o[t]=Math.max(o[t],e[t]);const a=cn(t.a3/2,t.a3/2,e.x,e.y,e.z),c=t.a_([],[0,1,0],a);t.aZ(c,c);const u=t.a_([],a,c);t.aZ(u,u);const h=t.a_([],n[2],n[1]);t.aZ(h,h);const d=t.a_([],n[0],n[3]);t.aZ(d,d),r.push(t.aV([],a,l)),e.y>=(1<<e.z)/2&&r.push(t.aV([],cn(t.a3/2,0,e.x,e.y,e.z),l)),e.y<(1<<e.z)/2&&r.push(t.aV([],cn(t.a3/2,t.a3,e.x,e.y,e.z),l));const p=Sn(a,r),f=Sn(u,r),m=[-a[0],-a[1],-a[2],p.max],g=[a[0],a[1],a[2],-p.min],_=[-u[0],-u[1],-u[2],f.max],y=[u[0],u[1],u[2],-f.min],v=[...h,0],b=[...d,0],x=[];return 0===e.y?x.push(t.bx(b,v,m),t.bx(b,v,g)):x.push(t.bx(_,v,m),t.bx(_,v,g),t.bx(_,b,m),t.bx(_,b,g)),e.y===(1<<e.z)-1?x.push(t.bx(b,v,m),t.bx(b,v,g)):x.push(t.bx(y,v,m),t.bx(y,v,g),t.bx(y,b,m),t.bx(y,b,g)),new vn(x,[m,g,_,y,v,b],i,o)}}}function Sn(e,n){let r=1/0,i=-1/0;for(const o of n){const n=t.a$(e,o);r=Math.min(r,n),i=Math.max(i,n)}return{min:r,max:i}}class Tn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,n){return this._helper.interpolatePadding(e,t,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t){this._helper.resize(e,t)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=t.bz(),this._projectionMatrix=t.bd(),this._globeViewProjMatrix32f=t.bc(),this._globeViewProjMatrixNoCorrection=t.bd(),this._globeViewProjMatrixNoCorrectionInverted=t.bd(),this._globeProjMatrixInverted=t.bd(),this._cameraPosition=t.bt(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(e,n)=>{const r=t.ai(e.lat,-t.aj,t.aj),i=t.ai(+n,this.minZoom+fn(0,r),this.maxZoom);return{center:new t.U(e.lng,r),zoom:i}},this.applyConstrain=(e,t)=>this._helper.applyConstrain(e,t),this._helper=new Ot({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(e,t)=>this.defaultConstrain(e,t)},e),this._coveringTilesDetailsProvider=new wn}clone(){const e=new Tn;return e.apply(this),e}apply(e,t){this._globeLatitudeErrorCorrectionRadians=t||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=t.bt();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:t,applyGlobeMatrix:n}=e,r=this._helper.getMercatorTileCoordinates(t);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:r,clippingPlane:this._cachedClippingPlane,projectionTransition:n?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const n=this.pitchInRadians,r=this.cameraToCenterDistance/e,i=Math.sin(n)*r,o=Math.cos(n)*r+1,a=1/Math.sqrt(i*i+o*o)*1;let s=-i,l=o;const c=Math.sqrt(s*s+l*l);s/=c,l/=c;const u=[0,s,l];t.bA(u,u,[0,0,0],-this.bearingInRadians),t.bB(u,u,[0,0,0],-1*this.center.lat*Math.PI/180),t.bC(u,u,[0,0,0],this.center.lng*Math.PI/180);const h=1/t.b1(u);return t.aV(u,u,h),[...u,-a*h]}isLocationOccluded(e){return!this.isSurfacePointVisible(un(e))}transformLightDirection(e){const n=this._helper._center.lng*Math.PI/180,r=this._helper._center.lat*Math.PI/180,i=Math.cos(r),o=[Math.sin(n)*i,Math.sin(r),Math.cos(n)*i],a=[o[2],0,-o[0]],s=[0,0,0];t.a_(s,a,o),t.aZ(a,a),t.aZ(s,s);const l=[0,0,0];return t.aZ(l,[a[0]*e[0]+s[0]*e[1]+o[0]*e[2],a[1]*e[0]+s[1]*e[1]+o[1]*e[2],a[2]*e[0]+s[2]*e[1]+o[2]*e[2]]),l}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,n,r){const i=function(e,n,r){const i=1/(1<<r.z);return new t.a5(e/t.a3*i+r.x*i,n/t.a3*i+r.y*i)}(e,n,r.canonical),o=(a=i.y,[t.bs(i.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI]);var a;return this.getCircleRadiusCorrection()/Math.cos(o[1])}projectTileCoordinates(e,n,r,i){const o=r.canonical,a=cn(e,n,o.x,o.y,o.z),s=1+(i?i(e,n):0)/t.by,l=[a[0]*s,a[1]*s,a[2]*s,1];t.aB(l,l,this._globeViewProjMatrixNoCorrection);const c=this._cachedClippingPlane,u=c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]<0;return{point:new t.P(l[0]/l[3],l[1]/l[3]),signedDistanceFromCamera:l[3],isOccluded:u}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=hn(this.worldSize,this.center.lat),n=t.be(),r=t.be();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),t.b8(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const i=this.centerOffset;n[8]=2*-i.x/this._helper._width,n[9]=2*i.y/this._helper._height,this._projectionMatrix=t.b9(n),this._globeProjMatrixInverted=t.be(),t.av(this._globeProjMatrixInverted,n),t.N(n,n,[0,0,-this.cameraToCenterDistance]),t.ba(n,n,this.rollInRadians),t.bb(n,n,-this.pitchInRadians),t.ba(n,n,this.bearingInRadians),t.N(n,n,[0,0,-e]);const o=t.bt();o[0]=e,o[1]=e,o[2]=e,t.bb(r,n,this.center.lat*Math.PI/180),t.bD(r,r,-this.center.lng*Math.PI/180),t.O(r,r,o),this._globeViewProjMatrixNoCorrection=r,t.bb(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),t.bD(n,n,-this.center.lng*Math.PI/180),t.O(n,n,o),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=t.be(),t.av(this._globeViewProjMatrixNoCorrectionInverted,r);const a=t.bt();this._cameraPosition=t.bt(),this._cameraPosition[2]=this.cameraToCenterDistance/e,t.bA(this._cameraPosition,this._cameraPosition,a,-this.rollInRadians),t.bB(this._cameraPosition,this._cameraPosition,a,this.pitchInRadians),t.bA(this._cameraPosition,this._cameraPosition,a,-this.bearingInRadians),t.aW(this._cameraPosition,this._cameraPosition,[0,0,1]),t.bB(this._cameraPosition,this._cameraPosition,a,-this.center.lat*Math.PI/180),t.bC(this._cameraPosition,this._cameraPosition,a,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const s=t.b9(this._globeViewProjMatrixNoCorrectionInverted);t.O(s,s,[1,1,-1]),this._cachedFrustum=Nt.fromInvProjectionMatrix(s,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){t.w("calculateFogMatrix is not supported on globe projection.");const n=t.be();return t.am(n),n}getVisibleUnwrappedCoordinates(e){return[new t.b6(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&t.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const r=un(e);t.aV(r,r,1+n/t.by);const i=t.bz();return t.aB(i,[r[0],r[1],r[2],1],this._globeViewProjMatrixNoCorrection),i[2]/i[3]}populateCache(e){}getBounds(){const e=.5*this.width,n=.5*this.height,r=[new t.P(0,0),new t.P(e,0),new t.P(this.width,0),new t.P(this.width,n),new t.P(this.width,this.height),new t.P(e,this.height),new t.P(0,this.height),new t.P(0,n)],i=[];for(const t of r)i.push(this.unprojectScreenPoint(t));let o=0,a=0,s=0,l=0;const c=this.center;for(const h of i){const e=t.bE(c.lng,h.lng),n=t.bE(c.lat,h.lat);e<a&&(a=e),e>o&&(o=e),n<l&&(l=n),n>s&&(s=n)}const u=[c.lng+a,c.lat+l,c.lng+o,c.lat+s];return this.isSurfacePointOnScreen([0,1,0])&&(u[3]=90,u[0]=-180,u[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(u[1]=-90,u[0]=-180,u[2]=180),new H(u)}calculateCenterFromCameraLngLatAlt(e,t,n,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,n,r)}setLocationAtPoint(e,n){const r=un(this.unprojectScreenPoint(n)),i=un(e),o=t.bt();t.bF(o);const a=t.bt();t.bC(a,r,o,-this.center.lng*Math.PI/180),t.bB(a,a,o,this.center.lat*Math.PI/180);const s=i[0]*i[0]+i[2]*i[2],l=a[0]*a[0];if(s<l)return;const c=Math.sqrt(s-l),u=-c,h=t.bG(i[0],i[2],a[0],c),d=t.bG(i[0],i[2],a[0],u),p=t.bt();t.bC(p,i,o,-h);const f=t.bG(p[1],p[2],a[1],a[2]),m=t.bt();t.bC(m,i,o,-d);const g=t.bG(m[1],m[2],a[1],a[2]),_=.5*Math.PI,y=f>=-_&&f<=_,v=g>=-_&&g<=_;let b,x;if(y&&v){const e=this.center.lng*Math.PI/180,n=this.center.lat*Math.PI/180;t.bH(h,e)+t.bH(f,n)<t.bH(d,e)+t.bH(g,n)?(b=h,x=f):(b=d,x=g)}else if(y)b=h,x=f;else{if(!v)return;b=d,x=g}const w=b/Math.PI*180,S=x/Math.PI*180,T=this.center.lat;this.setCenter(new t.U(w,t.ai(S,-90,90))),this.setZoom(this.zoom+fn(T,this.center.lat))}locationToScreenPoint(e,n){const r=un(e);if(n){const i=n.getElevationForLngLatZoom(e,this._helper._tileZoom);t.aV(r,r,1+i/t.by)}return this._projectSurfacePointToScreen(r)}_projectSurfacePointToScreen(e){const n=t.bz();return t.aB(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new t.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,n){if(n){const t=n.pointCoordinate(e);if(t)return t}return t.a5.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,t){var n;return null===(n=this.screenPointToMercatorCoordinate(e,t))||void 0===n?void 0:n.toLngLat()}isPointOnMapSurface(e,t){const n=this._cameraPosition,r=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(n,r)}getRayDirectionFromPixel(e){const n=t.bz();n[0]=e.x/this.width*2-1,n[1]=-1*(e.y/this.height*2-1),n[2]=1,n[3]=1,t.aB(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const r=t.bt();r[0]=n[0]-this._cameraPosition[0],r[1]=n[1]-this._cameraPosition[1],r[2]=n[2]-this._cameraPosition[2];const i=t.bt();return t.aZ(i,r),i}isSurfacePointVisible(e){const t=this._cachedClippingPlane;return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const n=t.bz();return t.aB(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(e,n){const r=t.a$(e,n),i=t.bt(),o=t.bt();t.aV(o,n,r),t.aY(i,e,o);const a=1-t.a$(i,i);if(a<0)return null;const s=t.a$(e,e)-1,l=-r+(r<0?1:-1)*Math.sqrt(a),c=s/l,u=l;return{tMin:Math.min(c,u),tMax:Math.max(c,u)}}unprojectScreenPoint(e){const n=this._cameraPosition,r=this.getRayDirectionFromPixel(e),i=this.rayPlanetIntersection(n,r);if(i){const e=t.bt();t.aW(e,n,[r[0]*i.tMin,r[1]*i.tMin,r[2]*i.tMin]);const o=t.bt();return t.aZ(o,e),dn(o)}const o=this._cachedClippingPlane,a=o[0]*r[0]+o[1]*r[1]+o[2]*r[2],s=-t.b5(o,n)/a,l=t.bt();if(s>0)t.aW(l,n,[r[0]*s,r[1]*s,r[2]*s]);else{const e=t.bt();t.aW(e,n,[2*r[0],2*r[1],2*r[2]]);const i=t.b5(this._cachedClippingPlane,e);t.aY(l,e,[this._cachedClippingPlane[0]*i,this._cachedClippingPlane[1]*i,this._cachedClippingPlane[2]*i])}const c=function(e){const n=t.bt();return n[0]=e[0]*-e[3],n[1]=e[1]*-e[3],n[2]=e[2]*-e[3],{center:n,radius:Math.sqrt(1-e[3]*e[3])}}(o);return dn(function(e,n,r){const i=t.bt();t.aY(i,r,e);const o=t.bt();return t.bu(o,e,i,n/t.b3(i)),o}(c.center,c.radius,l))}getMatrixForModel(e,n){const r=t.U.convert(e),i=1/t.by,o=t.bd();return t.bD(o,o,r.lng/180*Math.PI),t.bb(o,o,-r.lat/180*Math.PI),t.N(o,o,[0,0,1+n/t.by]),t.bb(o,o,.5*Math.PI),t.O(o,o,[i,i,i]),o}getProjectionDataForCustomLayer(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=this.getProjectionData({overscaledTileID:new t.a0(0,0,0,0,0),applyGlobeMatrix:e});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(e){}}class En{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,n){return this._helper.interpolatePadding(e,t,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._helper.resize(e,t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,t){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=t,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(e,t)=>this.currentTransform.defaultConstrain(e,t),this.applyConstrain=(e,t)=>this._helper.applyConstrain(e,t),this._helper=new Ot({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(e,t)=>this.defaultConstrain(e,t)},e),this._globeness=1,this._mercatorTransform=new Ut,this._verticalPerspectiveTransform=new Tn}clone(){const e=new En;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const t=this._mercatorTransform.getProjectionData(e),n=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?n.mainMatrix:t.mainMatrix,clippingPlane:n.clippingPlane,tileMercatorCoords:n.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:t.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return t.bo(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return t.bo(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,n,r){const i=this._mercatorTransform.getPitchedTextCorrection(e,n,r),o=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,n,r);return t.bo(i,o,this._globeness)}projectTileCoordinates(e,t,n,r){return this.currentTransform.projectTileCoordinates(e,t,n,r)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,t){return this.currentTransform.lngLatToCameraDepth(e,t)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,t,n,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,n,r)}setLocationAtPoint(e,t){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,t),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,t),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,t){return this.currentTransform.locationToScreenPoint(e,t)}screenPointToMercatorCoordinate(e,t){return this.currentTransform.screenPointToMercatorCoordinate(e,t)}screenPointToLocation(e,t){return this.currentTransform.screenPointToLocation(e,t)}isPointOnMapSurface(e,t){return this.currentTransform.isPointOnMapSurface(e,t)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,t){return this.currentTransform.getMatrixForModel(e,t)}getProjectionDataForCustomLayer(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return t;const n=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return n.fallbackMatrix=t.mainMatrix,n}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class kn{get useGlobeControls(){return!0}handlePanInertia(e,n){const r=mn(e,n);return Math.abs(r.lng-n.center.lng)>180&&(r.lng=n.center.lng+179.5*Math.sign(r.lng-n.center.lng)),{easingCenter:r,easingOffset:new t.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,n){const r=e.around,i=n.screenPointToLocation(r);e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta);const o=n.zoom;e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta);const a=n.zoom-o;if(0===a)return;const s=t.bE(n.center.lng,i.lng),l=s/(Math.abs(s/180)+1),c=t.bE(n.center.lat,i.lat),u=n.getRayDirectionFromPixel(r),h=n.cameraPosition,d=-1*t.a$(h,u),p=t.bt();t.aW(p,h,[u[0]*d,u[1]*d,u[2]*d]);const f=t.b1(p)-1,m=Math.exp(.5*-Math.max(f-.3,0)),g=hn(n.worldSize,n.center.lat)/Math.min(n.width,n.height),_=t.br(g,.9,.5,1,.25),y=(1-t.al(-a))*Math.min(m,_),v=n.center.lat,b=n.zoom,x=new t.U(n.center.lng+l*y,t.ai(n.center.lat+c*y,-t.aj,t.aj));n.setLocationAtPoint(i,r);const w=n.center,S=t.br(Math.abs(s),45,85,0,1),T=t.br(g,.75,.35,0,1),E=Math.pow(Math.max(S,T),.25),k=t.bE(w.lng,x.lng),P=t.bE(w.lat,x.lat);n.setCenter(new t.U(w.lng+k*E,w.lat+P*E).wrap()),n.setZoom(b+fn(v,n.center.lat))}handleMapControlsPan(e,t,n){if(!e.panDelta)return;const r=t.center.lat,i=t.zoom;t.setCenter(mn(e.panDelta,t).wrap()),t.setZoom(i+fn(r,t.center.lat))}cameraForBoxAndBearing(e,n,r,i,o){const a=qt(e,n,r,i,o),s=n.left/o.width*2-1,l=(o.width-n.right)/o.width*2-1,c=n.top/o.height*-2+1,u=(o.height-n.bottom)/o.height*-2+1,h=t.bE(r.getWest(),r.getEast())<0,d=h?r.getEast():r.getWest(),p=h?r.getWest():r.getEast(),f=Math.max(r.getNorth(),r.getSouth()),m=Math.min(r.getNorth(),r.getSouth()),g=d+.5*t.bE(d,p),_=f+.5*t.bE(f,m),y=o.clone();y.setCenter(a.center),y.setBearing(a.bearing),y.setPitch(0),y.setRoll(0),y.setZoom(a.zoom);const v=y.modelViewProjectionMatrix,b=[un(r.getNorthWest()),un(r.getNorthEast()),un(r.getSouthWest()),un(r.getSouthEast()),un(new t.U(p,_)),un(new t.U(d,_)),un(new t.U(g,f)),un(new t.U(g,m))],x=un(a.center);let w=Number.POSITIVE_INFINITY;for(const t of b)s<0&&(w=kn.getLesserNonNegativeNonNull(w,kn.solveVectorScale(t,x,v,"x",s))),l>0&&(w=kn.getLesserNonNegativeNonNull(w,kn.solveVectorScale(t,x,v,"x",l))),c>0&&(w=kn.getLesserNonNegativeNonNull(w,kn.solveVectorScale(t,x,v,"y",c))),u<0&&(w=kn.getLesserNonNegativeNonNull(w,kn.solveVectorScale(t,x,v,"y",u)));if(Number.isFinite(w)&&0!==w)return a.zoom=y.zoom+t.ao(w),a;Vt()}handleJumpToCenterZoom(e,n){const r=e.center.lat,i=e.applyConstrain(n.center?t.U.convert(n.center):e.center,e.zoom).center;e.setCenter(i.wrap());const o=void 0!==n.zoom?+n.zoom:e.zoom+fn(r,i.lat);e.zoom!==o&&e.setZoom(o)}handleEaseTo(e,n){const r=e.zoom,i=e.center,o=e.padding,a={roll:e.roll,pitch:e.pitch,bearing:e.bearing},s={roll:void 0===n.roll?e.roll:n.roll,pitch:void 0===n.pitch?e.pitch:n.pitch,bearing:void 0===n.bearing?e.bearing:n.bearing},l=void 0!==n.zoom,c=!e.isPaddingEqual(n.padding);let u=!1;const h=n.center?t.U.convert(n.center):i,d=e.applyConstrain(h,r).center;Lt(e,d);const p=e.clone();p.setCenter(d),p.setZoom(l?+n.zoom:r+fn(i.lat,h.lat)),p.setBearing(n.bearing);const f=new t.P(t.ai(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),t.ai(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));p.setLocationAtPoint(d,f);const m=(n.offset&&n.offsetAsPoint.mag())>0?p.center:d,g=l?+n.zoom:r+fn(i.lat,m.lat),_=r+fn(i.lat,0),y=g+fn(m.lat,0),v=t.bE(i.lng,m.lng),b=t.bE(i.lat,m.lat),x=t.al(y-_);return u=g!==r,{easeFunc:r=>{if(t.bi(a,s)||Gt({startEulerAngles:a,endEulerAngles:s,tr:e,k:r,useSlerp:a.roll!=s.roll}),c&&e.interpolatePadding(o,n.padding,r),n.around)t.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(n.around,n.aroundPoint);else{const t=y>_?Math.min(2,x):Math.max(.5,x),n=Math.pow(t,1-r),o=_n(i,v,b,r*n);e.setCenter(o.wrap())}if(u){const n=t.F.number(_,y,r)+fn(0,e.center.lat);e.setZoom(n)}},isZooming:u,elevationCenter:m}}handleFlyTo(e,n){const r=void 0!==n.zoom,i=e.center,o=e.zoom,a=e.padding,s=!e.isPaddingEqual(n.padding),l=e.applyConstrain(t.U.convert(n.center||n.locationAtOffset),o).center,c=r?+n.zoom:e.zoom+fn(e.center.lat,l.lat),u=e.clone();u.setCenter(l),u.setZoom(c),u.setBearing(n.bearing);const h=new t.P(t.ai(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),t.ai(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));u.setLocationAtPoint(l,h);const d=u.center;Lt(e,d);const p=function(e,n,r){const i=un(n),o=un(r),a=t.a$(i,o),s=Math.acos(a),l=ln(e);return s/(2*Math.PI)*l}(e,i,d),f=o+fn(i.lat,0),m=c+fn(d.lat,0),g=t.al(m-f);let _;if("number"==typeof n.minZoom){const r=+n.minZoom+fn(d.lat,0),i=Math.min(r,f,m)+fn(0,d.lat),o=e.applyConstrain(d,i).zoom+fn(d.lat,0);_=t.al(o-f)}const y=t.bE(i.lng,d.lng),v=t.bE(i.lat,d.lat);return{easeFunc:(r,o,l,u)=>{const h=_n(i,y,v,l);s&&e.interpolatePadding(a,n.padding,r);const p=1===r?d:h;e.setCenter(p.wrap());const m=f+t.ao(o);e.setZoom(1===r?c:m+fn(0,p.lat))},scaleOfZoom:g,targetCenter:d,scaleOfMinZoom:_,pixelPathLength:p}}static solveVectorScale(e,t,n,r,i){const o="x"===r?[n[0],n[4],n[8],n[12]]:[n[1],n[5],n[9],n[13]],a=[n[3],n[7],n[11],n[15]],s=e[0]*o[0]+e[1]*o[1]+e[2]*o[2],l=e[0]*a[0]+e[1]*a[1]+e[2]*a[2],c=t[0]*o[0]+t[1]*o[1]+t[2]*o[2],u=t[0]*a[0]+t[1]*a[1]+t[2]*a[2];return c+i*l===s+i*u||a[3]*(s-c)+o[3]*(u-l)+s*u==c*l?null:(c+o[3]-i*u-i*a[3])/(c-s-i*u+i*l)}static getLesserNonNegativeNonNull(e,t){return null!==t&&t>=0&&t<e?t:e}}class Pn{constructor(e){this._globe=e,this._mercatorCameraHelper=new Zt,this._verticalPerspectiveCameraHelper=new kn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,t){return this.currentHelper.handlePanInertia(e,t)}handleMapControlsRollPitchBearingZoom(e,t){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,t)}handleMapControlsPan(e,t,n){this.currentHelper.handleMapControlsPan(e,t,n)}cameraForBoxAndBearing(e,t,n,r,i){return this.currentHelper.cameraForBoxAndBearing(e,t,n,r,i)}handleJumpToCenterZoom(e,t){this.currentHelper.handleJumpToCenterZoom(e,t)}handleEaseTo(e,t){return this.currentHelper.handleEaseTo(e,t)}handleFlyTo(e,t){return this.currentHelper.handleFlyTo(e,t)}}const Cn=(e,n)=>t.z(e,n&&n.filter(e=>"source.canvas"!==e.identifier)),In=t.bI();class An extends t.E{constructor(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r,i;super(),this._rtlPluginLoaded=()=>{for(const e in this.tileManagers){const t=this.tileManagers[e].getSource().type;"vector"!==t&&"geojson"!==t||this.tileManagers[e].reload()}},this.map=e,this.dispatcher=new N(B(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(e,t)=>this.getGlyphs(e,t)),this.dispatcher.registerMessageHandler("GI",(e,t)=>this.getImages(e,t)),this.dispatcher.registerMessageHandler("GDA",(e,t)=>this.getDashes(e,t)),this.imageManager=new w,this.imageManager.setEventedParent(this);const o=(null===(r=e._container)||void 0===r?void 0:r.lang)||"undefined"!=typeof document&&(null===(i=document.documentElement)||void 0===i?void 0:i.lang)||void 0;this.glyphManager=new P(e._requestManager,n.localIdeographFontFamily,o),this.lineAtlas=new D(256,512),this.crossTileSymbolIndex=new Et,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",t.bJ()),ce().on(ae,this._rtlPluginLoaded),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.tileManagers[e.sourceId];if(!t)return;const n=t.getSource();if(n&&n.vectorLayerIds)for(const r in this._layers){const e=this._layers[r];e.source===n.id&&this._validateLayer(e)}})}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new t.bK,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new((null===(e=this.crossTileSymbolIndex)||void 0===e?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,n){var r,i,o;this._checkLoaded();const a=null===n?null!==(o=null===(i=null===(r=this.stylesheet.state)||void 0===r?void 0:r[e])||void 0===i?void 0:i.default)&&void 0!==o?o:null:n;if(t.bL(a,this._globalState[e]))return this;this._globalState[e]=a,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const n=[];for(const r in e)!t.bL(this._globalState[r],e[r].default)&&(n.push(r),this._globalState[r]=e[r].default);this._applyGlobalStateChanges(n)}_applyGlobalStateChanges(e){if(0===e.length)return;const t=new Set,n={};for(const r of e){n[r]=this._globalState[r];for(const e in this._layers){const n=this._layers[e],i=n.getLayoutAffectingGlobalStateRefs(),o=n.getPaintAffectingGlobalStateRefs();if(i.has(r)&&t.add(n.source),o.has(r))for(const{name:e,value:t}of o.get(r))this._updatePaintProperty(n,e,t)}}this.dispatcher.broadcast("UGS",n);for(const r in this.tileManagers)t.has(r)&&(this._reloadSource(r),this._changed=!0)}loadURL(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;this.fire(new t.l("dataloading",{dataType:"style"})),n.validate="boolean"!=typeof n.validate||n.validate;const i=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const o=this._loadStyleRequest;t.j(i,this._loadStyleRequest).then(e=>{this._loadStyleRequest=null,this._load(e.data,n,r)}).catch(e=>{this._loadStyleRequest=null,e&&!o.signal.aborted&&this.fire(new t.k(e))})}loadJSON(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;this.fire(new t.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,s.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=!1!==n.validate,this._load(e,n,r)}).catch(()=>{})}loadEmpty(){this.fire(new t.l("dataloading",{dataType:"style"})),this._load(In,{validate:!1})}_load(e,n,r){var i,o;let a=n.transformStyle?n.transformStyle(r,e):e;if(!n.validate||!Cn(this,t.B(a))){a=Object.assign({},a),this._loaded=!0,this.stylesheet=a;for(const e in a.sources)this.addSource(e,a.sources[e],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs),this._createLayers(),this.light=new A(this.stylesheet.light),this._setProjectionInternal((null===(i=this.stylesheet.projection)||void 0===i?void 0:i.type)||"mercator"),this.sky=new R(this.stylesheet.sky),this.map.setTerrain(null!==(o=this.stylesheet.terrain)&&void 0!==o?o:null),this.fire(new t.l("data",{dataType:"style"})),this.fire(new t.l("style.load"))}}_createLayers(){var e,n,r;const i=t.bM(this.stylesheet.layers);this.setGlobalState(null!==(e=this.stylesheet.state)&&void 0!==e?e:null),this.dispatcher.broadcast("SL",i),this._order=i.map(e=>e.id),this._layers={},this._serializedLayers=null;for(const o of i){const e=t.bN(o,this._globalState);if(e.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=e,t.bO(e)&&this.tileManagers[e.source]){const t=null!==(r=null===(n=o.paint)||void 0===n?void 0:n["raster-fade-duration"])&&void 0!==r?r:e.paint.get("raster-fade-duration");this.tileManagers[e.source].setRasterFadeDuration(t)}}}_loadSprite(e){let n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(e,n,r,i){return t._(this,void 0,void 0,function*(){const o=v(e),a=r>1?"@2x":"",l={},c={};for(const{id:e,url:r}of o){const o=n.transformRequest(b(r,a,".json"),"SpriteJSON");l[e]=t.j(o,i);const s=n.transformRequest(b(r,a,".png"),"SpriteImage");c[e]=_.getImage(s,i)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(e,n){return t._(this,void 0,void 0,function*(){const t={};for(const r in e){t[r]={};const i=s.getImageCanvasContext((yield n[r]).data),o=(yield e[r]).data;for(const e in o){const{width:n,height:a,x:s,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m}=o[e];t[r][e]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m,spriteData:{width:n,height:a,x:s,y:l,context:i}}}}return t})}(l,c)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(e=>{if(this._spriteRequest=null,e)for(const t in e){this._spritesImagesIds[t]=[];const n=this._spritesImagesIds[t]?this._spritesImagesIds[t].filter(t=>!(t in e)):[];for(const e of n)this.imageManager.removeImage(e),this._changedImages[e]=!0;for(const i in e[t]){const n="default"===t?i:"".concat(t,":").concat(i);this._spritesImagesIds[t].push(n),n in this.imageManager.images?this.imageManager.updateImage(n,e[t][i],!1):this.imageManager.addImage(n,e[t][i]),r&&(this._changedImages[n]=!0)}}}).catch(e=>{this._spriteRequest=null,n=e,this.fire(new t.k(n))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"})),i&&i(n)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}_validateLayer(e){const n=this.tileManagers[e.source];if(!n)return;const r=e.sourceLayer;if(!r)return;const i=n.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.k(new Error('Source layer "'.concat(r,'" does not exist on source "').concat(i.id,'" as specified by style layer "').concat(e.id,'".'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this._serializedAllLayers();if(!e||0===e.length)return Object.values(n?t.bP(r):r);const i=[];for(const o of e)if(r[o]){const e=n?t.bP(r[o]):r[o];i.push(e)}return i}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const t=Object.keys(this._layers);for(const n of t){const t=this._layers[n];"custom"!==t.type&&(e[n]=t.serialize())}return e}hasTransitions(){var e,t,n;if(null===(e=this.light)||void 0===e?void 0:e.hasTransition())return!0;if(null===(t=this.sky)||void 0===t?void 0:t.hasTransition())return!0;if(null===(n=this.projection)||void 0===n?void 0:n.hasTransition())return!0;for(const r in this.tileManagers)if(this.tileManagers[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const t=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(t.length||n.length)&&this._updateWorkerLayers(t,n);for(const e in this._updatedSources){const t=this._updatedSources[e];if("reload"===t)this._reloadSource(e);else{if("clear"!==t)throw new Error("Invalid action ".concat(t));this._clearSource(e)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const r in this._updatedPaintProps)this._layers[r].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const r={};for(const t in this.tileManagers){const e=this.tileManagers[t];r[t]=e.used,e.used=!1}for(const t of this._order){const n=this._layers[t];n.recalculate(e,this._availableImages),!n.isHidden(e.zoom)&&n.source&&(this.tileManagers[n.source].used=!0)}for(const i in r){const e=this.tileManagers[i];!!r[i]!=!!e.used&&e.fire(new t.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:i}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,n&&this.fire(new t.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;this._checkLoaded();const i=this.serialize();if(e=n.transformStyle?n.transformStyle(i,e):e,(null===(r=n.validate)||void 0===r||r)&&Cn(this,t.B(e)))return!1;(e=t.bP(e)).layers=t.bM(e.layers);const o=t.bQ(i,e),a=this._getOperationsToPerform(o);if(a.unimplemented.length>0)throw new Error("Unimplemented: ".concat(a.unimplemented.join(", "),"."));if(0===a.operations.length)return!1;for(const t of a.operations)t();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const t=[],n=[];for(const r of e)switch(r.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":t.push(()=>this.addLayer.apply(this,r.args));break;case"removeLayer":t.push(()=>this.removeLayer.apply(this,r.args));break;case"setPaintProperty":t.push(()=>this.setPaintProperty.apply(this,r.args));break;case"setLayoutProperty":t.push(()=>this.setLayoutProperty.apply(this,r.args));break;case"setFilter":t.push(()=>this.setFilter.apply(this,r.args));break;case"addSource":t.push(()=>this.addSource.apply(this,r.args));break;case"removeSource":t.push(()=>this.removeSource.apply(this,r.args));break;case"setLayerZoomRange":t.push(()=>this.setLayerZoomRange.apply(this,r.args));break;case"setLight":t.push(()=>this.setLight.apply(this,r.args));break;case"setGeoJSONSourceData":t.push(()=>this.setGeoJSONSourceData.apply(this,r.args));break;case"setGlyphs":t.push(()=>this.setGlyphs.apply(this,r.args));break;case"setSprite":t.push(()=>this.setSprite.apply(this,r.args));break;case"setTerrain":t.push(()=>this.map.setTerrain.apply(this,r.args));break;case"setSky":t.push(()=>this.setSky.apply(this,r.args));break;case"setProjection":this.setProjection.apply(this,r.args);break;case"setGlobalState":t.push(()=>this.setGlobalState.apply(this,r.args));break;case"setTransition":t.push(()=>{});break;default:n.push(r.command)}return{operations:t,unimplemented:n}}addImage(e,n){if(this.getImage(e))return this.fire(new t.k(new Error('An image named "'.concat(e,'" already exists.'))));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new t.k(new Error('An image named "'.concat(e,'" does not exist.'))));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.tileManagers[e])throw new Error('Source "'.concat(e,'" already exists.'));if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(n).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.B.source,"sources.".concat(e),n,null,r))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const i=this.tileManagers[e]=new Pe(e,n,this.dispatcher);i.style=this,i.setEventedParent(this,()=>({isSourceLoaded:i.loaded(),source:i.serialize(),sourceId:e})),i.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.tileManagers[e])throw new Error("There is no source with this ID");for(const r in this._layers)if(this._layers[r].source===e)return this.fire(new t.k(new Error('Source "'.concat(e,'" cannot be removed while layer "').concat(r,'" is using it.'))));const n=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],n.fire(new t.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){if(this._checkLoaded(),void 0===this.tileManagers[e])throw new Error("There is no source with this ID=".concat(e));const n=this.tileManagers[e].getSource();if("geojson"!==n.type)throw new Error("geojsonSource.type is ".concat(n.type,", which is !== 'geojson"));n.setData(t),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=e.id;if(this.getLayer(i))return void this.fire(new t.k(new Error('Layer "'.concat(i,'" already exists on this map.'))));let o;if("custom"===e.type){if(Cn(this,t.bR(e)))return;o=t.bN(e,this._globalState)}else{if("source"in e&&"object"==typeof e.source&&(this.addSource(i,e.source),e=t.bP(e),e=t.e(e,{source:i})),this._validate(t.B.layer,"layers.".concat(i),e,{arrayIndex:-1},r))return;o=t.bN(e,this._globalState),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}})}const a=n?this._order.indexOf(n):this._order.length;if(n&&-1===a)this.fire(new t.k(new Error('Cannot add layer "'.concat(i,'" before non-existing layer "').concat(n,'".'))));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){const e=this._removedLayers[i];delete this._removedLayers[i],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.tileManagers[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.k(new Error("The layer '".concat(e,"' does not exist in the map's style and cannot be moved."))));if(e===n)return;const r=this._order.indexOf(e);this._order.splice(r,1);const i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.k(new Error('Cannot move layer "'.concat(e,'" before non-existing layer "').concat(n,'".')))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new t.k(new Error('Cannot remove non-existing layer "'.concat(e,'".'))));n.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,r){this._checkLoaded();const i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.k(new Error('Cannot set the zoom range of non-existing layer "'.concat(e,'".'))))}setFilter(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this.getLayer(e);if(i){if(!t.bL(i.filter,n))return null==n?(i.setFilter(void 0),void this._updateLayer(i)):void(this._validate(t.B.filter,"layers.".concat(i.id,".filter"),n,null,r)||(i.setFilter(t.bP(n)),this._updateLayer(i)))}else this.fire(new t.k(new Error('Cannot filter non-existing layer "'.concat(e,'".'))))}getFilter(e){return t.bP(this.getLayer(e).filter)}setLayoutProperty(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this.getLayer(e);o?t.bL(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),this._updateLayer(o)):this.fire(new t.k(new Error('Cannot style non-existing layer "'.concat(e,'".'))))}getLayoutProperty(e,n){const r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.k(new Error('Cannot get style of non-existing layer "'.concat(e,'".'))))}setPaintProperty(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this.getLayer(e);o?t.bL(o.getPaintProperty(n),r)||this._updatePaintProperty(o,n,r,i):this.fire(new t.k(new Error('Cannot style non-existing layer "'.concat(e,'".'))))}_updatePaintProperty(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.setPaintProperty(n,r,i)&&this._updateLayer(e),t.bO(e)&&"raster-fade-duration"===n&&this.tileManagers[e.source].setRasterFadeDuration(r),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(e,n){this._checkLoaded();const r=e.source,i=e.sourceLayer,o=this.tileManagers[r];if(void 0===o)return void this.fire(new t.k(new Error("The source '".concat(r,"' does not exist in the map's style."))));const a=o.getSource().type;"geojson"===a&&i?this.fire(new t.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||i?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),o.setFeatureState(i,e.id,n)):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const r=e.source,i=this.tileManagers[r];if(void 0===i)return void this.fire(new t.k(new Error("The source '".concat(r,"' does not exist in the map's style."))));const o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0;"vector"!==o||a?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.k(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(a,e.id,n):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,r=e.sourceLayer,i=this.tileManagers[n];if(void 0!==i)return"vector"!==i.getSource().type||r?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),i.getFeatureState(r,e.id)):void this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.k(new Error("The source '".concat(n,"' does not exist in the map's style."))))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=t.bS(this.tileManagers,e=>e.serialize()),n=this._serializeByIds(this._order,!0),r=this.map.getTerrain()||void 0,i=this.stylesheet;return t.bT({version:i.version,name:i.name,metadata:i.metadata,light:i.light,sky:i.sky,center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch,sprite:i.sprite,glyphs:i.glyphs,transition:i.transition,projection:i.projection,sources:e,layers:n,terrain:r},e=>void 0!==e)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.tileManagers[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,n={},r=[];for(let o=this._order.length-1;o>=0;o--){const i=this._order[o];if(t(i)){n[i]=o;for(const t of e){const e=t[i];if(e)for(const t of e)r.push(t)}}}r.sort((e,t)=>t.intersectionZ-e.intersectionZ);const i=[];for(let o=this._order.length-1;o>=0;o--){const a=this._order[o];if(t(a))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(n[t.layer.id]<o)break;i.push(t),r.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)i.push(t.feature)}}return i}queryRenderedFeatures(e,n,r){n&&n.filter&&this._validate(t.B.filter,"queryRenderedFeatures.filter",n.filter,null,n);const i={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new t.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const e of n.layers){const n=this._layers[e];if(!n)return this.fire(new t.k(new Error("The layer '".concat(e,"' does not exist in the map's style and cannot be queried for features.")))),[];i[n.source]=!0}}const o=[];n.availableImages=this._availableImages;const a=this._serializedAllLayers(),s=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,l=Object.assign(Object.assign({},n),{layers:s,globalState:this._globalState});for(const t in this.tileManagers)n.layers&&!i[t]||o.push(G(this.tileManagers[t],this._layers,a,e,l,r,this.map.terrain?(e,t,n)=>this.map.terrain.getElevation(e,t,n):void 0));return this.placement&&o.push(function(e,t,n,r,i,o,a){const s={},l=o.queryRenderedSymbols(r),c=[];for(const u of Object.keys(l).map(Number))c.push(a[u]);c.sort(q);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],t,u.bucketIndex,u.sourceLayerIndex,{filterSpec:i.filter,globalState:i.globalState},i.layers,i.availableImages,e);for(const e in n){const t=s[e]=s[e]||[],r=n[e];r.sort((e,t)=>{const n=u.featureSortOrder;if(n){const r=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-r}return t.featureIndex-e.featureIndex});for(const e of r)t.push(e)}}return function(e,t,n){for(const r in e)for(const i of e[r])Z(i,n[t[r].source]);return e}(s,e,n)}(this._layers,a,this.tileManagers,e,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,n){(null==n?void 0:n.filter)&&this._validate(t.B.filter,"querySourceFeatures.filter",n.filter,null,n);const r=this.tileManagers[e];return r?function(e,t){const n=e.getRenderableIds().map(t=>e.getTileByID(t)),r=[],i={};for(let o=0;o<n.length;o++){const e=n[o],a=e.tileID.canonical.key;i[a]||(i[a]=!0,e.querySourceFeatures(r,t))}return r}(r,n?Object.assign(Object.assign({},n),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded();const r=this.light.getLight();let i=!1;for(const a in e)if(!t.bL(e[a],r[a])){i=!0;break}if(!i)return;const o={now:c(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(o)}getProjection(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.sky}setSky(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded();const r=this.getSky();let i=!1;if(!e&&!r)return;if(e&&!r)i=!0;else if(!e&&r)i=!0;else for(const a in e)if(!t.bL(e[a],r[a])){i=!0;break}if(!i)return;const o={now:c(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(o)}_setProjectionInternal(e){const n=function(e,n){const r={constrainOverride:n};if(Array.isArray(e)){const t=new sn({type:e});return{projection:t,transform:new En(r),cameraHelper:new Pn(t)}}switch(e){case"mercator":return{projection:new Dt,transform:new Ut(r),cameraHelper:new Zt};case"globe":{const e=new sn({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:e,transform:new En(r),cameraHelper:new Pn(e)}}case"vertical-perspective":return{projection:new on,transform:new Tn(r),cameraHelper:new kn};default:return t.w("Unknown projection name: ".concat(e,". Falling back to mercator projection.")),{projection:new Dt,transform:new Ut(r),cameraHelper:new Zt}}}(e,this.map.transformConstrain);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const t in this.tileManagers)this.tileManagers[t].reload()}_validate(e,n,r,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!o||!1!==o.validate)&&Cn(this,e.call(t.B,t.e({key:n,style:this.serialize(),value:r,styleSpec:t.u},i)))}_remove(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ce().off(ae,this._rtlPluginLoaded);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.tileManagers){const e=this.tileManagers[t];e.setEventedParent(null),e.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(const t in this.tileManagers)this.tileManagers[t].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=!1,a=!1;const s={};for(const l of this._order){const t=this._layers[l];if("symbol"!==t.type)continue;if(!s[t.source]){const e=this.tileManagers[t.source];s[t.source]=e.getRenderableIds(!0).map(t=>e.getTileByID(t)).sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const n=this.crossTileSymbolIndex.addLayer(t,s[t.source],e.center.lng);o=o||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((i=i||this._layerOrderChanged||0===n)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c(),e.zoom))&&(this.pauseablePlacement=new bt(e,this.map.terrain,this._order,i,t,n,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const l of this._order){const e=this._layers[l];"symbol"===e.type&&this.placement.updateLayerOpacities(e,s[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c())}_releaseSymbolFadeTiles(){for(const e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,n){return t._(this,void 0,void 0,function*(){const e=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const t=this.tileManagers[n.source];return t&&t.setDependencies(n.tileID.key,n.type,n.icons),e})}getGlyphs(e,n){return t._(this,void 0,void 0,function*(){const e=yield this.glyphManager.getGlyphs(n.stacks),t=this.tileManagers[n.source];return t&&t.setDependencies(n.tileID.key,n.type,[""]),e})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded(),e&&this._validate(t.B.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,n){return t._(this,void 0,void 0,function*(){const e={};for(const[t,r]of Object.entries(n.dashes))e[t]=this.lineAtlas.getDash(r.dasharray,r.round);return e})}addSprite(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const o=[{id:e,url:n}],a=[...v(this.stylesheet.sprite),...o];this._validate(t.B.sprite,"sprite",a,null,r)||(this.stylesheet.sprite=a,this._loadSprite(o,!0,i))}removeSprite(e){this._checkLoaded();const n=v(this.stylesheet.sprite);if(n.find(t=>t.id===e)){if(this._spritesImagesIds[e])for(const t of this._spritesImagesIds[e])this.imageManager.removeImage(t),this._changedImages[t]=!0;n.splice(n.findIndex(t=>t.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}else this.fire(new t.k(new Error('Sprite "'.concat(e,"\" doesn't exists on this map."))))}getSprite(){return v(this.stylesheet.sprite)}setSprite(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),e&&this._validate(t.B.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,r):(this._unloadSprite(),r&&r(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const e in this.tileManagers){const t=this.tileManagers[e];if(t.setEventedParent(null),t._tiles){for(const e in t._tiles)t._tiles[e].unloadVectorData();t._tiles={}}t._cache.reset(),t.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const e in this._layers){const t=this._layers[e];t.setEventedParent(null),t.onRemove&&t.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Mn=t.aO([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Rn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,n,r,i,o,a,s,l){this.context=e;let c=this.boundPaintVertexBuffers.length!==r.length;for(let u=0;!c&&u<r.length;u++)this.boundPaintVertexBuffers[u]!==r[u]&&(c=!0);!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||c||this.boundIndexBuffer!==i||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==a||this.boundDynamicVertexBuffer2!==s||this.boundDynamicVertexBuffer3!==l?this.freshBind(t,n,r,i,o,a,s,l):(e.bindVertexArray.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind(),l&&l.bind())}freshBind(e,t,n,r,i,o,a,s){const l=e.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a,this.boundDynamicVertexBuffer3=s,t.enableAttributes(u,e);for(const h of n)h.enableAttributes(u,e);o&&o.enableAttributes(u,e),a&&a.enableAttributes(u,e),s&&s.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i);for(const h of n)h.bind(),h.setVertexAttribPointers(u,e,i);o&&(o.bind(),o.setVertexAttribPointers(u,e,i)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(u,e,i)),s&&(s.bind(),s.setVertexAttribPointers(u,e,i)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Dn=(e,n,r,i,o)=>({u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:r?r.properties.get("fog-color"):t.bj.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?0:r?r.calculateFogBlendOpacity(i):0,u_horizon_color:r?r.properties.get("horizon-color"):t.bj.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:o?1:0}),zn={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ln(e){const t=[];for(let n=0;n<e.length;n++){if(null===e[n])continue;const r=e[n].split(" ");t.push(r.pop())}return t}class jn{constructor(e,n,r,i,o,a,s,l){let c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];const u=e.gl;this.program=u.createProgram();const h=Ln(n.staticAttributes),d=r?r.getBinderAttributes():[],p=h.concat(d),f=Pt.prelude.staticUniforms?Ln(Pt.prelude.staticUniforms):[],m=s.staticUniforms?Ln(s.staticUniforms):[],g=n.staticUniforms?Ln(n.staticUniforms):[],_=r?r.getBinderUniforms():[],y=f.concat(m).concat(g).concat(_),v=[];for(const t of y)v.indexOf(t)<0&&v.push(t);const b=r?r.defines():[];$t(u)&&b.unshift("#version 300 es"),o&&b.push("#define OVERDRAW_INSPECTOR;"),a&&b.push("#define TERRAIN3D;"),l&&b.push(l),c&&b.push(...c);let x=b.concat(Pt.prelude.fragmentSource,s.fragmentSource,n.fragmentSource).join("\n"),w=b.concat(Pt.prelude.vertexSource,s.vertexSource,n.vertexSource).join("\n");$t(u)||(x=function(e){return e.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(x),w=function(e){return e.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(w));const S=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(S,x),u.compileShader(S),!u.getShaderParameter(S,u.COMPILE_STATUS))throw new Error("Could not compile fragment shader: ".concat(u.getShaderInfoLog(S)));u.attachShader(this.program,S);const T=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(T,w),u.compileShader(T),!u.getShaderParameter(T,u.COMPILE_STATUS))throw new Error("Could not compile vertex shader: ".concat(u.getShaderInfoLog(T)));u.attachShader(this.program,T),this.attributes={};const E={};this.numAttributes=p.length;for(let t=0;t<this.numAttributes;t++)p[t]&&(u.bindAttribLocation(this.program,t,p[t]),this.attributes[p[t]]=t);if(u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw new Error("Program failed to link: ".concat(u.getProgramInfoLog(this.program)));u.deleteShader(T),u.deleteShader(S);for(let t=0;t<v.length;t++){const e=v[t];if(e&&!E[e]){const t=u.getUniformLocation(this.program,e);t&&(E[e]=t)}}this.fixedUniforms=i(e,E),this.terrainUniforms=((e,n)=>({u_depth:new t.bU(e,n.u_depth),u_terrain:new t.bU(e,n.u_terrain),u_terrain_dim:new t.bk(e,n.u_terrain_dim),u_terrain_matrix:new t.bW(e,n.u_terrain_matrix),u_terrain_unpack:new t.bX(e,n.u_terrain_unpack),u_terrain_exaggeration:new t.bk(e,n.u_terrain_exaggeration)}))(e,E),this.projectionUniforms=((e,n)=>({u_projection_matrix:new t.bW(e,n.u_projection_matrix),u_projection_tile_mercator_coords:new t.bX(e,n.u_projection_tile_mercator_coords),u_projection_clipping_plane:new t.bX(e,n.u_projection_clipping_plane),u_projection_transition:new t.bk(e,n.u_projection_transition),u_projection_fallback_matrix:new t.bW(e,n.u_projection_fallback_matrix)}))(e,E),this.binderUniforms=r?r.getUniforms(e,E):[]}draw(e,t,n,r,i,o,a,s,l,c,u,h,d,p,f,m,g,_,y){const v=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(r),e.setColorMode(i),e.setCullFace(o),s){e.activeTexture.set(v.TEXTURE2),v.bindTexture(v.TEXTURE_2D,s.depthTexture),e.activeTexture.set(v.TEXTURE3),v.bindTexture(v.TEXTURE_2D,s.texture);for(const e in this.terrainUniforms)this.terrainUniforms[e].set(s[e])}if(l)for(const x in l)this.projectionUniforms[zn[x]].set(l[x]);if(a)for(const x in this.fixedUniforms)this.fixedUniforms[x].set(a[x]);m&&m.setUniforms(e,this.binderUniforms,p,{zoom:f});let b=0;switch(t){case v.LINES:b=2;break;case v.TRIANGLES:b=3;break;case v.LINE_STRIP:b=1}for(const x of d.get()){const n=x.vaos||(x.vaos={});(n[c]||(n[c]=new Rn)).bind(e,this,u,m?m.getPaintVertexBuffers():[],h,x.vertexOffset,g,_,y),v.drawElements(t,x.primitiveLength*b,v.UNSIGNED_SHORT,x.primitiveOffset*b*2)}}}function On(e,n,r){const i=1/t.aH(r,1,n.transform.tileZoom),o=Math.pow(2,r.tileID.overscaledZ),a=r.tileSize*Math.pow(2,n.transform.tileZoom)/o,s=a*(r.tileID.canonical.x+r.tileID.wrap*o),l=a*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,l>>16],u_pixel_coord_lower:[65535&s,65535&l]}}const Fn=(e,n,r,i)=>{const o=e.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],l=t.b_();"viewport"===o.properties.get("anchor")&&t.b$(l,e.transform.bearingInRadians),t.c0(s,s,l);const c=e.transform.transformLightDirection(s),u=o.properties.get("color");return{u_lightpos:s,u_lightpos_globe:c,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+n,u_opacity:r,u_fill_translate:i}},Bn=(e,n,r,i,o,a,s)=>t.e(Fn(e,n,r,i),On(a,e,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8}),Nn=(e,n,r,i)=>t.e(On(n,e,r),{u_fill_translate:i}),Un=(e,t)=>({u_world:e,u_fill_translate:t}),Vn=(e,n,r,i,o)=>t.e(Nn(e,n,r,o),{u_world:i}),Gn=(e,n,r,i,o)=>{const a=e.transform;let s,l,c=0;if("map"===r.paint.get("circle-pitch-alignment")){const e=t.aH(n,1,a.zoom);s=!0,l=[e,e],c=e/(t.a3*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*o}else s=!1,l=a.pixelsToGLUnits;return{u_camera_to_center_distance:a.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_pitch_with_map:+s,u_device_pixel_ratio:e.pixelRatio,u_extrude_scale:l,u_globe_extrude_scale:c,u_translate:i}},qn=e=>({u_pixel_extrude_scale:[1/e.width,1/e.height]}),Zn=e=>({u_viewport_size:[e.width,e.height]}),Wn=function(e){return{u_color:e,u_overlay:0,u_overlay_scale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1}},Hn=(e,n,r,i)=>{const o=t.aH(e,1,n)/(t.a3*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*i;return{u_extrude_scale:t.aH(e,1,n),u_intensity:r,u_globe_extrude_scale:o}},Xn=(e,n,r,i)=>{const o=t.M();t.c1(o,0,e.width,e.height,0,0,1);const a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:r,u_color_ramp:i,u_opacity:n.paint.get("heatmap-opacity")}},Kn=(e,t,n)=>{const r=n.paint.get("hillshade-accent-color");let i;switch(n.paint.get("hillshade-method")){case"basic":i=4;break;case"combined":i=1;break;case"igor":i=2;break;case"multidirectional":i=3;break;default:i=0}const o=n.getIlluminationProperties();for(let a=0;a<o.directionRadians.length;a++)"viewport"===n.paint.get("hillshade-illumination-anchor")&&(o.directionRadians[a]+=e.transform.bearingInRadians);return{u_image:0,u_latrange:Jn(0,t.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:o.altitudeRadians,u_azimuths:o.directionRadians,u_accent:r,u_method:i,u_highlights:o.highlightColor,u_shadows:o.shadowColor}},Yn=(e,n)=>{const r=n.stride,i=t.M();return t.c1(i,0,t.a3,-t.a3,0,0,1),t.N(i,i,[0,-t.a3,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}};function Jn(e,n){const r=Math.pow(2,n.canonical.z),i=n.canonical.y;return[new t.a5(0,i/r).toLngLat().lat,new t.a5(0,(i+1)/r).toLngLat().lat]}const Qn=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:e.paint.get("color-relief-opacity")}},$n=(e,n,r,i)=>{const o=e.transform;return{u_translation:or(e,n,r),u_ratio:i/t.aH(n,1,o.zoom),u_device_pixel_ratio:e.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},er=(e,n,r,i,o)=>t.e($n(e,n,r,i),{u_image:0,u_image_height:o}),tr=(e,n,r,i,o)=>{const a=e.transform,s=ir(n,a);return{u_translation:or(e,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:i/t.aH(n,1,a.zoom),u_device_pixel_ratio:e.pixelRatio,u_image:0,u_scale:[s,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},nr=(e,n,r,i,o)=>{const a=ir(n,e.transform);return t.e($n(e,n,r,i),{u_tileratio:a,u_crossfade_from:o.fromScale,u_crossfade_to:o.toScale,u_image:0,u_mix:o.t,u_lineatlas_width:e.lineAtlas.width,u_lineatlas_height:e.lineAtlas.height})},rr=(e,n,r,i,o,a)=>{const s=ir(n,e.transform);return t.e($n(e,n,r,i),{u_image:0,u_image_height:a,u_tileratio:s,u_crossfade_from:o.fromScale,u_crossfade_to:o.toScale,u_image_dash:1,u_mix:o.t,u_lineatlas_width:e.lineAtlas.width,u_lineatlas_height:e.lineAtlas.height})};function ir(e,n){return 1/t.aH(e,1,n.tileZoom)}function or(e,n,r){return t.aI(e.transform,n,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const ar=(e,t,n,r,i)=>{return{u_tl_parent:e,u_scale_parent:t,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(a=r.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=r.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:sr(r.paint.get("raster-hue-rotate")),u_coords_top:[i[0].x,i[0].y,i[1].x,i[1].y],u_coords_bottom:[i[3].x,i[3].y,i[2].x,i[2].y]};var o,a};function sr(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const lr=(e,t,n,r,i,o,a,s,l,c,u,h,d)=>{const p=a.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:p.width/p.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+r,u_is_along_line:i,u_is_variable_anchor:o,u_texsize:h,u_texture:0,u_translation:c,u_pitched_scale:d}},cr=(e,n,r,i,o,a,s,l,c,u,h,d,p,f)=>{const m=s.transform;return t.e(lr(e,n,r,i,o,a,s,l,c,u,h,d,f),{u_gamma_scale:i?Math.cos(m.pitch*Math.PI/180)*m.cameraToCenterDistance:1,u_device_pixel_ratio:s.pixelRatio,u_is_halo:1})},ur=(e,n,r,i,o,a,s,l,c,u,h,d,p)=>t.e(cr(e,n,r,i,o,a,s,l,c,u,!0,h,0,p),{u_texsize_icon:d,u_texture_icon:1}),hr=(e,t)=>({u_opacity:e,u_color:t}),dr=(e,n,r,i,o)=>t.e(function(e,n,r,i){const o=r.imageManager.getPattern(e.from.toString()),a=r.imageManager.getPattern(e.to.toString()),{width:s,height:l}=r.imageManager.getPixelSize(),c=Math.pow(2,i.tileID.overscaledZ),u=i.tileSize*Math.pow(2,r.transform.tileZoom)/c,h=u*(i.tileID.canonical.x+i.tileID.wrap*c),d=u*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:o.tl,u_pattern_br_a:o.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,l],u_mix:n.t,u_pattern_size_a:o.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:n.fromScale,u_scale_b:n.toScale,u_tile_units_to_pixels:1/t.aH(i,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(r,o,n,i),{u_opacity:e}),pr=(e,t)=>{},fr={fillExtrusion:(e,n)=>({u_lightpos:new t.bY(e,n.u_lightpos),u_lightpos_globe:new t.bY(e,n.u_lightpos_globe),u_lightintensity:new t.bk(e,n.u_lightintensity),u_lightcolor:new t.bY(e,n.u_lightcolor),u_vertical_gradient:new t.bk(e,n.u_vertical_gradient),u_opacity:new t.bk(e,n.u_opacity),u_fill_translate:new t.bZ(e,n.u_fill_translate)}),fillExtrusionPattern:(e,n)=>({u_lightpos:new t.bY(e,n.u_lightpos),u_lightpos_globe:new t.bY(e,n.u_lightpos_globe),u_lightintensity:new t.bk(e,n.u_lightintensity),u_lightcolor:new t.bY(e,n.u_lightcolor),u_vertical_gradient:new t.bk(e,n.u_vertical_gradient),u_height_factor:new t.bk(e,n.u_height_factor),u_opacity:new t.bk(e,n.u_opacity),u_fill_translate:new t.bZ(e,n.u_fill_translate),u_image:new t.bU(e,n.u_image),u_texsize:new t.bZ(e,n.u_texsize),u_pixel_coord_upper:new t.bZ(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.bZ(e,n.u_pixel_coord_lower),u_scale:new t.bY(e,n.u_scale),u_fade:new t.bk(e,n.u_fade)}),fill:(e,n)=>({u_fill_translate:new t.bZ(e,n.u_fill_translate)}),fillPattern:(e,n)=>({u_image:new t.bU(e,n.u_image),u_texsize:new t.bZ(e,n.u_texsize),u_pixel_coord_upper:new t.bZ(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.bZ(e,n.u_pixel_coord_lower),u_scale:new t.bY(e,n.u_scale),u_fade:new t.bk(e,n.u_fade),u_fill_translate:new t.bZ(e,n.u_fill_translate)}),fillOutline:(e,n)=>({u_world:new t.bZ(e,n.u_world),u_fill_translate:new t.bZ(e,n.u_fill_translate)}),fillOutlinePattern:(e,n)=>({u_world:new t.bZ(e,n.u_world),u_image:new t.bU(e,n.u_image),u_texsize:new t.bZ(e,n.u_texsize),u_pixel_coord_upper:new t.bZ(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.bZ(e,n.u_pixel_coord_lower),u_scale:new t.bY(e,n.u_scale),u_fade:new t.bk(e,n.u_fade),u_fill_translate:new t.bZ(e,n.u_fill_translate)}),circle:(e,n)=>({u_camera_to_center_distance:new t.bk(e,n.u_camera_to_center_distance),u_scale_with_map:new t.bU(e,n.u_scale_with_map),u_pitch_with_map:new t.bU(e,n.u_pitch_with_map),u_extrude_scale:new t.bZ(e,n.u_extrude_scale),u_device_pixel_ratio:new t.bk(e,n.u_device_pixel_ratio),u_globe_extrude_scale:new t.bk(e,n.u_globe_extrude_scale),u_translate:new t.bZ(e,n.u_translate)}),collisionBox:(e,n)=>({u_pixel_extrude_scale:new t.bZ(e,n.u_pixel_extrude_scale)}),collisionCircle:(e,n)=>({u_viewport_size:new t.bZ(e,n.u_viewport_size)}),debug:(e,n)=>({u_color:new t.bV(e,n.u_color),u_overlay:new t.bU(e,n.u_overlay),u_overlay_scale:new t.bk(e,n.u_overlay_scale)}),depth:pr,clippingMask:pr,heatmap:(e,n)=>({u_extrude_scale:new t.bk(e,n.u_extrude_scale),u_intensity:new t.bk(e,n.u_intensity),u_globe_extrude_scale:new t.bk(e,n.u_globe_extrude_scale)}),heatmapTexture:(e,n)=>({u_matrix:new t.bW(e,n.u_matrix),u_world:new t.bZ(e,n.u_world),u_image:new t.bU(e,n.u_image),u_color_ramp:new t.bU(e,n.u_color_ramp),u_opacity:new t.bk(e,n.u_opacity)}),hillshade:(e,n)=>({u_image:new t.bU(e,n.u_image),u_latrange:new t.bZ(e,n.u_latrange),u_exaggeration:new t.bk(e,n.u_exaggeration),u_altitudes:new t.c3(e,n.u_altitudes),u_azimuths:new t.c3(e,n.u_azimuths),u_accent:new t.bV(e,n.u_accent),u_method:new t.bU(e,n.u_method),u_shadows:new t.c2(e,n.u_shadows),u_highlights:new t.c2(e,n.u_highlights)}),hillshadePrepare:(e,n)=>({u_matrix:new t.bW(e,n.u_matrix),u_image:new t.bU(e,n.u_image),u_dimension:new t.bZ(e,n.u_dimension),u_zoom:new t.bk(e,n.u_zoom),u_unpack:new t.bX(e,n.u_unpack)}),colorRelief:(e,n)=>({u_image:new t.bU(e,n.u_image),u_unpack:new t.bX(e,n.u_unpack),u_dimension:new t.bZ(e,n.u_dimension),u_elevation_stops:new t.bU(e,n.u_elevation_stops),u_color_stops:new t.bU(e,n.u_color_stops),u_color_ramp_size:new t.bU(e,n.u_color_ramp_size),u_opacity:new t.bk(e,n.u_opacity)}),line:(e,n)=>({u_translation:new t.bZ(e,n.u_translation),u_ratio:new t.bk(e,n.u_ratio),u_device_pixel_ratio:new t.bk(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.bZ(e,n.u_units_to_pixels)}),lineGradient:(e,n)=>({u_translation:new t.bZ(e,n.u_translation),u_ratio:new t.bk(e,n.u_ratio),u_device_pixel_ratio:new t.bk(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.bZ(e,n.u_units_to_pixels),u_image:new t.bU(e,n.u_image),u_image_height:new t.bk(e,n.u_image_height)}),linePattern:(e,n)=>({u_translation:new t.bZ(e,n.u_translation),u_texsize:new t.bZ(e,n.u_texsize),u_ratio:new t.bk(e,n.u_ratio),u_device_pixel_ratio:new t.bk(e,n.u_device_pixel_ratio),u_image:new t.bU(e,n.u_image),u_units_to_pixels:new t.bZ(e,n.u_units_to_pixels),u_scale:new t.bY(e,n.u_scale),u_fade:new t.bk(e,n.u_fade)}),lineSDF:(e,n)=>({u_translation:new t.bZ(e,n.u_translation),u_ratio:new t.bk(e,n.u_ratio),u_device_pixel_ratio:new t.bk(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.bZ(e,n.u_units_to_pixels),u_image:new t.bU(e,n.u_image),u_mix:new t.bk(e,n.u_mix),u_tileratio:new t.bk(e,n.u_tileratio),u_crossfade_from:new t.bk(e,n.u_crossfade_from),u_crossfade_to:new t.bk(e,n.u_crossfade_to),u_lineatlas_width:new t.bk(e,n.u_lineatlas_width),u_lineatlas_height:new t.bk(e,n.u_lineatlas_height)}),lineGradientSDF:(e,n)=>({u_translation:new t.bZ(e,n.u_translation),u_ratio:new t.bk(e,n.u_ratio),u_device_pixel_ratio:new t.bk(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.bZ(e,n.u_units_to_pixels),u_image:new t.bU(e,n.u_image),u_image_height:new t.bk(e,n.u_image_height),u_tileratio:new t.bk(e,n.u_tileratio),u_crossfade_from:new t.bk(e,n.u_crossfade_from),u_crossfade_to:new t.bk(e,n.u_crossfade_to),u_image_dash:new t.bU(e,n.u_image_dash),u_mix:new t.bk(e,n.u_mix),u_lineatlas_width:new t.bk(e,n.u_lineatlas_width),u_lineatlas_height:new t.bk(e,n.u_lineatlas_height)}),raster:(e,n)=>({u_tl_parent:new t.bZ(e,n.u_tl_parent),u_scale_parent:new t.bk(e,n.u_scale_parent),u_buffer_scale:new t.bk(e,n.u_buffer_scale),u_fade_t:new t.bk(e,n.u_fade_t),u_opacity:new t.bk(e,n.u_opacity),u_image0:new t.bU(e,n.u_image0),u_image1:new t.bU(e,n.u_image1),u_brightness_low:new t.bk(e,n.u_brightness_low),u_brightness_high:new t.bk(e,n.u_brightness_high),u_saturation_factor:new t.bk(e,n.u_saturation_factor),u_contrast_factor:new t.bk(e,n.u_contrast_factor),u_spin_weights:new t.bY(e,n.u_spin_weights),u_coords_top:new t.bX(e,n.u_coords_top),u_coords_bottom:new t.bX(e,n.u_coords_bottom)}),symbolIcon:(e,n)=>({u_is_size_zoom_constant:new t.bU(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bU(e,n.u_is_size_feature_constant),u_size_t:new t.bk(e,n.u_size_t),u_size:new t.bk(e,n.u_size),u_camera_to_center_distance:new t.bk(e,n.u_camera_to_center_distance),u_pitch:new t.bk(e,n.u_pitch),u_rotate_symbol:new t.bU(e,n.u_rotate_symbol),u_aspect_ratio:new t.bk(e,n.u_aspect_ratio),u_fade_change:new t.bk(e,n.u_fade_change),u_label_plane_matrix:new t.bW(e,n.u_label_plane_matrix),u_coord_matrix:new t.bW(e,n.u_coord_matrix),u_is_text:new t.bU(e,n.u_is_text),u_pitch_with_map:new t.bU(e,n.u_pitch_with_map),u_is_along_line:new t.bU(e,n.u_is_along_line),u_is_variable_anchor:new t.bU(e,n.u_is_variable_anchor),u_texsize:new t.bZ(e,n.u_texsize),u_texture:new t.bU(e,n.u_texture),u_translation:new t.bZ(e,n.u_translation),u_pitched_scale:new t.bk(e,n.u_pitched_scale)}),symbolSDF:(e,n)=>({u_is_size_zoom_constant:new t.bU(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bU(e,n.u_is_size_feature_constant),u_size_t:new t.bk(e,n.u_size_t),u_size:new t.bk(e,n.u_size),u_camera_to_center_distance:new t.bk(e,n.u_camera_to_center_distance),u_pitch:new t.bk(e,n.u_pitch),u_rotate_symbol:new t.bU(e,n.u_rotate_symbol),u_aspect_ratio:new t.bk(e,n.u_aspect_ratio),u_fade_change:new t.bk(e,n.u_fade_change),u_label_plane_matrix:new t.bW(e,n.u_label_plane_matrix),u_coord_matrix:new t.bW(e,n.u_coord_matrix),u_is_text:new t.bU(e,n.u_is_text),u_pitch_with_map:new t.bU(e,n.u_pitch_with_map),u_is_along_line:new t.bU(e,n.u_is_along_line),u_is_variable_anchor:new t.bU(e,n.u_is_variable_anchor),u_texsize:new t.bZ(e,n.u_texsize),u_texture:new t.bU(e,n.u_texture),u_gamma_scale:new t.bk(e,n.u_gamma_scale),u_device_pixel_ratio:new t.bk(e,n.u_device_pixel_ratio),u_is_halo:new t.bU(e,n.u_is_halo),u_translation:new t.bZ(e,n.u_translation),u_pitched_scale:new t.bk(e,n.u_pitched_scale)}),symbolTextAndIcon:(e,n)=>({u_is_size_zoom_constant:new t.bU(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bU(e,n.u_is_size_feature_constant),u_size_t:new t.bk(e,n.u_size_t),u_size:new t.bk(e,n.u_size),u_camera_to_center_distance:new t.bk(e,n.u_camera_to_center_distance),u_pitch:new t.bk(e,n.u_pitch),u_rotate_symbol:new t.bU(e,n.u_rotate_symbol),u_aspect_ratio:new t.bk(e,n.u_aspect_ratio),u_fade_change:new t.bk(e,n.u_fade_change),u_label_plane_matrix:new t.bW(e,n.u_label_plane_matrix),u_coord_matrix:new t.bW(e,n.u_coord_matrix),u_is_text:new t.bU(e,n.u_is_text),u_pitch_with_map:new t.bU(e,n.u_pitch_with_map),u_is_along_line:new t.bU(e,n.u_is_along_line),u_is_variable_anchor:new t.bU(e,n.u_is_variable_anchor),u_texsize:new t.bZ(e,n.u_texsize),u_texsize_icon:new t.bZ(e,n.u_texsize_icon),u_texture:new t.bU(e,n.u_texture),u_texture_icon:new t.bU(e,n.u_texture_icon),u_gamma_scale:new t.bk(e,n.u_gamma_scale),u_device_pixel_ratio:new t.bk(e,n.u_device_pixel_ratio),u_is_halo:new t.bU(e,n.u_is_halo),u_translation:new t.bZ(e,n.u_translation),u_pitched_scale:new t.bk(e,n.u_pitched_scale)}),background:(e,n)=>({u_opacity:new t.bk(e,n.u_opacity),u_color:new t.bV(e,n.u_color)}),backgroundPattern:(e,n)=>({u_opacity:new t.bk(e,n.u_opacity),u_image:new t.bU(e,n.u_image),u_pattern_tl_a:new t.bZ(e,n.u_pattern_tl_a),u_pattern_br_a:new t.bZ(e,n.u_pattern_br_a),u_pattern_tl_b:new t.bZ(e,n.u_pattern_tl_b),u_pattern_br_b:new t.bZ(e,n.u_pattern_br_b),u_texsize:new t.bZ(e,n.u_texsize),u_mix:new t.bk(e,n.u_mix),u_pattern_size_a:new t.bZ(e,n.u_pattern_size_a),u_pattern_size_b:new t.bZ(e,n.u_pattern_size_b),u_scale_a:new t.bk(e,n.u_scale_a),u_scale_b:new t.bk(e,n.u_scale_b),u_pixel_coord_upper:new t.bZ(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.bZ(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.bk(e,n.u_tile_units_to_pixels)}),terrain:(e,n)=>({u_texture:new t.bU(e,n.u_texture),u_ele_delta:new t.bk(e,n.u_ele_delta),u_fog_matrix:new t.bW(e,n.u_fog_matrix),u_fog_color:new t.bV(e,n.u_fog_color),u_fog_ground_blend:new t.bk(e,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new t.bk(e,n.u_fog_ground_blend_opacity),u_horizon_color:new t.bV(e,n.u_horizon_color),u_horizon_fog_blend:new t.bk(e,n.u_horizon_fog_blend),u_is_globe_mode:new t.bk(e,n.u_is_globe_mode)}),terrainDepth:(e,n)=>({u_ele_delta:new t.bk(e,n.u_ele_delta)}),terrainCoords:(e,n)=>({u_texture:new t.bU(e,n.u_texture),u_terrain_coords_id:new t.bk(e,n.u_terrain_coords_id),u_ele_delta:new t.bk(e,n.u_ele_delta)}),projectionErrorMeasurement:(e,n)=>({u_input:new t.bk(e,n.u_input),u_output_expected:new t.bk(e,n.u_output_expected)}),atmosphere:(e,n)=>({u_sun_pos:new t.bY(e,n.u_sun_pos),u_atmosphere_blend:new t.bk(e,n.u_atmosphere_blend),u_globe_position:new t.bY(e,n.u_globe_position),u_globe_radius:new t.bk(e,n.u_globe_radius),u_inv_proj_matrix:new t.bW(e,n.u_inv_proj_matrix)}),sky:(e,n)=>({u_sky_color:new t.bV(e,n.u_sky_color),u_horizon_color:new t.bV(e,n.u_horizon_color),u_horizon:new t.bZ(e,n.u_horizon),u_horizon_normal:new t.bZ(e,n.u_horizon_normal),u_sky_horizon_blend:new t.bk(e,n.u_sky_horizon_blend),u_sky_blend:new t.bk(e,n.u_sky_blend)})};class mr{constructor(e,t,n){this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _r{constructor(e,t,n,r){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;const i=e.gl;this.buffer=i.createBuffer(),e.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error("Length of new data is ".concat(e.length,", which doesn't match current length of ").concat(this.length));const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const r=t.attributes[this.attributes[n].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,n){for(let r=0;r<this.attributes.length;r++){const i=this.attributes[r],o=t.attributes[i.name];void 0!==o&&e.vertexAttribPointer(o,i.components,e[gr[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vr extends yr{getDefault(){return t.bj.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class br extends yr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class xr extends yr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class wr extends yr{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Sr extends yr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Tr extends yr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Er extends yr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class kr extends yr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Pr extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Cr extends yr{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ir extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ar extends yr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Mr extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class Rr extends yr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Dr extends yr{getDefault(){return t.bj.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class zr extends yr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Lr extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class jr extends yr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Or extends yr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Fr extends yr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Br extends yr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Nr extends yr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ur extends yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Vr extends yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Gr extends yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class qr extends yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Zr extends yr{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Wr extends yr{getDefault(){return null}set(e){var t;if(e===this.current&&!this.dirty)return;const n=this.gl;$t(n)?n.bindVertexArray(e):null===(t=n.getExtension("OES_vertex_array_object"))||void 0===t||t.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Hr extends yr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Xr extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Kr extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Yr extends yr{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Jr extends Yr{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Qr extends Yr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class $r extends Yr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const ei="Framebuffer is not complete";class ti{constructor(e,t,n,r,i){this.context=e,this.width=t,this.height=n;const o=e.gl,a=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new Jr(e,a),r)this.depthAttachment=i?new $r(e,a):new Qr(e,a);else if(i)throw new Error("Stencil cannot be set without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error(ei)}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class ni{constructor(e){var t,n;if(this.gl=e,this.clearColor=new vr(this),this.clearDepth=new br(this),this.clearStencil=new xr(this),this.colorMask=new wr(this),this.depthMask=new Sr(this),this.stencilMask=new Tr(this),this.stencilFunc=new Er(this),this.stencilOp=new kr(this),this.stencilTest=new Pr(this),this.depthRange=new Cr(this),this.depthTest=new Ir(this),this.depthFunc=new Ar(this),this.blend=new Mr(this),this.blendFunc=new Rr(this),this.blendColor=new Dr(this),this.blendEquation=new zr(this),this.cullFace=new Lr(this),this.cullFaceSide=new jr(this),this.frontFace=new Or(this),this.program=new Fr(this),this.activeTexture=new Br(this),this.viewport=new Nr(this),this.bindFramebuffer=new Ur(this),this.bindRenderbuffer=new Vr(this),this.bindTexture=new Gr(this),this.bindVertexBuffer=new qr(this),this.bindElementBuffer=new Zr(this),this.bindVertexArray=new Wr(this),this.pixelStoreUnpack=new Hr(this),this.pixelStoreUnpackPremultiplyAlpha=new Xr(this),this.pixelStoreUnpackFlipY=new Kr(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),$t(e)){this.HALF_FLOAT=e.HALF_FLOAT;const r=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(t=e.RGBA16F)&&void 0!==t?t:null==r?void 0:r.RGBA16F_EXT,this.RGB16F=null!==(n=e.RGB16F)&&void 0!==n?n:null==r?void 0:r.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const t=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==t?void 0:t.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new mr(this,e,t)}createVertexBuffer(e,t,n){return new _r(this,e,t,n)}createRenderbuffer(e,t,n){const r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),i}createFramebuffer(e,t,n,r){return new ti(this,e,t,n,r)}clear(e){let{color:t,depth:n,stencil:r}=e;const i=this.gl;let o=0;t&&(o|=i.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(o|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==r&&(o|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),i.clear(o)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.bL(e.blendFunction,Wt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return $t(this.gl)?this.gl.createVertexArray():null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var t;return $t(this.gl)?this.gl.deleteVertexArray(e):null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let ri;function ii(e,n,r,i,o){const a=e.context,s=e.transform,l=a.gl,c=e.useProgram("collisionBox"),u=[];let h=0,d=0;for(let t=0;t<i.length;t++){const p=i[t],f=n.getTile(p).getBucket(r);if(!f)continue;const m=o?f.textCollisionBox:f.iconCollisionBox,g=f.collisionCircleArray;g.length>0&&(u.push({circleArray:g,circleOffset:d,coord:p}),h+=g.length/4,d=h),m&&c.draw(a,l.LINES,Kt.disabled,Jt.disabled,e.colorModeForRenderPass(),Xt.disabled,qn(e.transform),e.style.map.terrain&&e.style.map.terrain.getTerrainData(p),s.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,e.transform.zoom,null,null,m.collisionVertexBuffer)}if(!o||!u.length)return;const p=e.useProgram("collisionCircle"),f=new t.c4;f.resize(4*h),f._trim();let m=0;for(const t of u)for(let e=0;e<t.circleArray.length/4;e++){const n=4*e,r=t.circleArray[n+0],i=t.circleArray[n+1],o=t.circleArray[n+2],a=t.circleArray[n+3];f.emplace(m++,r,i,o,a,0),f.emplace(m++,r,i,o,a,1),f.emplace(m++,r,i,o,a,2),f.emplace(m++,r,i,o,a,3)}(!ri||ri.length<2*h)&&(ri=function(e){const n=2*e,r=new t.c6;r.resize(n),r._trim();for(let t=0;t<n;t++){const e=6*t;r.uint16[e+0]=4*t+0,r.uint16[e+1]=4*t+1,r.uint16[e+2]=4*t+2,r.uint16[e+3]=4*t+2,r.uint16[e+4]=4*t+3,r.uint16[e+5]=4*t+0}return r}(h));const g=a.createIndexBuffer(ri,!0),_=a.createVertexBuffer(f,t.c5.members,!0);for(const y of u){const n=Zn(e.transform);p.draw(a,l.TRIANGLES,Kt.disabled,Jt.disabled,e.colorModeForRenderPass(),Xt.disabled,n,e.style.map.terrain&&e.style.map.terrain.getTerrainData(y.coord),null,r.id,_,g,t.aR.simpleSegment(0,2*y.circleOffset,y.circleArray.length,y.circleArray.length/2),null,e.transform.zoom,null,null,null)}_.destroy(),g.destroy()}const oi=t.am(new Float32Array(16));function ai(e,n,r,i,o,a){const{horizontalAlign:s,verticalAlign:l}=t.aM(e);return new t.P((-(s-.5)*n/o+i[0])*a,(-(l-.5)*r/o+i[1])*a)}function si(e,n,r,i,o,a){const s=n.tileAnchorPoint.add(new t.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let e=i.mult(a);r||(e=e.rotate(-o));const t=s.add(e);return je(t.x,t.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(r){const t=Ze(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(e),r=Math.atan(t.y/t.x)+(t.x<0?Math.PI:0);return e.add(i.rotate(r))}return e.add(i)}function li(e,n,r,i,o,a,s,l,c,u,h,d){const p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,m=e.icon.dynamicLayoutVertexArray,g={};f.clear();for(let _=0;_<p.length;_++){const m=p.get(_),y=m.hidden||!m.crossTileID||e.allowVerticalPlacement&&!m.placedOrientation?null:i[m.crossTileID];if(y){const i=new t.P(m.anchorX,m.anchorY),p={getElevation:d,width:o.width,height:o.height,pitchedLabelPlaneMatrix:a,pitchWithMap:r,transform:o,tileAnchorPoint:i,translation:u,unwrappedTileID:h},_=r?He(i.x,i.y,p):Ze(i.x,i.y,p),v=Oe(o.cameraToCenterDistance,_.signedDistanceFromCamera);let b=t.au(e.textSizeData,l,m)*v/t.aG;r&&(b*=e.tilePixelRatio/s);const{width:x,height:w,anchor:S,textOffset:T,textBoxScale:E}=y,k=ai(S,x,w,T,E,b),P=o.getPitchedTextCorrection(i.x+u[0],i.y+u[1],h),C=si(_.point,p,n,k,-o.bearingInRadians,P),I=e.allowVerticalPlacement&&m.placedOrientation===t.at.vertical?Math.PI/2:0;for(let e=0;e<m.numGlyphs;e++)t.aA(f,C,I);c&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:C,angle:I})}else Qe(m.numGlyphs,f)}if(c){m.clear();const n=e.icon.placedSymbolArray;for(let e=0;e<n.length;e++){const r=n.get(e);if(r.hidden)Qe(r.numGlyphs,m);else{const n=g[e];if(n)for(let e=0;e<r.numGlyphs;e++)t.aA(m,n.shiftedAnchor,n.angle);else Qe(r.numGlyphs,m)}}e.icon.dynamicLayoutVertexBuffer.updateData(m)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function ci(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function ui(e,n,r,i,o,a,s,l,c,u,h,d,p){const f=e.context,m=f.gl,g=e.transform,_="map"===l,y="map"===c,v="viewport"!==l&&"point"!==r.layout.get("symbol-placement"),b=_&&!y&&!v,x=!r.layout.get("symbol-sort-key").isConstant();let w=!1;const S=e.getDepthModeForSublayer(0,Kt.ReadOnly),T=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),E=[],k=g.getCircleRadiusCorrection();for(const P of i){const i=n.getTile(P),l=i.getBucket(r);if(!l)continue;const c=o?l.text:l.icon;if(!c||!c.segments.get().length||!c.hasVisibleVertices)continue;const h=c.programConfigurations.get(r.id),d=o||l.sdfIcons,f=o?l.textSizeData:l.iconSizeData,S=y||0!==g.pitch,C=e.useProgram(ci(d,o,l),h),I=t.as(f,g.zoom),A=e.style.map.terrain&&e.style.map.terrain.getTerrainData(P);let M,R,D,z,L=[0,0],j=null;if(o)R=i.glyphAtlasTexture,D=m.LINEAR,M=i.glyphAtlasTexture.size,l.iconsInText&&(L=i.imageAtlasTexture.size,j=i.imageAtlasTexture,z=S||e.options.rotating||e.options.zooming||"composite"===f.kind||"camera"===f.kind?m.LINEAR:m.NEAREST);else{const t=1!==r.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;R=i.imageAtlasTexture,D=d||e.options.rotating||e.options.zooming||t||S?m.LINEAR:m.NEAREST,M=i.imageAtlasTexture.size}const O=t.aH(i,1,e.transform.zoom),F=De(_,e.transform,O),B=t.M();t.av(B,F);const N=ze(y,_,e.transform,O),U=t.aI(g,i,a,s),V=g.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!p,applyTerrainMatrix:!0}),G=T&&l.hasTextData(),q="none"!==r.layout.get("icon-text-fit")&&G&&l.hasIconData();if(v){const t=e.style.map.terrain?(t,n)=>e.style.map.terrain.getElevation(P,t,n):null,n="map"===r.layout.get("text-rotation-alignment");Be(l,e,o,F,B,y,u,n,P.toUnwrapped(),g.width,g.height,U,t)}const Z=o&&T||q,W=v||Z?oi:y?F:e.transform.clipSpaceToPixelsMatrix,H=d&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let X;X=d?l.iconsInText?ur(f.kind,I,b,y,v,Z,e,W,N,U,M,L,k):cr(f.kind,I,b,y,v,Z,e,W,N,U,o,M,0,k):lr(f.kind,I,b,y,v,Z,e,W,N,U,o,M,k);const K={program:C,buffers:c,uniformValues:X,projectionData:V,atlasTexture:R,atlasTextureIcon:j,atlasInterpolation:D,atlasInterpolationIcon:z,isSDF:d,hasHalo:H};if(x&&l.canOverlap){w=!0;const e=c.segments.get();for(const n of e)E.push({segments:new t.aR([n]),sortKey:n.sortKey,state:K,terrainData:A})}else E.push({segments:c.segments,sortKey:0,state:K,terrainData:A})}w&&E.sort((e,t)=>e.sortKey-t.sortKey);for(const t of E){const n=t.state;if(f.activeTexture.set(m.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,m.CLAMP_TO_EDGE),n.atlasTextureIcon&&(f.activeTexture.set(m.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,m.CLAMP_TO_EDGE)),n.isSDF){const i=n.uniformValues;n.hasHalo&&(i.u_is_halo=1,hi(n.buffers,t.segments,r,e,n.program,S,h,d,i,n.projectionData,t.terrainData)),i.u_is_halo=0}hi(n.buffers,t.segments,r,e,n.program,S,h,d,n.uniformValues,n.projectionData,t.terrainData)}}function hi(e,t,n,r,i,o,a,s,l,c,u){const h=r.context;i.draw(h,h.gl.TRIANGLES,o,a,s,Xt.backCCW,l,u,c,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function di(e,n,r,i,o){const a=e.context,s=a.gl,l=Jt.disabled,c=new Wt([s.ONE,s.ONE],t.bj.transparent,[!0,!0,!0,!0]),u=n.getBucket(r);if(!u)return;const h=i.key;let d=r.heatmapFbos.get(h);d||(d=fi(a,n.tileSize,n.tileSize),r.heatmapFbos.set(h,d)),a.bindFramebuffer.set(d.framebuffer),a.viewport.set([0,0,n.tileSize,n.tileSize]),a.clear({color:t.bj.transparent});const p=u.programConfigurations.get(r.id),f=e.useProgram("heatmap",p,!o),m=e.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),g=e.style.map.terrain.getTerrainData(i);f.draw(a,s.TRIANGLES,Kt.disabled,l,c,Xt.disabled,Hn(n,e.transform.zoom,r.paint.get("heatmap-intensity"),1),g,m,r.id,u.layoutVertexBuffer,u.indexBuffer,u.segments,r.paint,e.transform.zoom,p)}function pi(e,t,n,r,i){const o=e.context,a=o.gl,s=e.transform;o.setColorMode(e.colorModeForRenderPass());const l=mi(o,t),c=n.key,u=t.heatmapFbos.get(c);if(!u)return;o.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,u.colorAttachment.get()),o.activeTexture.set(a.TEXTURE1),l.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=s.getProjectionData({overscaledTileID:n,applyTerrainMatrix:i,applyGlobeMatrix:!r});e.useProgram("heatmapTexture").draw(o,a.TRIANGLES,Kt.disabled,Jt.disabled,e.colorModeForRenderPass(),Xt.disabled,Xn(e,t,0,1),null,h,t.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments,t.paint,s.zoom),u.destroy(),t.heatmapFbos.delete(c)}function fi(e,t,n){var r,i;const o=e.gl,a=o.createTexture();o.bindTexture(o.TEXTURE_2D,a),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR);const s=null!==(r=e.HALF_FLOAT)&&void 0!==r?r:o.UNSIGNED_BYTE,l=null!==(i=e.RGBA16F)&&void 0!==i?i:o.RGBA;o.texImage2D(o.TEXTURE_2D,0,l,t,n,0,o.RGBA,s,null);const c=e.createFramebuffer(t,n,!1,!1);return c.colorAttachment.set(a),c}function mi(e,n){return n.colorRampTexture||(n.colorRampTexture=new t.T(e,n.colorRamp,e.gl.RGBA)),n.colorRampTexture}function gi(e,n,r,i,o,a,s,l){let c=256;if(o.stepInterpolant){const i=n.getSource().maxzoom,o=s.canonical.z===i?Math.ceil(1<<e.transform.maxZoom-s.canonical.z):1;c=t.ai(t.c8(a.maxLineLength/t.a3*1024*o),256,r.maxTextureSize)}return l.gradient=t.c9({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:c,image:l.gradient||void 0,clips:a.lineClipsArray}),l.texture?l.texture.update(l.gradient):l.texture=new t.T(r,l.gradient,i.RGBA),l.version=o.gradientVersion,l.texture}function _i(e,t,n,r,i){e.activeTexture.set(t.TEXTURE0),n.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),r.updatePaintBuffers(i)}function yi(e,t,n,r,i,o){(i||e.lineAtlas.dirty)&&(t.activeTexture.set(n.TEXTURE0),e.lineAtlas.bind(t)),r.updatePaintBuffers(o)}function vi(e,t,n,r,i,o,a){const s=o.gradients[i.id];let l=s.texture;i.gradientVersion!==s.version&&(l=gi(e,t,n,r,i,o,a,s)),n.activeTexture.set(r.TEXTURE0),l.bind(i.stepInterpolant?r.NEAREST:r.LINEAR,r.CLAMP_TO_EDGE)}function bi(e,t,n,r,i,o,a,s,l){const c=o.gradients[i.id];let u=c.texture;i.gradientVersion!==c.version&&(u=gi(e,t,n,r,i,o,a,c)),n.activeTexture.set(r.TEXTURE0),u.bind(i.stepInterpolant?r.NEAREST:r.LINEAR,r.CLAMP_TO_EDGE),n.activeTexture.set(r.TEXTURE1),e.lineAtlas.bind(n),s.updatePaintBuffers(l)}function xi(e,t,n,r,i){if(!n||!r||!r.imageAtlas)return;const o=r.imageAtlas.patternPositions;let a=o[n.to.toString()],s=o[n.from.toString()];if(!a&&s&&(a=s),!s&&a&&(s=a),!a||!s){const e=i.getPaintProperty(t);a=o[e],s=o[e]}a&&s&&e.setConstantPatternPositions(a,s)}function wi(e,n,r,i,o,a,s,l){const c=e.context.gl,u="fill-pattern",h=r.paint.get(u),d=h&&h.constantOr(1),p=r.getCrossfadeParameters();let f,m,g,_,y;const v=e.transform,b=r.paint.get("fill-translate"),x=r.paint.get("fill-translate-anchor");s?(m=d&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=c.LINES):(m=d?"fillPattern":"fill",f=c.TRIANGLES);const w=h.constantOr(null);for(const S of i){const i=n.getTile(S);if(d&&!i.patternsLoaded())continue;const h=i.getBucket(r);if(!h)continue;const T=h.programConfigurations.get(r.id),E=e.useProgram(m,T),k=e.style.map.terrain&&e.style.map.terrain.getTerrainData(S);d&&(e.context.activeTexture.set(c.TEXTURE0),i.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),T.updatePaintBuffers(p)),xi(T,u,w,i,r);const P=v.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!l,applyTerrainMatrix:!0}),C=t.aI(v,i,b,x);if(s){_=h.indexBuffer2,y=h.segments2;const t=[c.drawingBufferWidth,c.drawingBufferHeight];g="fillOutlinePattern"===m&&d?Vn(e,p,i,t,C):Un(t,C)}else _=h.indexBuffer,y=h.segments,g=d?Nn(e,p,i,C):{u_fill_translate:C};const I=e.stencilModeForClipping(S);E.draw(e.context,f,o,I,a,Xt.backCCW,g,k,P,r.id,h.layoutVertexBuffer,_,y,r.paint,e.transform.zoom,T)}}function Si(e,n,r,i,o,a,s,l){const c=e.context,u=c.gl,h="fill-extrusion-pattern",d=r.paint.get(h),p=d.constantOr(1),f=r.getCrossfadeParameters(),m=r.paint.get("fill-extrusion-opacity"),g=d.constantOr(null),_=e.transform;for(const y of i){const i=n.getTile(y),d=i.getBucket(r);if(!d)continue;const v=e.style.map.terrain&&e.style.map.terrain.getTerrainData(y),b=d.programConfigurations.get(r.id),x=e.useProgram(p?"fillExtrusionPattern":"fillExtrusion",b);p&&(e.context.activeTexture.set(u.TEXTURE0),i.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),b.updatePaintBuffers(f));const w=_.getProjectionData({overscaledTileID:y,applyGlobeMatrix:!l,applyTerrainMatrix:!0});xi(b,h,g,i,r);const S=t.aI(_,i,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),T=r.paint.get("fill-extrusion-vertical-gradient"),E=p?Bn(e,T,m,S,y,f,i):Fn(e,T,m,S);x.draw(c,c.gl.TRIANGLES,o,a,s,Xt.backCCW,E,v,w,r.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,r.paint,e.transform.zoom,b,e.style.map.terrain&&d.centroidVertexBuffer)}}function Ti(e,t,n,r,i,o,a,s,l){var c;const u=e.style.projection,h=e.context,d=e.transform,p=h.gl,f=["#define NUM_ILLUMINATION_SOURCES ".concat(n.paint.get("hillshade-highlight-color").values.length)],m=e.useProgram("hillshade",null,!1,f),g=!e.options.moving;for(const _ of r){const r=t.getTile(_),f=r.fbo;if(!f)continue;const y=u.getMeshFromTileID(h,_.canonical,s,!0,"raster"),v=null===(c=e.style.map.terrain)||void 0===c?void 0:c.getTerrainData(_);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,f.colorAttachment.get());const b=d.getProjectionData({overscaledTileID:_,aligned:g,applyGlobeMatrix:!l,applyTerrainMatrix:!0});m.draw(h,p.TRIANGLES,o,i[_.overscaledZ],a,Xt.backCCW,Kn(e,r,n),v,b,n.id,y.vertexBuffer,y.indexBuffer,y.segments)}}function Ei(e,n,r,i,o,a,s,l,c){var u;const h=e.style.projection,d=e.context,p=e.transform,f=d.gl,m=e.useProgram("colorRelief"),g=!e.options.moving;let _=!0,y=0;for(const v of i){const i=n.getTile(v),b=i.dem;if(_){const e=f.getParameter(f.MAX_TEXTURE_SIZE),{elevationTexture:t,colorTexture:n}=r.getColorRampTextures(d,e,b.getUnpackVector());d.activeTexture.set(f.TEXTURE1),t.bind(f.NEAREST,f.CLAMP_TO_EDGE),d.activeTexture.set(f.TEXTURE4),n.bind(f.LINEAR,f.CLAMP_TO_EDGE),_=!1,y=t.size[0]}if(!b||!b.data)continue;const x=b.stride,w=b.getPixels();if(d.activeTexture.set(f.TEXTURE0),d.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(x),i.demTexture){const e=i.demTexture;e.update(w,{premultiply:!1}),e.bind(f.LINEAR,f.CLAMP_TO_EDGE)}else i.demTexture=new t.T(d,w,f.RGBA,{premultiply:!1}),i.demTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE);const S=h.getMeshFromTileID(d,v.canonical,l,!0,"raster"),T=null===(u=e.style.map.terrain)||void 0===u?void 0:u.getTerrainData(v),E=p.getProjectionData({overscaledTileID:v,aligned:g,applyGlobeMatrix:!c,applyTerrainMatrix:!0});m.draw(d,f.TRIANGLES,a,o[v.overscaledZ],s,Xt.backCCW,Qn(r,i.dem,y),T,E,r.id,S.vertexBuffer,S.indexBuffer,S.segments)}}const ki=[new t.P(0,0),new t.P(t.a3,0),new t.P(t.a3,t.a3),new t.P(0,t.a3)];function Pi(e,t,n,r,i,o,a,s){let l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const u=r[r.length-1].overscaledZ,h=e.context,d=h.gl,p=e.useProgram("raster"),f=e.transform,m=e.style.projection,g=e.colorModeForRenderPass(),_=!e.options.moving,y=n.paint.get("raster-opacity"),v=n.paint.get("raster-resampling"),b=n.paint.get("raster-fade-duration"),x=!!e.style.map.terrain;for(const w of r){const r=e.getDepthModeForSublayer(w.overscaledZ-u,1===y?Kt.ReadWrite:Kt.ReadOnly,d.LESS),S=t.getTile(w),T="nearest"===v?d.NEAREST:d.LINEAR;h.activeTexture.set(d.TEXTURE0),S.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),h.activeTexture.set(d.TEXTURE1);const{parentTile:E,parentScaleBy:k,parentTopLeft:P,fadeValues:C}=Ci(S,t,b,x);S.fadeOpacity=C.tileOpacity,E?(E.fadeOpacity=C.parentTileOpacity,E.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)):S.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),S.texture.useMipmap&&h.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const I=e.style.map.terrain&&e.style.map.terrain.getTerrainData(w),A=f.getProjectionData({overscaledTileID:w,aligned:_,applyGlobeMatrix:!c,applyTerrainMatrix:!0}),M=ar(P,k,C.fadeMix,n,s),R=m.getMeshFromTileID(h,w.canonical,o,a,"raster");p.draw(h,d.TRIANGLES,r,i?i[w.overscaledZ]:Jt.disabled,g,l?Xt.frontCCW:Xt.backCCW,M,I,A,n.id,R.vertexBuffer,R.indexBuffer,R.segments)}}function Ci(e,n,r,i){const o={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(0===r||i)return o;if(e.fadingParentID){const i=n.getLoadedTile(e.fadingParentID);if(!i)return o;const a=Math.pow(2,i.tileID.overscaledZ-e.tileID.overscaledZ),s=[e.tileID.canonical.x*a%1,e.tileID.canonical.y*a%1],l=function(e,n,r){const i=c(),o=(i-n.timeAdded)/r,a=e.fadingDirection===he.Incoming,s=t.ai((i-e.timeAdded)/r,0,1),l=t.ai(1-o,0,1),u=a?s:l;return{tileOpacity:u,parentTileOpacity:a?l:s,fadeMix:{opacity:1,mix:1-u}}}(e,i,r);return{parentTile:i,parentScaleBy:a,parentTopLeft:s,fadeValues:l}}if(e.selfFading){const n=function(e,n){const r=(c()-e.timeAdded)/n,i=t.ai(r,0,1);return{tileOpacity:i,fadeMix:{opacity:i,mix:0}}}(e,r);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:n}}return o}const Ii=new t.bj(1,0,0,1),Ai=new t.bj(0,1,0,1),Mi=new t.bj(0,0,1,1),Ri=new t.bj(1,0,1,1),Di=new t.bj(0,1,1,1);function zi(e,t,n,r){ji(e,0,t+n/2,e.transform.width,n,r)}function Li(e,t,n,r){ji(e,t-n/2,0,n,e.transform.height,r)}function ji(e,t,n,r,i,o){const a=e.context,s=a.gl;s.enable(s.SCISSOR_TEST),s.scissor(t*e.pixelRatio,n*e.pixelRatio,r*e.pixelRatio,i*e.pixelRatio),a.clear({color:o}),s.disable(s.SCISSOR_TEST)}function Oi(e,n,r){const i=e.context,o=i.gl,a=e.useProgram("debug"),s=Kt.disabled,l=Jt.disabled,c=e.colorModeForRenderPass(),u="$debug",h=e.style.map.terrain&&e.style.map.terrain.getTerrainData(r);i.activeTexture.set(o.TEXTURE0);const d=n.getTileByID(r.key).latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=n.getTile(r).tileSize,m=512/Math.min(f,512)*(r.overscaledZ/e.transform.zoom)*.5;let g=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(g+=" => ".concat(r.overscaledZ)),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,r=e.context.gl,i=e.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,"".concat(g," ").concat(p,"kB"));const _=e.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});a.draw(i,o.TRIANGLES,s,l,Wt.alphaBlended,Xt.disabled,Wn(t.bj.transparent,m),null,_,u,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments),a.draw(i,o.LINE_STRIP,s,l,c,Xt.disabled,Wn(t.bj.red),h,_,u,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments)}function Fi(e,t,n,r){const{isRenderingGlobe:i}=r,o=e.context,a=o.gl,s=e.transform,l=e.colorModeForRenderPass(),c=e.getDepthModeFor3D(),u=e.useProgram("terrain");o.bindFramebuffer.set(null),o.viewport.set([0,0,e.width,e.height]);for(const h of n){const n=t.getTerrainMesh(h.tileID),r=e.renderToTexture.getTexture(h),d=t.getTerrainData(h.tileID);o.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,r.texture);const p=t.getMeshFrameDelta(s.zoom),f=s.calculateFogMatrix(h.tileID.toUnwrapped()),m=Dn(p,f,e.style.sky,s.pitch,i),g=s.getProjectionData({overscaledTileID:h.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(o,a.TRIANGLES,c,Jt.disabled,l,Xt.backCCW,m,d,g,"terrain",n.vertexBuffer,n.indexBuffer,n.segments)}}function Bi(e,n){if(!n.mesh){const r=new t.aQ;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const i=new t.aS;i.emplaceBack(0,1,2),i.emplaceBack(0,2,3),n.mesh=new It(e.createVertexBuffer(r,At.members),e.createIndexBuffer(i),t.aR.simpleSegment(0,0,r.length,i.length))}return n.mesh}class Ni{constructor(e,n){this.context=new ni(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.am(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Pe.maxUnderzooming+Pe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Et}resize(e,t,n){if(this.width=Math.floor(e*n),this.height=Math.floor(t*n),this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const r of this.style._order)this.style._layers[r].resize()}setup(){const e=this.context,n=new t.aQ;n.emplaceBack(0,0),n.emplaceBack(t.a3,0),n.emplaceBack(0,t.a3),n.emplaceBack(t.a3,t.a3),this.tileExtentBuffer=e.createVertexBuffer(n,At.members),this.tileExtentSegments=t.aR.simpleSegment(0,0,4,2);const r=new t.aQ;r.emplaceBack(0,0),r.emplaceBack(t.a3,0),r.emplaceBack(0,t.a3),r.emplaceBack(t.a3,t.a3),this.debugBuffer=e.createVertexBuffer(r,At.members),this.debugSegments=t.aR.simpleSegment(0,0,4,5);const i=new t.cb;i.emplaceBack(0,0,0,0),i.emplaceBack(t.a3,0,t.a3,0),i.emplaceBack(0,t.a3,0,t.a3),i.emplaceBack(t.a3,t.a3,t.a3,t.a3),this.rasterBoundsBuffer=e.createVertexBuffer(i,Mn.members),this.rasterBoundsSegments=t.aR.simpleSegment(0,0,4,2);const o=new t.aQ;o.emplaceBack(0,0),o.emplaceBack(t.a3,0),o.emplaceBack(0,t.a3),o.emplaceBack(t.a3,t.a3),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(o,At.members),this.rasterBoundsSegmentsPosOnly=t.aR.simpleSegment(0,0,4,5);const a=new t.aQ;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(a,At.members),this.viewportSegments=t.aR.simpleSegment(0,0,4,2);const s=new t.cc;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(s);const l=new t.aS;l.emplaceBack(1,0,2),l.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(l);const c=this.context.gl;this.stencilClearMode=new Jt({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.tileExtentMesh=new It(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const r=t.M();t.c1(r,0,this.width,this.height,0,0,1),t.O(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const i={mainMatrix:r,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:r};this.useProgram("clippingMask",null,!0).draw(e,n.TRIANGLES,Kt.disabled,this.stencilClearMode,Wt.disabled,Xt.disabled,null,null,i,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,t,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!t||!t.length)return;this.currentStencilSource=e.source,this.nextStencilID+t.length>256&&this.clearStencil();const r=this.context;r.setColorMode(Wt.disabled),r.setDepthMode(Kt.disabled);const i={};for(const o of t)i[o.key]=this.nextStencilID++;this._renderTileMasks(i,t,n,!0),this._renderTileMasks(i,t,n,!1),this._tileClippingMaskIDs=i}_renderTileMasks(e,t,n,r){const i=this.context,o=i.gl,a=this.style.projection,s=this.transform,l=this.useProgram("clippingMask");for(const c of t){const t=e[c.key],u=this.style.map.terrain&&this.style.map.terrain.getTerrainData(c),h=a.getMeshFromTileID(this.context,c.canonical,r,!0,"stencil"),d=s.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!n,applyTerrainMatrix:!0});l.draw(i,o.TRIANGLES,Kt.disabled,new Jt({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),Wt.disabled,n?Xt.disabled:Xt.backCCW,null,u,d,"$clipping",h.vertexBuffer,h.indexBuffer,h.segments)}}_renderTilesDepthBuffer(){const e=this.context,t=e.gl,n=this.style.projection,r=this.transform,i=this.useProgram("depth"),o=this.getDepthModeFor3D(),a=Ee(r,{tileSize:r.tileSize});for(const s of a){const a=this.style.map.terrain&&this.style.map.terrain.getTerrainData(s),l=n.getMeshFromTileID(this.context,s.canonical,!0,!0,"raster"),c=r.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});i.draw(e,t.TRIANGLES,o,Jt.disabled,Wt.disabled,Xt.backCCW,null,a,c,"$clipping",l.vertexBuffer,l.indexBuffer,l.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Jt({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){const t=this.context.gl;return new Jt({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const t=this.context.gl,n=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),r=n[n.length-1].overscaledZ,i=n[0].overscaledZ-r+1;if(i>1){this.currentStencilSource=void 0,this.nextStencilID+i>256&&this.clearStencil();const e={};for(let n=0;n<i;n++)e[n+r]=new Jt({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=i,[e,n]}return[{[r]:Jt.disabled},n]}stencilConfigForOverlapTwoPass(e){const t=this.context.gl,n=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),r=n[n.length-1].overscaledZ,i=n[0].overscaledZ-r+1;if(this.clearStencil(),i>1){const e={},o={};for(let n=0;n<i;n++)e[n+r]=new Jt({func:t.GREATER,mask:255},i+1+n,255,t.KEEP,t.KEEP,t.REPLACE),o[n+r]=new Jt({func:t.GREATER,mask:255},1+n,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID=2*i+1,[e,o,n]}return this.nextStencilID=3,[{[r]:new Jt({func:t.GREATER,mask:255},2,255,t.KEEP,t.KEEP,t.REPLACE)},{[r]:new Jt({func:t.GREATER,mask:255},1,255,t.KEEP,t.KEEP,t.REPLACE)},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new Wt([e.CONSTANT_COLOR,e.ONE],new t.bj(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Wt.unblended:Wt.alphaBlended}getDepthModeForSublayer(e,t,n){if(!this.opaquePassEnabledForLayer())return Kt.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Kt(n||this.context.gl.LEQUAL,t,[r,r])}getDepthModeFor3D(){return new Kt(this.context.gl.LEQUAL,Kt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){var r,i;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(c()),this.imageManager.beginFrame();const o=this.style._order,a=this.style.tileManagers,s={},l={},u={},h={isRenderingToTexture:!1,isRenderingGlobe:(null===(r=e.projection)||void 0===r?void 0:r.transitionState)>0};for(const t in a){const e=a[t];e.used&&e.prepare(this.context),s[t]=e.getVisibleCoordinates(!1),l[t]=s[t].slice().reverse(),u[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<o.length;t++)if(this.style._layers[o[t]].is3D()){this.opaquePassCutoff=t;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const t of o){const e=this.style._layers[t];if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const n=l[e.source];("custom"===e.type||n.length)&&this.renderLayer(this,a[e.source],e,n,h)}if(null===(i=this.style.projection)||void 0===i||i.updateGPUdependent({context:this.context,useProgram:e=>this.useProgram(e)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.bj.black:t.bj.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(e,t){const n=e.context,r=n.gl,i=((e,t,n)=>{const r=Math.cos(t.rollInRadians),i=Math.sin(t.rollInRadians),o=_e(t),a=t.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:e.properties.get("sky-color"),u_horizon_color:e.properties.get("horizon-color"),u_horizon:[(t.width/2-o*i)*n,(t.height/2+o*r)*n],u_horizon_normal:[-i,r],u_sky_horizon_blend:e.properties.get("sky-horizon-blend")*t.height/2*n,u_sky_blend:a}})(t,e.style.map.transform,e.pixelRatio),o=new Kt(r.LEQUAL,Kt.ReadWrite,[0,1]),a=Jt.disabled,s=e.colorModeForRenderPass(),l=e.useProgram("sky"),c=Bi(n,t);l.draw(n,r.TRIANGLES,o,a,s,Xt.disabled,i,null,void 0,"sky",c.vertexBuffer,c.indexBuffer,c.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[o[this.currentLayer]],t=a[e.source],n=s[e.source];this._renderTileClippingMasks(e,n,!1),this.renderLayer(this,t,e,n,h)}this.renderPass="translucent";let d=!1;for(this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const e=this.style._layers[o[this.currentLayer]],t=a[e.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(e,h))continue;this.opaquePassEnabledForLayer()||d||(d=!0,h.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const n=("symbol"===e.type?u:l)[e.source];this._renderTileClippingMasks(e,s[e.source],!!this.renderToTexture),this.renderLayer(this,t,e,n,h)}if(h.isRenderingGlobe&&function(e,n,r){const i=e.context,o=i.gl,a=e.useProgram("atmosphere"),s=new Kt(o.LEQUAL,Kt.ReadOnly,[0,1]),l=e.transform,c=function(e,n){const r=e.properties.get("position"),i=[-r.x,-r.y,-r.z],o=t.am(new Float64Array(16));return"map"===e.properties.get("anchor")&&(t.ba(o,o,n.rollInRadians),t.bb(o,o,-n.pitchInRadians),t.ba(o,o,n.bearingInRadians),t.bb(o,o,n.center.lat*Math.PI/180),t.bD(o,o,-n.center.lng*Math.PI/180)),t.ca(i,i,o),i}(r,e.transform),u=l.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h=n.properties.get("atmosphere-blend")*u.projectionTransition;if(0===h)return;const d=hn(l.worldSize,l.center.lat),p=l.inverseProjectionMatrix,f=new Float64Array(4);f[3]=1,t.aB(f,f,l.modelViewProjectionMatrix),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1,t.aB(f,f,p),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1;const m=((e,t,n,r,i)=>({u_sun_pos:e,u_atmosphere_blend:t,u_globe_position:n,u_globe_radius:r,u_inv_proj_matrix:i}))(c,h,[f[0],f[1],f[2]],d,p),g=Bi(i,n);a.draw(i,o.TRIANGLES,s,Jt.disabled,Wt.alphaBlended,Xt.disabled,m,null,null,"atmosphere",g.vertexBuffer,g.indexBuffer,g.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const e=function(e,t){let n=null;const r=Object.values(e._layers).flatMap(n=>n.source&&!n.isHidden(t)?[e.tileManagers[n.source]]:[]),i=r.filter(e=>"vector"===e.getSource().type),o=r.filter(e=>"vector"!==e.getSource().type),a=e=>{(!n||n.getSource().maxzoom<e.getSource().maxzoom)&&(n=e)};return i.forEach(e=>a(e)),n||o.forEach(e=>a(e)),n}(this.style,this.transform.zoom);e&&function(e,t,n){for(let r=0;r<n.length;r++)Oi(e,t,n[r])}(this,e,e.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;zi(e,e.transform.height-(t.top||0),3,Ii),zi(e,t.bottom||0,3,Ai),Li(e,t.left||0,3,Mi),Li(e,e.transform.width-(t.right||0),3,Ri);const n=e.transform.centerPoint;!function(e,t,n,r){ji(e,t-1,n-10,2,20,r),ji(e,t-10,n-1,20,2,r)}(e,n.x,e.transform.height-n.y,Di)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,r=this.transform.modelViewProjectionMatrix;let i=this.terrainFacilitator.dirty;i||(i=e?!t.cd(n,r):!t.ce(n,r)),i||(i=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),i&&(t.cf(n,r),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(e,n){const r=e.context,i=r.gl,o=e.transform,a=Wt.unblended,s=new Kt(i.LEQUAL,Kt.ReadWrite,[0,1]),l=n.tileManager.getRenderableTiles(),c=e.useProgram("terrainDepth");r.bindFramebuffer.set(n.getFramebuffer("depth").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.bj.transparent,depth:1});for(const t of l){const e=n.getTerrainMesh(t.tileID),l=n.getTerrainData(t.tileID),u=o.getProjectionData({overscaledTileID:t.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),h={u_ele_delta:n.getMeshFrameDelta(o.zoom)};c.draw(r,i.TRIANGLES,s,Jt.disabled,a,Xt.backCCW,h,l,u,"terrain",e.vertexBuffer,e.indexBuffer,e.segments)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain),function(e,n){const r=e.context,i=r.gl,o=e.transform,a=Wt.unblended,s=new Kt(i.LEQUAL,Kt.ReadWrite,[0,1]),l=n.getCoordsTexture(),c=n.tileManager.getRenderableTiles(),u=e.useProgram("terrainCoords");r.bindFramebuffer.set(n.getFramebuffer("coords").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.bj.transparent,depth:1}),n.coordsIndex=[];for(const t of c){const e=n.getTerrainMesh(t.tileID),c=n.getTerrainData(t.tileID);r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,l.texture);const h={u_terrain_coords_id:(255-n.coordsIndex.length)/255,u_texture:0,u_ele_delta:n.getMeshFrameDelta(o.zoom)},d=o.getProjectionData({overscaledTileID:t.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(r,i.TRIANGLES,s,Jt.disabled,a,Xt.backCCW,h,c,d,"terrain",e.vertexBuffer,e.indexBuffer,e.segments),n.coordsIndex.push(t.tileID.key)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain))}renderLayer(e,n,r,i,o){r.isHidden(this.transform.zoom)||("background"===r.type||"custom"===r.type||(i||[]).length)&&(this.id=r.id,t.cg(r)?function(e,n,r,i,o,a){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=a,l=Jt.disabled,c=e.colorModeForRenderPass();(r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(e,n,r,i,o,a,s,l,c){const u=n.transform,h=n.style.map.terrain,d="map"===o,p="map"===a;for(const f of e){const e=i.getTile(f),o=e.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)continue;const a=t.as(o.textSizeData,u.zoom),m=t.aH(e,1,n.transform.zoom),g=De(d,n.transform,m),_="none"!==r.layout.get("icon-text-fit")&&o.hasIconData();if(a){const n=Math.pow(2,u.zoom-e.tileID.overscaledZ),r=h?(e,t)=>h.getElevation(f,e,t):null;li(o,d,p,c,u,g,n,a,_,t.aI(u,e,s,l),f.toUnwrapped(),r)}}}(i,e,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&ui(e,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),l,c,s),0!==r.paint.get("text-opacity").constantOr(1)&&ui(e,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),l,c,s),n.map.showCollisionBoxes&&(ii(e,n,r,i,!0),ii(e,n,r,i,!1))}(e,n,r,i,this.style.placement.variableOffsets,o):t.ch(r)?function(e,n,r,i,o){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:a}=o,s=r.paint.get("circle-opacity"),l=r.paint.get("circle-stroke-width"),c=r.paint.get("circle-stroke-opacity"),u=!r.layout.get("circle-sort-key").isConstant();if(0===s.constantOr(1)&&(0===l.constantOr(1)||0===c.constantOr(1)))return;const h=e.context,d=h.gl,p=e.transform,f=e.getDepthModeForSublayer(0,Kt.ReadOnly),m=Jt.disabled,g=e.colorModeForRenderPass(),_=[],y=p.getCircleRadiusCorrection();for(let v=0;v<i.length;v++){const o=i[v],s=n.getTile(o),l=s.getBucket(r);if(!l)continue;const c=r.paint.get("circle-translate"),h=r.paint.get("circle-translate-anchor"),d=t.aI(p,s,c,h),f=l.programConfigurations.get(r.id),m=e.useProgram("circle",f),g=l.layoutVertexBuffer,b=l.indexBuffer,x=e.style.map.terrain&&e.style.map.terrain.getTerrainData(o),w={programConfiguration:f,program:m,layoutVertexBuffer:g,indexBuffer:b,uniformValues:Gn(e,s,r,d,y),terrainData:x,projectionData:p.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!a,applyTerrainMatrix:!0})};if(u){const e=l.segments.get();for(const n of e)_.push({segments:new t.aR([n]),sortKey:n.sortKey,state:w})}else _.push({segments:l.segments,sortKey:0,state:w})}u&&_.sort((e,t)=>e.sortKey-t.sortKey);for(const t of _){const{programConfiguration:n,program:i,layoutVertexBuffer:o,indexBuffer:a,uniformValues:s,terrainData:l,projectionData:c}=t.state;i.draw(h,d.TRIANGLES,f,m,g,Xt.backCCW,s,l,c,r.id,o,a,t.segments,r.paint,e.transform.zoom,n)}}(e,n,r,i,o):t.ci(r)?function(e,n,r,i,o){if(0===r.paint.get("heatmap-opacity"))return;const a=e.context,{isRenderingToTexture:s,isRenderingGlobe:l}=o;if(e.style.map.terrain){for(const t of i){const i=n.getTile(t);n.hasRenderableParent(t)||("offscreen"===e.renderPass?di(e,i,r,t,l):"translucent"===e.renderPass&&pi(e,r,t,s,l))}a.viewport.set([0,0,e.width,e.height])}else"offscreen"===e.renderPass?function(e,n,r,i){const o=e.context,a=o.gl,s=e.transform,l=Jt.disabled,c=new Wt([a.ONE,a.ONE],t.bj.transparent,[!0,!0,!0,!0]);(function(e,n,r){const i=e.gl;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,n.width/4,n.height/4]);let o=r.heatmapFbos.get(t.c7);o?(i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),e.bindFramebuffer.set(o.framebuffer)):(o=fi(e,n.width/4,n.height/4),r.heatmapFbos.set(t.c7,o))})(o,e,r),o.clear({color:t.bj.transparent});for(let t=0;t<i.length;t++){const u=i[t];if(n.hasRenderableParent(u))continue;const h=n.getTile(u),d=h.getBucket(r);if(!d)continue;const p=d.programConfigurations.get(r.id),f=e.useProgram("heatmap",p),m=s.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),g=s.getCircleRadiusCorrection();f.draw(o,a.TRIANGLES,Kt.disabled,l,c,Xt.backCCW,Hn(h,s.zoom,r.paint.get("heatmap-intensity"),g),null,m,r.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,r.paint,s.zoom,p)}o.viewport.set([0,0,e.width,e.height])}(e,n,r,i):"translucent"===e.renderPass&&function(e,n){const r=e.context,i=r.gl;r.setColorMode(e.colorModeForRenderPass());const o=n.heatmapFbos.get(t.c7);o&&(r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1),mi(r,n).bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,Kt.disabled,Jt.disabled,e.colorModeForRenderPass(),Xt.disabled,Xn(e,n,0,1),null,null,n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom))}(e,r)}(e,n,r,i,o):t.cj(r)?function(e,t,n,r,i){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:o}=i,a=n.paint.get("line-opacity"),s=n.paint.get("line-width");if(0===a.constantOr(1)||0===s.constantOr(1))return;const l=e.getDepthModeForSublayer(0,Kt.ReadOnly),c=e.colorModeForRenderPass(),u=n.paint.get("line-dasharray"),h=u.constantOr(1),d=n.paint.get("line-pattern"),p=d.constantOr(1),f=n.paint.get("line-gradient"),m=n.getCrossfadeParameters();let g;g=p?"linePattern":h&&f?"lineGradientSDF":h?"lineSDF":f?"lineGradient":"line";const _=e.context,y=_.gl,v=e.transform;let b=!0;for(const x of r){const r=t.getTile(x);if(p&&!r.patternsLoaded())continue;const i=r.getBucket(n);if(!i)continue;const a=i.programConfigurations.get(n.id),s=e.context.program.get(),w=e.useProgram(g,a),S=b||w.program!==s,T=e.style.map.terrain&&e.style.map.terrain.getTerrainData(x),E=d.constantOr(null),k=u&&u.constantOr(null);if(E&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[E.to.toString()],n=e.patternPositions[E.from.toString()];t&&n&&a.setConstantPatternPositions(t,n)}else if(k){const t="round"===n.layout.get("line-cap"),r=e.lineAtlas.getDash(k.to,t),i=e.lineAtlas.getDash(k.from,t);a.setConstantDashPositions(r,i)}const P=v.getProjectionData({overscaledTileID:x,applyGlobeMatrix:!o,applyTerrainMatrix:!0}),C=v.getPixelScale();let I;p?(I=tr(e,r,n,C,m),_i(_,y,r,a,m)):h&&f?(I=rr(e,r,n,C,m,i.lineClipsArray.length),bi(e,t,_,y,n,i,x,a,m)):h?(I=nr(e,r,n,C,m),yi(e,_,y,a,S,m)):f?(I=er(e,r,n,C,i.lineClipsArray.length),vi(e,t,_,y,n,i,x)):I=$n(e,r,n,C);const A=e.stencilModeForClipping(x);w.draw(_,y.TRIANGLES,l,A,c,Xt.disabled,I,T,P,n.id,i.layoutVertexBuffer,i.indexBuffer,i.segments,n.paint,e.transform.zoom,a,i.layoutVertexBuffer2),b=!1}}(e,n,r,i,o):t.ck(r)?function(e,n,r,i,o){const a=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const{isRenderingToTexture:l}=o,c=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),h=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===a.constantOr(t.bj.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===h){const t=e.getDepthModeForSublayer(1,"opaque"===e.renderPass?Kt.ReadWrite:Kt.ReadOnly);wi(e,n,r,i,t,c,!1,l)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const t=e.getDepthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly);wi(e,n,r,i,t,c,!0,l)}}(e,n,r,i,o):t.cl(r)?function(e,t,n,r,i){const o=n.paint.get("fill-extrusion-opacity");if(0===o)return;const{isRenderingToTexture:a}=i;if("translucent"===e.renderPass){const i=new Kt(e.context.gl.LEQUAL,Kt.ReadWrite,e.depthRangeFor3D);if(1!==o||n.paint.get("fill-extrusion-pattern").constantOr(1))Si(e,t,n,r,i,Jt.disabled,Wt.disabled,a),Si(e,t,n,r,i,e.stencilModeFor3D(),e.colorModeForRenderPass(),a);else{const o=e.colorModeForRenderPass();Si(e,t,n,r,i,Jt.disabled,o,a)}}}(e,n,r,i,o):t.cm(r)?function(e,n,r,i,o){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const{isRenderingToTexture:a}=o,s=e.context,l=e.style.projection.useSubdivision,c=e.getDepthModeForSublayer(0,Kt.ReadOnly),u=e.colorModeForRenderPass();if("offscreen"===e.renderPass)!function(e,n,r,i,o,a,s){const l=e.context,c=l.gl;for(const u of r){const r=n.getTile(u),h=r.dem;if(!h||!h.data)continue;if(!r.needsHillshadePrepare)continue;const d=h.dim,p=h.stride,f=h.getPixels();if(l.activeTexture.set(c.TEXTURE1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(p),r.demTexture){const e=r.demTexture;e.update(f,{premultiply:!1}),e.bind(c.NEAREST,c.CLAMP_TO_EDGE)}else r.demTexture=new t.T(l,f,c.RGBA,{premultiply:!1}),r.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);l.activeTexture.set(c.TEXTURE0);let m=r.fbo;if(!m){const e=new t.T(l,{width:d,height:d,data:null},c.RGBA);e.bind(c.LINEAR,c.CLAMP_TO_EDGE),m=r.fbo=l.createFramebuffer(d,d,!0,!1),m.colorAttachment.set(e.texture)}l.bindFramebuffer.set(m.framebuffer),l.viewport.set([0,0,d,d]),e.useProgram("hillshadePrepare").draw(l,c.TRIANGLES,o,a,s,Xt.disabled,Yn(r.tileID,h),null,null,i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),r.needsHillshadePrepare=!1}}(e,n,i,r,c,Jt.disabled,u),s.viewport.set([0,0,e.width,e.height]);else if("translucent"===e.renderPass)if(l){const[t,o,s]=e.stencilConfigForOverlapTwoPass(i);Ti(e,n,r,s,t,c,u,!1,a),Ti(e,n,r,s,o,c,u,!0,a)}else{const[t,o]=e.getStencilConfigForOverlapAndUpdateStencilID(i);Ti(e,n,r,o,t,c,u,!1,a)}}(e,n,r,i,o):t.cn(r)?function(e,t,n,r,i){if("translucent"!==e.renderPass)return;if(!r.length)return;const{isRenderingToTexture:o}=i,a=e.style.projection.useSubdivision,s=e.getDepthModeForSublayer(0,Kt.ReadOnly),l=e.colorModeForRenderPass();if(a){const[i,a,c]=e.stencilConfigForOverlapTwoPass(r);Ei(e,t,n,c,i,s,l,!1,o),Ei(e,t,n,c,a,s,l,!0,o)}else{const[i,a]=e.getStencilConfigForOverlapAndUpdateStencilID(r);Ei(e,t,n,a,i,s,l,!1,o)}}(e,n,r,i,o):t.bO(r)?function(e,t,n,r,i){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!r.length)return;const{isRenderingToTexture:o}=i,a=t.getSource(),s=e.style.projection.useSubdivision;if(a instanceof te)Pi(e,t,n,r,null,!1,!1,a.tileCoords,a.flippedWindingOrder,o);else if(s){const[i,a,s]=e.stencilConfigForOverlapTwoPass(r);Pi(e,t,n,s,i,!1,!0,ki,!1,o),Pi(e,t,n,s,a,!0,!0,ki,!1,o)}else{const[i,a]=e.getStencilConfigForOverlapAndUpdateStencilID(r);Pi(e,t,n,a,i,!1,!0,ki,!1,o)}}(e,n,r,i,o):t.co(r)?function(e,t,n,r,i){const o=n.paint.get("background-color"),a=n.paint.get("background-opacity");if(0===a)return;const{isRenderingToTexture:s}=i,l=e.context,c=l.gl,u=e.style.projection,h=e.transform,d=h.tileSize,p=n.paint.get("background-pattern");if(e.isPatternMissing(p))return;const f=!p&&1===o.a&&1===a&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==f)return;const m=Jt.disabled,g=e.getDepthModeForSublayer(0,"opaque"===f?Kt.ReadWrite:Kt.ReadOnly),_=e.colorModeForRenderPass(),y=e.useProgram(p?"backgroundPattern":"background"),v=r||Ee(h,{tileSize:d,terrain:e.style.map.terrain});p&&(l.activeTexture.set(c.TEXTURE0),e.imageManager.bind(e.context));const b=n.getCrossfadeParameters();for(const x of v){const t=h.getProjectionData({overscaledTileID:x,applyGlobeMatrix:!s,applyTerrainMatrix:!0}),r=p?dr(a,e,p,{tileID:x,tileSize:d},b):hr(a,o),i=e.style.map.terrain&&e.style.map.terrain.getTerrainData(x),f=u.getMeshFromTileID(l,x.canonical,!1,!0,"raster");y.draw(l,c.TRIANGLES,g,m,_,Xt.backCCW,r,i,t,n.id,f.vertexBuffer,f.indexBuffer,f.segments)}}(e,0,r,i,o):t.cp(r)&&function(e,t,n,r){const{isRenderingGlobe:i}=r,o=e.context,a=n.implementation,s=e.style.projection,l=e.transform,c=l.getProjectionDataForCustomLayer(i),u={farZ:l.farZ,nearZ:l.nearZ,fov:l.fov*Math.PI/180,modelViewProjectionMatrix:l.modelViewProjectionMatrix,projectionMatrix:l.projectionMatrix,shaderData:{variantName:s.shaderVariantName,vertexShaderPrelude:"const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n".concat(s.shaderPreludeCode.vertexSource),define:s.shaderDefine},defaultProjectionData:c},h=a.renderingMode?a.renderingMode:"2d";if("offscreen"===e.renderPass){const t=a.prerender;t&&(e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),t.call(a,o.gl,u),o.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),o.setStencilMode(Jt.disabled);const t="3d"===h?e.getDepthModeFor3D():e.getDepthModeForSublayer(0,Kt.ReadOnly);o.setDepthMode(t),a.render(o.gl,u),o.setDirty(),e.setBaseState(),o.bindFramebuffer.set(null)}}(e,0,r,o))}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n}useProgram(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.cache=this.cache||{};const i=!!this.style.map.terrain,o=this.style.projection,a=n?Pt.projectionMercator:o.shaderPreludeCode,s=n?Mt:o.shaderDefine,l=e+(t?t.cacheKey:"")+"/".concat(n?Rt:o.shaderVariantName)+(this._showOverdrawInspector?"/overdraw":"")+(i?"/terrain":"")+(r?"/".concat(r.join("/")):"");return this.cache[l]||(this.cache[l]=new jn(this.context,Pt[e],t,fr[e],this._showOverdrawInspector,i,a,s,r)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,t;if(this._tileTextures){for(const e in this._tileTextures){const t=this._tileTextures[e];if(t)for(const e of t)e.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&(null===(e=this.tileExtentMesh.vertexBuffer)||void 0===e||e.destroy()),this.tileExtentMesh&&(null===(t=this.tileExtentMesh.indexBuffer)||void 0===t||t.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const e in this.cache){const t=this.cache[e];t&&t.program&&this.context.gl.deleteProgram(t.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:t}=this.context.gl;return this.width!==e||this.height!==t}}function Ui(e,t){var n=this;let r,i=!1,o=null,a=null;const s=()=>{o=null,i&&(e.apply(a,r),o=setTimeout(s,t),i=!1)};return function(){for(var e=arguments.length,t=new Array(e),l=0;l<e;l++)t[l]=arguments[l];return i=!0,a=n,r=t,o||s(),o}}class Vi{constructor(e){this._getCurrentHash=()=>{const e=window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")},this._onHashChange=()=>{const e=this._getCurrentHash();if(!this._isValidHash(e))return!1;const t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0},this._updateHashUnthrottled=()=>{const e=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,e)},this._removeHash=()=>{const e=this._getCurrentHash();if(0===e.length)return;const t=e.join("/");let n=t;n.split("&").length>0&&(n=n.split("&")[0]),this._hashName&&(n="".concat(this._hashName,"=").concat(t));let r=window.location.hash.replace(n,"");r.startsWith("#&")?r=r.slice(0,1)+r.slice(2):"#"===r&&(r="");let i=window.location.href.replace(/(#.+)?$/,r);i=i.replace("&&","&"),window.history.replaceState(window.history.state,null,i)},this._updateHash=Ui(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const t=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(t.lng*i)/i,a=Math.round(t.lat*i)/i,s=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=e?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||l)&&(c+="/"+Math.round(10*s)/10),l&&(c+="/".concat(Math.round(l))),this._hashName){const e=this._hashName;let t=!1;const n=window.location.hash.slice(1).split("&").map(n=>{const r=n.split("=")[0];return r===e?(t=!0,"".concat(r,"=").concat(c)):n}).filter(e=>e);return t||n.push("".concat(e,"=").concat(c)),"#".concat(n.join("&"))}return"#".concat(c)}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new t.U(+e[2],+e[1])}catch(e){return!1}const n=+e[0],r=+(e[3]||0),i=+(e[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&r>=-180&&r<=180&&i>=this._map.getMinPitch()&&i<=this._map.getMaxPitch()}}const Gi={linearity:.3,easing:t.cq(0,0,.3,1)},qi=t.e({deceleration:2500,maxSpeed:1400},Gi),Zi=t.e({deceleration:20,maxSpeed:1400},Gi),Wi=t.e({deceleration:1e3,maxSpeed:360},Gi),Hi=t.e({deceleration:1e3,maxSpeed:90},Gi),Xi=t.e({deceleration:1e3,maxSpeed:360},Gi);class Ki{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=c();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)n.zoom+=t.zoomDelta||0,n.bearing+=t.bearingDelta||0,n.pitch+=t.pitchDelta||0,n.roll+=t.rollDelta||0,t.panDelta&&n.pan._add(t.panDelta),t.around&&(n.around=t.around),t.pinchAround&&(n.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(n.pan.mag()){const o=Ji(n.pan.mag(),r,t.e({},qi,e||{})),a=n.pan.mult(o.amount/n.pan.mag()),s=this._map.cameraHelper.handlePanInertia(a,this._map.transform);i.center=s.easingCenter,i.offset=s.easingOffset,Yi(i,o)}if(n.zoom){const e=Ji(n.zoom,r,Zi);i.zoom=this._map.transform.zoom+e.amount,Yi(i,e)}if(n.bearing){const e=Ji(n.bearing,r,Wi);i.bearing=this._map.transform.bearing+t.ai(e.amount,-179,179),Yi(i,e)}if(n.pitch){const e=Ji(n.pitch,r,Hi);i.pitch=this._map.transform.pitch+e.amount,Yi(i,e)}if(n.roll){const e=Ji(n.roll,r,Xi);i.roll=this._map.transform.roll+t.ai(e.amount,-179,179),Yi(i,e)}if(i.zoom||i.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;i.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),t.e(i,{noMoveStart:!0})}}function Yi(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Ji(e,n,r){const{maxSpeed:i,linearity:o,deceleration:a}=r,s=t.ai(e*o/(n/1e3),-i,i),l=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*l,amount:s*(l/2)}}class Qi extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r=r instanceof MouseEvent?r:new MouseEvent(e,r);const o=u.mousePos(n.getCanvas(),r),a=n.unproject(o);super(e,t.e({point:o,lngLat:a,originalEvent:r},i)),this._defaultPrevented=!1,this.target=n}}class $i extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,r){const i="touchend"===e?r.changedTouches:r.touches,o=u.touchPos(n.getCanvasContainer(),i),a=o.map(e=>n.unproject(e)),s=o.reduce((e,t,n,r)=>e.add(t.div(r.length)),new t.P(0,0));super(e,{points:o,point:s,lngLats:a,lngLat:n.unproject(s),originalEvent:r}),this._defaultPrevented=!1}}class eo extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class to{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new eo(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Qi(e.type,this._map,e))}mouseup(e){this._map.fire(new Qi(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new Qi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Qi(e.type,this._map,e))}mouseover(e){this._map.fire(new Qi(e.type,this._map,e))}mouseout(e){this._map.fire(new Qi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new $i(e.type,this._map,e))}touchmove(e){this._map.fire(new $i(e.type,this._map,e))}touchend(e){this._map.fire(new $i(e.type,this._map,e))}touchcancel(e){this._map.fire(new $i(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class no{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Qi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Qi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ro{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this._map.terrain)}}class io{constructor(e,t){this._map=e,this._tr=new ro(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=n,this._box||(this._box=u.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);u.setTransform(this._box,"translate(".concat(i,"px,").concat(a,"px)")),this._box.style.width=o-i+"px",this._box.style.height=s-a+"px"}mouseupWindow(e,n){if(!this._active)return;if(0!==e.button)return;const r=this._startPos,i=n;if(this.reset(),u.suppressClick(),r.x!==i.x||r.y!==i.y)return this._map.fire(new t.l("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(r,i,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(u.remove(this._box),this._box=null),u.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new t.l(e,{originalEvent:n}))}}function oo(e,t){if(e.length!==t.length)throw new Error("The number of touches and points are not equal - touches ".concat(e.length,", points ").concat(t.length));const n={};for(let r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}class ao{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const n=new t.P(0,0);for(const t of e)n._add(t);return n.div(e.length)}(n),this.touches=oo(r,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const r=oo(n,t);for(const i in this.touches){const e=r[i];(!e||e.dist(this.touches[i])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class so{constructor(e){this.singleTap=new ao(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const r=this.singleTap.touchend(e,t,n);if(r){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(r)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class lo{constructor(e){this._tr=new ro(e),this._zoomIn=new so({numTouches:1,numTaps:2}),this._zoomOut=new so({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const r=this._zoomIn.touchend(e,t,n),i=this._zoomOut.touchend(e,t,n),o=this._tr;return r?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(r)},{originalEvent:e})}):i?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(i)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class co{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(){const e=this._moveFunction(...arguments);if(e.bearingDelta||e.pitchDelta||e.rollDelta||e.around||e.panDelta)return this._active=!0,e}dragStart(e,t){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(t)?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,t){if(!this.isEnabled())return;const n=this._lastPoint;if(!n)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const r=Array.isArray(t)?t[0]:t;return!this._moved&&r.dist(n)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=r,this._move(n,r))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&u.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const uo=0,ho=2,po={[uo]:1,[ho]:2};class fo{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const t=u.mouseButton(e);this._eventButton=t}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(e,t){const n=po[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton)}isValidEndEvent(e){return u.mouseButton(e)===this._eventButton}}class mo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return 1===e.targetTouches.length}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class go{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fo({checkCorrectEvent:()=>!0}),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mo;this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=t}_executeRelevantHandler(e,t,n){return e instanceof MouseEvent?t(e):"undefined"!=typeof TouchEvent&&e instanceof TouchEvent?n(e):void 0}startMove(e){this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.startMove(e),e=>this.oneFingerTouchMoveStateManager.startMove(e))}endMove(e){this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.endMove(e),e=>this.oneFingerTouchMoveStateManager.endMove(e))}isValidStartEvent(e){return this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.isValidStartEvent(e),e=>this.oneFingerTouchMoveStateManager.isValidStartEvent(e))}isValidMoveEvent(e){return this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.isValidMoveEvent(e),e=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(e))}isValidEndEvent(e){return this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.isValidEndEvent(e),e=>this.oneFingerTouchMoveStateManager.isValidEndEvent(e))}}const _o=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=e=>{e.preventDefault()}};class yo{constructor(e,t){this._clickTolerance=e.clickTolerance||1,this._map=t,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._active){if(!this._shouldBePrevented(n.length))return e.preventDefault(),this._calculateTransform(e,t,n);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&this._shouldBePrevented(n.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,r){r.length>0&&(this._active=!0);const i=oo(r,n),o=new t.P(0,0),a=new t.P(0,0);let s=0;for(const t in i){const e=i[t],n=this._touches[t];n&&(o._add(e),a._add(e.sub(n)),s++,i[t]=e)}if(this._touches=i,this._shouldBePrevented(s)||!a.mag())return;const l=a.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(s),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){if(!this._firstTwoTouches)return;e.preventDefault();const[r,i]=this._firstTwoTouches,o=bo(n,t,r),a=bo(n,t,i);if(!o||!a)return;const s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[r,i]=this._firstTwoTouches,o=bo(n,t,r),a=bo(n,t,i);o&&a||(this._active&&u.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function bo(e,t,n){for(let r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function xo(e,t){return Math.log(e/t)/Math.LN2}class wo extends vo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(xo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xo(this._distance,n),pinchAround:t}}}function So(e,t){return 180*e.angleWith(t)/Math.PI}class To extends vo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t,n){const r=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:So(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=So(e,this._startVector);return Math.abs(n)<t}}function Eo(e){return Math.abs(e.y)>Math.abs(e.x)}class ko extends vo{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,t,n){super.touchstart(e,t,n),this._currentTouchCount=n.length}_start(e){this._lastPoints=e,Eo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const r=e[0].sub(this._lastPoints[0]),i=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}):void 0}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,i=t.mag()>=2;if(!r&&!i)return;if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return Eo(e)&&Eo(t)&&o}}const Po={panStep:100,bearingStep:15,pitchStep:10};class Co{constructor(e){this._tr=new ro(e);const t=Po;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,r=0,i=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),i=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),i=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,r=0),{cameraAnimation:a=>{const s=this._tr;a.easeTo({duration:300,easeId:"keyboardHandler",easing:Io,zoom:t?Math.round(s.zoom)+t*(e.shiftKey?2:1):s.zoom,bearing:s.bearing+n*this._bearingStep,pitch:s.pitch+r*this._pitchStep,offset:[-i*this._panStep,-o*this._panStep],center:s.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Io(e){return e*(2-e)}const Ao=4.000244140625,Mo=1/450;class Ro{constructor(e,t){this._onTimeout=e=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},this._map=e,this._tr=new ro(e),this._triggerRenderFrame=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Mo}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let t=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=c(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==t&&t%Ao==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&(this._lastWheelEvent=e,this._delta-=t,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=u.mousePos(this._map.getCanvas(),e),r=this._tr;this._aroundPoint=this._aroundCenter?r.transform.locationToScreenPoint(t.U.convert(r.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const t=e.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=t),"number"==typeof this._targetZoom&&(this._targetZoom+=t)}if(0!==this._delta){const n="wheel"===this._type&&Math.abs(this._delta)>Ao?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==r&&(r=1/r);const i="number"!=typeof this._targetZoom?e.scale:t.al(this._targetZoom);this._targetZoom=e.applyConstrain(e.getCameraLngLat(),t.ao(i*r)).zoom,"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"!=typeof this._targetZoom?e.zoom:this._targetZoom,r=this._startZoom,i=this._easing;let o,a=!1;if("wheel"===this._type&&r&&i){const e=c()-this._lastWheelEventTime,s=Math.min((e+5)/200,1),l=i(s);o=t.F.number(r,n,l),s<1?this._frameId||(this._frameId=!0):a=!0}else o=n,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=o,{noInertia:!0,needsRenderFrame:!a,zoomDelta:o-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=t.cs;if(this._prevEase){const e=this._prevEase,r=(c()-e.start)/e.duration,i=e.easing(r+.01)-e.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01,a=Math.sqrt(.0729-o*o);n=t.cq(o,a,.25,1)}return this._prevEase={start:c(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Do{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zo{constructor(e){this._tr=new ro(e),this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lo{constructor(){this._tap=new so({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,t,n){if(!this._swipePoint)if(this._tapTime){const r=t[0],i=e.timeStamp-this._tapTime<500,o=this._tapPoint.dist(r)<30;i&&o?n.length>0&&(this._swipePoint=r,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(e,t,n)}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){if(this._tapTime)this._swipePoint&&0===n.length&&this.reset();else{const r=this._tap.touchend(e,t,n);r&&(this._tapTime=e.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jo{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Oo{constructor(e,t,n,r){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=t,this._mousePitch=n,this._mouseRoll=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Fo{constructor(e,t,n,r){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Bo{constructor(e,t){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=e,this._options=t,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=u.create("div","maplibregl-cooperative-gesture-screen",e);let t=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(t=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const n=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),r=document.createElement("div");r.className="maplibregl-desktop-message",r.textContent=t,this._container.appendChild(r);const i=document.createElement("div");i.className="maplibregl-mobile-message",i.textContent=n,this._container.appendChild(i),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(u.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new t.l("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const No=e=>e.zoom||e.drag||e.roll||e.pitch||e.rotate;class Uo extends t.l{}function Vo(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta||e.rollDelta}class Go{constructor(e,n){this.handleWindowEvent=e=>{this.handleEvent(e,"".concat(e.type,"Window"))},this.handleEvent=(e,n)=>{if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const r="renderFrame"===e.type?void 0:e,i={needsRenderFrame:!1},o={},a={};for(const{handlerName:c,handler:h,allowed:d}of this._handlers){if(!h.isEnabled())continue;let s;if(this._blockedByActive(a,d,c))h.reset();else if(h[n||e.type]){if(t.ct(e,n||e.type)){const t=u.mousePos(this._map.getCanvas(),e);s=h[n||e.type](e,t)}else if(t.cu(e,n||e.type)){const t=this._getMapTouches(e.touches),r=u.touchPos(this._map.getCanvas(),t);s=h[n||e.type](e,r,t)}else t.cv(n||e.type)||(s=h[n||e.type](e));this.mergeHandlerResult(i,o,s,c,r),s&&s.needsRenderFrame&&this._triggerRenderFrame()}(s||h.isActive())&&(a[c]=h)}const s={};for(const t in this._previousActiveHandlers)a[t]||(s[t]=r);this._previousActiveHandlers=a,(Object.keys(s).length||Vo(i))&&(this._changes.push([i,o,s]),this._triggerRenderFrame()),(Object.keys(a).length||Vo(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:l}=i;l&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],l(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ki(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,i,o]of this._listeners)u.addEventListener(t,i,t===document?this.handleWindowEvent:this.handleEvent,o)}destroy(){for(const[e,t,n]of this._listeners)u.removeEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const n=this._map,r=n.getCanvasContainer();this._add("mapEvent",new to(n,e));const i=n.boxZoom=new io(n,e);this._add("boxZoom",i),e.interactive&&e.boxZoom&&i.enable();const o=n.cooperativeGestures=new Bo(n,e.cooperativeGestures);this._add("cooperativeGestures",o),e.cooperativeGestures&&o.enable();const a=new lo(n),s=new zo(n);n.doubleClickZoom=new Do(s,a),this._add("tapZoom",a),this._add("clickZoom",s),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const l=new Lo;this._add("tapDragZoom",l);const c=n.touchPitch=new ko(n);this._add("touchPitch",c),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const h=()=>n.project(n.getCenter()),d=function(e,n){let{enable:r,clickTolerance:i,aroundCenter:o=!0,minPixelCenterThreshold:a=100,rotateDegreesPerPixelMoved:s=.8}=e;const l=new fo({checkCorrectEvent:e=>0===u.mouseButton(e)&&e.ctrlKey||2===u.mouseButton(e)&&!e.ctrlKey});return new co({clickTolerance:i,move:(e,r)=>{const i=n();if(o&&Math.abs(i.y-e.y)>a)return{bearingDelta:t.cr(new t.P(e.x,r.y),r,i)};let l=(r.x-e.x)*s;return o&&r.y<i.y&&(l=-l),{bearingDelta:l}},moveStateManager:l,enable:r,assignEvents:_o})}(e,h),p=function(e){let{enable:t,clickTolerance:n,pitchDegreesPerPixelMoved:r=-.5}=e;const i=new fo({checkCorrectEvent:e=>0===u.mouseButton(e)&&e.ctrlKey||2===u.mouseButton(e)});return new co({clickTolerance:n,move:(e,t)=>({pitchDelta:(t.y-e.y)*r}),moveStateManager:i,enable:t,assignEvents:_o})}(e),f=function(e,t){let{enable:n,clickTolerance:r,rollDegreesPerPixelMoved:i=.3}=e;const o=new fo({checkCorrectEvent:e=>2===u.mouseButton(e)&&e.ctrlKey});return new co({clickTolerance:r,move:(e,n)=>{const r=t();let o=(n.x-e.x)*i;return n.y<r.y&&(o=-o),{rollDelta:o}},moveStateManager:o,enable:n,assignEvents:_o})}(e,h);n.dragRotate=new Oo(e,d,p,f),this._add("mouseRotate",d,["mousePitch"]),this._add("mousePitch",p,["mouseRotate","mouseRoll"]),this._add("mouseRoll",f,["mousePitch"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const m=function(e){let{enable:t,clickTolerance:n}=e;const r=new fo({checkCorrectEvent:e=>0===u.mouseButton(e)&&!e.ctrlKey});return new co({clickTolerance:n,move:(e,t)=>({around:t,panDelta:t.sub(e)}),activateOnStart:!0,moveStateManager:r,enable:t,assignEvents:_o})}(e),g=new yo(e,n);n.dragPan=new jo(r,m,g),this._add("mousePan",m),this._add("touchPan",g,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const _=new To,y=new wo;n.touchZoomRotate=new Fo(r,y,_,l),this._add("touchRotate",_,["touchPan","touchZoom"]),this._add("touchZoom",y,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new no(n));const v=n.scrollZoom=new Ro(n,()=>this._triggerRenderFrame());this._add("scrollZoom",v,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const b=n.keyboard=new Co(n);this._add("keyboard",b),e.interactive&&e.keyboard&&n.keyboard.enable()}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(No(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,n){for(const r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}mergeHandlerResult(e,n,r,i,o){if(!r)return;t.e(e,r);const a={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=a),void 0!==r.panDelta&&(n.drag=a),void 0!==r.rollDelta&&(n.roll=a),void 0!==r.pitchDelta&&(n.pitch=a),void 0!==r.bearingDelta&&(n.rotate=a)}_applyChanges(){const e={},n={},r={};for(const[i,o,a]of this._changes)i.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(i.panDelta)),i.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+i.pitchDelta),i.rollDelta&&(e.rollDelta=(e.rollDelta||0)+i.rollDelta),void 0!==i.around&&(e.around=i.around),void 0!==i.pinchAround&&(e.pinchAround=i.pinchAround),i.noInertia&&(e.noInertia=i.noInertia),t.e(n,o),t.e(r,a);this._updateMapTransform(e,n,r),this._changes=[]}_updateMapTransform(e,t,n){const r=this._map,i=r._getTransformForUpdate(),o=r.terrain;if(!(Vo(e)||o&&this._terrainMovement))return this._fireEvents(t,n,!0);r._stop(!0);let{panDelta:a,zoomDelta:s,bearingDelta:l,pitchDelta:c,rollDelta:u,around:h,pinchAround:d}=e;void 0!==d&&(h=d),h=h||r.transform.centerPoint,o&&!i.isPointOnMapSurface(h)&&(h=i.centerPoint);const p={panDelta:a,zoomDelta:s,rollDelta:u,pitchDelta:c,bearingDelta:l,around:h};this._map.cameraHelper.useGlobeControls&&!i.isPointOnMapSurface(h)&&(h=i.centerPoint);const f=h.distSqr(i.centerPoint)<.01?i.center:i.screenPointToLocation(a?h.sub(a):h);this._handleMapControls({terrain:o,tr:i,deltasForHelper:p,preZoomAroundLoc:f,combinedEventsInProgress:t,panDelta:a}),r._applyUpdatedTransform(i),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}_handleMapControls(e){let{terrain:t,tr:n,deltasForHelper:r,preZoomAroundLoc:i,combinedEventsInProgress:o,panDelta:a}=e;const s=this._map.cameraHelper;if(s.handleMapControlsRollPitchBearingZoom(r,n),t)return s.useGlobeControls?(this._terrainMovement||!o.drag&&!o.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void s.handleMapControlsPan(r,n,i)):this._terrainMovement||!o.drag&&!o.zoom?void(o.drag&&this._terrainMovement&&a?n.setCenter(n.screenPointToLocation(n.centerPoint.sub(a))):s.handleMapControlsPan(r,n,i)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void s.handleMapControlsPan(r,n,i));s.handleMapControlsPan(r,n,i)}_fireEvents(e,n,r){const i=No(this._eventsInProgress),o=No(e),a={};for(const t in e){const{originalEvent:n}=e[t];this._eventsInProgress[t]||(a["".concat(t,"start")]=n),this._eventsInProgress[t]=e[t]}!i&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in a)this._fireEvent(t,a[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:n}=e[t];this._fireEvent(t,n)}const l={};let c;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],c=n[e]||r,l["".concat(t,"end")]=c)}for(const t in l)this._fireEvent(t,l[t]);const u=No(this._eventsInProgress),h=(i||o)&&!u;if(h&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const e=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&e.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(e)}if(r&&h){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;!e||!e.essential&&s.prefersReducedMotion?(this._map.fire(new t.l("moveend",{originalEvent:c})),n(this._map.getBearing())&&this._map.resetNorth()):(n(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new t.l(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Uo("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class qo extends t.E{constructor(e,t,n){super(),this._renderFrameCallback=()=>{const e=Math.min((c()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.cameraHelper=t,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,t){e.apply(this.transform),this.transform=e,this.cameraHelper=t}getCenter(){return new t.U(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,t){return this.jumpTo({elevation:e},t),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,n,r){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},n),r)}panTo(e,n,r){return this.easeTo(t.e({center:e},n),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,n,r){return this.easeTo(t.e({zoom:e},n),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,n){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new t.l("movestart",n)).fire(new t.l("move",n)).fire(new t.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,n,r){return this.easeTo(t.e({bearing:e},n),r)}resetNorth(e,n){return this.rotateTo(0,t.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(t.e({bearing:0,pitch:0,roll:0,duration:1e3},e),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}getRoll(){return this.transform.roll}setRoll(e,t){return this.jumpTo({roll:e},t),this}cameraForBounds(e,t){e=H.convert(e).adjustAntiMeridian();const n=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,t)}_cameraForBoxAndBearing(e,n,r,i){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=t.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const e=i.padding;i.padding={top:e,bottom:e,right:e,left:e}}const a=t.e(o,i.padding);i.padding=a;const s=this.transform,l=new H(e,n);return this.cameraHelper.cameraForBoxAndBearing(i,a,l,r,s)}fitBounds(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}fitScreenCoordinates(e,n,r,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(t.P.convert(e)),this.transform.screenPointToLocation(t.P.convert(n)),r,i),i,o)}_fitInternal(e,n,r){return e?(delete(n=t.e(e,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this}jumpTo(e,n){this.stop();const r=this._getTransformForUpdate();let i=!1,o=!1,a=!1;const s=r.zoom;this.cameraHelper.handleJumpToCenterZoom(r,e);const l=r.zoom!==s;return"elevation"in e&&r.elevation!==+e.elevation&&r.setElevation(+e.elevation),"bearing"in e&&r.bearing!==+e.bearing&&(i=!0,r.setBearing(+e.bearing)),"pitch"in e&&r.pitch!==+e.pitch&&(o=!0,r.setPitch(+e.pitch)),"roll"in e&&r.roll!==+e.roll&&(a=!0,r.setRoll(+e.roll)),null==e.padding||r.isPaddingEqual(e.padding)||r.setPadding(e.padding),this._applyUpdatedTransform(r),this.fire(new t.l("movestart",n)).fire(new t.l("move",n)),l&&this.fire(new t.l("zoomstart",n)).fire(new t.l("zoom",n)).fire(new t.l("zoomend",n)),i&&this.fire(new t.l("rotatestart",n)).fire(new t.l("rotate",n)).fire(new t.l("rotateend",n)),o&&this.fire(new t.l("pitchstart",n)).fire(new t.l("pitch",n)).fire(new t.l("pitchend",n)),a&&this.fire(new t.l("rollstart",n)).fire(new t.l("roll",n)).fire(new t.l("rollend",n)),this.fire(new t.l("moveend",n))}calculateCameraOptionsFromTo(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=t.a5.fromLngLat(e,n),a=t.a5.fromLngLat(r,i),s=a.x-o.x,l=a.y-o.y,c=a.z-o.z,u=Math.hypot(s,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(s,l),d=t.ao(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(s,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:a.toLngLat(),elevation:i,zoom:d,pitch:f,bearing:p}}calculateCameraOptionsFromCameraLngLatAltRotation(e,t,n,r,i){const o=this.transform.calculateCenterFromCameraLngLatAlt(e,t,n,r);return{center:o.center,elevation:o.elevation,zoom:o.zoom,bearing:n,pitch:r,roll:i}}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.cs},e)).animate||!e.essential&&s.prefersReducedMotion)&&(e.duration=0);const r=this._getTransformForUpdate(),i=this.getBearing(),o=r.pitch,a=r.roll,l="bearing"in e?this._normalizeBearing(e.bearing,i):i,c="pitch"in e?+e.pitch:o,u="roll"in e?this._normalizeBearing(e.roll,a):a,h="padding"in e?e.padding:r.padding,d=t.P.convert(e.offset);let p,f;e.around&&(p=t.U.convert(e.around),f=r.locationToScreenPoint(p));const m={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},g=this.cameraHelper.handleEaseTo(r,{bearing:l,pitch:c,roll:u,padding:h,around:p,aroundPoint:f,offsetAsPoint:d,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||i!==l,this._pitching=this._pitching||c!==o,this._rolling=this._rolling||u!==a,this._padding=!r.isPaddingEqual(h),this._zooming=this._zooming||g.isZooming,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,m),this.terrain&&this._prepareElevation(g.elevationCenter),this._ease(t=>{g.easeFunc(t),this.terrain&&!e.freezeElevation&&this._updateElevation(t),this._applyUpdatedTransform(r),this._fireMoveEvents(n)},t=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,t)},e),this}_prepareEase(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,n||r.moving||this.fire(new t.l("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.l("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.l("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.l("pitchstart",e)),this._rolling&&!r.rolling&&this.fire(new t.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){void 0!==this._elevationStart&&void 0!==this._elevationCenter||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const t=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(t-(n-(t*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.setElevation(t.F.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const t=e.getCameraLngLat(),n=e.getCameraAltitude(),r=this.terrain?this.terrain.getElevationForLngLatZoom(t,e.zoom):0;if(n<r){const n=this.calculateCameraOptionsFromTo(t,r,e.center,e.elevation);return{pitch:n.pitch,zoom:n.zoom}}return{}}_applyUpdatedTransform(e){const t=[];if(t.push(e=>this._elevateCameraIfInsideTerrain(e)),this.transformCameraUpdate&&t.push(e=>this.transformCameraUpdate(e)),!t.length)return;const n=e.clone();for(const r of t){const e=n.clone(),{center:t,zoom:i,roll:o,pitch:a,bearing:s,elevation:l}=r(e);t&&e.setCenter(t),void 0!==l&&e.setElevation(l),void 0!==i&&e.setZoom(i),void 0!==o&&e.setRoll(o),void 0!==a&&e.setPitch(a),void 0!==s&&e.setBearing(s),n.apply(e)}this.transform.apply(n)}_fireMoveEvents(e){this.fire(new t.l("move",e)),this._zooming&&this.fire(new t.l("zoom",e)),this._rotating&&this.fire(new t.l("rotate",e)),this._pitching&&this.fire(new t.l("pitch",e)),this._rolling&&this.fire(new t.l("roll",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const r=this._zooming,i=this._rotating,o=this._pitching,a=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,r&&this.fire(new t.l("zoomend",e)),i&&this.fire(new t.l("rotateend",e)),o&&this.fire(new t.l("pitchend",e)),a&&this.fire(new t.l("rollend",e)),this.fire(new t.l("moveend",e))}flyTo(e,n){if(!e.essential&&s.prefersReducedMotion){const r=t.S(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(r,n)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.cs},e);const r=this._getTransformForUpdate(),i=r.bearing,o=r.pitch,a=r.roll,l=r.padding,c="bearing"in e?this._normalizeBearing(e.bearing,i):i,u="pitch"in e?+e.pitch:o,h="roll"in e?this._normalizeBearing(e.roll,a):a,d="padding"in e?e.padding:r.padding,p=t.P.convert(e.offset);let f=r.centerPoint.add(p);const m=r.screenPointToLocation(f),g=this.cameraHelper.handleFlyTo(r,{bearing:c,pitch:u,roll:h,padding:d,locationAtOffset:m,offsetAsPoint:p,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let _=e.curve;const y=Math.max(r.width,r.height),v=y/g.scaleOfZoom,b=g.pixelPathLength;"number"==typeof g.scaleOfMinZoom&&(_=Math.sqrt(y/g.scaleOfMinZoom/b*2));const x=_*_;function w(e){const t=(v*v-y*y+(e?-1:1)*x*x*b*b)/(2*(e?v:y)*x*b);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return(Math.exp(e)-Math.exp(-e))/2}function T(e){return(Math.exp(e)+Math.exp(-e))/2}const E=w(!1);let k=function(e){return T(E)/T(E+_*e)},P=function(e){return y*((T(E)*(S(t=E+_*e)/T(t))-S(E))/x)/b;var t},C=(w(!0)-E)/_;if(Math.abs(b)<2e-6||!isFinite(C)){if(Math.abs(y-v)<1e-6)return this.easeTo(e,n);const t=v<y?-1:1;C=Math.abs(Math.log(v/y))/_,P=()=>0,k=e=>Math.exp(t*_*e)}return e.duration="duration"in e?+e.duration:1e3*C/("screenSpeed"in e?+e.screenSpeed/_:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=i!==c,this._pitching=u!==o,this._rolling=h!==a,this._padding=!r.isPaddingEqual(d),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(g.targetCenter),this._ease(s=>{const m=s*C,_=1/k(m),y=P(m);this._rotating&&r.setBearing(t.F.number(i,c,s)),this._pitching&&r.setPitch(t.F.number(o,u,s)),this._rolling&&r.setRoll(t.F.number(a,h,s)),this._padding&&(r.interpolatePadding(l,d,s),f=r.centerPoint.add(p)),g.easeFunc(s,_,y,f),this.terrain&&!e.freezeElevation&&this._updateElevation(s),this._applyUpdatedTransform(r),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){var n;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}return e||null===(n=this.handlers)||void 0===n||n.stop(!1),this}_ease(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this._easeStart=c(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=t.V(e,-180,180);const r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(t.U.convert(e),this.transform.tileZoom):null}}const Zo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Wo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Zo;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=e=>{!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType&&"terrain"!==e.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=u.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=u.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=u.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){u.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString("AttributionControl.".concat(t));e.title=n,e.setAttribute("aria-label",n)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(e=>"string"!=typeof e?"":e)):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style.tileManagers;for(const r in t){const n=t[r];if(n.used||n.usedForTerrain){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e=e.filter(e=>String(e).trim()),e.sort((e,t)=>e.length-t.length),e=e.filter((t,n)=>{for(let r=n+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0});const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=u.sanitize(n),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ho{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._updateCompact=()=>{const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&t.classList.add("maplibregl-compact"):t.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=u.create("div","maplibregl-ctrl");const t=u.create("a","maplibregl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://maplibre.org/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){u.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Xo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const r of n)if(r.id===e)return void(r.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ko=t.aO([{name:"a_pos3d",type:"Int16",components:3}]);class Yo extends t.E{constructor(e){super(),this._lastTilesetChange=c(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,n){this.tileManager.update(e,n),this._renderableTilesKeys=[];const r={};for(const i of Ee(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.tileManager._source.calculateTileZoom}))r[i.key]=!0,this._renderableTilesKeys.push(i.key),this._tiles[i.key]||(i.terrainRttPosMatrix32f=new Float64Array(16),t.c1(i.terrainRttPosMatrix32f,0,t.a3,t.a3,0,0,1),this._tiles[i.key]=new de(i,this.tileSize),this._lastTilesetChange=c());for(const t in this._tiles)r[t]||delete this._tiles[t]}freeRtt(e){for(const t in this._tiles){const n=this._tiles[t];(!e||n.tileID.equals(e)||n.tileID.isChildOf(e)||e.isChildOf(n.tileID))&&(n.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,t){return t?this._getTerrainCoordsForTileRanges(e,t):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const n={};for(const r of this._renderableTilesKeys){const i=this._tiles[r].tileID,o=e.clone(),a=t.be();if(i.canonical.equals(e.canonical))t.c1(a,0,t.a3,t.a3,0,0,1);else if(i.canonical.isChildOf(e.canonical)){const n=i.canonical.z-e.canonical.z,r=i.canonical.x-(i.canonical.x>>n<<n),o=i.canonical.y-(i.canonical.y>>n<<n),s=t.a3>>n;t.c1(a,0,s,s,0,0,1),t.N(a,a,[-r*s,-o*s,0])}else{if(!e.canonical.isChildOf(i.canonical))continue;{const n=e.canonical.z-i.canonical.z,r=e.canonical.x-(e.canonical.x>>n<<n),o=e.canonical.y-(e.canonical.y>>n<<n),s=t.a3>>n;t.c1(a,0,t.a3,t.a3,0,0,1),t.N(a,a,[r*s,o*s,0]),t.O(a,a,[1/2**n,1/2**n,0])}}o.terrainRttPosMatrix32f=new Float32Array(a),n[r]=o}return n}_getTerrainCoordsForTileRanges(e,n){const r={};for(const i of this._renderableTilesKeys){const o=this._tiles[i].tileID;if(!this._isWithinTileRanges(o,n))continue;const a=e.clone(),s=t.be();if(o.canonical.z===e.canonical.z){const n=e.canonical.x-o.canonical.x,r=e.canonical.y-o.canonical.y;t.c1(s,0,t.a3,t.a3,0,0,1),t.N(s,s,[n*t.a3,r*t.a3,0])}else if(o.canonical.z>e.canonical.z){const n=o.canonical.z-e.canonical.z,r=o.canonical.x-(o.canonical.x>>n<<n),i=o.canonical.y-(o.canonical.y>>n<<n),a=e.canonical.x-(o.canonical.x>>n),l=e.canonical.y-(o.canonical.y>>n),c=t.a3>>n;t.c1(s,0,c,c,0,0,1),t.N(s,s,[-r*c+a*t.a3,-i*c+l*t.a3,0])}else{const n=e.canonical.z-o.canonical.z,r=e.canonical.x-(e.canonical.x>>n<<n),i=e.canonical.y-(e.canonical.y>>n<<n),a=(e.canonical.x>>n)-o.canonical.x,l=(e.canonical.y>>n)-o.canonical.y,c=t.a3<<n;t.c1(s,0,c,c,0,0,1),t.N(s,s,[r*t.a3+a*c,i*t.a3+l*c,0])}a.terrainRttPosMatrix32f=new Float32Array(s),r[i]=a}return r}getSourceTile(e,t){const n=this.tileManager._source;let r=e.overscaledZ-this.deltaZoom;if(r>n.maxzoom&&(r=n.maxzoom),r<n.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(r).key);let i=this.tileManager.getTileByID(this._sourceTileCache[e.key]);if((!i||!i.dem)&&t)for(;r>=n.minzoom&&(!i||!i.dem);)i=this.tileManager.getTileByID(e.scaledTo(r--).key);return i}anyTilesAfterTime(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return this._lastTilesetChange>=e}_isWithinTileRanges(e,t){return t[e.canonical.z]&&e.canonical.x>=t[e.canonical.z].minTileX&&e.canonical.x<=t[e.canonical.z].maxTileX&&e.canonical.y>=t[e.canonical.z].minTileY&&e.canonical.y<=t[e.canonical.z].maxTileY}}class Jo{constructor(e,t,n){this._meshCache={},this.painter=e,this.tileManager=new Yo(t),this.options=n,this.exaggeration="number"==typeof n.exaggeration?n.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.a3;var o;if(!(n>=0&&n<i&&r>=0&&r<i))return 0;const a=this.getTerrainData(e),s=null===(o=a.tile)||void 0===o?void 0:o.dem;if(!s)return 0;const l=t.cw([],[n/i*t.a3,r/i*t.a3],a.u_terrain_matrix),c=[l[0]*s.dim,l[1]*s.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return s.get(u,h)*(1-d)*(1-p)+s.get(u+1,h)*d*(1-p)+s.get(u,h+1)*(1-d)*p+s.get(u+1,h+1)*d*p}getElevationForLngLatZoom(e,n){if(!t.cx(n,e.wrap()))return 0;const{tileID:r,mercatorX:i,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(r,i%t.a3,o%t.a3,t.a3)}getElevation(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.a3;return this.getDEMElevation(e,n,r,i)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const e=this.painter.context,n=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new t.T(e,n,e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new t.T(e,new t.R({width:1,height:1}),e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.am([])}const n=this.tileManager.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const e=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new t.T(e,n.dem.getPixels(),e.gl.RGBA,{premultiply:!1}),n.demTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const r=n&&n+n.tileID.key+e.key;if(r&&!this._demMatrixCache[r]){const r=this.tileManager.getSource().maxzoom;let i=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=r?i=e.canonical.z-r:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=e.canonical.x-(e.canonical.x>>i<<i),a=e.canonical.y-(e.canonical.y>>i<<i),s=t.cy(new Float64Array(16),[1/(t.a3<<i),1/(t.a3<<i),0]);t.N(s,s,[o*t.a3,a*t.a3,0]),this._demMatrixCache[e.key]={matrix:s,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:r?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,r=n.width/devicePixelRatio,i=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===r&&this._fbo.height===i||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new t.T(n.context,{width:r,height:i,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new t.T(n.context,{width:r,height:i,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(r,i,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,r,i))),this._fbo.colorAttachment.set("coords"===e?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let t=0,o=0;t<this._coordsTextureSize;t++)for(let e=0;e<this._coordsTextureSize;e++,o+=4)n[o+0]=255&e,n[o+1]=255&t,n[o+2]=e>>8<<4|t>>8,n[o+3]=0;const r=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),i=new t.T(e,r,e.gl.RGBA,{premultiply:!1});return i.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=i,i}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),r=this.painter.context,i=r.gl,o=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),a=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),s=Math.round(this.painter.height/devicePixelRatio);r.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),i.readPixels(o,s-a-1,1,1,i.RGBA,i.UNSIGNED_BYTE,n),r.bindFramebuffer.set(null);const l=n[0]+(n[2]>>4<<8),c=n[1]+((15&n[2])<<8),u=this.coordsIndex[255-n[3]],h=u&&this.tileManager.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new t.a5((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(e){const t=new Uint8Array(4),n=this.painter.context,r=n.gl;return n.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),r.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,r.RGBA,r.UNSIGNED_BYTE,t),n.bindFramebuffer.set(null),(t[0]/16777216+t[1]/65536+t[2]/256+t[3])/256}getTerrainMesh(e){var n;const r=(null===(n=this.painter.style.projection)||void 0===n?void 0:n.transitionState)>0,i=r&&0===e.canonical.y,o=r&&e.canonical.y===(1<<e.canonical.z)-1,a="m_".concat(i?"n":"","_").concat(o?"s":"");if(this._meshCache[a])return this._meshCache[a];const s=this.painter.context,l=new t.cz,c=new t.aS,u=this.meshSize,h=t.a3/u,d=u*u;for(let t=0;t<=u;t++)for(let e=0;e<=u;e++)l.emplaceBack(e*h,t*h,0);for(let t=0;t<d;t+=u+1)for(let e=0;e<u;e++)c.emplaceBack(e+t,u+e+t+1,u+e+t+2),c.emplaceBack(e+t,u+e+t+2,e+t+1);const p=l.length,f=p+(u+1),m=(u+1)*u,g=i?t.bl:0,_=i?0:1,y=o?t.bm:t.a3,v=o?0:1;for(let t=0;t<=u;t++)l.emplaceBack(t*h,g,_);for(let t=0;t<=u;t++)l.emplaceBack(t*h,y,v);for(let t=0;t<u;t++)c.emplaceBack(m+t,f+t,f+t+1),c.emplaceBack(m+t,f+t+1,m+t+1),c.emplaceBack(0+t,p+t+1,p+t),c.emplaceBack(0+t,0+t+1,p+t+1);const b=l.length,x=b+2*(u+1);for(const S of[0,1])for(let e=0;e<=u;e++)for(const n of[0,1])l.emplaceBack(S*t.a3,e*h,n);for(let t=0;t<2*u;t+=2)c.emplaceBack(b+t,b+t+1,b+t+3),c.emplaceBack(b+t,b+t+3,b+t+2),c.emplaceBack(x+t,x+t+3,x+t+1),c.emplaceBack(x+t,x+t+2,x+t+3);const w=new It(s.createVertexBuffer(l,Ko.members),s.createIndexBuffer(c),t.aR.simpleSegment(0,0,l.length,c.length));return this._meshCache[a]=w,w}getMeshFrameDelta(e){return 2*Math.PI*t.by/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,t){var n;const{tileID:r}=this._getOverscaledTileIDFromLngLatZoom(e,t);return null!==(n=this.getMinMaxElevation(r).minElevation)&&void 0!==n?n:0}getMinMaxElevation(e){const t=this.getTerrainData(e).tile,n={minElevation:null,maxElevation:null};return t&&t.dem&&(n.minElevation=t.dem.min*this.exaggeration,n.maxElevation=t.dem.max*this.exaggeration),n}_getOverscaledTileIDFromLngLatZoom(e,n){const r=t.a5.fromLngLat(e.wrap()),i=(1<<n)*t.a3,o=r.x*i,a=r.y*i,s=Math.floor(o/t.a3),l=Math.floor(a/t.a3);return{tileID:new t.a0(n,0,n,s,l),mercatorX:o,mercatorY:a}}}class Qo{constructor(e,t,n){this._context=e,this._size=t,this._tileSize=n,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),r=new t.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return r.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(r.texture),{id:e,fbo:n,texture:r,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(t=>e.id!==t),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const t of this._recentlyUsed)if(!this._objects[t].inUse)return this._objects[t];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(e=>!e.inUse)}}const $o={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class ea{constructor(e,t){this.painter=e,this.terrain=t,this.pool=new Qo(e.context,30,t.tileManager.tileSize*t.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,t){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter(n=>!e._layers[n].isHidden(t)),this._coordsAscending={};for(const n in e.tileManagers){this._coordsAscending[n]={};const t=e.tileManagers[n].getVisibleCoordinates(),r=e.tileManagers[n].getSource(),i=r instanceof te?r.terrainTileRanges:null;for(const e of t){const t=this.terrain.tileManager.getTerrainCoords(e,i);for(const e in t)this._coordsAscending[n][e]||(this._coordsAscending[n][e]=[]),this._coordsAscending[n][e].push(t[e])}}this._coordsAscendingStr={};for(const n of e._order){const t=e._layers[n],r=t.source;if($o[t.type]&&!this._coordsAscendingStr[r]){this._coordsAscendingStr[r]={};for(const e in this._coordsAscending[r])this._coordsAscendingStr[r][e]=this._coordsAscending[r][e].map(e=>e.key).sort().join()}}for(const n of this._renderableTiles)for(const e in this._coordsAscendingStr){const t=this._coordsAscendingStr[e][n.tileID.key];t&&t!==n.rttCoords[e]&&(n.rtt=[])}}renderLayer(e,n){if(e.isHidden(this.painter.transform.zoom))return!1;const r=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),i=e.type,o=this.painter,a=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if($o[i]&&(this._prevType&&$o[this._prevType]||this._stacks.push([]),this._prevType=i,this._stacks[this._stacks.length-1].push(e.id),!a))return!0;if($o[this._prevType]||$o[i]&&a){this._prevType=i;const e=this._stacks.length-1,n=this._stacks[e]||[];for(const i of this._renderableTiles){if(this.pool.isFull()&&(Fi(this.painter,this.terrain,this._rttTiles,r),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(i),i.rtt[e]){const t=this.pool.getObjectForId(i.rtt[e].id);if(t.stamp===i.rtt[e].stamp){this.pool.useObject(t);continue}}const a=this.pool.getOrCreateFreeObject();this.pool.useObject(a),this.pool.stampObject(a),i.rtt[e]={id:a.id,stamp:a.stamp},o.context.bindFramebuffer.set(a.fbo.framebuffer),o.context.clear({color:t.bj.transparent,stencil:0}),o.currentStencilSource=void 0;for(let e=0;e<n.length;e++){const t=o.style._layers[n[e]],s=t.source?this._coordsAscending[t.source][i.tileID.key]:[i.tileID];o.context.viewport.set([0,0,a.fbo.width,a.fbo.height]),o._renderTileClippingMasks(t,s,!0),o.renderLayer(o,o.style.tileManagers[t.source],t,s,r),t.source&&(i.rttCoords[t.source]=this._coordsAscendingStr[t.source][i.tileID.key])}}return Fi(this.painter,this.terrain,this._rttTiles,r),this._rttTiles=[],this.pool.freeAllObjects(),$o[i]}return!1}}const ta={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},na=n,ra={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Zo,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},ia={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class oa{constructor(e,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.mousedown=e=>{this.startMove(e,u.mousePos(this.element,e)),u.addEventListener(window,"mousemove",this.mousemove),u.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=e=>{this.move(e,u.mousePos(this.element,e))},this.mouseup=e=>{this._rotatePitchHandler.dragEnd(e),this.offTemp()},this.touchstart=e=>{1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=u.touchPos(this.element,e.targetTouches)[0],this.startMove(e,this._startPos),u.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),u.addEventListener(window,"touchend",this.touchend))},this.touchmove=e=>{1!==e.targetTouches.length?this.reset():(this._lastPos=u.touchPos(this.element,e.targetTouches)[0],this.move(e,this._lastPos))},this.touchend=e=>{0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const i=new go;this._rotatePitchHandler=new co({clickTolerance:3,move:(e,i)=>{const o=n.getBoundingClientRect(),a=new t.P((o.bottom-o.top)/2,(o.right-o.left)/2);return{bearingDelta:t.cr(new t.P(e.x,i.y),i,a),pitchDelta:r?-.5*(i.y-e.y):void 0}},moveStateManager:i,enable:!0,assignEvents:()=>{}}),this.map=e,u.addEventListener(n,"mousedown",this.mousedown),u.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),u.addEventListener(n,"touchcancel",this.reset)}startMove(e,t){this._rotatePitchHandler.dragStart(e,t),u.disableDrag()}move(e,t){const n=this.map,{bearingDelta:r,pitchDelta:i}=this._rotatePitchHandler.dragMove(e,t)||{};r&&n.setBearing(n.getBearing()+r),i&&n.setPitch(n.getPitch()+i)}off(){const e=this.element;u.removeEventListener(e,"mousedown",this.mousedown),u.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),u.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),u.removeEventListener(window,"touchend",this.touchend),u.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){u.enableDrag(),u.removeEventListener(window,"mousemove",this.mousemove),u.removeEventListener(window,"mouseup",this.mouseup),u.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),u.removeEventListener(window,"touchend",this.touchend)}}let aa;function sa(e,n,r){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3]||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return null==e?void 0:e.wrap();const i=new t.U(e.lng,e.lat);if(e=new t.U(e.lng,e.lat),n){const i=new t.U(e.lng-360,e.lat),o=new t.U(e.lng+360,e.lat),a=r.locationToScreenPoint(e).distSqr(n);r.locationToScreenPoint(i).distSqr(n)<a?e=i:r.locationToScreenPoint(o).distSqr(n)<a&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationToScreenPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e.lng!==i.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(e))?e:i}const la={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ca(e,t,n){const r=e.classList;for(const i in la)r.remove("maplibregl-".concat(n,"-anchor-").concat(i));r.add("maplibregl-".concat(n,"-anchor-").concat(t))}class ua extends t.E{constructor(e){if(super(),this._onKeyPress=e=>{const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()},this._onMapClick=e=>{const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()},this._update=e=>{if(!this._map)return;const t=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==e?void 0:e.type)||"render"===(null==e?void 0:e.type)&&!t)&&this._map.once("render",this._update),this._lngLat=sa(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let n="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?n="rotateZ(".concat(this._rotation,"deg)"):"map"===this._rotationAlignment&&(n="rotateZ(".concat(this._rotation-this._map.getBearing(),"deg)"));let r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX(".concat(this._map.getPitch(),"deg)")),this._subpixelPositioning||e&&"moveend"!==e.type||(this._pos=this._pos.round()),u.setTransform(this._element,"".concat(la[this._anchor]," translate(").concat(this._pos.x,"px, ").concat(this._pos.y,"px) ").concat(r," ").concat(n)),s.frameAsync(new AbortController).then(()=>{this._updateOpacity(e&&"moveend"===e.type)}).catch(()=>{})},this._onMove=e=>{if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.l("dragstart"))),this.fire(new t.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.l("dragend")),this._state="inactive"},this._addDragHandler=e=>{this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,this.setOpacity(null==e?void 0:e.opacity,null==e?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=u.create("div");const n=u.createNS("http://www.w3.org/2000/svg","svg"),r=41,i=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height","".concat(r,"px")),n.setAttributeNS(null,"width","".concat(i,"px")),n.setAttributeNS(null,"viewBox","0 0 ".concat(i," ").concat(r));const o=u.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const a=u.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const s=u.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"transform","translate(3.0, 29.0)"),s.setAttributeNS(null,"fill","#000000");const l=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of l){const t=u.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),s.appendChild(t)}const c=u.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"fill",this._color);const h=u.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),c.appendChild(h);const d=u.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=u.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=u.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=u.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=u.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const _=u.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#FFFFFF"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(_),a.appendChild(s),a.appendChild(c),a.appendChild(d),a.appendChild(f),a.appendChild(m),n.appendChild(a),n.setAttributeNS(null,"height",r*this._scale+"px"),n.setAttributeNS(null,"width",i*this._scale+"px"),this._element.appendChild(n),this._offset=t.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()}),ca(this._element,this._anchor,"marker"),e&&e.className)for(const t of e.className.split(" "))this._element.classList.add(t);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),u.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.U.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,r=Math.abs(n)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-n+r)],"bottom-right":[-r,-1*(t-n+r)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var n,r;const i=null===(n=this._map)||void 0===n?void 0:n.terrain,o=this._map.transform.isLocationOccluded(this._lngLat);if(!i||o){const e=o?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==e&&(this._element.style.opacity=e))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const a=this._map,s=a.terrain.depthAtPoint(this._pos),l=a.terrain.getElevationForLngLatZoom(this._lngLat,a.transform.tileZoom);if(a.transform.lngLatToCameraDepth(this._lngLat,l)-s<.006)return void(this._element.style.opacity=this._opacity);const c=-this._offset.y/a.transform.pixelsPerMeter,u=Math.sin(a.getPitch()*Math.PI/180)*c,h=a.terrain.depthAtPoint(new t.P(this._pos.x,this._pos.y-this._offset.y)),d=a.transform.lngLatToCameraDepth(this._lngLat,l+u)-h>.006;(null===(r=this._popup)||void 0===r?void 0:r.isOpen())&&d&&this._popup.remove(),this._element.style.opacity=d?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,t){return(void 0===this._opacity||void 0===e&&void 0===t)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==e&&(this._opacity=e),void 0!==t&&(this._opacityWhenCovered=t),this._map&&this._updateOpacity(!0),this}}const ha={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let da=0,pa=!1;const fa={maxWidth:100,unit:"metric"};function ma(e,t,n){const r=n&&n.maxWidth||100,i=e._container.clientHeight/2,o=e._container.clientWidth/2,a=e.unproject([o-r/2,i]),s=e.unproject([o+r/2,i]),l=Math.round(e.project(s).x-e.project(a).x),c=Math.min(r,l,e._container.clientWidth),u=a.distanceTo(s);if(n&&"imperial"===n.unit){const n=3.2808*u;n>5280?ga(t,c,n/5280,e._getUIString("ScaleControl.Miles")):ga(t,c,n,e._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?ga(t,c,u/1852,e._getUIString("ScaleControl.NauticalMiles")):u>=1e3?ga(t,c,u/1e3,e._getUIString("ScaleControl.Kilometers")):ga(t,c,u,e._getUIString("ScaleControl.Meters"))}function ga(e,t,n,r){const i=function(e){const t=Math.pow(10,"".concat(Math.floor(e)).length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(n);e.style.width=t*(i/n)+"px",e.innerHTML="".concat(i,"&nbsp;").concat(r)}const _a={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ya=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function va(e){if(e){if("number"==typeof e){const n=Math.round(Math.abs(e)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,e),"top-left":new t.P(n,n),"top-right":new t.P(-n,n),bottom:new t.P(0,-e),"bottom-left":new t.P(n,-n),"bottom-right":new t.P(-n,-n),left:new t.P(e,0),right:new t.P(-e,0)}}if(e instanceof t.P||Array.isArray(e)){const n=t.P.convert(e);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:t.P.convert(e.center||[0,0]),top:t.P.convert(e.top||[0,0]),"top-left":t.P.convert(e["top-left"]||[0,0]),"top-right":t.P.convert(e["top-right"]||[0,0]),bottom:t.P.convert(e.bottom||[0,0]),"bottom-left":t.P.convert(e["bottom-left"]||[0,0]),"bottom-right":t.P.convert(e["bottom-right"]||[0,0]),left:t.P.convert(e.left||[0,0]),right:t.P.convert(e.right||[0,0])}}return va(new t.P(0,0))}const ba=n;e.AJAXError=t.cD,e.Event=t.l,e.Evented=t.E,e.LngLat=t.U,e.MercatorCoordinate=t.a5,e.Point=t.P,e.addProtocol=t.cE,e.config=t.a,e.removeProtocol=t.cF,e.AttributionControl=Wo,e.BoxZoomHandler=io,e.CanvasSource=re,e.CooperativeGesturesHandler=Bo,e.DoubleClickZoomHandler=Do,e.DragPanHandler=jo,e.DragRotateHandler=Oo,e.EdgeInsets=zt,e.FullscreenControl=class extends t.E{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._onFullscreenChange=()=>{var e;let t=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(e=null==t?void 0:t.shadowRoot)||void 0===e?void 0:e.fullscreenElement;)t=t.shadowRoot.fullscreenElement;t===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){u.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const e=this._fullscreenButton=u.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);u.create("span","maplibregl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new t.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},e.GeoJSONSource=ee,e.GeolocateControl=class extends t.E{constructor(e){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new t.U(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),o=t.e({bearing:i},this.options.fitBoundsOptions),a=H.fromLngLat(n,r);this._map.fitBounds(a,o,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new t.U(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&pa)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=u.create("button","maplibregl-ctrl-geolocate",this._container),u.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=u.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ua({element:this._dotElement}),this._circleElement=u.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ua({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{const n=(null==e?void 0:e[0])instanceof ResizeObserverEntry;e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.l("trackuserlocationend")),this.fire(new t.l("userlocationlostfocus")))})}},this.options=t.e({},ha,e)}onAdd(e){return this._map=e,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return t._(this,arguments,void 0,function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function*(){if(void 0!==aa&&!e)return aa;if(void 0===window.navigator.permissions)return aa=!!window.navigator.geolocation,aa;try{const e=yield window.navigator.permissions.query({name:"geolocation"});aa="denied"!==e.state}catch(e){aa=!!window.navigator.geolocation}return aa}()})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),u.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,da=0,pa=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}}_updateCircleRadiusIfNeeded(){const e=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&e))return;const t=this._map.project(e),n=this._map.unproject([t.x+100,t.y]),r=e.distanceTo(n)/100,i=2*this._accuracy/r;this._circleElement.style.width="".concat(i.toFixed(2),"px"),this._circleElement.style.height="".concat(i.toFixed(2),"px")}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":da--,pa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.l("trackuserlocationstart")),this.fire(new t.l("userlocationfocus"));break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),da++,da>1?(e={maximumAge:6e5,timeout:0},pa=!0):(e=this.options.positionOptions,pa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},e.GlobeControl=class{constructor(){this._toggleProjection=()=>{var e;const t=null===(e=this._map.getProjection())||void 0===e?void 0:e.type;this._map.setProjection("mercator"!==t&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var e;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(e=this._map.getProjection())||void 0===e?void 0:e.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(e){return this._map=e,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=u.create("button","maplibregl-ctrl-globe",this._container),u.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){u.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},e.Hash=Vi,e.ImageSource=te,e.KeyboardHandler=Co,e.LngLatBounds=H,e.LogoControl=Ho,e.Map=class extends qo{constructor(e){var n,r;t.cA.mark(t.cB.create);const i=Object.assign(Object.assign(Object.assign({},ra),e),{canvasContextAttributes:Object.assign(Object.assign({},ra.canvasContextAttributes),e.canvasContextAttributes)});if(null!=i.minZoom&&null!=i.maxZoom&&i.minZoom>i.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=i.minPitch&&null!=i.maxPitch&&i.minPitch>i.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=i.minPitch&&i.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=i.maxPitch&&i.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const o=new Ut,a=new Zt;if(void 0!==i.minZoom&&o.setMinZoom(i.minZoom),void 0!==i.maxZoom&&o.setMaxZoom(i.maxZoom),void 0!==i.minPitch&&o.setMinPitch(i.minPitch),void 0!==i.maxPitch&&o.setMaxPitch(i.maxPitch),void 0!==i.renderWorldCopies&&o.setRenderWorldCopies(i.renderWorldCopies),null!==i.transformConstrain&&o.setConstrainOverride(i.transformConstrain),super(o,a,{bearingSnap:i.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Xo,this._controls=[],this._mapId=t.ab(),this._lostContextStyle={style:null,images:null},this._contextLost=e=>{e.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const t of Object.values(this.style._layers))if("custom"===t.type&&console.warn("Custom layer with id '".concat(t.id,"' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.")),t._listeners)for(const[e]of Object.entries(t._listeners))console.warn("Custom layer with id '".concat(t.id,"' had event listeners for event '").concat(e,"' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration."));this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new t.l("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new t.l("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=i.interactive,this._maxTileCacheSize=i.maxTileCacheSize,this._maxTileCacheZoomLevels=i.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},i.canvasContextAttributes),this._trackResize=!0===i.trackResize,this._bearingSnap=i.bearingSnap,this._centerClampedToGround=i.centerClampedToGround,this._refreshExpiredTiles=!0===i.refreshExpiredTiles,this._fadeDuration=i.fadeDuration,this._crossSourceCollisions=!0===i.crossSourceCollisions,this._collectResourceTiming=!0===i.collectResourceTiming,this._locale=Object.assign(Object.assign({},ta),i.locale),this._clickTolerance=i.clickTolerance,this._overridePixelRatio=i.pixelRatio,this._maxCanvasSize=i.maxCanvasSize,this._zoomLevelsToOverscale=i.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=i.transformCameraUpdate,this.transformConstrain=i.transformConstrain,this.cancelPendingTileRequestsWhileZooming=!0===i.cancelPendingTileRequestsWhileZooming,void 0!==i.reduceMotion&&(s.prefersReducedMotion=i.reduceMotion),this._imageQueueHandle=_.addThrottleControl(()=>this.isMoving()),this._requestManager=new y(i.transformRequest),"string"==typeof i.container){if(this._container=document.getElementById(i.container),!this._container)throw new Error("Container '".concat(i.container,"' not found."))}else{if(!(i.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=i.container}if(i.maxBounds&&this.setMaxBounds(i.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let e=!1;const t=Ui(e=>{this._trackResize&&!this._removed&&(this.resize(e),this.redraw())},50);this._resizeObserver=new ResizeObserver(n=>{e?t(n):e=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Go(this,i),this._hash=i.hash&&new Vi("string"==typeof i.hash&&i.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:i.center,elevation:i.elevation,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch,roll:i.roll}),i.bounds&&(this.resize(),this.fitBounds(i.bounds,t.e({},i.fitBoundsOptions,{duration:0}))));const l="string"==typeof i.style||!("globe"===(null===(r=null===(n=i.style)||void 0===n?void 0:n.projection)||void 0===r?void 0:r.type));this.resize(null,l),this._localIdeographFontFamily=i.localIdeographFontFamily,this._validateStyle=i.validateStyle,i.style&&this.setStyle(i.style,{localIdeographFontFamily:i.localIdeographFontFamily}),i.attributionControl&&this.addControl(new Wo("boolean"==typeof i.attributionControl?void 0:i.attributionControl)),i.maplibreLogo&&this.addControl(new Ho,i.logoPosition),this.on("style.load",()=>{if(l||this._resizeTransform(),this.transform.unmodified){const e=t.S(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(e)}}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new t.l("".concat(e.dataType,"data"),e))}),this.on("dataloading",e=>{this.fire(new t.l("".concat(e.dataType,"dataloading"),e))}),this.on("dataabort",e=>{this.fire(new t.l("sourcedataabort",e))})}_getMapId(){return this._mapId}setGlobalStateProperty(e,t){return this.style.setGlobalStateProperty(e,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}coveringTiles(e){return Ee(this.transform,e)}calculateCameraOptionsFromTo(e,t,n,r){return null==r&&this.terrain&&(r=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(e,t,n,r)}resize(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[r,i]=this._containerDimensions(),o=this._getClampedPixelRatio(r,i);if(this._resizeCanvas(r,i,o),this.painter.resize(r,i,o),this.painter.overLimit()){const e=this.painter.context.gl;this._maxCanvasSize=[e.drawingBufferWidth,e.drawingBufferHeight];const t=this._getClampedPixelRatio(r,i);this._resizeCanvas(r,i,t),this.painter.resize(r,i,t)}this._resizeTransform(n);const a=!this._moving;return a&&(this.stop(),this.fire(new t.l("movestart",e)).fire(new t.l("move",e))),this.fire(new t.l("resize",e)),a&&this.fire(new t.l("moveend",e)),this}_resizeTransform(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t;const[n,r]=this._containerDimensions();this.transform.resize(n,r,e),null===(t=this._requestedCameraState)||void 0===t||t.resize(n,r,e)}_getClampedPixelRatio(e,t){const{0:n,1:r}=this._maxCanvasSize,i=this.getPixelRatio(),o=e*i,a=t*i;return Math.min(o>n?n/o:1,a>r?r/a:1)*i}getPixelRatio(){var e;return null!==(e=this._overridePixelRatio)&&void 0!==e?e:devicePixelRatio}setPixelRatio(e){this._overridePixelRatio=e,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(H.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.setMinZoom(e),this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.setMaxZoom(e),this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.setMinPitch(e),this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?60:e)>180)throw new Error("maxPitch must be less than or equal to 180");if(e>=this.transform.minPitch)return this.transform.setMaxPitch(e),this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.setRenderWorldCopies(e),this._update()}setTransformConstrain(e){return this.transform.setConstrainOverride(e),this._update()}project(e){return this.transform.locationToScreenPoint(t.U.convert(e),this.style&&this.terrain)}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this.terrain)}isMoving(){var e;return this._moving||(null===(e=this.handlers)||void 0===e?void 0:e.isMoving())}isZooming(){var e;return this._zooming||(null===(e=this.handlers)||void 0===e?void 0:e.isZooming())}isRotating(){var e;return this._rotating||(null===(e=this.handlers)||void 0===e?void 0:e.isRotating())}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let r=!1;const i=i=>{const o=t.filter(e=>this.getLayer(e)),a=0!==o.length?this.queryRenderedFeatures(i.point,{layers:o}):[];a.length?r||(r=!0,n.call(this,new Qi(e,this,i.originalEvent,{features:a}))):r=!1};return{layers:t,listener:n,delegates:{mousemove:i,mouseout:()=>{r=!1}}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const i=i=>{const o=t.filter(e=>this.getLayer(e));(0!==o.length?this.queryRenderedFeatures(i.point,{layers:o}):[]).length?r=!0:r&&(r=!1,n.call(this,new Qi(e,this,i.originalEvent)))},o=t=>{r&&(r=!1,n.call(this,new Qi(e,this,t.originalEvent)))};return{layers:t,listener:n,delegates:{mousemove:i,mouseout:o}}}{const r=e=>{const r=t.filter(e=>this.getLayer(e)),i=0!==r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];i.length&&(e.features=i,n.call(this,e),delete e.features)};return{layers:t,listener:n,delegates:{[e]:r}}}}_saveDelegatedListener(e,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(t)}_removeDelegatedListener(e,t,n){if(!this._delegatedListeners||!this._delegatedListeners[e])return;const r=this._delegatedListeners[e];for(let i=0;i<r.length;i++){const e=r[i];if(e.listener===n&&e.layers.length===t.length&&e.layers.every(e=>t.includes(e))){for(const t in e.delegates)this.off(t,e.delegates[t]);return void r.splice(i,1)}}}on(e,t,n){if(void 0===n)return super.on(e,t);const r="string"==typeof t?[t]:t,i=this._createDelegatedListener(e,r,n);this._saveDelegatedListener(e,i);for(const o in i.delegates)this.on(o,i.delegates[o]);return{unsubscribe:()=>{this._removeDelegatedListener(e,r,n)}}}once(e,t,n){var r=this;if(void 0===n)return super.once(e,t);const i="string"==typeof t?[t]:t,o=this._createDelegatedListener(e,i,n);for(const a in o.delegates){const t=o.delegates[a];o.delegates[a]=function(){r._removeDelegatedListener(e,i,n),t(...arguments)}}this._saveDelegatedListener(e,o);for(const a in o.delegates)this.once(a,o.delegates[a]);return this}off(e,t,n){return void 0===n?super.off(e,t):(this._removeDelegatedListener(e,"string"==typeof t?[t]:t,n),this)}queryRenderedFeatures(e,n){if(!this.style)return[];let r;const i=e instanceof t.P||Array.isArray(e),o=i?e:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(i?{}:e)||{},o instanceof t.P||"number"==typeof o[0])r=[t.P.convert(o)];else{const e=t.P.convert(o[0]),n=t.P.convert(o[1]);r=[e,new t.P(n.x,e.y),n,new t.P(e.x,n.y),e]}return this.style.queryRenderedFeatures(r,n,this.transform)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(e,n){return!1!==(n=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))}setTransformRequest(e){return this._requestManager.setTransformRequest(e),this}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(e,t){var n,r;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(e,t));const i=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!e)),e?(this.style=new An(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,t,i):this.style.loadJSON(e,t,i),this):(null===(r=null===(n=this.style)||void 0===n?void 0:n.projection)||void 0===r||r.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new An(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,n){if("string"==typeof e){const r=this._requestManager.transformRequest(e,"Style");t.j(r,new AbortController).then(e=>{this._updateDiff(e.data,n)}).catch(e=>{e&&this.fire(new t.k(e))})}else"object"==typeof e&&this._updateDiff(e,n)}_updateDiff(e,n){try{this.style.setState(e,n)&&this._update(!0)}catch(r){t.w("Unable to perform style diff: ".concat(r.message||r.error||r,".  Rebuilding the style from scratch.")),this._updateStyle(e,n)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){const n=this.style&&this.style.tileManagers[e];if(void 0!==n)return n.loaded();this.fire(new t.k(new Error("There is no tile manager with ID '".concat(e,"'"))))}setTerrain(e){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),e){const n=this.style.tileManagers[e.source];if(!n)throw new Error("cannot load terrain, because there exists no source with ID: ".concat(e.source));null===this.terrain&&n.reload();for(const r in this.style._layers){const n=this.style._layers[r];"hillshade"===n.type&&n.source===e.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),"color-relief"===n.type&&n.source===e.source&&t.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Jo(this.painter,n,e),this.painter.renderToTexture=new ea(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=t=>{var n;"style"===t.dataType?this.terrain.tileManager.freeRtt():"source"===t.dataType&&t.tile&&(t.sourceId!==e.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(n=t.source)||void 0===n?void 0:n.type)?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(t.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new t.l("terrain",{terrain:e})),this}getTerrain(){var e,t;return null!==(t=null===(e=this.terrain)||void 0===e?void 0:e.options)&&void 0!==t?t:null}areTilesLoaded(){const e=this.style&&this.style.tileManagers;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}removeSource(e){return this.style.removeSource(e),this._update(!0)}getSource(e){return this.style.getSource(e)}setSourceTileLodParams(e,t,n){if(n){const r=this.getSource(n);if(!r)throw new Error('There is no source with ID "'.concat(n,'", cannot set LOD parameters'));r.calculateTileZoom=we(Math.max(1,e),Math.max(1,t))}else for(const r in this.style.tileManagers)this.style.tileManagers[r].getSource().calculateTileZoom=we(Math.max(1,e),Math.max(1,t));return this._update(!0),this}refreshTiles(e,n){const r=this.style.tileManagers[e];if(!r)throw new Error('There is no tile manager with ID "'.concat(e,'", cannot refresh tile'));void 0===n?r.reload(!0):r.refreshTiles(n.map(e=>new t.a8(e.z,e.x,e.y)))}addImage(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{pixelRatio:i=1,sdf:o=!1,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=r;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||t.b(n))){if(void 0===n.width||void 0===n.height)return this.fire(new t.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:r,height:s,data:d}=n,p=n;return this.style.addImage(e,{data:new t.R({width:r,height:s},new Uint8Array(d)),pixelRatio:i,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e),this}}{const{width:r,height:d,data:p}=s.getImageData(n);this.style.addImage(e,{data:new t.R({width:r,height:d},p),pixelRatio:i,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0})}}updateImage(e,n){const r=this.style.getImage(e);if(!r)return this.fire(new t.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=n instanceof HTMLImageElement||t.b(n)?s.getImageData(n):n,{width:o,height:a,data:l}=i;if(void 0===o||void 0===a)return this.fire(new t.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==r.data.width||a!==r.data.height)return this.fire(new t.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(n instanceof HTMLImageElement||t.b(n));return r.data.replace(l,c),this.style.updateImage(e,r),this}getImage(e){return this.style.getImage(e)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.k(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e){return _.getImage(this._requestManager.transformRequest(e,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)}setFilter(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.style.setFilter(e,t,n),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setPaintProperty(e,t,n,r),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setLayoutProperty(e,t,n,r),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setGlyphs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(e,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(e,t,n,e=>{e||this._update(!0)}),this}removeSprite(e){return this._lazyInitEmptyStyle(),this.style.removeSprite(e),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(e,t,e=>{e||this._update(!0)}),this}setLight(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSky(e,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_setupContainer(){const e=this._container;e.classList.add("maplibregl-map");const t=this._canvasContainer=u.create("div","maplibregl-canvas-container",e);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=u.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),r=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],r);const i=this._controlContainer=u.create("div","maplibregl-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(e=>{o[e]=u.create("div","maplibregl-ctrl-".concat(e," "),i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t,n){this._canvas.width=Math.floor(n*e),this._canvas.height=Math.floor(n*t),this._canvas.style.width="".concat(e,"px"),this._canvas.style.height="".concat(t,"px")}_setupPainter(){const e=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",n=>{t={requestedAttributes:e},n&&(t.statusMessage=n.statusMessage,t.type=n.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,e):this._canvas.getContext("webgl2",e)||this._canvas.getContext("webgl",e),!n){const e="Failed to initialize WebGL";throw t?(t.message=e,new Error(JSON.stringify(t))):new Error(e)}this.painter=new Ni(n,this.transform),h.testSupport(n)}migrateProjection(e,n){super.migrateProjection(e,n),this.painter.transform=e,this.fire(new t.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(e){var n,r,i,o,a;const s=this._idleTriggered?this._fadeDuration:0,l=(null===(n=this.style.projection)||void 0===n?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,n=c();this.style.zoomHistory.update(e,n);const r=new t.G(e,{now:n,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),i=r.crossFadingFactor();1===i&&i===this._crossFadingFactor||(u=!0,this._crossFadingFactor=i),this.style.update(r)}const h=(null===(r=this.style.projection)||void 0===r?void 0:r.transitionState)>0!==l;null===(i=this.style.projection)||void 0===i||i.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(o=this.style.projection)||void 0===o?void 0:o.transitionState,null===(a=this.style.projection)||void 0===a?void 0:a.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||h)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,s,this._crossSourceCollisions,h),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new t.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.cA.mark(t.cB.load),this.fire(new t.l("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.l("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,t.cA.mark(t.cB.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var e;this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),_.removeThrottleControl(this._imageQueueHandle),null===(e=this._resizeObserver)||void 0===e||e.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==n?void 0:n.loseContext)&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),u.remove(this._canvasContainer),u.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),t.cA.clearMetrics(),this._removed=!0,this.fire(new t.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,s.frame(this._frameRequest,e=>{t.cA.frame(e),this._frameRequest=null;try{this._render(e)}catch(e){if(!t.cC(e)&&!function(e){return e.message===ei}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get version(){return na}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(e){return this._lazyInitEmptyStyle(),this.style.setProjection(e),this._update(!0)}},e.MapMouseEvent=Qi,e.MapTouchEvent=$i,e.MapWheelEvent=eo,e.Marker=ua,e.NavigationControl=class{constructor(e){this._updateZoomButtons=()=>{const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?"scale(".concat(1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5),") rotateZ(").concat(-this._map.transform.roll,"deg) rotateX(").concat(this._map.transform.pitch,"deg) rotateZ(").concat(-this._map.transform.bearing,"deg)"):this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5),") rotateX(").concat(this._map.transform.pitch,"deg) rotateZ(").concat(-this._map.transform.bearing,"deg)"):this.options.visualizeRoll?"rotate(".concat(-this._map.transform.bearing-this._map.transform.roll,"deg)"):"rotate(".concat(-this._map.transform.bearing,"deg)")},this._setButtonTitle=(e,t)=>{const n=this._map._getUIString("NavigationControl.".concat(t));e.title=n,e.setAttribute("aria-label",n)},this.options=t.e({},ia,e),this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),u.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),u.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=u.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new oa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){u.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const n=u.create("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}},e.Popup=class extends t.E{constructor(e){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?"".concat(this.options.locationOccludedOpacity):"")},this.remove=()=>(this._content&&u.remove(this._content),this._container&&(u.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new t.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=u.create("div","maplibregl-popup",this._map.getContainer()),this._tip=u.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const e of this.options.className.split(" "))this._container.classList.add(e);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=sa(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const t=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let n=this.options.anchor;const r=va(this.options.offset);if(!n){const e=this._container.offsetWidth,i=this._container.offsetHeight;let o;o=t.y+r.bottom.y<i?["top"]:t.y>this._map.transform.height-i?["bottom"]:[],t.x<e/2?o.push("left"):t.x>this._map.transform.width-e/2&&o.push("right"),n=0===o.length?"bottom":o.join("-")}let i=t.add(r[n]);this.options.subpixelPositioning||(i=i.round()),u.setTransform(this._container,"".concat(la[n]," translate(").concat(i.x,"px,").concat(i.y,"px)")),ca(this._container,n,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(_a),e)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.U.convert(e),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),n=document.createElement("body");let r;for(n.innerHTML=e;r=n.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){var e;return null===(e=this._container)||void 0===e?void 0:e.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=u.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._container&&this._container.classList.add(e),this}removeClassName(e){return this._container&&this._container.classList.remove(e),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}setSubpixelPositioning(e){this.options.subpixelPositioning=e}_createCloseButton(){this.options.closeButton&&(this._closeButton=u.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(ya);e&&e.focus()}},e.RasterDEMTileSource=J,e.RasterTileSource=Y,e.ScaleControl=class{constructor(e){this._onMove=()=>{ma(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,ma(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},fa),e)}getDefaultPosition(){return"bottom-left"}onAdd(e){return this._map=e,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){u.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},e.ScrollZoomHandler=Ro,e.Style=An,e.TerrainControl=class{constructor(e){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=e}onAdd(e){return this._map=e,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=u.create("button","maplibregl-ctrl-terrain",this._container),u.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){u.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},e.TwoFingersTouchPitchHandler=ko,e.TwoFingersTouchRotateHandler=To,e.TwoFingersTouchZoomHandler=wo,e.TwoFingersTouchZoomRotateHandler=Fo,e.VectorTileSource=K,e.VideoSource=ne,e.addSourceType=(e,n)=>t._(void 0,void 0,void 0,function*(){if(oe(e))throw new Error('A source type called "'.concat(e,'" already exists.'));((e,t)=>{ie[e]=t})(e,n)}),e.clearPrewarmedResources=function(){const e=O;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(z),O=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.createTileMesh=nn,e.getMaxParallelImageRequests=function(){return t.a.MAX_PARALLEL_IMAGE_REQUESTS},e.getRTLTextPluginStatus=function(){return ce().getRTLTextPluginStatus()},e.getVersion=function(){return ba},e.getWorkerCount=function(){return L.workerCount},e.getWorkerUrl=function(){return t.a.WORKER_URL},e.importScriptInWorkers=function(e){return U().broadcast("IS",e)},e.isTimeFrozen=function(){return l.isFrozen()},e.now=c,e.prewarm=function(){B().acquire(z)},e.restoreNow=function(){l.restoreNow()},e.setMaxParallelImageRequests=function(e){t.a.MAX_PARALLEL_IMAGE_REQUESTS=e},e.setNow=function(e){l.setNow(e)},e.setRTLTextPlugin=function(e,t){return ce().setRTLTextPlugin(e,t)},e.setWorkerCount=function(e){L.workerCount=e},e.setWorkerUrl=function(e){t.a.WORKER_URL=e}}),e}()},210:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(326),i=r.__importDefault(n(829)),o=r.__importDefault(n(736));class a{constructor(e){let{headers:t={},schema:n,fetch:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=r}from(e){const t=new URL("".concat(this.url,"/").concat(e));return new i.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new a(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:n=!1,get:r=!1,count:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var a;let s;const l=new URL("".concat(this.url,"/rpc/").concat(e));let c;n||r?(s=n?"HEAD":"GET",Object.entries(t).filter(e=>{let[t,n]=e;return void 0!==n}).map(e=>{let[t,n]=e;return[t,Array.isArray(n)?"{".concat(n.join(","),"}"):"".concat(n)]}).forEach(e=>{let[t,n]=e;l.searchParams.append(t,n)})):(s="POST",c=t);const u=new Headers(this.headers);return i&&u.set("Prefer","count=".concat(i)),new o.default({method:s,url:l,headers:u,schema:this.schemaName,body:c,fetch:null!==(a=this.fetch)&&void 0!==a?a:fetch})}}t.default=a},286:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(326).__importDefault(n(611));t.default=class{constructor(e){var t,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(n=e.isMaybeSingle)&&void 0!==n&&n,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,n,i,o;let a=null,s=null,l=null,c=e.status,u=e.statusText;if(e.ok){if("HEAD"!==this.method){const n=await e.text();""===n||(s="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?n:JSON.parse(n))}const r=null===(n=this.headers.get("Prefer"))||void 0===n?void 0:n.match(/count=(exact|planned|estimated)/),o=null===(i=e.headers.get("content-range"))||void 0===i?void 0:i.split("/");r&&o&&o.length>1&&(l=parseInt(o[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(s)&&(s.length>1?(a={code:"PGRST116",details:"Results contain ".concat(s.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},s=null,l=null,c=406,u="Not Acceptable"):s=1===s.length?s[0]:null)}else{const t=await e.text();try{a=JSON.parse(t),Array.isArray(a)&&404===e.status&&(s=[],a=null,c=200,u="OK")}catch(h){404===e.status&&""===t?(c=204,u="No Content"):a={message:t}}if(a&&this.isMaybeSingle&&(null===(o=null===a||void 0===a?void 0:a.details)||void 0===o?void 0:o.includes("0 rows"))&&(a=null,c=200,u="OK"),a&&this.shouldThrowOnError)throw new r.default(a)}return{error:a,data:s,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(n=n.catch(e=>{var t,n,r;return{error:{message:"".concat(null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),details:"".concat(null!==(n=null===e||void 0===e?void 0:e.stack)&&void 0!==n?n:""),hint:"",code:"".concat(null!==(r=null===e||void 0===e?void 0:e.code)&&void 0!==r?r:"")},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}}},288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),f=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,_={};function y(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||m}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||m}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var x=b.prototype=new v;x.constructor=b,g(x,y.prototype),x.isPureReactComponent=!0;var w=Array.isArray;function S(){}var T={H:null,A:null,T:null,S:null},E=Object.prototype.hasOwnProperty;function k(e,t,r){var i=r.ref;return{$$typeof:n,type:e,key:t,ref:void 0!==i?i:null,props:r}}function P(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function A(e,t,i,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(s){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0;break;case d:return A((u=e._init)(e._payload),t,i,o,a)}}if(u)return a=a(e),u=""===o?"."+I(e,0):o,w(a)?(i="",null!=u&&(i=u.replace(C,"$&/")+"/"),A(a,t,i,"",function(e){return e})):null!=a&&(P(a)&&(l=a,c=i+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+u,a=k(l.type,c,l.props)),t.push(a)),1;u=0;var h,p=""===o?".":o+":";if(w(e))for(var m=0;m<e.length;m++)u+=A(o=e[m],t,i,s=p+I(o,m),a);else if("function"===typeof(m=null===(h=e)||"object"!==typeof h?null:"function"===typeof(h=f&&h[f]||h["@@iterator"])?h:null))for(e=m.call(e),m=0;!(o=e.next()).done;)u+=A(o=o.value,t,i,s=p+I(o,m++),a);else if("object"===s){if("function"===typeof e.then)return A(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(S,S):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,i,o,a);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function M(e,t,n){if(null==e)return e;var r=[],i=0;return A(e,r,"","",function(e){return t.call(n,e,i++)}),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},z={map:M,forEach:function(e,t,n){M(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return M(e,function(){t++}),t},toArray:function(e){return M(e,function(e){return e})||[]},only:function(e){if(!P(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};t.Activity=p,t.Children=z,t.Component=y,t.Fragment=i,t.Profiler=a,t.PureComponent=b,t.StrictMode=o,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return T.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cacheSignal=function(){return null},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=g({},e.props),i=e.key;if(null!=t)for(o in void 0!==t.key&&(i=""+t.key),t)!E.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(r[o]=t[o]);var o=arguments.length-2;if(1===o)r.children=n;else if(1<o){for(var a=Array(o),s=0;s<o;s++)a[s]=arguments[s+2];r.children=a}return k(e.type,i,r)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,n){var r,i={},o=null;if(null!=t)for(r in void 0!==t.key&&(o=""+t.key),t)E.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var a=arguments.length-2;if(1===a)i.children=n;else if(1<a){for(var s=Array(a),l=0;l<a;l++)s[l]=arguments[l+2];i.children=s}if(e&&e.defaultProps)for(r in a=e.defaultProps)void 0===i[r]&&(i[r]=a[r]);return k(e,o,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=P,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=T.T,n={};T.T=n;try{var r=e(),i=T.S;null!==i&&i(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(S,D)}catch(o){D(o)}finally{null!==t&&null!==n.types&&(t.types=n.types),T.T=t}},t.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},t.use=function(e){return T.H.use(e)},t.useActionState=function(e,t,n){return T.H.useActionState(e,t,n)},t.useCallback=function(e,t){return T.H.useCallback(e,t)},t.useContext=function(e){return T.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return T.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return T.H.useEffect(e,t)},t.useEffectEvent=function(e){return T.H.useEffectEvent(e)},t.useId=function(){return T.H.useId()},t.useImperativeHandle=function(e,t,n){return T.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return T.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return T.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return T.H.useMemo(e,t)},t.useOptimistic=function(e,t){return T.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return T.H.useReducer(e,t,n)},t.useRef=function(e){return T.H.useRef(e)},t.useState=function(e){return T.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return T.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return T.H.useTransition()},t.version="19.2.0"},326:(e,t,n)=>{"use strict";n.r(t),n.d(t,{__addDisposableResource:()=>L,__assign:()=>o,__asyncDelegator:()=>E,__asyncGenerator:()=>T,__asyncValues:()=>k,__await:()=>S,__awaiter:()=>f,__classPrivateFieldGet:()=>R,__classPrivateFieldIn:()=>z,__classPrivateFieldSet:()=>D,__createBinding:()=>g,__decorate:()=>s,__disposeResources:()=>O,__esDecorate:()=>c,__exportStar:()=>_,__extends:()=>i,__generator:()=>m,__importDefault:()=>M,__importStar:()=>A,__makeTemplateObject:()=>P,__metadata:()=>p,__param:()=>l,__propKey:()=>h,__read:()=>v,__rest:()=>a,__rewriteRelativeImportExtension:()=>F,__runInitializers:()=>u,__setFunctionName:()=>d,__spread:()=>b,__spreadArray:()=>w,__spreadArrays:()=>x,__values:()=>y,default:()=>B});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function s(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function l(e,t){return function(n,r){t(n,r,e)}}function c(e,t,n,r,i,o){function a(e){if(void 0!==e&&"function"!==typeof e)throw new TypeError("Function expected");return e}for(var s,l=r.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?r.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in r)f[m]="access"===m?{}:r[m];for(var m in r.access)f.access[m]=r.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!==typeof g)throw new TypeError("Object expected");(s=a(g.get))&&(h.get=s),(s=a(g.set))&&(h.set=s),(s=a(g.init))&&i.unshift(s)}else(s=a(g))&&("field"===l?i.unshift(s):h[c]=s)}u&&Object.defineProperty(u,r.name,h),d=!0}function u(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0}function h(e){return"symbol"===typeof e?e:"".concat(e)}function d(e,t,n){return"symbol"===typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function p(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((r=r.apply(e,t||[])).next())})}function m(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"===typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(l){s=[6,l],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}var g=Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function _(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||g(t,e,n)}function y(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function b(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(v(arguments[t]));return e}function x(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function w(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function S(e){return this instanceof S?(this.v=e,this):new S(e)}function T(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"===typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||s(e,t)})},t&&(r[e]=t(r[e])))}function s(e,t){try{(n=i[e](t)).value instanceof S?Promise.resolve(n.value.v).then(l,c):u(o[0][2],n)}catch(r){u(o[0][3],r)}var n}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function E(e){var t,n;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:S(e[r](t)),done:!1}:i?i(t):t}:i}}function k(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=y(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){(function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)})(r,i,(t=e[n](t)).done,t.value)})}}}function P(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var C=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},I=function(e){return I=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},I(e)};function A(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=I(e),r=0;r<n.length;r++)"default"!==n[r]&&g(t,e,n[r]);return C(t,e),t}function M(e){return e&&e.__esModule?e:{default:e}}function R(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function D(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}function z(e,t){if(null===t||"object"!==typeof t&&"function"!==typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"===typeof e?t===e:e.has(t)}function L(e,t,n){if(null!==t&&void 0!==t){if("object"!==typeof t&&"function"!==typeof t)throw new TypeError("Object expected.");var r,i;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],n&&(i=r)}if("function"!==typeof r)throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t}var j="function"===typeof SuppressedError?SuppressedError:function(e,t,n){var r=new Error(n);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function O(e){function t(t){e.error=e.hasError?new j(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var n,r=0;return function i(){for(;n=e.stack.pop();)try{if(!n.async&&1===r)return r=0,e.stack.push(n),Promise.resolve().then(i);if(n.dispose){var o=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(o).then(i,function(e){return t(e),i()})}else r|=1}catch(a){t(a)}if(1===r)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function F(e,t){return"string"===typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,n,r,i,o){return n?t?".jsx":".js":!r||i&&o?r+i+"."+o.toLowerCase()+"js":e}):e}const B={__extends:i,__assign:o,__rest:a,__decorate:s,__param:l,__esDecorate:c,__runInitializers:u,__propKey:h,__setFunctionName:d,__metadata:p,__awaiter:f,__generator:m,__createBinding:g,__exportStar:_,__values:y,__read:v,__spread:b,__spreadArrays:x,__spreadArray:w,__await:S,__asyncGenerator:T,__asyncDelegator:E,__asyncValues:k,__makeTemplateObject:P,__importStar:A,__importDefault:M,__classPrivateFieldGet:R,__classPrivateFieldSet:D,__classPrivateFieldIn:z,__addDisposableResource:L,__disposeResources:O,__rewriteRelativeImportExtension:F}},355:(e,t,n)=>{var r=n(738).default,i=n(45);e.exports=function(e){var t=i(e,"string");return"symbol"==r(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},374:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(326).__importDefault(n(286));class i extends r.default{select(e){let t=!1;const n=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e){let{ascending:t=!0,nullsFirst:n,foreignTable:r,referencedTable:i=r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=i?"".concat(i,".order"):"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,"".concat(a?"".concat(a,","):"").concat(e,".").concat(t?"asc":"desc").concat(void 0===n?"":n?".nullsfirst":".nullslast")),this}limit(e){let{foreignTable:t,referencedTable:n=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="undefined"===typeof n?"limit":"".concat(n,".limit");return this.url.searchParams.set(r,"".concat(e)),this}range(e,t){let{foreignTable:n,referencedTable:r=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i="undefined"===typeof r?"offset":"".concat(r,".offset"),o="undefined"===typeof r?"limit":"".concat(r,".limit");return this.url.searchParams.set(i,"".concat(e)),this.url.searchParams.set(o,"".concat(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain(){let{analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:r=!1,wal:i=!1,format:o="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var a;const s=[e?"analyze":null,t?"verbose":null,n?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=null!==(a=this.headers.get("Accept"))&&void 0!==a?a:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(o,'; for="').concat(l,'"; options=').concat(s,";")),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(e)),this}}t.default=i},391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},579:(e,t,n)=>{"use strict";e.exports=n(799)},611:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=n},672:(e,t,n)=>{"use strict";var r=n(43);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var a={d:{f:o,r:function(){throw Error(i(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},s=Symbol.for("react.portal");var l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:s,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=a.p;try{if(l.T=null,a.p=2,e)return e()}finally{l.T=t,a.p=n,a.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,a.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&a.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin),i="string"===typeof t.integrity?t.integrity:void 0,o="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?a.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:o}):"script"===n&&a.d.X(e,{crossOrigin:r,integrity:i,fetchPriority:o,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);a.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&a.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin);a.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);a.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else a.d.m(e)},t.requestFormReset=function(e){a.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.2.0"},693:(e,t,n)=>{var r=n(355);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},736:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(326).__importDefault(n(374)),i=new RegExp("[,()]");class o extends r.default{eq(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}neq(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}gt(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}gte(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}lt(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}lte(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}like(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}likeAllOf(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}likeAnyOf(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}ilike(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}is(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}in(e,t){const n=Array.from(new Set(t)).map(e=>"string"===typeof e&&i.test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"in.(".concat(n,")")),this}contains(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}containedBy(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}rangeGt(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}rangeGte(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}rangeLt(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}rangeLte(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}overlaps(e,t){return"string"===typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}textSearch(e,t){let{config:n,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="";"plain"===r?i="pl":"phrase"===r?i="ph":"websearch"===r&&(i="w");const o=void 0===n?"":"(".concat(n,")");return this.url.searchParams.append(e,"".concat(i,"fts").concat(o,".").concat(t)),this}match(e){return Object.entries(e).forEach(e=>{let[t,n]=e;this.url.searchParams.append(t,"eq.".concat(n))}),this}not(e,t,n){return this.url.searchParams.append(e,"not.".concat(t,".").concat(n)),this}or(e){let{foreignTable:t,referencedTable:n=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=n?"".concat(n,".or"):"or";return this.url.searchParams.append(r,"(".concat(e,")")),this}filter(e,t,n){return this.url.searchParams.append(e,"".concat(t,".").concat(n)),this}}t.default=o},738:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function i(e,t,r){var i=null;if(void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),"key"in t)for(var o in r={},t)"key"!==o&&(r[o]=t[o]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:i,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=i,t.jsxs=i},829:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(326).__importDefault(n(736));t.default=class{constructor(e,t){let{headers:n={},schema:r,fetch:i}=t;this.url=e,this.headers=new Headers(n),this.schema=r,this.fetch=i}select(e,t){const{head:n=!1,count:i}=null!==t&&void 0!==t?t:{},o=n?"HEAD":"GET";let a=!1;const s=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join("");return this.url.searchParams.set("select",s),i&&this.headers.append("Prefer","count=".concat(i)),new r.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e){let{count:t,defaultToNull:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;if(t&&this.headers.append("Prefer","count=".concat(t)),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new r.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}upsert(e){let{onConflict:t,ignoreDuplicates:n=!1,count:i,defaultToNull:o=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var a;if(this.headers.append("Prefer","resolution=".concat(n?"ignore":"merge","-duplicates")),void 0!==t&&this.url.searchParams.set("on_conflict",t),i&&this.headers.append("Prefer","count=".concat(i)),o||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new r.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(a=this.fetch)&&void 0!==a?a:fetch})}update(e){let{count:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return t&&this.headers.append("Prefer","count=".concat(t)),new r.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}delete(){let{count:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return e&&this.headers.append("Prefer","count=".concat(e)),new r.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}}},853:(e,t,n)=>{"use strict";e.exports=n(896)},896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>o(l,n))c<i&&0>o(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<i&&0>o(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,_=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function w(e){if(g=!1,x(e),!m)if(null!==r(c))m=!0,T||(T=!0,S());else{var t=r(u);null!==t&&R(w,t.startTime-e)}}var S,T=!1,E=-1,k=5,P=-1;function C(){return!!_||!(t.unstable_now()-P<k)}function I(){if(_=!1,T){var e=t.unstable_now();P=e;var n=!0;try{e:{m=!1,g&&(g=!1,v(E),E=-1),f=!0;var o=p;try{t:{for(x(e),d=r(c);null!==d&&!(d.expirationTime>e&&C());){var a=d.callback;if("function"===typeof a){d.callback=null,p=d.priorityLevel;var s=a(d.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof s){d.callback=s,x(e),n=!0;break t}d===r(c)&&i(c),x(e)}else i(c);d=r(c)}if(null!==d)n=!0;else{var l=r(u);null!==l&&R(w,l.startTime-e),n=!1}}break e}finally{d=null,p=o,f=!1}n=void 0}}finally{n?S():T=!1}}}if("function"===typeof b)S=function(){b(I)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,M=A.port2;A.port1.onmessage=I,S=function(){M.postMessage(null)}}else S=function(){y(I,0)};function R(e,n){E=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_requestPaint=function(){_=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(u,e),null===r(c)&&e===r(u)&&(g?(v(E),E=-1):g=!0,R(w,o-a))):(e.sortIndex=s,n(c,e),m||f||(m=!0,T||(T=!0,S()))),e},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)},980:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;const r=n(326),i=r.__importDefault(n(210));t.PostgrestClient=i.default;const o=r.__importDefault(n(829));t.PostgrestQueryBuilder=o.default;const a=r.__importDefault(n(736));t.PostgrestFilterBuilder=a.default;const s=r.__importDefault(n(374));t.PostgrestTransformBuilder=s.default;const l=r.__importDefault(n(286));t.PostgrestBuilder=l.default;const c=r.__importDefault(n(611));t.PostgrestError=c.default,t.default={PostgrestClient:i.default,PostgrestQueryBuilder:o.default,PostgrestFilterBuilder:a.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:l.default,PostgrestError:c.default}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var o=Object.create(null);n.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&r;("object"==typeof s||"function"==typeof s)&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>a[e]=()=>r[e]);return a.default=()=>r,n.d(o,a),o}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+"."+{159:"32eca207",453:"eb570f4f"}[e]+".chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="client:";n.l=(r,i,o,a)=>{if(e[r])e[r].push(i);else{var s,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==t+o){s=h;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+o),s.src=r),e[r]=[i];var d=(t,n)=>{s.onerror=s.onload=null,clearTimeout(p);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach(e=>e(n)),t)return t(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),l&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/swallow-skyer/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise((n,r)=>i=e[t]=[n,r]);r.push(i[2]=o);var a=n.p+n.u(t),s=new Error;n.l(a,r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,i[1](s)}},"chunk-"+t,t)}};var t=(t,r)=>{var i,o,[a,s,l]=r,c=0;if(a.some(t=>0!==e[t])){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(l)l(n)}for(t&&t(r);c<a.length;c++)o=a[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunkclient=self.webpackChunkclient||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e,t=n(43),r=n.t(t,2),i=n(391),o=n(950),a=n.t(o,2);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const l="popstate";function c(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function u(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function h(e,t){return{usr:e.state,key:e.key,idx:t}}function d(e,t,n,r){return void 0===n&&(n=null),s({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?f(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function p(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function f(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function m(t,n,r,i){void 0===i&&(i={});let{window:o=document.defaultView,v5Compat:a=!1}=i,u=o.history,f=e.Pop,m=null,g=_();function _(){return(u.state||{idx:null}).idx}function y(){f=e.Pop;let t=_(),n=null==t?null:t-g;g=t,m&&m({action:f,location:b.location,delta:n})}function v(e){let t="null"!==o.location.origin?o.location.origin:o.location.href,n="string"===typeof e?e:p(e);return n=n.replace(/ $/,"%20"),c(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,u.replaceState(s({},u.state,{idx:g}),""));let b={get action(){return f},get location(){return t(o,u)},listen(e){if(m)throw new Error("A history only accepts one active listener");return o.addEventListener(l,y),m=e,()=>{o.removeEventListener(l,y),m=null}},createHref:e=>n(o,e),createURL:v,encodeLocation(e){let t=v(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){f=e.Push;let i=d(b.location,t,n);r&&r(i,t),g=_()+1;let s=h(i,g),l=b.createHref(i);try{u.pushState(s,"",l)}catch(c){if(c instanceof DOMException&&"DataCloneError"===c.name)throw c;o.location.assign(l)}a&&m&&m({action:f,location:b.location,delta:1})},replace:function(t,n){f=e.Replace;let i=d(b.location,t,n);r&&r(i,t),g=_();let o=h(i,g),s=b.createHref(i);u.replaceState(o,"",s),a&&m&&m({action:f,location:b.location,delta:0})},go:e=>u.go(e)};return b}var g;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(g||(g={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function _(e,t,n){return void 0===n&&(n="/"),y(e,t,n,!1)}function y(e,t,n,r){let i=R(("string"===typeof t?f(t):t).pathname||"/",n);if(null==i)return null;let o=v(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(o);let a=null;for(let s=0;null==a&&s<o.length;++s){let e=M(i);a=I(o[s],e,r)}return a}function v(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,o)=>{let a={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(c(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let s=N([r,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(c(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),v(e.children,t,l,s)),(null!=e.path||e.index)&&t.push({path:s,score:C(s,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of b(e.path))i(e,t,r);else i(e,t)}),t}function b(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===r.length)return i?[o,""]:[o];let a=b(r.join("/")),s=[];return s.push(...a.map(e=>""===e?o:[o,e].join("/"))),i&&s.push(...a),s.map(t=>e.startsWith("/")&&""===t?"/":t)}const x=/^:[\w-]+$/,w=3,S=2,T=1,E=10,k=-2,P=e=>"*"===e;function C(e,t){let n=e.split("/"),r=n.length;return n.some(P)&&(r+=k),t&&(r+=S),n.filter(e=>!P(e)).reduce((e,t)=>e+(x.test(t)?w:""===t?T:E),r)}function I(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,i={},o="/",a=[];for(let s=0;s<r.length;++s){let e=r[s],l=s===r.length-1,c="/"===o?t:t.slice(o.length)||"/",u=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),h=e.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),a.push({params:i,pathname:N([o,u.pathname]),pathnameBase:U(N([o,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(o=N([o,u.pathnameBase]))}return a}function A(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);u("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let o=new RegExp(i,t?void 0:"i");return[o,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],a=o.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=s[n]||"";a=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const l=s[n];return e[r]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:o,pathnameBase:a,pattern:e}}function M(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return u(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function R(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}const D=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function z(e,t){void 0===t&&(t="/");let n,{pathname:r,search:i="",hash:o=""}="string"===typeof e?f(e):e;if(r)if(a=r,D.test(a))n=r;else{if(r.includes("//")){let e=r;r=r.replace(/\/\/+/g,"/"),u(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+r)}n=r.startsWith("/")?L(r.substring(1),"/"):L(r,t)}else n=t;var a;return{pathname:n,search:V(i),hash:G(o)}}function L(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function j(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function O(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function F(e,t){let n=O(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function B(e,t,n,r){let i;void 0===r&&(r=!1),"string"===typeof e?i=f(e):(i=s({},e),c(!i.pathname||!i.pathname.includes("?"),j("?","pathname","search",i)),c(!i.pathname||!i.pathname.includes("#"),j("#","pathname","hash",i)),c(!i.search||!i.search.includes("#"),j("#","search","hash",i)));let o,a=""===e||""===i.pathname,l=a?"/":i.pathname;if(null==l)o=n;else{let e=t.length-1;if(!r&&l.startsWith("..")){let t=l.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}o=e>=0?t[e]:"/"}let u=z(i,o),h=l&&"/"!==l&&l.endsWith("/"),d=(a||"."===l)&&n.endsWith("/");return u.pathname.endsWith("/")||!h&&!d||(u.pathname+="/"),u}const N=e=>e.join("/").replace(/\/\/+/g,"/"),U=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),V=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",G=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function q(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const Z=["post","put","patch","delete"],W=(new Set(Z),["get",...Z]);new Set(W),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},H.apply(this,arguments)}const X=t.createContext(null);const K=t.createContext(null);const Y=t.createContext(null);const J=t.createContext(null);const Q=t.createContext({outlet:null,matches:[],isDataRoute:!1});const $=t.createContext(null);function ee(){return null!=t.useContext(J)}function te(){return ee()||c(!1),t.useContext(J).location}function ne(e){t.useContext(Y).static||t.useLayoutEffect(e)}function re(){let{isDataRoute:e}=t.useContext(Q);return e?function(){let{router:e}=fe(de.UseNavigateStable),n=ge(pe.UseNavigateStable),r=t.useRef(!1);return ne(()=>{r.current=!0}),t.useCallback(function(t,i){void 0===i&&(i={}),r.current&&("number"===typeof t?e.navigate(t):e.navigate(t,H({fromRouteId:n},i)))},[e,n])}():function(){ee()||c(!1);let e=t.useContext(X),{basename:n,future:r,navigator:i}=t.useContext(Y),{matches:o}=t.useContext(Q),{pathname:a}=te(),s=JSON.stringify(F(o,r.v7_relativeSplatPath)),l=t.useRef(!1);return ne(()=>{l.current=!0}),t.useCallback(function(t,r){if(void 0===r&&(r={}),!l.current)return;if("number"===typeof t)return void i.go(t);let o=B(t,JSON.parse(s),a,"path"===r.relative);null==e&&"/"!==n&&(o.pathname="/"===o.pathname?n:N([n,o.pathname])),(r.replace?i.replace:i.push)(o,r.state,r)},[n,i,s,a,e])}()}function ie(){let{matches:e}=t.useContext(Q),n=e[e.length-1];return n?n.params:{}}function oe(e,n){let{relative:r}=void 0===n?{}:n,{future:i}=t.useContext(Y),{matches:o}=t.useContext(Q),{pathname:a}=te(),s=JSON.stringify(F(o,i.v7_relativeSplatPath));return t.useMemo(()=>B(e,JSON.parse(s),a,"path"===r),[e,s,a,r])}function ae(n,r,i,o){ee()||c(!1);let{navigator:a}=t.useContext(Y),{matches:s}=t.useContext(Q),l=s[s.length-1],u=l?l.params:{},h=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let d,p=te();if(r){var m;let e="string"===typeof r?f(r):r;"/"===h||(null==(m=e.pathname)?void 0:m.startsWith(h))||c(!1),d=e}else d=p;let g=d.pathname||"/",y=g;if("/"!==h){let e=h.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=_(n,{pathname:y});let b=he(v&&v.map(e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:N([h,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?h:N([h,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),s,i,o);return r&&b?t.createElement(J.Provider,{value:{location:H({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:e.Pop}},b):b}function se(){let e=function(){var e;let n=t.useContext($),r=me(pe.UseRouteError),i=ge(pe.UseRouteError);if(void 0!==n)return n;return null==(e=r.errors)?void 0:e[i]}(),n=q(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:i};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:o},r):null,null)}const le=t.createElement(se,null);class ce extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(Q.Provider,{value:this.props.routeContext},t.createElement($.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ue(e){let{routeContext:n,match:r,children:i}=e,o=t.useContext(X);return o&&o.static&&o.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(Q.Provider,{value:n},i)}function he(e,n,r,i){var o;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),null==e){var a;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(a=i)&&a.v7_partialHydration&&0===n.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let s=e,l=null==(o=r)?void 0:o.errors;if(null!=l){let e=s.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||c(!1),s=s.slice(0,Math.min(s.length,e+1))}let u=!1,h=-1;if(r&&i&&i.v7_partialHydration)for(let t=0;t<s.length;t++){let e=s[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(h=t),e.route.id){let{loaderData:t,errors:n}=r,i=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||i){u=!0,s=h>=0?s.slice(0,h+1):[s[0]];break}}}return s.reduceRight((e,i,o)=>{let a,c=!1,d=null,p=null;var f;r&&(a=l&&i.route.id?l[i.route.id]:void 0,d=i.route.errorElement||le,u&&(h<0&&0===o?(f="route-fallback",!1||_e[f]||(_e[f]=!0),c=!0,p=null):h===o&&(c=!0,p=i.route.hydrateFallbackElement||null)));let m=n.concat(s.slice(0,o+1)),g=()=>{let n;return n=a?d:c?p:i.route.Component?t.createElement(i.route.Component,null):i.route.element?i.route.element:e,t.createElement(ue,{match:i,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:n})};return r&&(i.route.ErrorBoundary||i.route.errorElement||0===o)?t.createElement(ce,{location:r.location,revalidation:r.revalidation,component:d,error:a,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()},null)}var de=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(de||{}),pe=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(pe||{});function fe(e){let n=t.useContext(X);return n||c(!1),n}function me(e){let n=t.useContext(K);return n||c(!1),n}function ge(e){let n=function(){let e=t.useContext(Q);return e||c(!1),e}(),r=n.matches[n.matches.length-1];return r.route.id||c(!1),r.route.id}const _e={};function ye(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}r.startTransition;function ve(e){let{to:n,replace:r,state:i,relative:o}=e;ee()||c(!1);let{future:a,static:s}=t.useContext(Y),{matches:l}=t.useContext(Q),{pathname:u}=te(),h=re(),d=B(n,F(l,a.v7_relativeSplatPath),u,"path"===o),p=JSON.stringify(d);return t.useEffect(()=>h(JSON.parse(p),{replace:r,state:i,relative:o}),[h,p,o,r,i]),null}function be(e){c(!1)}function xe(n){let{basename:r="/",children:i=null,location:o,navigationType:a=e.Pop,navigator:s,static:l=!1,future:u}=n;ee()&&c(!1);let h=r.replace(/^\/*/,"/"),d=t.useMemo(()=>({basename:h,navigator:s,static:l,future:H({v7_relativeSplatPath:!1},u)}),[h,u,s,l]);"string"===typeof o&&(o=f(o));let{pathname:p="/",search:m="",hash:g="",state:_=null,key:y="default"}=o,v=t.useMemo(()=>{let e=R(p,h);return null==e?null:{location:{pathname:e,search:m,hash:g,state:_,key:y},navigationType:a}},[h,p,m,g,_,y,a]);return null==v?null:t.createElement(Y.Provider,{value:d},t.createElement(J.Provider,{children:i,value:v}))}function we(e){let{children:t,location:n}=e;return ae(Se(t),n)}new Promise(()=>{});t.Component;function Se(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,(e,i)=>{if(!t.isValidElement(e))return;let o=[...n,i];if(e.type===t.Fragment)return void r.push.apply(r,Se(e.props.children,o));e.type!==be&&c(!1),e.props.index&&e.props.children&&c(!1);let a={id:e.props.id||o.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=Se(e.props.children,o)),r.push(a)}),r}function Te(){return Te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Te.apply(this,arguments)}function Ee(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function ke(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(e=>[n,e]):[[n,r]])},[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Pe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(Ao){}new Map;const Ce=r.startTransition;a.flushSync,r.useId;function Ie(e){let{basename:n,children:r,future:i,window:o}=e,a=t.useRef();var s;null==a.current&&(a.current=(void 0===(s={window:o,v5Compat:!0})&&(s={}),m(function(e,t){let{pathname:n,search:r,hash:i}=e.location;return d("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:p(t)},null,s)));let l=a.current,[c,u]=t.useState({action:l.action,location:l.location}),{v7_startTransition:h}=i||{},f=t.useCallback(e=>{h&&Ce?Ce(()=>u(e)):u(e)},[u,h]);return t.useLayoutEffect(()=>l.listen(f),[l,f]),t.useEffect(()=>ye(i),[i]),t.createElement(xe,{basename:n,children:r,location:c.location,navigationType:c.action,navigator:l,future:i})}const Ae="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Me=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Re=t.forwardRef(function(e,n){let r,{onClick:i,relative:o,reloadDocument:a,replace:s,state:l,target:u,to:h,preventScrollReset:d,viewTransition:f}=e,m=Ee(e,Pe),{basename:g}=t.useContext(Y),_=!1;if("string"===typeof h&&Me.test(h)&&(r=h,Ae))try{let e=new URL(window.location.href),t=h.startsWith("//")?new URL(e.protocol+h):new URL(h),n=R(t.pathname,g);t.origin===e.origin&&null!=n?h=n+t.search+t.hash:_=!0}catch(Ao){}let y=function(e,n){let{relative:r}=void 0===n?{}:n;ee()||c(!1);let{basename:i,navigator:o}=t.useContext(Y),{hash:a,pathname:s,search:l}=oe(e,{relative:r}),u=s;return"/"!==i&&(u="/"===s?i:N([i,s])),o.createHref({pathname:u,search:l,hash:a})}(h,{relative:o}),v=function(e,n){let{target:r,replace:i,state:o,preventScrollReset:a,relative:s,viewTransition:l}=void 0===n?{}:n,c=re(),u=te(),h=oe(e,{relative:s});return t.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,r)){t.preventDefault();let n=void 0!==i?i:p(u)===p(h);c(e,{replace:n,state:o,preventScrollReset:a,relative:s,viewTransition:l})}},[u,c,h,i,o,r,e,a,s,l])}(h,{replace:s,state:l,target:u,preventScrollReset:d,relative:o,viewTransition:f});return t.createElement("a",Te({},m,{href:r||y,onClick:_||a?i:function(e){i&&i(e),e.defaultPrevented||v(e)},ref:n,target:u}))});var De,ze;function Le(e){let n=t.useRef(ke(e)),r=t.useRef(!1),i=te(),o=t.useMemo(()=>function(e,t){let n=ke(e);return t&&t.forEach((e,r)=>{n.has(r)||t.getAll(r).forEach(e=>{n.append(r,e)})}),n}(i.search,r.current?null:n.current),[i.search]),a=re(),s=t.useCallback((e,t)=>{const n=ke("function"===typeof e?e(o):e);r.current=!0,a("?"+n,t)},[a,o]);return[o,s]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(De||(De={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(ze||(ze={}));function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Oe(e){var t=function(e,t){if("object"!=je(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==je(t)?t:t+""}function Fe(e,t,n){return(t=Oe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach(function(t){Fe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Ue=n(326);class Ve extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",n=arguments.length>2?arguments[2]:void 0;super(e),this.name=t,this.context=n}}class Ge extends Ve{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class qe extends Ve{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ze extends Ve{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var We;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(We||(We={}));class He{constructor(e){let{headers:t={},customFetch:n,region:r=We.Any}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=t,this.region=r,this.fetch=(e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)})(n)}setAuth(e){this.headers.Authorization="Bearer ".concat(e)}invoke(e){return(0,Ue.__awaiter)(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){var r;let i,o;try{const{headers:a,method:s,body:l,signal:c,timeout:u}=n;let h={},{region:d}=n;d||(d=t.region);const p=new URL("".concat(t.url,"/").concat(e));let f;d&&"any"!==d&&(h["x-region"]=d,p.searchParams.set("forceFunctionRegion",d)),l&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?"undefined"!==typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",f=l):"string"===typeof l?(h["Content-Type"]="text/plain",f=l):"undefined"!==typeof FormData&&l instanceof FormData?f=l:(h["Content-Type"]="application/json",f=JSON.stringify(l)):f=l;let m=c;u&&(o=new AbortController,i=setTimeout(()=>o.abort(),u),c?(m=o.signal,c.addEventListener("abort",()=>o.abort())):m=o.signal);const g=yield t.fetch(p.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},h),t.headers),a),body:f,signal:m}).catch(e=>{throw new Ge(e)}),_=g.headers.get("x-relay-error");if(_&&"true"===_)throw new qe(g);if(!g.ok)throw new Ze(g);let y,v=(null!==(r=g.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return y="application/json"===v?yield g.json():"application/octet-stream"===v||"application/pdf"===v?yield g.blob():"text/event-stream"===v?g:"multipart/form-data"===v?yield g.formData():yield g.text(),{data:y,error:null,response:g}}catch(a){return{data:null,error:a,response:a instanceof Ze||a instanceof qe?a.context:void 0}}finally{i&&clearTimeout(i)}}()})}}var Xe=n(980),Ke=n.t(Xe,2);const{PostgrestClient:Ye,PostgrestQueryBuilder:Je,PostgrestFilterBuilder:Qe,PostgrestTransformBuilder:$e,PostgrestBuilder:et,PostgrestError:tt}=Xe||Ke;const nt=class{static detectEnvironment(){var e;if("undefined"!==typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket)return{type:"native",constructor:n.g.WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocketPair&&"undefined"===typeof globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!==typeof globalThis&&globalThis.EdgeRuntime||"undefined"!==typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!==typeof process){const e=process.versions;if(e&&e.node){const t=e.node,n=parseInt(t.replace(/^v/,"").split(".")[0]);return n>=22?"undefined"!==typeof globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(n," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:"Node.js ".concat(n," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+="\n\nSuggested solution: ".concat(e.workaround)),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch($t){return!1}}},rt="realtime-js/".concat("2.81.0"),it="1.0.0",ot=it,at=1e4;var st,lt,ct,ut,ht,dt;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(st||(st={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(lt||(lt={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(ct||(ct={})),function(e){e.websocket="websocket"}(ut||(ut={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(ht||(ht={}));class pt{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,t){if(this._isArrayBuffer(e.payload))return t(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&"string"===typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodePush(e){const{join_ref:t,ref:n,event:r,topic:i,payload:o}=e,a=this.META_LENGTH+t.length+n.length+i.length+r.length,s=new ArrayBuffer(this.HEADER_LENGTH+a);let l=new DataView(s),c=0;l.setUint8(c++,this.KINDS.push),l.setUint8(c++,t.length),l.setUint8(c++,n.length),l.setUint8(c++,i.length),l.setUint8(c++,r.length),Array.from(t,e=>l.setUint8(c++,e.charCodeAt(0))),Array.from(n,e=>l.setUint8(c++,e.charCodeAt(0))),Array.from(i,e=>l.setUint8(c++,e.charCodeAt(0))),Array.from(r,e=>l.setUint8(c++,e.charCodeAt(0)));var u=new Uint8Array(s.byteLength+o.byteLength);return u.set(new Uint8Array(s),0),u.set(new Uint8Array(o),s.byteLength),u.buffer}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const{join_ref:r,ref:i,topic:o}=e,a=e.payload.event,s=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:new ArrayBuffer(0),l=this.USER_BROADCAST_PUSH_META_LENGTH+r.length+i.length+o.length+a.length,c=new ArrayBuffer(this.HEADER_LENGTH+l);let u=new DataView(c),h=0;u.setUint8(h++,this.KINDS.userBroadcastPush),u.setUint8(h++,r.length),u.setUint8(h++,i.length),u.setUint8(h++,o.length),u.setUint8(h++,a.length),u.setUint8(h++,this.BINARY_ENCODING),Array.from(r,e=>u.setUint8(h++,e.charCodeAt(0))),Array.from(i,e=>u.setUint8(h++,e.charCodeAt(0))),Array.from(o,e=>u.setUint8(h++,e.charCodeAt(0))),Array.from(a,e=>u.setUint8(h++,e.charCodeAt(0)));var d=new Uint8Array(c.byteLength+s.byteLength);return d.set(new Uint8Array(c),0),d.set(new Uint8Array(s),c.byteLength),d.buffer}_encodeJsonUserBroadcastPush(e){var t,n;const{join_ref:r,ref:i,topic:o}=e,a=e.payload.event,s=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:{},l=(new TextEncoder).encode(JSON.stringify(s)).buffer,c=this.USER_BROADCAST_PUSH_META_LENGTH+r.length+i.length+o.length+a.length,u=new ArrayBuffer(this.HEADER_LENGTH+c);let h=new DataView(u),d=0;h.setUint8(d++,this.KINDS.userBroadcastPush),h.setUint8(d++,r.length),h.setUint8(d++,i.length),h.setUint8(d++,o.length),h.setUint8(d++,a.length),h.setUint8(d++,this.JSON_ENCODING),Array.from(r,e=>h.setUint8(d++,e.charCodeAt(0))),Array.from(i,e=>h.setUint8(d++,e.charCodeAt(0))),Array.from(o,e=>h.setUint8(d++,e.charCodeAt(0))),Array.from(a,e=>h.setUint8(d++,e.charCodeAt(0)));var p=new Uint8Array(u.byteLength+l.byteLength);return p.set(new Uint8Array(u),0),p.set(new Uint8Array(l),u.byteLength),p.buffer}decode(e,t){if(this._isArrayBuffer(e)){return t(this._binaryDecode(e))}if("string"===typeof e){const n=JSON.parse(e),[r,i,o,a,s]=n;return t({join_ref:r,ref:i,topic:o,event:a,payload:s})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),r=new TextDecoder;switch(n){case this.KINDS.push:return this._decodePush(e,t,r);case this.KINDS.reply:return this._decodeReply(e,t,r);case this.KINDS.broadcast:return this._decodeBroadcast(e,t,r);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,r)}}_decodePush(e,t,n){const r=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3);let a=this.HEADER_LENGTH+this.META_LENGTH-1;const s=n.decode(e.slice(a,a+r));a+=r;const l=n.decode(e.slice(a,a+i));a+=i;const c=n.decode(e.slice(a,a+o));a+=o;return{join_ref:s,ref:null,topic:l,event:c,payload:JSON.parse(n.decode(e.slice(a,e.byteLength)))}}_decodeReply(e,t,n){const r=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let s=this.HEADER_LENGTH+this.META_LENGTH;const l=n.decode(e.slice(s,s+r));s+=r;const c=n.decode(e.slice(s,s+i));s+=i;const u=n.decode(e.slice(s,s+o));s+=o;const h=n.decode(e.slice(s,s+a));s+=a;const d={status:h,response:JSON.parse(n.decode(e.slice(s,e.byteLength)))};return{join_ref:l,ref:c,topic:u,event:ct.reply,payload:d}}_decodeBroadcast(e,t,n){const r=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=n.decode(e.slice(o,o+r));o+=r;const s=n.decode(e.slice(o,o+i));o+=i;return{join_ref:null,ref:null,topic:a,event:s,payload:JSON.parse(n.decode(e.slice(o,e.byteLength)))}}_decodeUserBroadcast(e,t,n){const r=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let s=this.HEADER_LENGTH+4;const l=n.decode(e.slice(s,s+r));s+=r;const c=n.decode(e.slice(s,s+i));s+=i;const u=n.decode(e.slice(s,s+o));s+=o;const h=e.slice(s,e.byteLength),d=a===this.JSON_ENCODING?JSON.parse(n.decode(h)):h,p={type:this.BROADCAST,event:c,payload:d};return o>0&&(p.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST,payload:p}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null===e||void 0===e?void 0:e.constructor)||void 0===t?void 0:t.name)}}class ft{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(dt||(dt={}));const mt=function(e,t){var n;const r=null!==(n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==n?n:[];return t?Object.keys(t).reduce((n,i)=>(n[i]=gt(i,e,t,r),n),{}):{}},gt=(e,t,n,r)=>{const i=t.find(t=>t.name===e),o=null===i||void 0===i?void 0:i.type,a=n[e];return o&&!r.includes(o)?_t(o,a):yt(a)},_t=(e,t)=>{if("_"===e.charAt(0)){const n=e.slice(1,e.length);return wt(t,n)}switch(e){case dt.bool:return vt(t);case dt.float4:case dt.float8:case dt.int2:case dt.int4:case dt.int8:case dt.numeric:case dt.oid:return bt(t);case dt.json:case dt.jsonb:return xt(t);case dt.timestamp:return St(t);case dt.abstime:case dt.date:case dt.daterange:case dt.int4range:case dt.int8range:case dt.money:case dt.reltime:case dt.text:case dt.time:case dt.timestamptz:case dt.timetz:case dt.tsrange:case dt.tstzrange:default:return yt(t)}},yt=e=>e,vt=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},bt=e=>{if("string"===typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},xt=e=>{if("string"===typeof e)try{return JSON.parse(e)}catch(t){return console.log("JSON parse error: ".concat(t)),e}return e},wt=(e,t)=>{if("string"!==typeof e)return e;const n=e.length-1,r=e[n];if("{"===e[0]&&"}"===r){let r;const o=e.slice(1,n);try{r=JSON.parse("["+o+"]")}catch(i){r=o?o.split(","):[]}return r.map(e=>_t(t,e))}return e},St=e=>"string"===typeof e?e.replace(" ","T"):e,Tt=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Et{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:at;this.channel=e,this.event=t,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(e){let{status:t,response:n}=e;this.recHooks.filter(e=>e.status===t).forEach(e=>e.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var kt,Pt,Ct,It;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(kt||(kt={}));class At{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null===t||void 0===t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=At.syncState(this.state,e,t,n),this.pendingDiffs.forEach(e=>{this.state=At.syncDiff(this.state,e,t,n)}),this.pendingDiffs=[],r()}),this.channel._on(n.diff,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=At.syncDiff(this.state,e,t,n),r())}),this.onJoin((e,t,n)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:n})}),this.onLeave((e,t,n)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:n})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,r){const i=this.cloneDeep(e),o=this.transformState(t),a={},s={};return this.map(i,(e,t)=>{o[e]||(s[e]=t)}),this.map(o,(e,t)=>{const n=i[e];if(n){const r=t.map(e=>e.presence_ref),i=n.map(e=>e.presence_ref),o=t.filter(e=>i.indexOf(e.presence_ref)<0),l=n.filter(e=>r.indexOf(e.presence_ref)<0);o.length>0&&(a[e]=o),l.length>0&&(s[e]=l)}else a[e]=t}),this.syncDiff(i,{joins:a,leaves:s},n,r)}static syncDiff(e,t,n,r){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(i,(t,r)=>{var i;const o=null!==(i=e[t])&&void 0!==i?i:[];if(e[t]=this.cloneDeep(r),o.length>0){const n=e[t].map(e=>e.presence_ref),r=o.filter(e=>n.indexOf(e.presence_ref)<0);e[t].unshift(...r)}n(t,o,r)}),this.map(o,(t,n)=>{let i=e[t];if(!i)return;const o=n.map(e=>e.presence_ref);i=i.filter(e=>o.indexOf(e.presence_ref)<0),e[t]=i,r(t,i,n),0===i.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const r=e[n];return t[n]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Pt||(Pt={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(Ct||(Ct={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(It||(It={}));class Mt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},n=arguments.length>2?arguments[2]:void 0;var r,i;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=lt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Et(this,ct.join,this.params,this.timeout),this.rejoinTimer=new ft(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=lt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this._joinRef())),this.state=lt.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=lt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=lt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=lt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ct.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new At(this),this.broadcastEndpointURL=Tt(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(i=null===(r=this.params.config)||void 0===r?void 0:r.broadcast)||void 0===i?void 0:i.replay))throw"tried to use replay on public channel '".concat(this.topic,"'. It must be a private channel.")}subscribe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;var n,r,i;if(this.socket.isConnected()||this.socket.connect(),this.state==lt.closed){const{config:{broadcast:o,presence:a,private:s}}=this.params,l=null!==(r=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map(e=>e.filter))&&void 0!==r?r:[],c=!!this.bindings[Ct.PRESENCE]&&this.bindings[Ct.PRESENCE].length>0||!0===(null===(i=this.params.config.presence)||void 0===i?void 0:i.enabled),u={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:c}),postgres_changes:l,private:s};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null===e||void 0===e?void 0:e(It.CHANNEL_ERROR,t)),this._onClose(()=>null===e||void 0===e?void 0:e(It.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async t=>{let{postgres_changes:n}=t;var r;if(this.socket.setAuth(),void 0!==n){const t=this.bindings.postgres_changes,i=null!==(r=null===t||void 0===t?void 0:t.length)&&void 0!==r?r:0,o=[];for(let r=0;r<i;r++){const i=t[r],{filter:{event:a,schema:s,table:l,filter:c}}=i,u=n&&n[r];if(!u||u.event!==a||u.schema!==s||u.table!==l||u.filter!==c)return this.unsubscribe(),this.state=lt.errored,void(null===e||void 0===e||e(It.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));o.push(Object.assign(Object.assign({},i),{id:u.id}))}return this.bindings.postgres_changes=o,void(e&&e(It.SUBSCRIBED))}null===e||void 0===e||e(It.SUBSCRIBED)}).receive("error",t=>{this.state=lt.errored,null===e||void 0===e||e(It.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null===e||void 0===e||e(It.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===lt.joined&&e===Ct.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async httpSend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r;const i=this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"";if(void 0===t||null===t)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(r=n.timeout)&&void 0!==r?r:this.timeout);if(202===a.status)return{success:!0};let s=a.statusText;try{const e=await a.json();s=e.error||e.message||s}catch(l){}return Promise.reject(new Error(s))}async send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(n=>{var r,i,o;const a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(o=null===(i=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===i?void 0:i.broadcast)||void 0===o?void 0:o.ack)||n("ok"),a.receive("ok",()=>n("ok")),a.receive("error",()=>n("error")),a.receive("timeout",()=>n("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:a}=e,s={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:a,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,s,null!==(n=t.timeout)&&void 0!==n?n:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(i){return"AbortError"===i.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=lt.leaving;const t=()=>{this.socket.log("channel","leave ".concat(this.topic)),this._trigger(ct.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new Et(this,ct.leave,{},e),n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{null===n||void 0===n||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=lt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const r=new AbortController,i=setTimeout(()=>r.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),o}_push(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let r=new Et(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(e.event),e.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var r,i;const o=e.toLocaleLowerCase(),{close:a,error:s,leave:l,join:c}=ct;if(n&&[a,s,l,c].indexOf(o)>=0&&n!==this._joinRef())return;let u=this._onMessage(o,t,n);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,n,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(n=e.filter)||void 0===n?void 0:n.event)||void 0===r?void 0:r.toLocaleLowerCase())===o}).map(e=>e.callback(u,n)):null===(i=this.bindings[o])||void 0===i||i.filter(e=>{var n,r,i,a,s,l;if(["broadcast","presence","postgres_changes"].includes(o)){if("id"in e){const o=e.id,a=null===(n=e.filter)||void 0===n?void 0:n.event;return o&&(null===(r=t.ids)||void 0===r?void 0:r.includes(o))&&("*"===a||(null===a||void 0===a?void 0:a.toLocaleLowerCase())===(null===(i=t.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{const n=null===(s=null===(a=null===e||void 0===e?void 0:e.filter)||void 0===a?void 0:a.event)||void 0===s?void 0:s.toLocaleLowerCase();return"*"===n||n===(null===(l=null===t||void 0===t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===o}).map(e=>{if("object"===typeof u&&"ids"in u){const e=u.data,{schema:t,table:n,commit_timestamp:r,type:i,errors:o}=e,a={schema:t,table:n,commit_timestamp:r,eventType:i,new:{},old:{},errors:o};u=Object.assign(Object.assign({},a),this._getPayloadRecords(e))}e.callback(u,n)})}_isClosed(){return this.state===lt.closed}_isJoined(){return this.state===lt.joined}_isJoining(){return this.state===lt.joining}_isLeaving(){return this.state===lt.leaving}_replyEventName(e){return"chan_reply_".concat(e)}_on(e,t,n){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===n&&Mt.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ct.close,{},e)}_onError(e){this._on(ct.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=lt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=mt(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=mt(e.columns,e.old_record)),t}}const Rt=()=>{},Dt=25e3,zt=10,Lt=100,jt=[1e3,2e3,5e3,1e4];class Ot{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=at,this.transport=null,this.heartbeatIntervalMs=Dt,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Rt,this.ref=0,this.reconnectTimer=null,this.vsn=ot,this.logger=Rt,this.conn=null,this.sendBuffer=[],this.serializer=new pt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},!(null===(n=null===t||void 0===t?void 0:t.params)||void 0===n?void 0:n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint="".concat(e,"/").concat(ut.websocket),this.httpEndpoint=Tt(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null===t||void 0===t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=nt.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error("".concat(t,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw new Error("WebSocket not available: ".concat(t))}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,null!==t&&void 0!==t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case st.connecting:return ht.Connecting;case st.open:return ht.Open;case st.closing:return ht.Closing;default:return ht.Closed}}isConnected(){return this.connectionState()===ht.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};const n="realtime:".concat(e),r=this.getChannels().find(e=>e.topic===n);if(r)return r;{const n=new Mt("realtime:".concat(e),t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:n,payload:r,ref:i}=e,o=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push","".concat(t," ").concat(n," (").concat(i,")"),r),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(Ao){this.log("error","error in heartbeat callback",Ao)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},Lt)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(Ao){this.log("error","error in heartbeat callback",Ao)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(Ao){this.log("error","error in heartbeat callback",Ao)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(Ao){this.log("error","error in heartbeat callback",Ao)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:n,payload:r,ref:i}=e,o=i?"(".concat(i,")"):"",a=r.status||"";this.log("receive","".concat(a," ").concat(t," ").concat(n," ").concat(o).trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(n,r,i)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===st.open||this.conn.readyState===st.connecting)try{this.conn.close()}catch(Ao){this.log("error","Error closing connection",Ao)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport","connected to ".concat(this.endpointURL())),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport","".concat(e)),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ct.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return"".concat(e).concat(n).concat(r)}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=t||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const n={access_token:e,version:rt};e&&t.updateJoinPayload(n),t.joinedOnce&&t._isJoined()&&t._push(ct.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";this.setAuth().catch(t=>{this.log("error","error setting auth in ".concat(e),t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(Ao){this.log("error","error in ".concat(e," callback"),Ao)}})}catch(Ao){this.log("error","error triggering ".concat(e," callbacks"),Ao)}}_setupReconnectionTimer(){this.reconnectTimer=new ft(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},zt)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,r,i,o,a,s,l,c,u,h,d;switch(this.transport=null!==(t=null===e||void 0===e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(n=null===e||void 0===e?void 0:e.timeout)&&void 0!==n?n:at,this.heartbeatIntervalMs=null!==(r=null===e||void 0===e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:Dt,this.worker=null!==(i=null===e||void 0===e?void 0:e.worker)&&void 0!==i&&i,this.accessToken=null!==(o=null===e||void 0===e?void 0:e.accessToken)&&void 0!==o?o:null,this.heartbeatCallback=null!==(a=null===e||void 0===e?void 0:e.heartbeatCallback)&&void 0!==a?a:Rt,this.vsn=null!==(s=null===e||void 0===e?void 0:e.vsn)&&void 0!==s?s:ot,(null===e||void 0===e?void 0:e.params)&&(this.params=e.params),(null===e||void 0===e?void 0:e.logger)&&(this.logger=e.logger),((null===e||void 0===e?void 0:e.logLevel)||(null===e||void 0===e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null===e||void 0===e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>jt[e-1]||1e4,this.vsn){case it:this.encode=null!==(c=null===e||void 0===e?void 0:e.encode)&&void 0!==c?c:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(u=null===e||void 0===e?void 0:e.decode)&&void 0!==u?u:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!==(h=null===e||void 0===e?void 0:e.encode)&&void 0!==h?h:this.serializer.encode.bind(this.serializer),this.decode=null!==(d=null===e||void 0===e?void 0:e.decode)&&void 0!==d?d:this.serializer.decode.bind(this.serializer);break;default:throw new Error("Unsupported serializer version: ".concat(this.vsn))}if(this.worker){if("undefined"!==typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null===e||void 0===e?void 0:e.workerUrl}}}class Ft extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Bt(e){return"object"===typeof e&&null!==e&&"__isStorageError"in e}class Nt extends Ft{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ut extends Ft{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const Vt=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},Gt=e=>{if(Array.isArray(e))return e.map(e=>Gt(e));if("function"===typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(e=>{let[n,r]=e;const i=n.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[i]=Gt(r)}),t},qt=e=>{var t;return e.msg||e.message||e.error_description||("string"===typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)},Zt=(e,t,n)=>(0,Ue.__awaiter)(void 0,void 0,void 0,function*(){const r=yield Response;e instanceof r&&!(null===n||void 0===n?void 0:n.noResolveJson)?e.json().then(n=>{const r=e.status||500,i=(null===n||void 0===n?void 0:n.statusCode)||r+"";t(new Nt(qt(n),r,i))}).catch(e=>{t(new Ut(qt(e),e))}):t(new Ut(qt(e),e))}),Wt=(e,t,n,r)=>{const i={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(r)?(i.headers=Object.assign({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),i.body=JSON.stringify(r)):i.body=r,(null===t||void 0===t?void 0:t.duplex)&&(i.duplex=t.duplex),Object.assign(Object.assign({},i),n)):i};function Ht(e,t,n,r,i,o){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return new Promise((a,s)=>{e(n,Wt(t,r,i,o)).then(e=>{if(!e.ok)throw e;return(null===r||void 0===r?void 0:r.noResolveJson)?e:e.json()}).then(e=>a(e)).catch(e=>Zt(e,s,r))})})}function Xt(e,t,n,r){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return Ht(e,"GET",t,n,r)})}function Kt(e,t,n,r,i){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return Ht(e,"POST",t,r,i,n)})}function Yt(e,t,n,r,i){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return Ht(e,"PUT",t,r,i,n)})}function Jt(e,t,n,r,i){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return Ht(e,"DELETE",t,r,i,n)})}class Qt{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Bt(e))return{data:null,error:e};throw e}})}}var $t;$t=Symbol.toStringTag;const en=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[$t]="BlobDownloadBuilder",this.promise=null}asStream(){return new Qt(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{const e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Bt(e))return{data:null,error:e};throw e}})}},tn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},nn={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class rn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=Vt(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,n,r){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},nn),r);let a=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(o.upsert)});const s=o.metadata;if("undefined"!==typeof Blob&&n instanceof Blob)i=new FormData,i.append("cacheControl",o.cacheControl),s&&i.append("metadata",this.encodeMetadata(s)),i.append("",n);else if("undefined"!==typeof FormData&&n instanceof FormData)i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),s&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(s));else{i=n,a["cache-control"]="max-age=".concat(o.cacheControl),a["content-type"]=o.contentType,s&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(s)));("undefined"!==typeof ReadableStream&&i instanceof ReadableStream||i&&"object"===typeof i&&"pipe"in i&&"function"===typeof i.pipe)&&!o.duplex&&(o.duplex="half")}(null===r||void 0===r?void 0:r.headers)&&(a=Object.assign(Object.assign({},a),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield("PUT"==e?Yt:Kt)(this.fetch,"".concat(this.url,"/object/").concat(c),i,Object.assign({headers:a},(null===o||void 0===o?void 0:o.duplex)?{duplex:o.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Bt(i))return{data:null,error:i};throw i}})}upload(e,t,n){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,r){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+"/object/upload/sign/".concat(o));a.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:nn.upsert},r),o=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!==typeof Blob&&n instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(e=n,e.append("cacheControl",t.cacheControl)):(e=n,o["cache-control"]="max-age=".concat(t.cacheControl),o["content-type"]=t.contentType);return{data:{path:i,fullPath:(yield Yt(this.fetch,a.toString(),e,{headers:o})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Bt(s))return{data:null,error:s};throw s}})}createSignedUploadUrl(e,t){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const r=Object.assign({},this.headers);(null===t||void 0===t?void 0:t.upsert)&&(r["x-upsert"]="true");const i=yield Kt(this.fetch,"".concat(this.url,"/object/upload/sign/").concat(n),{},{headers:r}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Ft("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Bt(n))return{data:null,error:n};throw n}})}update(e,t,n){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield Kt(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Bt(r))return{data:null,error:r};throw r}})}copy(e,t,n){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:{path:(yield Kt(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Bt(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,n){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield Kt(this.fetch,"".concat(this.url,"/object/sign/").concat(r),Object.assign({expiresIn:t},(null===n||void 0===n?void 0:n.transform)?{transform:n.transform}:{}),{headers:this.headers});const o=(null===n||void 0===n?void 0:n.download)?"&download=".concat(!0===n.download?"":n.download):"";return i={signedUrl:encodeURI("".concat(this.url).concat(i.signedURL).concat(o))},{data:i,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Bt(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,n){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{const r=yield Kt(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:t,paths:e},{headers:this.headers}),i=(null===n||void 0===n?void 0:n.download)?"&download=".concat(!0===n.download?"":n.download):"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI("".concat(this.url).concat(e.signedURL).concat(i)):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Bt(r))return{data:null,error:r};throw r}})}download(e,t){const n="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{}),i=r?"?".concat(r):"",o=this._getFinalPath(e);return new en(()=>Xt(this.fetch,"".concat(this.url,"/").concat(n,"/").concat(o).concat(i),{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield Xt(this.fetch,"".concat(this.url,"/object/info/").concat(t),{headers:this.headers});return{data:Gt(e),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Bt(n))return{data:null,error:n};throw n}})}exists(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,n,r){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return Ht(e,"HEAD",t,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}(this.fetch,"".concat(this.url,"/object/").concat(t),{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Bt(n)&&n instanceof Ut){const e=n.originalError;if([400,404].includes(null===e||void 0===e?void 0:e.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],i=(null===t||void 0===t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==i&&r.push(i);const o="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{});""!==a&&r.push(a);let s=r.join("&");return""!==s&&(s="?".concat(s)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(o,"/public/").concat(n).concat(s))}}}remove(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Bt(t))return{data:null,error:t};throw t}})}list(e,t,n){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},tn),t),{prefix:e||""});return{data:yield Kt(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Bt(r))return{data:null,error:r};throw r}})}listV2(e,t){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield Kt(this.fetch,"".concat(this.url,"/object/list-v2/").concat(this.bucketId),n,{headers:this.headers},t),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Bt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!==typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return"".concat(this.bucketId,"/").concat(e.replace(/^\/+/,""))}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}}const on="2.81.0",an={"X-Client-Info":"storage-js/".concat(on)};class sn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.shouldThrowOnError=!1;const i=new URL(e);if(null===r||void 0===r?void 0:r.useNewHostname){/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."))}this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},an),t),this.fetch=Vt(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield Xt(this.fetch,"".concat(this.url,"/bucket").concat(t),{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Bt(t))return{data:null,error:t};throw t}})}getBucket(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield Xt(this.fetch,"".concat(this.url,"/bucket/").concat(e),{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Bt(t))return{data:null,error:t};throw t}})}createBucket(e){return(0,Ue.__awaiter)(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};return function*(){try{return{data:yield Kt(t.fetch,"".concat(t.url,"/bucket"),{id:e,name:e,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Bt(r))return{data:null,error:r};throw r}}()})}updateBucket(e,t){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield Yt(this.fetch,"".concat(this.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Bt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield Kt(this.fetch,"".concat(this.url,"/bucket/").concat(e,"/empty"),{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Bt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Bt(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class ln{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},an),t),this.fetch=Vt(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield Kt(this.fetch,"".concat(this.url,"/bucket"),{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Bt(t))return{data:null,error:t};throw t}})}listBuckets(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{const t=new URLSearchParams;void 0!==(null===e||void 0===e?void 0:e.limit)&&t.set("limit",e.limit.toString()),void 0!==(null===e||void 0===e?void 0:e.offset)&&t.set("offset",e.offset.toString()),(null===e||void 0===e?void 0:e.sortColumn)&&t.set("sortColumn",e.sortColumn),(null===e||void 0===e?void 0:e.sortOrder)&&t.set("sortOrder",e.sortOrder),(null===e||void 0===e?void 0:e.search)&&t.set("search",e.search);const n=t.toString(),r=n?"".concat(this.url,"/bucket?").concat(n):"".concat(this.url,"/bucket");return{data:yield Xt(this.fetch,r,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Bt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Bt(t))return{data:null,error:t};throw t}})}}const cn={"X-Client-Info":"storage-js/".concat(on),"Content-Type":"application/json"};class un extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function hn(e){return"object"===typeof e&&null!==e&&"__isStorageVectorsError"in e}class dn extends un{constructor(e,t,n){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class pn extends un{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var fn;!function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"}(fn||(fn={}));const mn=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},gn=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),_n=(e,t,n,r)=>{const i={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(r)?(i.headers=Object.assign({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),i.body=JSON.stringify(r)):i.body=r,Object.assign(Object.assign({},i),n)):i};function yn(e,t,n,r,i,o){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return new Promise((a,s)=>{e(n,_n(t,r,i,o)).then(e=>{if(!e.ok)throw e;if(null===r||void 0===r?void 0:r.noResolveJson)return e;const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>a(e)).catch(e=>((e,t,n)=>(0,Ue.__awaiter)(void 0,void 0,void 0,function*(){if(e&&"object"===typeof e&&"status"in e&&"ok"in e&&"number"===typeof e.status&&!(null===n||void 0===n?void 0:n.noResolveJson)){const n=e.status||500,r=e;if("function"===typeof r.json)r.json().then(e=>{const r=(null===e||void 0===e?void 0:e.statusCode)||(null===e||void 0===e?void 0:e.code)||n+"";t(new dn(gn(e),n,r))}).catch(()=>{const e=n+"",i=r.statusText||"HTTP ".concat(n," error");t(new dn(i,n,e))});else{const e=n+"",i=r.statusText||"HTTP ".concat(n," error");t(new dn(i,n,e))}}else t(new pn(gn(e),e))}))(e,s,r))})})}function vn(e,t,n,r,i){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return yn(e,"POST",t,r,i,n)})}class bn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cn),t),this.fetch=mn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield vn(this.fetch,"".concat(this.url,"/CreateIndex"),e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}getIndex(e,t){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield vn(this.fetch,"".concat(this.url,"/GetIndex"),{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(hn(n))return{data:null,error:n};throw n}})}listIndexes(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield vn(this.fetch,"".concat(this.url,"/ListIndexes"),e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield vn(this.fetch,"".concat(this.url,"/DeleteIndex"),{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(hn(n))return{data:null,error:n};throw n}})}}class xn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cn),t),this.fetch=mn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield vn(this.fetch,"".concat(this.url,"/PutVectors"),e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}getVectors(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield vn(this.fetch,"".concat(this.url,"/GetVectors"),e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}listVectors(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and ".concat(e.segmentCount-1))}return{data:yield vn(this.fetch,"".concat(this.url,"/ListVectors"),e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}queryVectors(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield vn(this.fetch,"".concat(this.url,"/QueryVectors"),e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}deleteVectors(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield vn(this.fetch,"".concat(this.url,"/DeleteVectors"),e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}}class wn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cn),t),this.fetch=mn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield vn(this.fetch,"".concat(this.url,"/CreateVectorBucket"),{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}getBucket(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield vn(this.fetch,"".concat(this.url,"/GetVectorBucket"),{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}listBuckets(){return(0,Ue.__awaiter)(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){try{return{data:yield vn(e.fetch,"".concat(e.url,"/ListVectorBuckets"),t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(hn(n))return{data:null,error:n};throw n}}()})}deleteBucket(e){return(0,Ue.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield vn(this.fetch,"".concat(this.url,"/DeleteVectorBucket"),{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hn(t))return{data:null,error:t};throw t}})}}class Sn extends wn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t.headers||{},t.fetch)}from(e){return new Tn(this.url,this.headers,e,this.fetch)}}class Tn extends bn{constructor(e,t,n,r){super(e,t,r),this.vectorBucketName=n}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return(0,Ue.__awaiter)(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){return e.listIndexes.call(t,Object.assign(Object.assign({},n),{vectorBucketName:t.vectorBucketName}))}()})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new En(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class En extends xn{constructor(e,t,n,r,i){super(e,t,i),this.vectorBucketName=n,this.indexName=r}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return(0,Ue.__awaiter)(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){return e.listVectors.call(t,Object.assign(Object.assign({},n),{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}()})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return(0,Ue.__awaiter)(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class kn extends sn{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}from(e){return new rn(this.url,this.headers,e,this.fetch)}get vectors(){return new Sn(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new ln(this.url+"/iceberg",this.headers,this.fetch)}}let Pn="";Pn="undefined"!==typeof Deno?"deno":"undefined"!==typeof document?"web":"undefined"!==typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Cn={headers:{"X-Client-Info":"supabase-js-".concat(Pn,"/").concat("2.81.0")}},In={schema:"public"},An={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Mn={},Rn=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},Dn=(e,t,n)=>{const r=Rn(n),i=Headers;return async(n,o)=>{var a;const s=null!==(a=await t())&&void 0!==a?a:e;let l=new i(null===o||void 0===o?void 0:o.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization","Bearer ".concat(s)),r(n,Object.assign(Object.assign({},o),{headers:l}))}};const zn="2.81.0",Ln=3e4,jn=9e4,On={"X-Client-Info":"gotrue-js/".concat(zn)},Fn="X-Supabase-Api-Version",Bn={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Nn=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Un extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Vn(e){return"object"===typeof e&&null!==e&&"__isAuthError"in e}class Gn extends Un{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}class qn extends Un{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Zn extends Un{constructor(e,t,n,r){super(e,n,r),this.name=t,this.status=n}}class Wn extends Zn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Hn extends Zn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Xn extends Zn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Kn extends Zn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Yn extends Zn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Jn extends Zn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Qn(e){return Vn(e)&&"AuthRetryableFetchError"===e.name}class $n extends Zn{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class er extends Zn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const tr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),nr=" \t\n\r=".split(""),rr=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<nr.length;t+=1)e[nr[t].charCodeAt(0)]=-2;for(let t=0;t<tr.length;t+=1)e[tr[t].charCodeAt(0)]=t;return e})();function ir(e,t,n){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(tr[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(tr[e]),t.queuedBits-=6}}function or(e,t,n){const r=rr[e];if(!(r>-1)){if(-2===r)return;throw new Error('Invalid Base64-URL character "'.concat(String.fromCharCode(e),'"'))}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function ar(e){const t=[],n=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},o=e=>{!function(e,t,n){if(0===t.utf8seq){if(e<=127)return void n(e);for(let n=1;n<6;n+=1)if(0===(e>>7-n&1)){t.utf8seq=n;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&n(t.codepoint)}}(e,r,n)};for(let a=0;a<e.length;a+=1)or(e.charCodeAt(a),i,o);return t.join("")}function sr(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error("Unrecognized Unicode codepoint: ".concat(e.toString(16)))}t(e)}function lr(e,t){for(let n=0;n<e.length;n+=1){let r=e.charCodeAt(n);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(n+1)-56320&65535|t),n+=1}sr(r,t)}}function cr(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let i=0;i<e.length;i+=1)or(e.charCodeAt(i),n,r);return new Uint8Array(t)}function ur(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>ir(e,n,r)),ir(null,n,r),t.join("")}const hr=()=>"undefined"!==typeof window&&"undefined"!==typeof document,dr={tested:!1,writable:!1},pr=()=>{if(!hr())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(Ao){return!1}if(dr.tested)return dr.writable;const e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),dr.tested=!0,dr.writable=!0}catch(Ao){dr.tested=!0,dr.writable=!1}return dr.writable};const fr=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},mr=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},gr=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch($t){return n}},_r=async(e,t)=>{await e.removeItem(t)};class yr{constructor(){this.promise=new yr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function vr(e){const t=e.split(".");if(3!==t.length)throw new er("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!Nn.test(t[n]))throw new er("JWT not in base64url format");return{header:JSON.parse(ar(t[0])),payload:JSON.parse(ar(t[1])),signature:cr(t[2]),raw:{header:t[0],payload:t[1]}}}function br(e){return("0"+e.toString(16)).substr(-2)}async function xr(e){if(!("undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"undefined"!==typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(n);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function wr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=function(){const e=new Uint32Array(56);if("undefined"===typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let r=0;r<56;r++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(e),Array.from(e,br).join("")}();let i=r;n&&(i+="/PASSWORD_RECOVERY"),await mr(e,"".concat(t,"-code-verifier"),i);const o=await xr(r);return[o,r===o?"plain":"s256"]}yr.promiseConstructor=Promise;const Sr=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Tr=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Er(e){if(!Tr.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function kr(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"===typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(t,'" property of the session object is not supported. Please use getUser() instead.'))},set:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function Pr(e){return JSON.parse(JSON.stringify(e))}const Cr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ir=[502,503,504];async function Ar(e){var t,n;if(!("object"===typeof(n=e)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"===typeof n.json))throw new Jn(Cr(e),0);if(Ir.includes(e.status))throw new Jn(Cr(e),e.status);let r,i;try{r=await e.json()}catch(Ao){throw new qn(Cr(Ao),Ao)}const o=function(e){const t=e.headers.get(Fn);if(!t)return null;if(!t.match(Sr))return null;try{return new Date("".concat(t,"T00:00:00.0Z"))}catch(Ao){return null}}(e);if(o&&o.getTime()>=Bn.timestamp&&"object"===typeof r&&r&&"string"===typeof r.code?i=r.code:"object"===typeof r&&r&&"string"===typeof r.error_code&&(i=r.error_code),i){if("weak_password"===i)throw new $n(Cr(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===i)throw new Wn}else if("object"===typeof r&&r&&"object"===typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0))throw new $n(Cr(r),e.status,r.weak_password.reasons);throw new Gn(Cr(r),e.status||500,i)}async function Mr(e,t,n,r){var i;const o=Object.assign({},null===r||void 0===r?void 0:r.headers);o[Fn]||(o[Fn]=Bn.name),(null===r||void 0===r?void 0:r.jwt)&&(o.Authorization="Bearer ".concat(r.jwt));const a=null!==(i=null===r||void 0===r?void 0:r.query)&&void 0!==i?i:{};(null===r||void 0===r?void 0:r.redirectTo)&&(a.redirect_to=r.redirectTo);const s=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await async function(e,t,n,r,i,o){const a=((e,t,n,r)=>{const i={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===t||void 0===t?void 0:t.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),n))})(t,r,i,o);let s;try{s=await e(n,Object.assign({},a))}catch(Ao){throw console.error(Ao),new Jn(Cr(Ao),0)}s.ok||await Ar(s);if(null===r||void 0===r?void 0:r.noResolveJson)return s;try{return await s.json()}catch(Ao){await Ar(Ao)}}(e,t,n+s,{headers:o,noResolveJson:null===r||void 0===r?void 0:r.noResolveJson},{},null===r||void 0===r?void 0:r.body);return(null===r||void 0===r?void 0:r.xform)?null===r||void 0===r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function Rr(e){var t;let n=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:n,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Dr(e){const t=Rr(e);return!t.error&&e.weak_password&&"object"===typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"===typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function zr(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Lr(e){return{data:e,error:null}}function jr(e){const{action_link:t,email_otp:n,hashed_token:r,redirect_to:i,verification_type:o}=e,a=(0,Ue.__rest)(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:n,hashed_token:r,redirect_to:i,verification_type:o},user:Object.assign({},a)},error:null}}function Or(e){return e}const Fr=["global","local","others"];class Br{constructor(e){let{url:t="",headers:n={},fetch:r}=e;this.url=t,this.headers=n,this.fetch=fr(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fr[0];if(Fr.indexOf(t)<0)throw new Error("@supabase/auth-js: Parameter scope must be one of ".concat(Fr.join(", ")));try{return await Mr(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(t),{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Vn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await Mr(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:zr})}catch(n){if(Vn(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=(0,Ue.__rest)(e,["options"]),r=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(r.new_email=null===n||void 0===n?void 0:n.newEmail,delete r.newEmail),await Mr(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:r,headers:this.headers,xform:jr,redirectTo:null===t||void 0===t?void 0:t.redirectTo})}catch(t){if(Vn(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Mr(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:zr})}catch(t){if(Vn(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,r,i,o,a,s;try{const l={nextPage:null,lastPage:0,total:0},c=await Mr(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(i=null===(r=null===e||void 0===e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==i?i:""},xform:Or});if(c.error)throw c.error;const u=await c.json(),h=null!==(o=c.headers.get("x-total-count"))&&void 0!==o?o:0,d=null!==(s=null===(a=c.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==s?s:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(n,"Page")]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Vn(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Er(e);try{return await Mr(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:zr})}catch(t){if(Vn(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Er(e);try{return await Mr(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:zr})}catch(n){if(Vn(n))return{data:{user:null},error:n};throw n}}async deleteUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Er(e);try{return await Mr(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:zr})}catch(n){if(Vn(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Er(e.userId);try{const{data:t,error:n}=await Mr(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:n}}catch(t){if(Vn(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Er(e.userId),Er(e.id);try{return{data:await Mr(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers}),error:null}}catch(t){if(Vn(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,r,i,o,a,s;try{const l={nextPage:null,lastPage:0,total:0},c=await Mr(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(i=null===(r=null===e||void 0===e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==i?i:""},xform:Or});if(c.error)throw c.error;const u=await c.json(),h=null!==(o=c.headers.get("x-total-count"))&&void 0!==o?o:0,d=null!==(s=null===(a=c.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==s?s:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(n,"Page")]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Vn(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await Mr(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients"),{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Vn(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await Mr(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients/").concat(e),{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Vn(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await Mr(this.fetch,"PUT","".concat(this.url,"/admin/oauth/clients/").concat(e),{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(n){if(Vn(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await Mr(this.fetch,"DELETE","".concat(this.url,"/admin/oauth/clients/").concat(e),{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(Vn(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await Mr(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients/").concat(e,"/regenerate_secret"),{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Vn(t))return{data:null,error:t};throw t}}}function Nr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const Ur=!!(globalThis&&pr()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Vr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Gr extends Vr{}async function qr(e,t,n){Ur&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Ur&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw Ur&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Gr('Acquiring an exclusive Navigator LockManager lock "'.concat(e,'" immediately failed'));if(Ur)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(Ao){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",Ao)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}Ur&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await n()}finally{Ur&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))}function Zr(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error('@supabase/auth-js: Address "'.concat(e,'" is invalid.'));return e.toLowerCase()}function Wr(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class Hr extends Error{constructor(e){let{message:t,code:n,cause:r,name:i}=e;var o;super(t,{cause:r}),this.__isWebAuthnError=!0,this.name=null!==(o=null!==i&&void 0!==i?i:r instanceof Error?r.name:void 0)&&void 0!==o?o:"Unknown Error",this.code=n}}class Xr extends Hr{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Kr(e){let{error:t,options:n}=e;var r,i,o;const{publicKey:a}=n;if(!a)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(n.signal instanceof AbortSignal)return new Hr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if("ConstraintError"===t.name){if(!0===(null===(r=a.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new Hr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if("conditional"===n.mediation&&"required"===(null===(i=a.authenticatorSelection)||void 0===i?void 0:i.userVerification))return new Hr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if("required"===(null===(o=a.authenticatorSelection)||void 0===o?void 0:o.userVerification))return new Hr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if("InvalidStateError"===t.name)return new Hr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if("NotAllowedError"===t.name)return new Hr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("NotSupportedError"===t.name){return 0===a.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new Hr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Hr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t})}if("SecurityError"===t.name){const e=window.location.hostname;if(!ni(e))return new Hr({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(a.rp.id!==e)return new Hr({message:'The RP ID "'.concat(a.rp.id,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("TypeError"===t.name){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new Hr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if("UnknownError"===t.name)return new Hr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Hr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function Yr(e){let{error:t,options:n}=e;const{publicKey:r}=n;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(n.signal instanceof AbortSignal)return new Hr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if("NotAllowedError"===t.name)return new Hr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("SecurityError"===t.name){const e=window.location.hostname;if(!ni(e))return new Hr({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(r.rpId!==e)return new Hr({message:'The RP ID "'.concat(r.rpId,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("UnknownError"===t.name)return new Hr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Hr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}const Jr=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Qr(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!==typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"===typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:n,excludeCredentials:r}=e,i=(0,Ue.__rest)(e,["challenge","user","excludeCredentials"]),o=cr(t).buffer,a=Object.assign(Object.assign({},n),{id:cr(n.id).buffer}),s=Object.assign(Object.assign({},i),{challenge:o,user:a});if(r&&r.length>0){s.excludeCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];s.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:cr(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return s}function $r(e){if(!e)throw new Error("Credential request options are required");if("undefined"!==typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"===typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:n}=e,r=(0,Ue.__rest)(e,["challenge","allowCredentials"]),i=cr(t).buffer,o=Object.assign(Object.assign({},r),{challenge:i});if(n&&n.length>0){o.allowCredentials=new Array(n.length);for(let e=0;e<n.length;e++){const t=n[e];o.allowCredentials[e]=Object.assign(Object.assign({},t),{id:cr(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}function ei(e){var t;if("toJSON"in e&&"function"===typeof e.toJSON)return e.toJSON();const n=e;return{id:e.id,rawId:e.id,response:{attestationObject:ur(new Uint8Array(e.response.attestationObject)),clientDataJSON:ur(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function ti(e){var t;if("toJSON"in e&&"function"===typeof e.toJSON)return e.toJSON();const n=e,r=e.getClientExtensionResults(),i=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:ur(new Uint8Array(i.authenticatorData)),clientDataJSON:ur(new Uint8Array(i.clientDataJSON)),signature:ur(new Uint8Array(i.signature)),userHandle:i.userHandle?ur(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function ni(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function ri(){var e,t;return!!(hr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"===typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"===typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const ii={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},oi={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ai(){const e=e=>null!==e&&"object"===typeof e&&!Array.isArray(e),t=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),n={};for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];for(const a of i)if(a)for(const r in a){const i=a[r];if(void 0!==i)if(Array.isArray(i))n[r]=i;else if(t(i))n[r]=i;else if(e(i)){const t=n[r];e(t)?n[r]=ai(t,i):n[r]=ai(i)}else n[r]=i}return n}class si{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge(e,t){let{factorId:n,webauthn:r,friendlyName:i,signal:o}=e;try{const{data:e,error:a}=await this.client.mfa.challenge({factorId:n,webauthn:r});if(!e)return{data:null,error:a};const s=null!==o&&void 0!==o?o:Jr.createNewAbortSignal();if("create"===e.webauthn.type){const{user:t}=e.webauthn.credential_options.publicKey;t.name||(t.name="".concat(t.id,":").concat(i)),t.displayName||(t.displayName=t.name)}switch(e.webauthn.type){case"create":{const r=function(e,t){return ai(ii,e,t||{})}(e.webauthn.credential_options.publicKey,null===t||void 0===t?void 0:t.create),{data:i,error:o}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Xr("Browser returned unexpected credential type",t)}:{data:null,error:new Xr("Empty credential response",t)}}catch(t){return{data:null,error:Kr({error:t,options:e})}}}({publicKey:r,signal:s});return i?{data:{factorId:n,challengeId:e.id,webauthn:{type:e.webauthn.type,credential_response:i}},error:null}:{data:null,error:o}}case"request":{const r=function(e,t){return ai(oi,e,t||{})}(e.webauthn.credential_options.publicKey,null===t||void 0===t?void 0:t.request),{data:i,error:o}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Xr("Browser returned unexpected credential type",t)}:{data:null,error:new Xr("Empty credential response",t)}}catch(t){return{data:null,error:Yr({error:t,options:e})}}}(Object.assign(Object.assign({},e.webauthn.credential_options),{publicKey:r,signal:s}));return i?{data:{factorId:n,challengeId:e.id,webauthn:{type:e.webauthn.type,credential_response:i}},error:null}:{data:null,error:o}}}}catch(a){return Vn(a)?{data:null,error:a}:{data:null,error:new qn("Unexpected error in challenge",a)}}}async _verify(e){let{challengeId:t,factorId:n,webauthn:r}=e;return this.client.mfa.verify({factorId:n,challengeId:t,webauthn:r})}async _authenticate(e,t){let{factorId:n,webauthn:{rpId:r=("undefined"!==typeof window?window.location.hostname:void 0),rpOrigins:i=("undefined"!==typeof window?[window.location.origin]:void 0),signal:o}={}}=e;if(!r)return{data:null,error:new Un("rpId is required for WebAuthn authentication")};try{if(!ri())return{data:null,error:new qn("Browser does not support WebAuthn",null)};const{data:e,error:a}=await this.challenge({factorId:n,webauthn:{rpId:r,rpOrigins:i},signal:o},{request:t});if(!e)return{data:null,error:a};const{webauthn:s}=e;return this._verify({factorId:n,challengeId:e.challengeId,webauthn:{type:s.type,rpId:r,rpOrigins:i,credential_response:s.credential_response}})}catch(a){return Vn(a)?{data:null,error:a}:{data:null,error:new qn("Unexpected error in authenticate",a)}}}async _register(e,t){let{friendlyName:n,webauthn:{rpId:r=("undefined"!==typeof window?window.location.hostname:void 0),rpOrigins:i=("undefined"!==typeof window?[window.location.origin]:void 0),signal:o}={}}=e;if(!r)return{data:null,error:new Un("rpId is required for WebAuthn registration")};try{if(!ri())return{data:null,error:new qn("Browser does not support WebAuthn",null)};const{data:e,error:a}=await this._enroll({friendlyName:n});if(!e)return await this.client.mfa.listFactors().then(e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.all.find(e=>"webauthn"===e.factor_type&&e.friendly_name===n&&"unverified"!==e.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null===e||void 0===e?void 0:e.id}):void 0),{data:null,error:a};const{data:s,error:l}=await this._challenge({factorId:e.id,friendlyName:e.friendly_name,webauthn:{rpId:r,rpOrigins:i},signal:o},{create:t});return s?this._verify({factorId:e.id,challengeId:s.challengeId,webauthn:{rpId:r,rpOrigins:i,type:s.webauthn.type,credential_response:s.webauthn.credential_response}}):{data:null,error:l}}catch(a){return Vn(a)?{data:null,error:a}:{data:null,error:new qn("Unexpected error in register",a)}}}}!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(Ao){"undefined"!==typeof self&&(self.globalThis=self)}}();const li={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:On,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function ci(e,t,n){return await n()}const ui={};class hi{get jwks(){var e,t;return null!==(t=null===(e=ui[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){ui[this.storageKey]=Object.assign(Object.assign({},ui[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=ui[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ui[this.storageKey]=Object.assign(Object.assign({},ui[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},li),e);if(this.storageKey=i.storageKey,this.instanceID=null!==(t=hi.nextInstanceID[this.storageKey])&&void 0!==t?t:0,hi.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,"function"===typeof i.debug&&(this.logger=i.debug),this.instanceID>0&&hr()){const e="".concat(this._logPrefix()," Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Br({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=fr(i.fetch),this.lock=i.lock||ci,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:hr()&&(null===(n=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===n?void 0:n.locks)?this.lock=qr:this.lock=ci,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new si(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:pr()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Nr(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Nr(this.memoryStorage)),hr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(Ao){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",Ao)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return"GoTrueClient@"+"".concat(this.storageKey,":").concat(this.instanceID," (").concat(zn,") ").concat((new Date).toISOString())}_debug(){if(this.logDebugMessages){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger(this._logPrefix(),...t)}return this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},n="none";if(hr()&&(t=function(e){const t={},n=new URL(e);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach((e,n)=>{t[n]=e})}catch(Ao){}return n.searchParams.forEach((e,n)=>{t[n]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),hr()&&this.detectSessionInUrl&&"none"!==n){const{data:r,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),function(e){return Vn(e)&&"AuthImplicitGrantRedirectError"===e.name}(i)){const t=null===(e=i.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Vn(t)?this._returnResult({error:t}):this._returnResult({error:new qn("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,r;try{const i=await Mr(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!==(n=null===(t=null===e||void 0===e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null===(r=null===e||void 0===e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:Rr}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const s=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",s)),this._returnResult({data:{user:l,session:s},error:null})}catch(i){if(Vn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,n,r;try{let i;if("email"in e){const{email:n,password:r,options:o}=e;let a=null,s=null;"pkce"===this.flowType&&([a,s]=await wr(this.storage,this.storageKey)),i=await Mr(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null===o||void 0===o?void 0:o.emailRedirectTo,body:{email:n,password:r,data:null!==(t=null===o||void 0===o?void 0:o.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken},code_challenge:a,code_challenge_method:s},xform:Rr})}else{if(!("phone"in e))throw new Xn("You must provide either an email or phone number and a password");{const{phone:t,password:o,options:a}=e;i=await Mr(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:t,password:o,data:null!==(n=null===a||void 0===a?void 0:a.data)&&void 0!==n?n:{},channel:null!==(r=null===a||void 0===a?void 0:a.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}},xform:Rr})}}const{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const s=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",s)),this._returnResult({data:{user:l,session:s},error:null})}catch(i){if(Vn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:r,options:i}=e;t=await Mr(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:n,password:r,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},xform:Dr})}else{if(!("phone"in e))throw new Xn("You must provide either an email or phone number and a password");{const{phone:n,password:r,options:i}=e;t=await Mr(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:n,password:r,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},xform:Dr})}}const{data:n,error:r}=t;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!n||!n.session||!n.user){const e=new Hn;return this._returnResult({data:{user:null,session:null},error:e})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r})}catch(t){if(Vn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error('@supabase/auth-js: Unsupported chain "'.concat(t,'"'))}}async signInWithEthereum(e){var t,n,r,i,o,a,s,l,c,u,h;let d,p;if("message"in e)d=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:f,options:m}=e;let g;if(hr())if("object"===typeof h)g=h;else{const e=window;if(!("ethereum"in e)||"object"!==typeof e.ethereum||!("request"in e.ethereum)||"function"!==typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");g=e.ethereum}else{if("object"!==typeof h||!(null===m||void 0===m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=h}const _=new URL(null!==(t=null===m||void 0===m?void 0:m.url)&&void 0!==t?t:window.location.href),y=await g.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!y||0===y.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const v=Zr(y[0]);let b=null===(n=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===n?void 0:n.chainId;if(!b){const e=await g.request({method:"eth_chainId"});b=parseInt(e,16)}d=function(e){var t;const{chainId:n,domain:r,expirationTime:i,issuedAt:o=new Date,nonce:a,notBefore:s,requestId:l,resources:c,scheme:u,uri:h,version:d}=e;if(!Number.isInteger(n))throw new Error('@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: '.concat(n));if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error('@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: '.concat(a));if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw new Error("@supabase/auth-js: Invalid SIWE message field \"version\". Version must be '1'. Provided value: ".concat(d));if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error("@supabase/auth-js: Invalid SIWE message field \"statement\". Statement must not include '\\n'. Provided value: ".concat(e.statement));const p=Zr(e.address),f=u?"".concat(u,"://").concat(r):r,m=e.statement?"".concat(e.statement,"\n"):"",g="".concat(f," wants you to sign in with your Ethereum account:\n").concat(p,"\n\n").concat(m);let _="URI: ".concat(h,"\nVersion: ").concat(d,"\nChain ID: ").concat(n).concat(a?"\nNonce: ".concat(a):"","\nIssued At: ").concat(o.toISOString());if(i&&(_+="\nExpiration Time: ".concat(i.toISOString())),s&&(_+="\nNot Before: ".concat(s.toISOString())),l&&(_+="\nRequest ID: ".concat(l)),c){let e="\nResources:";for(const t of c){if(!t||"string"!==typeof t)throw new Error('@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: '.concat(t));e+="\n- ".concat(t)}_+=e}return"".concat(g,"\n").concat(_)}({domain:_.host,address:v,statement:f,uri:_.href,version:"1",chainId:b,nonce:null===(r=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===r?void 0:r.nonce,issuedAt:null!==(o=null===(i=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===i?void 0:i.issuedAt)&&void 0!==o?o:new Date,expirationTime:null===(a=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===a?void 0:a.expirationTime,notBefore:null===(s=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===s?void 0:s.notBefore,requestId:null===(l=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===c?void 0:c.resources}),p=await g.request({method:"personal_sign",params:[Wr(d),v]})}try{const{data:t,error:n}=await Mr(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"ethereum",message:d,signature:p},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Rr});if(n)throw n;if(!t||!t.session||!t.user){const e=new Hn;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:n})}catch(f){if(Vn(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async signInWithSolana(e){var t,n,r,i,o,a,s,l,c,u,h,d;let p,f;if("message"in e)p=e.message,f=e.signature;else{const{chain:h,wallet:d,statement:m,options:g}=e;let _;if(hr())if("object"===typeof d)_=d;else{const e=window;if(!("solana"in e)||"object"!==typeof e.solana||!("signIn"in e.solana&&"function"===typeof e.solana.signIn||"signMessage"in e.solana&&"function"===typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");_=e.solana}else{if("object"!==typeof d||!(null===g||void 0===g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=d}const y=new URL(null!==(t=null===g||void 0===g?void 0:g.url)&&void 0!==t?t:window.location.href);if("signIn"in _&&_.signIn){const e=await _.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null===g||void 0===g?void 0:g.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),m?{statement:m}:null));let t;if(Array.isArray(e)&&e[0]&&"object"===typeof e[0])t=e[0];else{if(!(e&&"object"===typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"===typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");p="string"===typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),f=t.signature}else{if(!("signMessage"in _)||"function"!==typeof _.signMessage||!("publicKey"in _)||"object"!==typeof _||!_.publicKey||!("toBase58"in _.publicKey)||"function"!==typeof _.publicKey.toBase58)throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=["".concat(y.host," wants you to sign in with your Solana account:"),_.publicKey.toBase58(),...m?["",m,""]:[""],"Version: 1","URI: ".concat(y.href),"Issued At: ".concat(null!==(r=null===(n=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===n?void 0:n.issuedAt)&&void 0!==r?r:(new Date).toISOString()),...(null===(i=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===i?void 0:i.notBefore)?["Not Before: ".concat(g.signInWithSolana.notBefore)]:[],...(null===(o=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===o?void 0:o.expirationTime)?["Expiration Time: ".concat(g.signInWithSolana.expirationTime)]:[],...(null===(a=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===a?void 0:a.chainId)?["Chain ID: ".concat(g.signInWithSolana.chainId)]:[],...(null===(s=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===s?void 0:s.nonce)?["Nonce: ".concat(g.signInWithSolana.nonce)]:[],...(null===(l=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===l?void 0:l.requestId)?["Request ID: ".concat(g.signInWithSolana.requestId)]:[],...(null===(u=null===(c=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...g.signInWithSolana.resources.map(e=>"- ".concat(e))]:[]].join("\n");const e=await _.signMessage((new TextEncoder).encode(p),"utf8");if(!e||!(e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");f=e}}try{const{data:t,error:n}=await Mr(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:ur(f)},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:Rr});if(n)throw n;if(!t||!t.session||!t.user){const e=new Hn;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:n})}catch(m){if(Vn(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(e){const t=await gr(this.storage,"".concat(this.storageKey,"-code-verifier")),[n,r]=(null!==t&&void 0!==t?t:"").split("/");try{const{data:t,error:i}=await Mr(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Rr});if(await _r(this.storage,"".concat(this.storageKey,"-code-verifier")),i)throw i;if(!t||!t.session||!t.user){const e=new Hn;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!==r&&void 0!==r?r:null}),error:i})}catch(i){if(Vn(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:r,access_token:i,nonce:o}=e,a=await Mr(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:n,id_token:r,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:null===t||void 0===t?void 0:t.captchaToken}},xform:Rr}),{data:s,error:l}=a;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!s||!s.session||!s.user){const e=new Hn;return this._returnResult({data:{user:null,session:null},error:e})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:s,error:l})}catch(t){if(Vn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,r,i,o;try{if("email"in e){const{email:r,options:i}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await wr(this.storage,this.storageKey));const{error:s}=await Mr(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:r,data:null!==(t=null===i||void 0===i?void 0:i.data)&&void 0!==t?t:{},create_user:null===(n=null===i||void 0===i?void 0:i.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},redirectTo:null===i||void 0===i?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:s})}if("phone"in e){const{phone:t,options:n}=e,{data:a,error:s}=await Mr(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:t,data:null!==(r=null===n||void 0===n?void 0:n.data)&&void 0!==r?r:{},create_user:null===(i=null===n||void 0===n?void 0:n.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null===n||void 0===n?void 0:n.captchaToken},channel:null!==(o=null===n||void 0===n?void 0:n.channel)&&void 0!==o?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null===a||void 0===a?void 0:a.message_id},error:s})}throw new Xn("You must provide either an email or phone number.")}catch(a){if(Vn(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,n;try{let r,i;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,i=null===(n=e.options)||void 0===n?void 0:n.captchaToken);const{data:o,error:a}=await Mr(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:Rr});if(a)throw a;if(!o){throw new Error("An error occurred on token verification.")}const s=o.session,l=o.user;return(null===s||void 0===s?void 0:s.access_token)&&(await this._saveSession(s),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",s)),this._returnResult({data:{user:l,session:s},error:null})}catch(r){if(Vn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(e){var t,n,r;try{let i=null,o=null;"pkce"===this.flowType&&([i,o]=await wr(this.storage,this.storageKey));const a=await Mr(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==n?n:void 0}),(null===(r=null===e||void 0===e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Lr});return this._returnResult(a)}catch(i){if(Vn(i))return this._returnResult({data:null,error:i});throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Wn;const{error:r}=await Mr(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(Vn(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t="".concat(this.url,"/resend");if("email"in e){const{email:n,type:r,options:i}=e,{error:o}=await Mr(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},redirectTo:null===i||void 0===i?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){const{phone:n,type:r,options:i}=e,{data:o,error:a}=await Mr(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null===o||void 0===o?void 0:o.message_id},error:a})}throw new Xn("You must provide either an email or phone number and a type")}catch(t){if(Vn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch(Ao){}})()),n}return await this.lock("lock:".concat(this.storageKey),e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(Ao){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await gr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=!!e.expires_at&&1e3*e.expires_at-Date.now()<jn;if(this._debug("#__loadSession()","session has".concat(n?"":" not"," expired"),"expires_at",e.expires_at),!n){if(this.userStorage){const t=await gr(this.userStorage,this.storageKey+"-user");(null===t||void 0===t?void 0:t.user)?e.user=t.user:e.user=kr()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,n,r)=>{if("__isInsecureUserWarningProxy"===n)return!0;if("symbol"===typeof n){const t=n.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t||"Symbol(nodejs.util.inspect.custom)"===t)return Reflect.get(e,n,r)}return t.value||"string"!==typeof n||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,n,r)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Mr(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:zr}):await this._useSession(async e=>{var t,n,r;const{data:i,error:o}=e;if(o)throw o;return(null===(t=i.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Mr(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:null!==(r=null===(n=i.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0,xform:zr}):{data:{user:null},error:new Wn}})}catch(t){if(Vn(t))return function(e){return Vn(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await _r(this.storage,"".concat(this.storageKey,"-code-verifier"))),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession(async n=>{const{data:r,error:i}=n;if(i)throw i;if(!r.session)throw new Wn;const o=r.session;let a=null,s=null;"pkce"===this.flowType&&null!=e.email&&([a,s]=await wr(this.storage,this.storageKey));const{data:l,error:c}=await Mr(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null===t||void 0===t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:s}),jwt:o.access_token,xform:zr});if(c)throw c;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(n){if(Vn(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Wn;const t=Date.now()/1e3;let n=t,r=!0,i=null;const{payload:o}=vr(e.access_token);if(o.exp&&(n=o.exp,r=n<=t),r){const{data:t,error:n}=await this._callRefreshToken(e.refresh_token);if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!t)return{data:{user:null,session:null},error:null};i=t}else{const{data:r,error:o}=await this._getUser(e.access_token);if(o)throw o;i={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if(Vn(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:r,error:i}=t;if(i)throw i;e=null!==(n=r.session)&&void 0!==n?n:void 0}if(!(null===e||void 0===e?void 0:e.refresh_token))throw new Wn;const{data:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(Vn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!hr())throw new Kn("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Kn(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Yn("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Kn("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Yn("No code detected.");const{data:t,error:n}=await this._exchangeCodeForSession(e.code);if(n)throw n;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:i,refresh_token:o,expires_in:a,expires_at:s,token_type:l}=e;if(!i||!a||!o||!l)throw new Kn("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(a);let h=c+u;s&&(h=parseInt(s));const d=h-c;1e3*d<=Ln&&console.warn("@supabase/gotrue-js: Session as retrieved from URL expires in ".concat(d,"s, should have been closer to ").concat(u,"s"));const p=h-u;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,h,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,h,c);const{data:f,error:m}=await this._getUser(i);if(m)throw m;const g={provider_token:n,provider_refresh_token:r,access_token:i,expires_in:u,expires_at:h,refresh_token:o,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(n){if(Vn(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await gr(this.storage,"".concat(this.storageKey,"-code-verifier"));return!(!e.code||!t)}async signOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut(){let{scope:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i)return this._returnResult({error:i});const o=null===(n=r.session)||void 0===n?void 0:n.access_token;if(o){const{error:t}=await this.admin.signOut(o,e);if(t&&(!function(e){return Vn(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await _r(this.storage,"".concat(this.storageKey,"-code-verifier"))),this._returnResult({error:null})})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,r;try{const{data:{session:r},error:i}=t;if(i)throw i;await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(i){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null;"pkce"===this.flowType&&([n,r]=await wr(this.storage,this.storageKey,!0));try{return await Mr(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(Vn(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(t){if(Vn(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:r}=await this._useSession(async t=>{var n,r,i,o,a;const{data:s,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider("".concat(this.url,"/user/identities/authorize"),e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(i=e.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:!0});return await Mr(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(a=null===(o=s.session)||void 0===o?void 0:o.access_token)&&void 0!==a?a:void 0})});if(r)throw r;return hr()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null===n||void 0===n?void 0:n.url),this._returnResult({data:{provider:e.provider,url:null===n||void 0===n?void 0:n.url},error:null})}catch(n){if(Vn(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:r,data:{session:i}}=t;if(r)throw r;const{options:o,provider:a,token:s,access_token:l,nonce:c}=e,u=await Mr(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,jwt:null!==(n=null===i||void 0===i?void 0:i.access_token)&&void 0!==n?n:void 0,body:{provider:a,id_token:s,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken}},xform:Rr}),{data:h,error:d}=u;return d?this._returnResult({data:{user:null,session:null},error:d}):h&&h.session&&h.user?(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:d})):this._returnResult({data:{user:null,session:null},error:new Hn})}catch(r){if(Vn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,r;const{data:i,error:o}=t;if(o)throw o;return await Mr(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(e.identity_id),{headers:this.headers,jwt:null!==(r=null===(n=i.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0})})}catch(t){if(Vn(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t="#_refreshAccessToken(".concat(e.substring(0,5),"...)");this._debug(t,"begin");try{const i=Date.now();return await(n=async n=>(n>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await Mr(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:Rr})),r=(e,t)=>{const n=200*Math.pow(2,e);return t&&Qn(t)&&Date.now()+n-i<Ln},new Promise((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{const t=await n(i);if(!r(i,null,t))return void e(t)}catch(Ao){if(!r(i,Ao))return void t(Ao)}})()}))}catch(i){if(this._debug(t,"error",i),Vn(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}finally{this._debug(t,"end")}var n,r}_isValidSession(e){return"object"===typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider("".concat(this.url,"/authorize"),e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),hr()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const i=await gr(this.storage,this.storageKey);if(i&&this.userStorage){let t=await gr(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:i.user},await mr(this.userStorage,this.storageKey+"-user",t)),i.user=null!==(e=null===t||void 0===t?void 0:t.user)&&void 0!==e?e:kr()}else if(i&&!i.user&&!i.user){const e=await gr(this.storage,this.storageKey+"-user");e&&(null===e||void 0===e?void 0:e.user)?(i.user=e.user,await _r(this.storage,this.storageKey+"-user"),await mr(this.storage,this.storageKey,i)):i.user=kr()}if(this._debug(n,"session from storage",i),!this._isValidSession(i))return this._debug(n,"session is not valid"),void(null!==i&&await this._removeSession());const o=1e3*(null!==(t=i.expires_at)&&void 0!==t?t:1/0)-Date.now()<jn;if(this._debug(n,"session has".concat(o?"":" not"," expired with margin of ").concat(jn,"s")),o){if(this.autoRefreshToken&&i.refresh_token){const{error:e}=await this._callRefreshToken(i.refresh_token);e&&(console.error(e),Qn(e)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(i.user&&!0===i.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(i.access_token);!t&&(null===e||void 0===e?void 0:e.user)?(i.user=e.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(n,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){return this._debug(n,"error",i),void console.error(i)}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Wn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r="#_callRefreshToken(".concat(e.substring(0,5),"...)");this._debug(r,"begin");try{this.refreshingDeferred=new yr;const{data:t,error:n}=await this._refreshAccessToken(e);if(n)throw n;if(!t.session)throw new Wn;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={data:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(i){if(this._debug(r,"error",i),Vn(i)){const e={data:null,error:i};return Qn(i)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r="#_notifyAllSubscribers(".concat(e,")");this._debug(r,"begin",t,"broadcast = ".concat(n));try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],i=Array.from(this.stateChangeEmitters.values()).map(async n=>{try{await n.callback(e,t)}catch(Ao){r.push(Ao)}});if(await Promise.all(i),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!n&&t.user&&await mr(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=Pr(e);await mr(this.storage,this.storageKey,r)}else{const e=Pr(t);await mr(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await _r(this.storage,this.storageKey),await _r(this.storage,this.storageKey+"-code-verifier"),await _r(this.storage,this.storageKey+"-user"),this.userStorage&&await _r(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&hr()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(Ao){console.error("removing visibilitychange callback failed",Ao)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ln);this.autoRefreshTicker=e,e&&"object"===typeof e&&"function"===typeof e.unref?e.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*n.expires_at-e)/Ln);this._debug("#_autoRefreshTokenTick()","access token expires in ".concat(r," ticks, a tick lasts ").concat(Ln,"ms, refresh threshold is ").concat(3," ticks")),r<=3&&await this._callRefreshToken(n.refresh_token)})}catch(Ao){console.error("Auto refresh tick failed with error. This is likely a transient error.",Ao)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(Ao){if(!(Ao.isAcquireTimeout||Ao instanceof Vr))throw Ao;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!hr()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t="#_onVisibilityChanged(".concat(e,")");this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const r=["provider=".concat(encodeURIComponent(t))];if((null===n||void 0===n?void 0:n.redirectTo)&&r.push("redirect_to=".concat(encodeURIComponent(n.redirectTo))),(null===n||void 0===n?void 0:n.scopes)&&r.push("scopes=".concat(encodeURIComponent(n.scopes))),"pkce"===this.flowType){const[e,t]=await wr(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(e)),code_challenge_method:"".concat(encodeURIComponent(t))});r.push(n.toString())}if(null===n||void 0===n?void 0:n.queryParams){const e=new URLSearchParams(n.queryParams);r.push(e.toString())}return(null===n||void 0===n?void 0:n.skipBrowserRedirect)&&r.push("skip_http_redirect=".concat(n.skipBrowserRedirect)),"".concat(e,"?").concat(r.join("&"))}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;return i?this._returnResult({data:null,error:i}):await Mr(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token})})}catch(t){if(Vn(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,r;const{data:i,error:o}=t;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:s,error:l}=await Mr(this.fetch,"POST","".concat(this.url,"/factors"),{body:a,headers:this.headers,jwt:null===(n=null===i||void 0===i?void 0:i.session)||void 0===n?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===s.type&&(null===(r=null===s||void 0===s?void 0:s.totp)||void 0===r?void 0:r.qr_code)&&(s.totp.qr_code="data:image/svg+xml;utf-8,".concat(s.totp.qr_code)),this._returnResult({data:s,error:null}))})}catch(t){if(Vn(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?ei(e.webauthn.credential_response):ti(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:s}=await Mr(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:o,headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token});return s?this._returnResult({data:null,error:s}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:s}))})}catch(t){if(Vn(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=await Mr(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{body:e,headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token});if(o.error)return o;const{data:a}=o;if("webauthn"!==a.type)return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Qr(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:$r(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(Vn(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const r={all:[],phone:[],totp:[],webauthn:[]};for(const i of null!==(e=null===t||void 0===t?void 0:t.factors)&&void 0!==e?e:[])r.all.push(i),"verified"===i.status&&r[i.factor_type].push(i);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:n},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=vr(n.access_token);let o=null;i.aal&&(o=i.aal);let a=o;(null!==(t=null===(e=n.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==t?t:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:i.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?await Mr(this.fetch,"GET","".concat(this.url,"/oauth/authorizations/").concat(e),{headers:this.headers,jwt:n.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new Wn})})}catch(t){if(Vn(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!r)return this._returnResult({data:null,error:new Wn});const o=await Mr(this.fetch,"POST","".concat(this.url,"/oauth/authorizations/").concat(e,"/consent"),{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return o.data&&o.data.redirect_url&&hr()&&!(null===t||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(Vn(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!r)return this._returnResult({data:null,error:new Wn});const o=await Mr(this.fetch,"POST","".concat(this.url,"/oauth/authorizations/").concat(e,"/consent"),{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return o.data&&o.data.redirect_url&&hr()&&!(null===t||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(Vn(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e){let t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]}).keys.find(t=>t.kid===e);if(t)return t;const n=Date.now();if(t=this.jwks.keys.find(t=>t.kid===e),t&&this.jwks_cached_at+6e5>n)return t;const{data:r,error:i}=await Mr(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(i)throw i;return r.keys&&0!==r.keys.length?(this.jwks=r,this.jwks_cached_at=n,t=r.keys.find(t=>t.kid===e),t||null):null}async getClaims(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=e;if(!n){const{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});n=e.session.access_token}const{header:r,payload:i,signature:o,raw:{header:a,payload:s}}=vr(n);(null===t||void 0===t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(i.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null===t||void 0===t?void 0:t.keys)?{keys:t.keys}:null===t||void 0===t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(n);if(e)throw e;return{data:{claims:i,header:r,signature:o},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),u=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,o,function(e){const t=[];return lr(e,e=>t.push(e)),new Uint8Array(t)}("".concat(a,".").concat(s))))throw new er("Invalid JWT signature");return{data:{claims:i,header:r,signature:o},error:null}}catch(n){if(Vn(n))return this._returnResult({data:null,error:n});throw n}}}hi.nextInstanceID={};const di=hi;class pi extends di{constructor(e){super(e)}}class fi{constructor(e,t,n){var r,i,o;this.supabaseUrl=e,this.supabaseKey=t;const a=function(e){const t=null===e||void 0===e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((n=t).endsWith("/")?n:n+"/")}catch(r){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var n}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const s="sb-".concat(a.hostname.split(".")[0],"-auth-token"),l=function(e,t){var n,r;const{db:i,auth:o,realtime:a,global:s}=e,{db:l,auth:c,realtime:u,global:h}=t,d={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},c),o),realtime:Object.assign(Object.assign({},u),a),storage:{},global:Object.assign(Object.assign(Object.assign({},h),s),{headers:Object.assign(Object.assign({},null!==(n=null===h||void 0===h?void 0:h.headers)&&void 0!==n?n:{}),null!==(r=null===s||void 0===s?void 0:s.headers)&&void 0!==r?r:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!==n&&void 0!==n?n:{},{db:In,realtime:Mn,auth:Object.assign(Object.assign({},An),{storageKey:s}),global:Cn});this.storageKey=null!==(r=l.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(i=l.global.headers)&&void 0!==i?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!==(o=l.auth)&&void 0!==o?o:{},this.headers,l.global.fetch),this.fetch=Dn(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new Ye(new URL("rest/v1",a).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new kn(this.storageUrl.href,this.headers,this.fetch,null===n||void 0===n?void 0:n.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new He(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{head:!1,get:!1,count:void 0};return this.rest.rpc(e,t,n)}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:n}=await this.auth.getSession();return null!==(t=null===(e=n.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey}_initSupabaseAuthClient(e,t,n){let{autoRefreshToken:r,persistSession:i,detectSessionInUrl:o,storage:a,userStorage:s,storageKey:l,flowType:c,lock:u,debug:h,throwOnError:d}=e;const p={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new pi({url:this.authUrl.href,headers:Object.assign(Object.assign({},p),t),storageKey:l,autoRefreshToken:r,persistSession:i,detectSessionInUrl:o,storage:a,userStorage:s,flowType:c,lock:u,debug:h,throwOnError:d,fetch:n,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Ot(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null===e||void 0===e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null===t||void 0===t?void 0:t.access_token)})}_handleTokenChanged(e,t,n){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===n?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=n,this.realtime.setAuth(n))}}(function(){if("undefined"!==typeof window)return!1;if("undefined"===typeof process)return!1;const e=process.version;if(void 0===e||null===e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("\u26a0\ufe0f  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const mi="https://ykydjggblbdehtrwxzqj.supabase.co".trim(),gi="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlreWRqZ2dibGJkZWh0cnd4enFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NjY0OTEsImV4cCI6MjA3MzA0MjQ5MX0.azZf_c-HrUhZ-7QhljyZg1uFbqlnHC-4ZKkz9ifjHw0".trim(),_i=Boolean(mi&&gi),yi=()=>new Error(["Supabase is not configured.","Set REACT_APP_SUPABASE_URL and REACT_APP_SUPABASE_ANON_KEY in client/.env.local (or client/.env), then restart the dev server."].join(" ")),vi=_i?((e,t,n)=>new fi(e,t,n))(mi,gi):(()=>{const e=yi();return{__isConfigured:!1,auth:{getSession:async()=>({data:{session:null},error:e}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}}),signInWithPassword:async()=>({data:{session:null,user:null},error:e}),signUp:async()=>({data:{session:null,user:null},error:e}),signOut:async()=>({error:e}),updateUser:async()=>({data:{user:null,session:null},error:e})},from:()=>(()=>{const e=yi(),t={select:()=>t,eq:()=>t,order:()=>t,gte:()=>t,lte:()=>t,insert:()=>t,update:()=>t,upsert:()=>t,delete:()=>t,maybeSingle:async()=>({data:null,error:e}),single:async()=>({data:null,error:e}),then:(t,n)=>t({data:null,error:e})};return t})()}})();_i||"undefined"===typeof console||console.error(yi().message);const bi=vi;function xi(){const e="https://swallow-skyer-v1.onrender.com".trim();if(e)return e.replace(/\/+$/,"");throw new Error("Missing REACT_APP_API_BASE_URL. Set it at build time (e.g. REACT_APP_API_BASE_URL=https://swallow-skyer-v1.onrender.com).")}function wi(){return[xi()]}const Si=new class{constructor(){this.baseURL=(e=>{const t=(e||"").trim().replace(/\/+$/,"");return"".concat(t,"/api")})(xi()),this.getAccessToken=async()=>{try{var e;const{data:t}=await bi.auth.getSession();return(null===t||void 0===t||null===(e=t.session)||void 0===e?void 0:e.access_token)||""}catch(t){return""}},this.refreshPromise=null}setAuthHandlers(e){let{refreshTokens:t,logout:n}=e;this.refreshTokens=t,this.logout=n}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r="".concat(this.baseURL).concat(e),i=Ne(t&&t.body instanceof FormData?{}:{"Content-Type":"application/json"},t.headers||{}),o=await this.getAccessToken();o&&(i.Authorization="Bearer ".concat(o));const a=Ne(Ne({},t),{},{headers:i});try{const i=await fetch(r,a);if(401===i.status&&0===n&&this.refreshTokens)return await this._refreshTokens(),this.request(e,t,n+1);if(!i.ok){const e=await i.json().catch(()=>({})),t=new Error((null===e||void 0===e?void 0:e.error)||"HTTP error ".concat(i.status));throw t.status=i.status,t.payload=e,t}return 204===i.status?null:await i.json()}catch(s){throw 401===s.status&&this.logout&&this.logout(),console.error("API request failed:",s),s}}async _refreshTokens(){if(!this.refreshTokens)throw new Error("No refresh handler registered");this.refreshPromise||(this.refreshPromise=this.refreshTokens());try{await this.refreshPromise}finally{this.refreshPromise=null}}async get(e){return this.request(e,{method:"GET"})}async post(e,t){return this.request(e,{method:"POST",body:JSON.stringify(t)})}async put(e,t){return this.request(e,{method:"PUT",body:JSON.stringify(t)})}async delete(e){return this.request(e,{method:"DELETE"})}async patch(e,t){return this.request(e,{method:"PATCH",body:JSON.stringify(t)})}},Ti=Si;var Ei=n(579);const ki="projectRoles",Pi=()=>{try{if("undefined"!==typeof window&&window.localStorage)return window.localStorage}catch(e){}return null},Ci=()=>{const e=Pi();if(!e)return{};const t=e.getItem(ki);if(!t)return{};try{const e=JSON.parse(t);return e&&"object"===typeof e?e:{}}catch(n){return e.removeItem(ki),{}}},Ii=e=>{try{const t=Pi();if(!t)return;t.setItem(ki,JSON.stringify(e||{}))}catch(t){}},Ai={user:null,profile:null,session:null,projects:[],activeProject:null,setActiveProject:()=>{},refreshProjects:async()=>{},projectRoles:{},setProjectRole:()=>{},roleForActiveProject:()=>null,isLoading:!0,login:async()=>{},signup:async()=>{},logout:async()=>{},refreshProfile:async()=>{},updateProfile:async()=>{},updateLogin:async()=>{}},Mi=(0,t.createContext)(Ai),Ri=()=>{var e;return{session:null,user:null,profile:null,activeProjectId:(null===(e=Pi())||void 0===e?void 0:e.getItem("activeProjectId"))||null,projects:[],projectRoles:Ci()}},Di=e=>e?{id:e.id||null,email:e.email||"",username:e.username||"",firstName:e.first_name||"",lastName:e.last_name||"",company:e.company||"",createdAt:e.created_at||null,updatedAt:e.updated_at||null}:null,zi=e=>{let{children:n}=e;const[r,i]=(0,t.useState)(Ri),[o,a]=(0,t.useState)(!0),s=(0,t.useRef)(!1),l=(0,t.useRef)(0),c=(0,t.useRef)(!1),u=(0,t.useRef)(0),h=(0,t.useRef)({projectId:null,at:0}),d=r.projects.find(e=>e.id===r.activeProjectId)||r.activeProjectId||null,p=(0,t.useCallback)(e=>{const t="string"===typeof e?e:(null===e||void 0===e?void 0:e.id)||null;"undefined"!==typeof window&&(t?window.localStorage.setItem("activeProjectId",t):window.localStorage.removeItem("activeProjectId")),i(e=>Ne(Ne({},e),{},{activeProjectId:t||null}))},[]),f=(0,t.useCallback)((e,t)=>{e&&i(n=>{const r=Ne({},(null===n||void 0===n?void 0:n.projectRoles)||{});return t?r[e]=t:delete r[e],Ii(r),Ne(Ne({},n),{},{projectRoles:r})})},[]),m=(0,t.useCallback)(function(){var e;const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||r.activeProjectId;return t&&(null===(e=r.projectRoles)||void 0===e?void 0:e[t])||null},[r.activeProjectId,r.projectRoles]),g=(0,t.useCallback)(e=>{i(t=>Ne(Ne({},t),{},{profile:e}))},[]),_=(0,t.useCallback)(async function(){var e;let{ensureExists:t=!1,userOverride:n=null,force:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=n||(null===(e=r.session)||void 0===e?void 0:e.user);if(null===o||void 0===o||!o.id)return g(null),null;if(c.current)return r.profile;const a=Date.now();if(!i&&a-u.current<3e5)return r.profile;c.current=!0,u.current=a;try{const e=await Ti.get("/v1/profile"),t=(null===e||void 0===e?void 0:e.profile)||null,n=Di(t);return g(n),n}catch(s){return console.error("Failed to load profile",s),null}finally{c.current=!1}},[r.profile,r.session,g]),y=(0,t.useCallback)(async e=>{var t;const n=null===(t=r.session)||void 0===t?void 0:t.user;if(null===n||void 0===n||!n.id)throw new Error("Not authenticated");const i={email:n.email};"string"===typeof e.firstName&&(i.first_name=e.firstName.trim()),"string"===typeof e.lastName&&(i.last_name=e.lastName.trim()),"string"===typeof e.company&&(i.company=e.company.trim());const o=await Ti.patch("/v1/profile",i),a=Di((null===o||void 0===o?void 0:o.profile)||null);return g(a),a},[r.session,g]),v=(0,t.useCallback)(e=>{(e=>{const t=Pi();t&&(e?e.access_token&&t.setItem("access_token",e.access_token):t.removeItem("access_token"))})(e),i(t=>{var n,r,i,o,a;return{session:e,user:null!==(n=null===e||void 0===e?void 0:e.user)&&void 0!==n?n:null,profile:e&&null!==(r=null===t||void 0===t?void 0:t.profile)&&void 0!==r?r:null,activeProjectId:null!==(i=null===t||void 0===t?void 0:t.activeProjectId)&&void 0!==i?i:null,projects:null!==(o=null===t||void 0===t?void 0:t.projects)&&void 0!==o?o:[],projectRoles:null!==(a=null===t||void 0===t?void 0:t.projectRoles)&&void 0!==a?a:{}}})},[]),b=(0,t.useCallback)(async e=>{var t,n,i,o,a;let{email:s,password:l}=e;const c=null===(t=r.session)||void 0===t?void 0:t.user;if(null===c||void 0===c||!c.id)throw new Error("Not authenticated");const u={},h="string"===typeof s?s.trim():"";if(h&&h!==c.email&&(u.email=h),"string"===typeof l&&l.length&&(u.password=l),!u.email&&!u.password)return{user:c};const{data:d,error:p}=await bi.auth.updateUser(u);if(p)throw p;const f=null!==(n=null!==(i=null===d||void 0===d?void 0:d.session)&&void 0!==i?i:null===(o=await bi.auth.getSession())||void 0===o||null===(a=o.data)||void 0===a?void 0:a.session)&&void 0!==n?n:null;if(v(f),u.email)try{const e=await Ti.patch("/v1/profile",{email:u.email});g(Di((null===e||void 0===e?void 0:e.profile)||null))}catch(m){console.error("Failed to sync profile email",m)}return d},[r.session,g,v]),x=(0,t.useCallback)(async function(){let{redirectWhenEmpty:e=!1,force:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(s.current)return;if(!r.session)return void i(e=>Ne(Ne({},e),{},{projects:[]}));const n=Date.now();if(t||!(n-l.current<3e5)){l.current=n,s.current=!0;try{const e=await Ti.get("/v1/projects"),t=(null===e||void 0===e?void 0:e.projects)||[];try{window.localStorage.setItem("projects",JSON.stringify(t))}catch(o){}i(e=>{const n=Ne({},(null===e||void 0===e?void 0:e.projectRoles)||{});t.forEach(e=>{e.id&&e.role&&(n[e.id]=e.role)}),Ii(n);const r=null===e||void 0===e?void 0:e.activeProjectId,i=r&&t.some(e=>e.id===r)||!t.length?r||null:t[0].id;return Ne(Ne({},e),{},{projects:t,activeProjectId:i,projectRoles:n})})}catch(a){console.error("Failed to load projects",a)}finally{s.current=!1}}},[r.session]);(0,t.useEffect)(()=>{let e=!0;(async()=>{try{const{data:n,error:r}=await bi.auth.getSession();if(!e)return;var t;if(r)console.error("Failed to restore Supabase session",r),v(null);else v(null!==(t=null===n||void 0===n?void 0:n.session)&&void 0!==t?t:null),null!==n&&void 0!==n&&n.session&&x({redirectWhenEmpty:!1})}catch(n){e&&(console.error("Unexpected Supabase auth error",n),v(null))}finally{e&&a(!1)}})();const{data:{subscription:t}}=bi.auth.onAuthStateChange((t,n)=>{e&&(v(n||null),n?x({redirectWhenEmpty:!1}):i(e=>Ne(Ne({},e),{},{projects:[],activeProjectId:null})),a(!1))});return()=>{e=!1,t.unsubscribe()}},[x,v]),(0,t.useEffect)(()=>{var e,t;null!==(e=r.session)&&void 0!==e&&null!==(t=e.user)&&void 0!==t&&t.id?_({ensureExists:!0}):g(null)},[r.session,_,g]),(0,t.useEffect)(()=>{if(!r.session||!r.activeProjectId)return;const e=r.activeProjectId;if(!(r.projects||[]).some(t=>t.id===e))return;const t=Date.now(),n=h.current;n.projectId===e&&t-n.at<3e5||(h.current={projectId:e,at:t},Ti.post("/v1/projects/".concat(e,"/access")).catch(()=>{}))},[r.activeProjectId,r.projects,r.session]);const w=(0,t.useCallback)(async e=>{let{userId:t,email:n,firstName:r,lastName:i,company:o}=e;const a={userId:t,email:(n||"").trim(),first_name:(r||"").trim(),last_name:(i||"").trim(),company:(o||"").trim()},s="".concat(xi().replace(/\/+$/,""),"/api/v1/profile/register"),l=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok){const e=await l.json().catch(()=>({}));throw new Error((null===e||void 0===e?void 0:e.error)||"Unable to store user profile")}return l.json()},[]),S=(0,t.useCallback)(async(e,t)=>{var n,r,i,o;const a=(e||"").trim(),{data:s,error:l}=await bi.auth.signInWithPassword({email:a,password:t});if(l){if((400===(null===l||void 0===l?void 0:l.status)||401===(null===l||void 0===l?void 0:l.status))&&((null===l||void 0===l?void 0:l.message)||"").toLowerCase().includes("invalid login credentials"))throw new Error("Invalid email/password, or the account email has not been confirmed yet.");throw l}return v(null!==(n=null===s||void 0===s?void 0:s.session)&&void 0!==n?n:null),await _({ensureExists:!1,userOverride:null===s||void 0===s?void 0:s.user}),null!==(r=null!==(i=null===s||void 0===s?void 0:s.user)&&void 0!==i?i:null===s||void 0===s||null===(o=s.session)||void 0===o?void 0:o.user)&&void 0!==r?r:null},[_,v]),T=(0,t.useCallback)(async function(e,t){var n,r;let{firstName:i,lastName:o,company:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=(e||"").trim(),l="undefined"!==typeof window&&window.location?"".concat(window.location.origin,"/auth/callback"):void 0,{data:c,error:u}=await bi.auth.signUp(l?{email:s,password:t,options:{emailRedirectTo:l}}:{email:s,password:t});if(u)throw u;let h=null!==(n=null===c||void 0===c?void 0:c.user)&&void 0!==n?n:null,d=null!==(r=null===c||void 0===c?void 0:c.session)&&void 0!==r?r:null;if(null===h||void 0===h||!h.id)throw new Error("Unable to register profile metadata");return await w({userId:h.id,email:s,firstName:i,lastName:o,company:a}),d?(v(d),await _({ensureExists:!0,userOverride:h}),{user:h,needsEmailConfirmation:!1,email:s}):{user:h,needsEmailConfirmation:!0,email:s}},[_,w,v]),E=(0,t.useCallback)(async()=>{const{error:e}=await bi.auth.signOut();if(e)throw e;v(null)},[v]);(0,t.useEffect)(()=>{Ti.setAuthHandlers({refreshTokens:async()=>{var e,t;const{data:n,error:r}=await bi.auth.refreshSession();if(r)throw r;return v(null!==(e=null===n||void 0===n?void 0:n.session)&&void 0!==e?e:null),null!==(t=null===n||void 0===n?void 0:n.session)&&void 0!==t?t:null},logout:async()=>{try{await bi.auth.signOut()}catch(e){}v(null)}})},[v]);const k=(0,t.useMemo)(()=>({user:r.user,profile:r.profile,session:r.session,projects:r.projects,activeProject:d,setActiveProject:p,refreshProjects:x,projectRoles:r.projectRoles,setProjectRole:f,roleForActiveProject:m,isLoading:o,login:S,signup:T,logout:E,refreshProfile:_,updateProfile:y,updateLogin:b}),[r.projects,r.session,r.projectRoles,r.profile,o,S,T,E,p,f,m,d,x,_,y,b]);return(0,Ei.jsx)(Mi.Provider,{value:k,children:n})},Li=()=>(0,t.useContext)(Mi),ji=e=>{let{children:t}=e;const{user:n,isLoading:r}=Li(),i=te();return r?(0,Ei.jsx)("div",{children:"Loading..."}):n?t:(0,Ei.jsx)(ve,{to:"/login",replace:!0,state:{from:i}})},Oi=()=>{const{user:e,profile:n,logout:r}=Li(),[i,o]=(0,t.useState)(!1),a=(0,t.useRef)(null),s=re(),l=(0,t.useMemo)(()=>{const t=((null===n||void 0===n?void 0:n.firstName)||"").trim().charAt(0),r=((null===n||void 0===n?void 0:n.lastName)||"").trim().charAt(0);if(t||r)return"".concat(t).concat(r).toUpperCase()||"U";const i=(null===e||void 0===e?void 0:e.email)||"";return(i.replace(/@.*$/,"").slice(0,2)||i.charAt(0)||"U").toUpperCase()},[n,e]),c=(0,t.useMemo)(()=>{const e=[null===n||void 0===n?void 0:n.firstName,null===n||void 0===n?void 0:n.lastName].filter(Boolean);return e.length?e.join(" "):""},[n,e]);(0,t.useEffect)(()=>{const e=e=>{a.current&&!a.current.contains(e.target)&&o(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);return e?(0,Ei.jsxs)("div",{className:"profile-menu",ref:a,children:[(0,Ei.jsx)("button",{type:"button",className:"profile-menu__trigger",onClick:()=>o(e=>!e),"aria-label":"Open profile menu",children:(0,Ei.jsx)("span",{className:"profile-menu__avatar","aria-hidden":"true",children:l})}),i&&(0,Ei.jsxs)("div",{className:"profile-menu__panel",children:[(0,Ei.jsxs)("div",{className:"profile-menu__info",children:[(0,Ei.jsx)("span",{className:"profile-menu__avatar profile-menu__avatar--inline","aria-hidden":"true",children:l}),(0,Ei.jsxs)("div",{children:[(0,Ei.jsx)("div",{className:"profile-menu__label",children:c||e.email||"User"}),c?(0,Ei.jsx)("div",{className:"profile-menu__email",children:e.email}):null]})]}),(0,Ei.jsxs)("div",{className:"profile-menu__actions profile-menu__actions--inline",children:[(0,Ei.jsx)("button",{type:"button",className:"profile-menu__action btn-format-1",onClick:()=>{s("/profile"),o(!1)},children:"Profile"}),(0,Ei.jsx)("button",{type:"button",className:"profile-menu__action btn-format-1",onClick:async()=>{try{await r()}finally{o(!1)}},children:"Logout"})]})]})]}):null},Fi=()=>{var e,n;const{login:r}=Li(),i=re(),o=te(),[a,s]=(0,t.useState)({email:"",password:""}),[l,c]=(0,t.useState)(!1),[u,h]=(0,t.useState)(""),[d,p]=(0,t.useState)(!1),f=(null===(e=o.state)||void 0===e||null===(n=e.from)||void 0===n?void 0:n.pathname)||"/map",m=e=>{const{name:t,value:n}=e.target;s(e=>Ne(Ne({},e),{},{[t]:n}))};return(0,Ei.jsxs)("div",{className:"auth-page",children:[(0,Ei.jsx)("h2",{children:"Login"}),(0,Ei.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),h(""),p(!0);try{await r(a.email,a.password),i(f,{replace:!0})}catch(t){h((null===t||void 0===t?void 0:t.message)||"Unable to login")}finally{p(!1)}},className:"auth-form",children:[(0,Ei.jsxs)("label",{htmlFor:"email",children:["Email",(0,Ei.jsx)("input",{id:"email",name:"email",type:"email",value:a.email,onChange:m,required:!0})]}),(0,Ei.jsxs)("label",{htmlFor:"password",children:["Password",(0,Ei.jsxs)("div",{className:"auth-input-with-toggle",children:[(0,Ei.jsx)("input",{id:"password",name:"password",type:l?"text":"password",value:a.password,onChange:m,required:!0}),(0,Ei.jsx)("button",{type:"button",className:"auth-toggle",onClick:()=>c(e=>!e),children:l?"Hide":"Show"})]})]}),u?(0,Ei.jsx)("div",{className:"auth-error",children:u}):null,(0,Ei.jsx)("button",{type:"submit",disabled:d,children:d?"Logging in...":"Login"})]}),(0,Ei.jsxs)("div",{className:"auth-footer",children:["Need an account? ",(0,Ei.jsx)(Re,{to:"/register",children:"Register"})]})]})},Bi=()=>{const{signup:e}=Li(),n=re(),[r,i]=(0,t.useState)({firstName:"",lastName:"",company:"",email:"",password:""}),[o,a]=(0,t.useState)(""),[s,l]=(0,t.useState)(!1),[c,u]=(0,t.useState)(!1),h=e=>{const{name:t,value:n}=e.target;i(e=>Ne(Ne({},e),{},{[t]:n}))};return(0,Ei.jsxs)("div",{className:"auth-page",children:[(0,Ei.jsx)("h2",{children:"Create an account"}),(0,Ei.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),a(""),l(!0);try{const t=await e(r.email,r.password,{firstName:r.firstName,lastName:r.lastName,company:r.company});if(null!==t&&void 0!==t&&t.needsEmailConfirmation)return void n("/check-email",{replace:!0,state:{email:t.email||r.email}});n("/map",{replace:!0})}catch(i){a((null===i||void 0===i?void 0:i.message)||"Unable to register")}finally{l(!1)}},className:"auth-form",children:[(0,Ei.jsxs)("div",{className:"auth-form__row",children:[(0,Ei.jsxs)("label",{htmlFor:"firstName",children:["First name *",(0,Ei.jsx)("input",{id:"firstName",name:"firstName",type:"text",value:r.firstName,onChange:h,required:!0})]}),(0,Ei.jsxs)("label",{htmlFor:"lastName",children:["Last name *",(0,Ei.jsx)("input",{id:"lastName",name:"lastName",type:"text",value:r.lastName,onChange:h,required:!0})]})]}),(0,Ei.jsxs)("label",{htmlFor:"company",children:["Company (optional)",(0,Ei.jsx)("input",{id:"company",name:"company",type:"text",value:r.company,onChange:h,placeholder:"Company or organization"})]}),(0,Ei.jsxs)("label",{htmlFor:"email",children:["Email",(0,Ei.jsx)("input",{id:"email",name:"email",type:"email",value:r.email,onChange:h,required:!0})]}),(0,Ei.jsxs)("label",{htmlFor:"password",children:["Password",(0,Ei.jsxs)("div",{className:"auth-input-with-toggle",children:[(0,Ei.jsx)("input",{id:"password",name:"password",type:c?"text":"password",value:r.password,onChange:h,required:!0}),(0,Ei.jsx)("button",{type:"button",className:"auth-toggle",onClick:()=>u(e=>!e),children:c?"Hide":"Show"})]})]}),o?(0,Ei.jsx)("div",{className:"auth-error",children:o}):null,(0,Ei.jsx)("button",{type:"submit",disabled:s,children:s?"Registering...":"Register"})]}),(0,Ei.jsxs)("div",{className:"auth-footer",children:["Already have an account? ",(0,Ei.jsx)(Re,{to:"/login",children:"Login"})]})]})};var Ni=n(66),Ui=n.n(Ni);const Vi=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},Gi=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};const n=Vi(e);return n?n.toLocaleString(void 0,t):e?String(e):""};function qi(){if("undefined"===typeof Ui())return;const e="".concat("/swallow-skyer","/maplibre-gl-csp-worker.js");"function"===typeof Ui().setWorkerUrl?Ui().setWorkerUrl(e):Ui().workerUrl=e}const Zi=wi(),Wi={NODE_ENV:"production",PUBLIC_URL:"/swallow-skyer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://swallow-skyer-v1.onrender.com",REACT_APP_SUPABASE_URL:"https://ykydjggblbdehtrwxzqj.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlreWRqZ2dibGJkZWh0cnd4enFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NjY0OTEsImV4cCI6MjA3MzA0MjQ5MX0.azZf_c-HrUhZ-7QhljyZg1uFbqlnHC-4ZKkz9ifjHw0"}.REACT_APP_R2_PUBLIC_BASE_URL||{NODE_ENV:"production",PUBLIC_URL:"/swallow-skyer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://swallow-skyer-v1.onrender.com",REACT_APP_SUPABASE_URL:"https://ykydjggblbdehtrwxzqj.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlreWRqZ2dibGJkZWh0cnd4enFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NjY0OTEsImV4cCI6MjA3MzA0MjQ5MX0.azZf_c-HrUhZ-7QhljyZg1uFbqlnHC-4ZKkz9ifjHw0"}.REACT_APP_R2_PUBLIC_URL||{NODE_ENV:"production",PUBLIC_URL:"/swallow-skyer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://swallow-skyer-v1.onrender.com",REACT_APP_SUPABASE_URL:"https://ykydjggblbdehtrwxzqj.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlreWRqZ2dibGJkZWh0cnd4enFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NjY0OTEsImV4cCI6MjA3MzA0MjQ5MX0.azZf_c-HrUhZ-7QhljyZg1uFbqlnHC-4ZKkz9ifjHw0"}.R2_PUBLIC_BASE_URL||"",Hi=(e,t)=>{const n=Number(e),r=Number(t);return Number.isFinite(n)&&Number.isFinite(r)?[n,r]:null},Xi="https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",Ki={type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Tiles \xa9 Esri \u2014 Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},Yi=e=>{if("number"===typeof e&&Number.isFinite(e))return e;const t=Number(e);return Number.isFinite(t)?t:null},Ji=e=>(e=>{const t=Vi(e);return t?{dateLabel:t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),timeLabel:t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}:{dateLabel:e?String(e):"",timeLabel:""}})(e),Qi=e=>{const t=(null===e||void 0===e?void 0:e.captured_at)||(null===e||void 0===e?void 0:e.capturedAt)||(null===e||void 0===e?void 0:e.taken_at)||(null===e||void 0===e?void 0:e.takenAt)||(null===e||void 0===e?void 0:e.uploaded_at)||(null===e||void 0===e?void 0:e.uploadedAt)||(null===e||void 0===e?void 0:e.created_at)||(null===e||void 0===e?void 0:e.createdAt)||null;if(!t)return null;try{const e=new Date(t).getTime();return Number.isFinite(e)?e:null}catch(n){return null}};class $i{constructor(e){let{onSelect:t,getActive:n}=e;this._onSelect=t,this._getActive=n,this._container=null}onAdd(e){this._map=e;const t=document.createElement("div");t.className="maplibregl-ctrl maplibregl-ctrl-group";const n=(e,n)=>{const r=document.createElement("button");return r.type="button",r.textContent=e,r.style.padding="0 8px",r.style.fontSize="12px",r.style.minWidth="64px",r.onclick=()=>this._onSelect(n),t.appendChild(r),r};return this._standardBtn=n("Standard","standard"),this._satelliteBtn=n("Satellite","satellite"),this._container=t,this._updateActive(),t}onRemove(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._map=void 0}_updateActive(){const e=this._getActive(),t="maplibregl-ctrl-active";this._standardBtn&&this._standardBtn.classList.toggle(t,"standard"===e),this._satelliteBtn&&this._satelliteBtn.classList.toggle(t,"satellite"===e)}setActive(){this._updateActive()}}const eo=()=>{var e;qi();const r=re(),{activeProject:i,projects:o,setActiveProject:a}=Li(),s=(null===i||void 0===i?void 0:i.id)||i||null,l=(0,t.useRef)(null),c=(0,t.useRef)(null),[u,h]=(0,t.useState)(!1),[d,p]=(0,t.useState)([]),[f,m]=(0,t.useState)([]),[g,_]=(0,t.useState)(3.5),[y,v]=(0,t.useState)(null),b=(0,t.useRef)({data:null,fetchedAt:0}),x=(0,t.useRef)({data:null,fetchedAt:0}),w=(0,t.useRef)([]),S=(0,t.useRef)(null),T=(0,t.useRef)(null),E=(0,t.useRef)(!1),k=(0,t.useRef)(!1),[P,C]=(0,t.useState)(0),I=(0,t.useRef)("standard"),A=(0,t.useRef)({}),M=(0,t.useRef)({}),[R,D]=(0,t.useState)(180),z=(0,t.useRef)(null),L=(0,t.useCallback)(()=>v(null),[]),j=(0,t.useCallback)(()=>{T.current&&(T.current.remove(),T.current=null)},[]),O=(0,t.useMemo)(()=>{var e,t;return(null===(e=o.find(e=>e.id===s))||void 0===e?void 0:e.name)||(null===(t=o[0])||void 0===t?void 0:t.name)||""||""},[o,s]),F=(0,t.useMemo)(()=>{var e,t,n;const r=o.find(e=>e.id===s),i=(null===r||void 0===r?void 0:r.address_coord)||(null===r||void 0===r?void 0:r.addressCoord)||(null===r||void 0===r?void 0:r.address_coordinates)||(null===r||void 0===r?void 0:r.addressCoordinates)||null;if(!i)return null;const a=Number(null!==(e=i.lat)&&void 0!==e?e:i.latitude),l=Number(null!==(t=null!==(n=i.lon)&&void 0!==n?n:i.lng)&&void 0!==t?t:i.longitude);return Number.isFinite(a)&&Number.isFinite(l)?{lat:a,lon:l}:null},[o,s]),B=(0,t.useCallback)(e=>{null!==e&&void 0!==e&&e.id&&r("/photos/".concat(e.id,"/options"),{state:{from:"map"}})},[r]);(0,t.useEffect)(()=>{const e=z.current;if(!e)return;e.style.width="auto";const t=e.scrollWidth+18,n=Math.min(Math.max(t,140),.9*window.innerWidth);D(n)},[O,o.length]);const N=(0,t.useCallback)(()=>{w.current.forEach(e=>{try{var t;null===e||void 0===e||null===(t=e.remove)||void 0===t||t.call(e)}catch(n){}}),w.current=[]},[]);(0,t.useEffect)(()=>{var e,t;if(!l.current||c.current)return;try{c.current=new(Ui().Map)({container:l.current,style:Xi,center:[-98.5,39.8],zoom:3.5,transformRequest:(e,t)=>{if("Style"===t||"Source"===t||"Tile"===t)return{url:e,headers:{},credentials:"omit"}}})}catch(u){return void console.error("Error initializing map:",u)}"function"===typeof(null===(e=c.current)||void 0===e?void 0:e.addControl)&&c.current.addControl(new(Ui().NavigationControl),"top-right");const n="function"===typeof c.current.getZoom?c.current.getZoom():3.5;_(n);const r=()=>{_(e=>{var t;const n=null===(t=c.current)||void 0===t?void 0:t.getZoom;if("function"===typeof n){const t=n.call(c.current);return Number.isFinite(t)?t:e}return e})},i=()=>{h(!0)},o=e=>{console.error("Map error:",e)},a="function"===typeof(null===(t=c.current)||void 0===t?void 0:t.on);if(a){c.current.on("load",i),c.current.on("error",o),c.current.on("zoomend",r);const e=()=>{k.current=!0};c.current.on("dragstart",e),c.current.on("zoomstart",e),c.current.on("rotatestart",e),c.current.on("pitchstart",e),c.current.__setInteracted=e}const s=new $i({onSelect:e=>{const t=c.current;if(!t)return;const n=t.getCenter(),r=t.getZoom(),i=t.getBearing(),o=t.getPitch();I.current=e;const a=()=>{(()=>{try{t.getLayer("satellite-raster")&&t.removeLayer("satellite-raster"),t.getSource("satellite-raster")&&t.removeSource("satellite-raster")}catch(r){}const e=A.current||{};Object.entries(e).forEach(e=>{let[n,r]=e;try{t.getLayoutProperty(n,"visibility")!==r&&t.setLayoutProperty(n,"visibility",r)}catch(i){}}),A.current={};const n=M.current||{};Object.entries(n).forEach(e=>{let[n,r]=e;try{void 0!==r.textColor&&t.setPaintProperty(n,"text-color",r.textColor),void 0!==r.textHaloColor&&t.setPaintProperty(n,"text-halo-color",r.textHaloColor),void 0!==r.textHaloWidth&&t.setPaintProperty(n,"text-halo-width",r.textHaloWidth),void 0!==r.lineColor&&t.setPaintProperty(n,"line-color",r.lineColor),void 0!==r.lineOpacity&&t.setPaintProperty(n,"line-opacity",r.lineOpacity),void 0!==r.visibility&&t.setLayoutProperty(n,"visibility",r.visibility)}catch(i){}}),M.current={}})();try{const e=t.getStyle();if(e&&Array.isArray(e.layers)){const n=e.layers.find(e=>"background"===e.type);n&&t.setPaintProperty(n.id,"background-color","#f8f9fa")}}catch(e){}};"satellite"===e?(()=>{try{var e,n,r,i;const o=t.getStyle();if(o&&Array.isArray(o.layers)){const e=o.layers.find(e=>"background"===e.type);e&&t.setPaintProperty(e.id,"background-color","rgba(0,0,0,0)")}t.getSource("satellite-raster")||t.addSource("satellite-raster",Ki);const a=null===(e=t.getStyle())||void 0===e||null===(n=e.layers)||void 0===n||null===(r=n[0])||void 0===r?void 0:r.id;t.getLayer("satellite-raster")||(a?t.addLayer({id:"satellite-raster",type:"raster",source:"satellite-raster",minzoom:0,maxzoom:22},a):t.addLayer({id:"satellite-raster",type:"raster",source:"satellite-raster",minzoom:0,maxzoom:22}));const s=(null===(i=t.getStyle())||void 0===i?void 0:i.layers)||[],l={},c={};s.forEach(e=>{const{id:n,type:r}=e;if(n&&r)if("fill"!==r&&"fill-extrusion"!==r&&"background"!==r){if("line"===r){const e=n.includes("road")||n.includes("street")||n.includes("highway");if(n.includes("boundary")||n.includes("admin"))return;if(e){try{const e=t.getPaintProperty(n,"line-color"),r=t.getPaintProperty(n,"line-opacity"),i=t.getLayoutProperty(n,"visibility")||"visible";c[n]={lineColor:e,lineOpacity:r,visibility:i},t.setPaintProperty(n,"line-color","#000000"),t.setPaintProperty(n,"line-opacity",0),t.setLayoutProperty(n,"visibility","visible")}catch(i){}return}try{const e=t.getLayoutProperty(n,"visibility")||"visible";t.setLayoutProperty(n,"visibility","none"),l[n]=e}catch(o){}return}if("symbol"===r)try{const e=t.getLayoutProperty(n,"visibility")||"visible";"visible"!==e&&(l[n]=e,t.setLayoutProperty(n,"visibility","visible"));const r=t.getPaintProperty(n,"text-color"),i=t.getPaintProperty(n,"text-halo-color"),o=t.getPaintProperty(n,"text-halo-width");c[n]={textColor:r,textHaloColor:i,textHaloWidth:o},t.setPaintProperty(n,"text-color","#ffffff"),t.setPaintProperty(n,"text-halo-color","#000000"),t.setPaintProperty(n,"text-halo-width",1.5)}catch(a){}}else try{const e=t.getLayoutProperty(n,"visibility")||"visible";t.setLayoutProperty(n,"visibility","none"),l[n]=e}catch(s){}}),A.current=l,M.current=c}catch(o){}})():a(),t.jumpTo({center:n,zoom:r,bearing:i,pitch:o}),null===s||void 0===s||s.setActive()},getActive:()=>I.current});return c.current.addControl(s,"top-right"),()=>{var e,t;h(!1),a&&"function"===typeof(null===(e=c.current)||void 0===e?void 0:e.off)&&(c.current.off("load",i),c.current.off("zoomend",r),c.current.__setInteracted&&(c.current.off("dragstart",c.current.__setInteracted),c.current.off("zoomstart",c.current.__setInteracted),c.current.off("rotatestart",c.current.__setInteracted),c.current.off("pitchstart",c.current.__setInteracted),delete c.current.__setInteracted)),N(),"function"===typeof(null===(t=c.current)||void 0===t?void 0:t.remove)&&c.current.remove(),c.current=null}},[N,L,j]),(0,t.useEffect)(()=>{if(!l.current)return;const e=e=>{const t=null===e||void 0===e?void 0:e.target;t&&"function"===typeof t.closest&&(t.closest(".maplibregl-marker")||t.closest(".maplibregl-popup")||t.closest(".maplibregl-ctrl")||t.closest('[data-photo-map-live="1"]')&&(L(),j()))};return document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0)}},[j,L]),(0,t.useEffect)(()=>{let e=!1;return(async()=>{if(!s)return void p([]);const t=b.current||{},n=Zi,r=localStorage.getItem("access_token")||"";for(const i of n)try{const t=new URL("".concat(i,"/api/v1/photos/"));t.searchParams.set("project_id",s);const n=await fetch(t.toString(),{headers:Ne({},r?{Authorization:"Bearer ".concat(r)}:{})}),o=await n.json();if(!n.ok)continue;const a=Array.isArray(o.photos)?o.photos:[];return console.debug("Fetched photos",a.length),void(e||(p(a),b.current={data:a,fetchedAt:Date.now(),projectId:s}))}catch(Ao){continue}!e&&t.data&&p(t.data)})(),()=>{e=!0}},[P,s]),(0,t.useEffect)(()=>{let e=!1;return(async()=>{if(!s)return void m([]);const t=x.current||{},n=Zi,r=localStorage.getItem("access_token")||"";for(const i of n)try{const t=new URL("".concat(i,"/api/v1/locations/"));t.searchParams.set("project_id",s),t.searchParams.set("show_on_photos","true");const n=await fetch(t.toString(),{headers:Ne({},r?{Authorization:"Bearer ".concat(r)}:{})}),o=await n.json();if(!n.ok)continue;const a=Array.isArray(o.locations)?o.locations:[];return console.debug("Fetched locations",a.length),void(e||(m(a),x.current={data:a,fetchedAt:Date.now(),projectId:s}))}catch(Ao){continue}!e&&t.data&&m(t.data)})(),()=>{e=!0}},[P,s]);const U=(0,t.useMemo)(()=>(d||[]).map(e=>{var t,n,r;if(!1===e.show_on_photos)return null;const i=(null===e||void 0===e||null===(t=e.exif_data)||void 0===t?void 0:t.gps)||{},o=Yi(i.lat),a=Yi(i.lon),s=null!==(n=Yi(e.latitude))&&void 0!==n?n:o,l=null!==(r=Yi(e.longitude))&&void 0!==r?r:a;if(!Number.isFinite(s)||!Number.isFinite(l))return null;const c=(u=l,Number.isFinite(u),u);var u;const{primaryUrl:h,fallbackUrl:d,resolvedUrl:p}=(e=>{const t=e.r2_path||e.r2Path||e.r2_key||e.r2Key,n=(e.r2_url||"").trim(),r=(e.url||n||"").trim(),i=Wi&&t?"".concat(Wi.replace(/\/$/,""),"/").concat(t):"";return{primaryUrl:r,fallbackUrl:i,resolvedUrl:r||i}})(e);if(!p)return null;const f=e.taken_at||e.takenAt||e.created_at||e.createdAt||null;return Ne(Ne({},e),{},{url:p,primaryUrl:h,fallbackUrl:d,mapLatitude:s,mapLongitude:c,createdAt:(m=f,Gi(m)),timestampIso:f});var m}).filter(Boolean),[d]),V=(0,t.useMemo)(()=>f.map(e=>{const t=[...U.filter(t=>{const n=Math.abs(t.mapLatitude-e.latitude)<1e-6,r=Math.abs(t.mapLongitude-e.longitude)<1e-6;return n&&r})].sort((e,t)=>{const n=Qi(e),r=Qi(t);return null===n&&null===r?0:null===n?1:null===r?-1:n-r});return{latitude:e.latitude,longitude:e.longitude,photos:t,locationNumber:e.number||0}}).filter(e=>e.photos.length>0),[f,U]);(0,t.useEffect)(()=>{if(!y)return;const e=new Set(y.photos.map(e=>e.id));V.some(t=>t.photos.some(t=>e.has(t.id)))||v(null)},[y,V]);const G=(0,t.useCallback)(async e=>{if(null===e||void 0===e||!e.length)return;const t=async e=>{const t=await fetch(e,{mode:"cors"}).catch(()=>null);if(!t||!t.ok)throw new Error("Download failed");return t.blob()},r=(e,t)=>{const n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)},i=(e,t)=>{const n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",n.rel="noopener noreferrer",document.body.appendChild(n),n.click(),document.body.removeChild(n)},o=e=>e.file_name||e.caption||"photo-".concat(e.id||Date.now()),a=e=>e.primaryUrl||e.url||e.fallbackUrl||e.thumbnailUrl,s=new Map,l=e=>{const t=s.get(e)||0;if(s.set(e,t+1),0===t)return e;const n=e.split(".");if(n.length>1){const e=n.pop(),r=n.join(".");return"".concat(r,"(").concat(t,").").concat(e)}return"".concat(e,"(").concat(t,")")},c=localStorage.getItem("access_token")||"";try{if(e.length>1){if(await(async()=>{var t;const n=null===Zi||void 0===Zi||null===(t=Zi[0])||void 0===t?void 0:t.replace(/\/$/,"");if(!n)return!1;try{const t={items:e.map(e=>{const t=a(e);return t?{url:t,name:l(o(e))}:null}).filter(Boolean)};if(!t.items.length)return!1;const i=await fetch("".concat(n,"/api/v1/photos/download-zip"),{method:"POST",headers:Ne({"Content-Type":"application/json"},c?{Authorization:"Bearer ".concat(c)}:{}),body:JSON.stringify(t)});if(!i.ok)return!1;const s=await i.blob();return r(s,"photos-".concat(Date.now(),".zip")),!0}catch(i){return!1}})())return}if(1===e.length){const t=e[0],n=a(t);if(!n)throw new Error("No URL to download");return void i(n,o(t))}const{default:s}=await n.e(159).then(n.t.bind(n,159,23)),h=new s;let d=0;const p=[];for(const n of e){const e=a(n);if(e)try{const r=await t(e),i=l(o(n));h.file(i,r),d+=1}catch(u){p.push(n)}}if(d>0){const e=await h.generateAsync({type:"blob"});r(e,"photos-".concat(Date.now(),".zip"))}else p.length&&p.forEach(e=>{const t=a(e);t&&i(t,o(e))})}catch(h){}},[]);(0,t.useEffect)(()=>{if(!c.current||!u)return;N();const e=new(Ui().LngLatBounds),t=(e,t)=>{e.style.width="".concat(t,"px"),e.style.height="".concat(t,"px"),e.style.boxSizing="border-box",e.style.padding="0",e.style.margin="0",e.style.display="grid",e.style.placeItems="center",e.style.userSelect="none",e.style.lineHeight="0",e.style.transition="none",e.style.animation="none"},n=e=>{const t=document.createElement("div");return t.style.width="".concat(e,"px"),t.style.height="".concat(e,"px"),t.style.boxSizing="border-box",t.style.position="relative",t.style.display="grid",t.style.placeItems="center",t.style.lineHeight="0",t.style.transition="none",t.style.animation="none",t};V.forEach(r=>{if(!Number.isFinite(r.latitude)||!Number.isFinite(r.longitude))return;if(1===(r.locationNumber||0)&&r.photos.length>0){const i=(r=>{const i=Hi(r.mapLongitude,r.mapLatitude);if(!i)return null;const[o,a]=i;e.extend(i);const s=document.createElement("div");t(s,18),s.style.cursor="pointer",s.title=r.caption||"View photo",s.setAttribute("role","button"),s.setAttribute("tabindex","0");const l=n(18);l.style.borderRadius="50%",l.style.background="#61dafb",l.style.border="1px solid #61dafb",l.style.boxShadow="0 2px 6px rgba(0,0,0,0.12)";const u=document.createElement("div");u.style.width="6px",u.style.height="6px",u.style.borderRadius="50%",u.style.background="#2ca7e5",u.style.boxShadow="0 0 0 2px rgba(44,167,229,0.18)",l.appendChild(u),s.appendChild(l);const h=document.createElement("div");h.style.position="relative",h.style.maxWidth="320px",h.style.width="320px",h.style.padding="10px 10px 12px",h.style.background="#ffffff",h.style.borderRadius="12px",h.style.boxShadow="0 8px 18px rgba(0,0,0,0.12)",h.style.display="flex",h.style.flexDirection="column",h.style.gap="10px",h.addEventListener("click",e=>{e.stopPropagation()});const d=document.createElement("button");d.type="button",d.textContent="\xd7",d.style.position="absolute",d.style.top="8px",d.style.right="8px",d.style.width="22px",d.style.height="22px",d.style.fontSize="18px",d.style.lineHeight="1",d.style.padding="0",d.style.display="grid",d.style.placeItems="center",d.style.background="transparent",d.style.border="none",d.style.boxShadow="none",d.style.color="#111827",d.style.cursor="pointer",d.onclick=e=>{e.stopPropagation(),j()};const p=document.createElement("div");p.style.display="flex",p.style.alignItems="center",p.style.gap="12px";const f=document.createElement("img");f.alt=r.caption||"Photo",f.crossOrigin="anonymous",f.style.width="120px",f.style.height="120px",f.style.objectFit="cover",f.style.borderRadius="8px",f.style.background="#e5e7eb",f.onerror=()=>{r.fallbackUrl&&f.src!==r.fallbackUrl?f.src=r.fallbackUrl:f.style.display="none"},f.src=r.primaryUrl||r.url||r.fallbackUrl||"",f.style.cursor="pointer",f.onclick=e=>{e.stopPropagation(),B(r)};const m=document.createElement("div");m.style.display="flex",m.style.flex="1",m.style.flexDirection="column",m.style.alignItems="center",m.style.justifyContent="center",m.style.gap="4px";const{dateLabel:g,timeLabel:_}=Ji(r.timestampIso||r.createdAt||r.created_at||""),y=document.createElement("div");y.textContent=g,y.style.fontSize="13px",y.style.color="#1f2937",y.style.fontWeight="700",y.style.lineHeight="18px";const v=document.createElement("div");v.textContent=_,v.style.fontSize="13px",v.style.color="#1f2937",v.style.fontWeight="700",v.style.lineHeight="18px";const b=document.createElement("a");b.textContent="\u2913",b.setAttribute("aria-label","Download photo"),b.href=r.primaryUrl||r.url||r.fallbackUrl||"#",b.target="_blank",b.rel="noopener noreferrer",b.style.fontSize="18px",b.style.color="#1e88e5",b.style.textDecoration="none",b.style.fontWeight="700",b.style.display="inline-flex",b.style.alignItems="center",b.style.justifyContent="center",b.style.padding="2px 6px",b.style.borderRadius="6px",b.style.transition="color 0.15s ease, background 0.15s ease",b.onmouseover=()=>{b.style.color="#1565c0",b.style.background="rgba(21,101,192,0.08)"},b.onmouseout=()=>{b.style.color="#1e88e5",b.style.background="transparent"},b.onclick=e=>{"#"!==b.href||e.preventDefault()},m.appendChild(y),m.appendChild(v),p.appendChild(f),p.appendChild(m),p.appendChild(b),h.appendChild(d),h.appendChild(p);const x=new(Ui().Popup)({offset:24,closeButton:!1,closeOnClick:!1,closeOnMove:!1,maxWidth:"340px"}).setDOMContent(h);x.on("close",()=>{T.current===x&&(T.current=null)});const w=new(Ui().Marker)({element:s,anchor:"center",offset:[0,0]}).setLngLat(i).addTo(c.current),S=e=>{var t,n;null===e||void 0===e||null===(t=e.stopPropagation)||void 0===t||t.call(e),L(),j(),T.current=x,x.setLngLat(i).addTo(c.current);const r=null===(n=x.getElement)||void 0===n?void 0:n.call(x);if(r){r.style.background="transparent",r.style.boxShadow="none",r.style.padding="0";const e=r.querySelector(".maplibregl-popup-tip");e&&(e.style.display="none");const t=r.querySelector(".maplibregl-popup-content");t&&(t.style.background="transparent",t.style.boxShadow="none",t.style.padding="0")}};return s.addEventListener("click",S),s.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),S(e))}),w})(r.photos[0]);i&&w.current.push(i)}else if(r.photos.length>0){const i=(r=>{const i=Hi(r.longitude,r.latitude);if(!i)return null;const[o,a]=i;e.extend(i);const s=document.createElement("div");t(s,22),s.style.cursor="pointer",s.setAttribute("role","button"),s.setAttribute("tabindex","0"),s.setAttribute("aria-label","".concat(r.photos.length," photos at this location"));const l=n(22);l.style.borderRadius="50%",l.style.background="#282c34",l.style.border="1px solid #282c34",l.style.boxShadow="0 2px 6px rgba(0,0,0,0.16)";const u=document.createElement("div");u.style.width="6px",u.style.height="6px",u.style.borderRadius="50%",u.style.background="#61dafb",u.style.boxShadow="0 0 0 3px rgba(97,218,251,0.16)",l.appendChild(u),s.appendChild(l);const h=e=>{var t,n,i;e.stopPropagation(),j(),v({latitude:a,longitude:o,photos:r.photos}),null===(t=c.current)||void 0===t||t.flyTo({center:[o,a],zoom:Math.max((null===(n=c.current)||void 0===n||null===(i=n.getZoom)||void 0===i?void 0:i.call(n))||g,9),essential:!0})};return s.addEventListener("click",h),s.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),h(e))}),new(Ui().Marker)({element:s,anchor:"center",offset:[0,0]}).setLngLat(i).addTo(c.current)})(r);i&&w.current.push(i)}}),F&&e.extend([F.lon,F.lat]),e.isEmpty()||E.current||k.current||(0===V.length&&F?c.current.flyTo({center:[F.lon,F.lat],zoom:13,essential:!0}):c.current.fitBounds(e,{padding:60,maxZoom:19,duration:800}),E.current=!0)},[V,N,j,L,u,F]),(0,t.useEffect)(()=>{var e;if(S.current&&(S.current.remove(),S.current=null),!y||!c.current)return;const t=document.createElement("div");t.style.maxWidth="320px",t.style.width="320px",t.style.padding="10px 10px 12px",t.style.background="#ffffff",t.style.borderRadius="12px",t.style.boxShadow="none",t.style.display="flex",t.style.flexDirection="column",t.style.gap="8px",t.addEventListener("click",e=>{e.stopPropagation()});const n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="space-between";const r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.gap="6px";const i=document.createElement("div");i.textContent="Grouped Photos",i.style.fontWeight="700",i.style.fontSize="16px",i.style.color="#1f2937";const o=document.createElement("div");o.textContent="".concat(y.photos.length," items"),o.style.fontSize="13px",o.style.color="#4b5563",r.appendChild(i),r.appendChild(o);const a=document.createElement("button");a.type="button",a.textContent="\xd7",a.style.width="22px",a.style.height="22px",a.style.fontSize="18px",a.style.lineHeight="1",a.style.padding="0",a.style.display="grid",a.style.placeItems="center",a.style.background="transparent",a.style.border="none",a.style.boxShadow="none",a.style.color="#111827",a.style.cursor="pointer",a.onclick=e=>{e.stopPropagation(),L()},n.appendChild(r),n.appendChild(a),t.appendChild(n);const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",s.style.gap="8px",s.style.height="288px",s.style.overflowY="auto",s.style.paddingRight="4px",s.style.boxSizing="border-box",s.style.overscrollBehavior="contain",y.photos.forEach((e,t)=>{const n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.gap="12px",n.style.padding="10px",n.style.background="#f8fafc",n.style.borderRadius="10px";const r=document.createElement("img");r.alt=e.caption||"Photo ".concat(t+1),r.src=e.thumbnailUrl||e.primaryUrl||e.url||e.fallbackUrl||"",r.style.width="120px",r.style.height="120px",r.style.objectFit="cover",r.style.borderRadius="8px",r.style.background="#e5e7eb",r.style.cursor="pointer",r.onerror=()=>{r.style.display="none"},r.onclick=t=>{t.stopPropagation(),B(e)};const i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.gap="4px",i.style.flex="1";const{dateLabel:o,timeLabel:a}=Ji(e.timestampIso||e.createdAt||e.created_at||""),l=document.createElement("div");l.textContent=o,l.style.fontSize="13px",l.style.color="#1f2937",l.style.fontWeight="700",l.style.lineHeight="18px";const c=document.createElement("div");c.textContent=a,c.style.fontSize="13px",c.style.color="#1f2937",c.style.fontWeight="700",c.style.lineHeight="18px",i.appendChild(l),i.appendChild(c);const u=document.createElement("a");u.textContent="\u2913",u.setAttribute("aria-label","Download photo"),u.href="#",u.style.fontSize="18px",u.style.color="#1e88e5",u.style.textDecoration="none",u.style.fontWeight="700",u.style.display="inline-flex",u.style.alignItems="center",u.style.justifyContent="center",u.style.padding="2px 6px",u.style.borderRadius="6px",u.style.transition="color 0.15s ease, background 0.15s ease",u.onmouseover=()=>{u.style.color="#1565c0",u.style.background="rgba(21,101,192,0.08)"},u.onmouseout=()=>{u.style.color="#1e88e5",u.style.background="transparent"},u.onclick=t=>{t.preventDefault(),t.stopPropagation(),G([e])},n.appendChild(r),n.appendChild(i),n.appendChild(u),s.appendChild(n)}),t.appendChild(s);const l=document.createElement("button");l.type="button",l.className="btn-format-1",l.textContent="Download all (".concat(y.photos.length,")"),l.style.alignSelf="flex-end",l.style.marginTop="4px",l.onclick=async e=>{e.stopPropagation(),await G(y.photos)},t.appendChild(l);const u=new(Ui().Popup)({closeButton:!1,closeOnClick:!1,closeOnMove:!1,anchor:"left",offset:[16,0],maxWidth:"340px"}).setDOMContent(t).setLngLat([y.longitude,y.latitude]).addTo(c.current);S.current=u;const h=null===u||void 0===u||null===(e=u.getElement)||void 0===e?void 0:e.call(u);if(h){h.style.background="transparent",h.style.boxShadow="none",h.style.padding="0";const e=h.querySelector(".maplibregl-popup-tip");e&&(e.style.display="none");const t=h.querySelector(".maplibregl-popup-content");t&&(t.style.background="transparent",t.style.boxShadow="none",t.style.padding="0")}return()=>u.remove()},[y,L,G]);return(0,Ei.jsxs)("div",{"data-photo-map-live":"1",style:{width:"100%",height:"100%",position:"relative"},children:[(0,Ei.jsx)("div",{style:{position:"absolute",zIndex:3,top:8,left:8,display:"flex",alignItems:"center",gap:8},children:(0,Ei.jsx)("select",{className:"btn-format-1",ref:z,value:s||(null===(e=o[0])||void 0===e?void 0:e.id)||"",onChange:e=>{const t=e.target.value;a(t||null),b.current={data:null,fetchedAt:0},E.current=!1,k.current=!1,C(e=>e+1)},style:{paddingRight:28,width:"".concat(R,"px"),whiteSpace:"nowrap"},children:o.map(e=>(0,Ei.jsx)("option",{value:e.id,children:e.name},e.id))})}),(0,Ei.jsx)("div",{ref:l,style:{width:"100%",height:"100%"}})]})},to=()=>(0,Ei.jsx)("div",{className:"map-page",children:(0,Ei.jsx)(eo,{})}),no=xi(),ro=e=>{let{onForbidden:n,onUploaded:r,variant:i="full"}=e;const{activeProject:o}=Li(),a=(null===o||void 0===o?void 0:o.id)||o||null,[s,l]=(0,t.useState)([]),[c,u]=(0,t.useState)({}),[h,d]=(0,t.useState)(!1),[p,f]=(0,t.useState)(!1),m=(0,t.useRef)(null),g=(0,t.useCallback)(async e=>{if(!e.length)return;try{(e=>{if(!e)throw new Error("Select or create a project before uploading.")})(a)}catch(o){return void alert(o.message)}f(!0);const t=new FormData;e.forEach(e=>t.append("files",e)),((e,t)=>{if(!t)throw new Error("project_id is required");e.append("project_id",t)})(t,a);const i=localStorage.getItem("access_token")||"";try{const o=await fetch("".concat((no||"").replace(/\/$/,""),"/api/photos/upload"),{method:"POST",body:t,headers:Ne({},i?{Authorization:"Bearer ".concat(i)}:{})}),a=await o.json().catch(()=>({}));if(403===o.status&&"function"===typeof n&&n(),!o.ok){const e=(null===a||void 0===a?void 0:a.message)||(null===a||void 0===a?void 0:a.error)||(403===o.status?"You do not have permission for this action.":"Upload failed (".concat(o.status,")"));throw new Error(e)}const s={};((null===a||void 0===a?void 0:a.uploaded)||[]).forEach(e=>{s[e.original_filename]="done"}),e.forEach(e=>{s[e.name]||(s[e.name]="done")}),u(s),l([]),"function"===typeof r&&r(a)}catch(o){const t={};e.forEach(e=>{t[e.name]="error"}),u(t),alert(o.message||"Upload failed")}finally{f(!1)}},[a,n,r]),_=(0,t.useCallback)(e=>{if(null===e||void 0===e||!e.length)return;const t=[...s,...Array.from(e)];l(t);const n=Ne({},c);Array.from(e).forEach(e=>{n[e.name]="pending"}),u(n),"compact"===i&&g(t)},[s,g,c,i]),y=e=>{_(e.target.files)},v=e=>{e.preventDefault(),d(!0)},b=e=>{e.preventDefault(),d(!1)},x=e=>{var t;e.preventDefault(),d(!1),_(null===(t=e.dataTransfer)||void 0===t?void 0:t.files)},w=()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.click()};if("compact"===i){const e=h?"2px solid #1e88e5":"1px solid #e5e7eb";return(0,Ei.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,Ei.jsxs)("div",{"data-testid":"compact-drop",className:"btn-format-1",onDragOver:v,onDragLeave:b,onDrop:x,onClick:w,role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),w())},style:{borderRadius:"50%",width:28,height:28,minWidth:28,border:e,background:h?"#f1f5f9":"#f7f9fc",fontSize:20,fontWeight:700,lineHeight:"24px",textAlign:"center",cursor:"pointer",boxShadow:h?"0 0 0 3px rgba(30,136,229,0.18)":"none",transition:"all 120ms ease"},title:"Upload photos",children:[p?"\u2026":"+",(0,Ei.jsx)("input",{ref:m,type:"file",accept:"image/*",multiple:!0,style:{display:"none"},onChange:y})]}),p?(0,Ei.jsx)("span",{style:{fontSize:12,color:"#6b7280"},children:"Uploading\u2026"}):(0,Ei.jsx)("span",{style:{fontSize:12,color:"#6b7280"},children:"Click or drop to upload"})]})}return(0,Ei.jsxs)("div",{children:[(0,Ei.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),await g(s)},children:[(0,Ei.jsxs)("div",{"data-testid":"dropzone",onDragOver:v,onDragLeave:b,onDrop:x,style:{border:"2px dashed #999",padding:16,marginBottom:12,background:h?"#f0f6ff":"#fff",cursor:"pointer"},onClick:()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.click()},children:[(0,Ei.jsx)("p",{style:{margin:0},children:"Drag & drop images here or click to select files (multiple allowed)"}),(0,Ei.jsx)("input",{ref:m,type:"file",accept:"image/*",multiple:!0,style:{display:"none"},onChange:y})]}),(0,Ei.jsx)("button",{type:"submit",disabled:p||!s.length,children:p?"Uploading...":"Upload"})]}),s.length>0&&(0,Ei.jsx)("ul",{"data-testid":"file-list",children:s.map(e=>(0,Ei.jsxs)("li",{children:[e.name," \u2014 ",c[e.name]||"pending"]},e.name))})]})},io=wi(),oo={width:"100%",textAlign:"left",padding:"8px 12px",background:"transparent",border:"none",cursor:"pointer",fontSize:14,transition:"background 120ms ease"},ao=()=>{var e;const{activeProject:r,projects:i,setActiveProject:o}=Li(),a=re(),s=(null===r||void 0===r?void 0:r.id)||r||null,[l,c]=(0,t.useState)([]),[u,h]=(0,t.useState)(""),[d,p]=(0,t.useState)(!1),[f,m]=(0,t.useState)(!1),[g,_]=(0,t.useState)(180),y=(0,t.useRef)(null),[v,b]=(0,t.useState)(!1),[x,w]=(0,t.useState)(new Set),[S,T]=(0,t.useState)(null),E=(0,t.useRef)(null),k=(i||[]).length>0;(0,t.useEffect)(()=>{const e=y.current;if(!e)return;e.style.width="auto";const t=e.scrollWidth+18,n=Math.min(Math.max(t,140),.9*window.innerWidth);_(n)},[i.length,s]);const P=(0,t.useCallback)(async e=>{const t=null!==e&&void 0!==e?e:s;if(!t)return void c([]);p(!0),h("");const n=localStorage.getItem("access_token")||"",r=io;for(const i of r)try{const e=new URL("".concat(i,"/api/v1/photos/"));e.searchParams.set("project_id",t);const r=await fetch(e.toString(),{headers:Ne({},n?{Authorization:"Bearer ".concat(n)}:{})}),o=await r.json();if(!r.ok)continue;const a=Array.isArray(o.photos)?o.photos:[];return c(a),void p(!1)}catch(Ao){continue}h("Unable to load photos for this project."),p(!1)},[s]);(0,t.useEffect)(()=>{P()},[P]),(0,t.useEffect)(()=>{const e=e=>{var t,n,r,i;if(!S)return;if(!E.current)return;const o=null===(t=(n=e.target).closest)||void 0===t?void 0:t.call(n,".photo-menu"),a=null===(r=(i=e.target).closest)||void 0===r?void 0:r.call(i,".photo-card");o||a||T(null)};return document.addEventListener("click",e,!0),()=>document.removeEventListener("click",e,!0)},[S]);const C=async(e,t)=>{if(null===e||void 0===e||!e.length)return;const r=(t||A).filter(t=>e.includes(t.id));if(!r.length)return;const i=async e=>{const t=await fetch(e,{mode:"cors"}).catch(()=>null);if(!t||!t.ok)throw new Error("Download failed");return t.blob()},o=e=>e.file_name||e.caption||"photo-".concat(e.id||Date.now()),a=e=>e.primaryUrl||e.url||e.fallbackUrl||e.thumbnailUrl;m(!0);try{if(1===r.length){const e=r[0],t=a(e);if(!t)throw new Error("No URL to download");((e,t)=>{const n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",n.rel="noopener noreferrer",document.body.appendChild(n),n.click(),document.body.removeChild(n)})(t,o(e))}else{const{default:e}=await n.e(159).then(n.t.bind(n,159,23)),t=new e;for(const n of r){const e=a(n);if(e)try{const r=await i(e),a=o(n);t.file(a,r)}catch(Ao){}}((e,t)=>{const n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)})(await t.generateAsync({type:"blob"}),"photos-".concat(Date.now(),".zip"))}}catch(s){h((null===s||void 0===s?void 0:s.message)||"Download failed")}finally{m(!1)}},I=async e=>{if(null===e||void 0===e||!e.length)return;const t=localStorage.getItem("access_token")||"",n=io;for(const r of e)for(const e of n)try{const n=new URL("".concat(e,"/api/v1/photos/").concat(r));if((await fetch(n.toString(),{method:"DELETE",headers:Ne({},t?{Authorization:"Bearer ".concat(t)}:{})})).ok)break}catch(Ao){}w(new Set),b(!1),P(s)},A=(0,t.useMemo)(()=>(l||[]).map(e=>{const{primaryUrl:t,fallbackUrl:n,resolvedUrl:r,resolvedThumb:i}=(e=>{const t={NODE_ENV:"production",PUBLIC_URL:"/swallow-skyer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://swallow-skyer-v1.onrender.com",REACT_APP_SUPABASE_URL:"https://ykydjggblbdehtrwxzqj.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlreWRqZ2dibGJkZWh0cnd4enFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NjY0OTEsImV4cCI6MjA3MzA0MjQ5MX0.azZf_c-HrUhZ-7QhljyZg1uFbqlnHC-4ZKkz9ifjHw0"}.REACT_APP_R2_PUBLIC_BASE_URL||{NODE_ENV:"production",PUBLIC_URL:"/swallow-skyer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://swallow-skyer-v1.onrender.com",REACT_APP_SUPABASE_URL:"https://ykydjggblbdehtrwxzqj.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlreWRqZ2dibGJkZWh0cnd4enFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NjY0OTEsImV4cCI6MjA3MzA0MjQ5MX0.azZf_c-HrUhZ-7QhljyZg1uFbqlnHC-4ZKkz9ifjHw0"}.REACT_APP_R2_PUBLIC_URL||"",n=(e.r2_path||e.r2_key||"").trim(),r=(e.r2_url||"").trim(),i=(e.url||r||"").trim(),o=t&&n?"".concat(t.replace(/\/$/,""),"/").concat(n):"",a=i||o,s=(e.thumbnail_r2_path||"").trim();return{primaryUrl:i,fallbackUrl:o,resolvedUrl:a,resolvedThumb:(e.thumbnail_r2_url||e.thumbnail_url||"").trim()||(s&&t?"".concat(t.replace(/\/$/,""),"/").concat(s):"")}})(e);if(!1===e.show_on_photos)return null;if(!r&&!i)return null;const o=e.captured_at||e.capturedAt||e.created_at||e.createdAt||null;return Ne(Ne({},e),{},{url:r||i,primaryUrl:t,fallbackUrl:n,thumbnailUrl:i,createdAt:(a=o,Gi(a))});var a}).filter(Boolean),[l]);return k?(0,Ei.jsxs)("div",{style:{width:"100%",padding:"16px 24px",boxSizing:"border-box",position:"relative"},children:[(0,Ei.jsx)("div",{style:{position:"absolute",zIndex:3,top:8,left:8},children:(0,Ei.jsx)("select",{className:"btn-format-1",ref:y,value:s||(null===(e=i[0])||void 0===e?void 0:e.id)||"",onChange:e=>{const t=e.target.value;o(t||null),c([]),P(t)},style:{paddingRight:28,width:"".concat(g,"px"),whiteSpace:"nowrap"},children:i.map(e=>(0,Ei.jsx)("option",{value:e.id,children:e.name},e.id))})}),(0,Ei.jsxs)("div",{style:{width:"min(1200px, 100%)",margin:"0 auto",paddingTop:44},children:[(0,Ei.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:12},children:[(0,Ei.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,Ei.jsx)("h2",{style:{margin:0},children:"Photos"}),(0,Ei.jsxs)("span",{style:{color:"#6b7280",fontSize:13},children:[A.length," items"]})]}),(0,Ei.jsx)(ro,{variant:"compact",onUploaded:()=>P(s)})]}),v?(0,Ei.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:10},children:[(0,Ei.jsxs)("span",{style:{fontSize:13,color:"#374151"},children:[x.size," selected"]}),(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",style:{padding:"6px 10px"},onClick:()=>{const e=(A||[]).map(e=>null===e||void 0===e?void 0:e.id).filter(Boolean);w(new Set(e))},disabled:!A.length,children:"Select all"}),(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",style:{padding:"6px 10px"},onClick:()=>C([...x],A),disabled:f,children:f?"Downloading\u2026":"Download selected"}),(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",style:{padding:"6px 10px",color:"#b91c1c",borderColor:"#fca5a5"},onClick:()=>I([...x]),children:"Delete selected"}),(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",style:{padding:"6px 10px"},onClick:()=>{b(!1),w(new Set)},children:"Done"})]}):null,u?(0,Ei.jsx)("div",{style:{color:"#dc2626",marginBottom:12},children:u}):null,d?(0,Ei.jsx)("div",{children:"Loading photos..."}):null,(0,Ei.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:14},ref:E,children:A.map(e=>{const t=!(null!==e&&void 0!==e&&e.exif_data&&e.exif_data.gps),n=x.has(e.id);return(0,Ei.jsxs)("div",{className:"photo-card",style:{border:"1px solid #e5e7eb",borderRadius:12,padding:0,background:"#fff",boxShadow:"0 1px 3px rgba(0,0,0,0.06)",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"},onClick:()=>{v||a("/photos/".concat(e.id,"/options"))},children:[v?(0,Ei.jsx)("input",{type:"checkbox",checked:n,onChange:()=>{return t=e.id,void w(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});var t},style:{position:"absolute",top:10,left:10,zIndex:2,width:18,height:18,accentColor:"#1e88e5",borderRadius:6,border:"1px solid #d1d5db"}}):null,(0,Ei.jsxs)("div",{className:"photo-menu",style:{position:"absolute",top:10,right:10,zIndex:2},children:[(0,Ei.jsx)("button",{type:"button","aria-label":"Photo actions",onClick:t=>{t.stopPropagation(),T(t=>t===e.id?null:e.id)},style:{border:"1px solid #e5e7eb",borderRadius:10,width:30,height:30,background:"#fff",cursor:"pointer",lineHeight:"24px"},children:"\u22ee"}),S===e.id?(0,Ei.jsxs)("div",{style:{position:"absolute",top:34,right:0,background:"#fff",border:"1px solid #e5e7eb",borderRadius:8,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",zIndex:5,minWidth:180,padding:"6px 0"},onClick:e=>e.stopPropagation(),children:[(0,Ei.jsx)("button",{type:"button",style:oo,onMouseEnter:e=>{e.currentTarget.style.background="#f5f7fb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{T(null),C([e.id],A)},children:"Download"}),(0,Ei.jsx)("button",{type:"button",style:oo,onMouseEnter:e=>{e.currentTarget.style.background="#f5f7fb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{T(null),b(!0),w(t=>{const n=new Set(t);return n.add(e.id),n})},children:"More"}),(0,Ei.jsx)("button",{type:"button",style:Ne(Ne({},oo),{},{color:"#dc2626"}),onMouseEnter:e=>{e.currentTarget.style.background="#fef2f2"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{T(null),I([e.id])},children:"Delete"})]}):null]}),(0,Ei.jsx)("div",{style:{width:"100%",borderRadius:0,overflow:"hidden",background:"#f3f4f6",aspectRatio:"4 / 3",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,Ei.jsx)("img",{src:e.thumbnailUrl||e.url,alt:e.caption||e.file_name||"Photo",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:t=>{e.fallbackUrl&&t.target.src!==e.fallbackUrl?t.target.src=e.fallbackUrl:t.target.style.display="none"}})}),(0,Ei.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderTop:"1px solid #e5e7eb",background:"#fff"},children:[(0,Ei.jsx)("div",{style:{color:"#6b7280",fontSize:12},children:e.createdAt||"Date unknown"}),t?(0,Ei.jsx)("span",{style:{fontSize:11,color:"#92400e",background:"#fef3c7",borderRadius:999,padding:"2px 8px"},children:"No GPS"}):null]})]},e.id)})})]})]}):(0,Ei.jsxs)("div",{style:{padding:"24px",width:"100%",boxSizing:"border-box"},children:[(0,Ei.jsx)("h2",{children:"Photos"}),(0,Ei.jsx)("p",{children:"Select or create a project to view its photos."})]})},so=()=>{const{user:e,profile:n,logout:r,refreshProfile:i,updateProfile:o,updateLogin:a}=Li(),[s,l]=(0,t.useState)(!1),[c,u]=(0,t.useState)(!1),[h,d]=(0,t.useState)(!1),[p,f]=(0,t.useState)({firstName:"",lastName:"",company:""}),[m,g]=(0,t.useState)({email:"",password:""}),[_,y]=(0,t.useState)(""),[v,b]=(0,t.useState)("");(0,t.useEffect)(()=>{i({ensureExists:!0})},[i]),(0,t.useEffect)(()=>{s||f({firstName:(null===n||void 0===n?void 0:n.firstName)||"",lastName:(null===n||void 0===n?void 0:n.lastName)||"",company:(null===n||void 0===n?void 0:n.company)||""}),c||g({email:(null===n||void 0===n?void 0:n.email)||(null===e||void 0===e?void 0:e.email)||"",password:""})},[n,e,s,c]);const x=(0,t.useMemo)(()=>{const e=[null===n||void 0===n?void 0:n.firstName,null===n||void 0===n?void 0:n.lastName].filter(Boolean);return e.length?e.join(" "):"Add your name"},[n]);return(0,Ei.jsxs)("div",{className:"profile-page",children:[(0,Ei.jsx)("h2",{children:"Profile"}),(_||v)&&(0,Ei.jsx)("div",{className:"profile-page__alert ".concat(_?"profile-page__alert--error":"profile-page__alert--info"),children:_||v}),(0,Ei.jsxs)("div",{className:"profile-section",children:[(0,Ei.jsxs)("div",{className:"profile-section__header",children:[(0,Ei.jsx)("h3",{children:"User"}),s?null:(0,Ei.jsx)("button",{type:"button",className:"profile-section__edit profile-section__edit--ghost",onClick:()=>{f({firstName:(null===n||void 0===n?void 0:n.firstName)||"",lastName:(null===n||void 0===n?void 0:n.lastName)||"",company:(null===n||void 0===n?void 0:n.company)||""}),l(!0),y(""),b("")},children:"Edit"})]}),(0,Ei.jsx)("div",{className:"profile-section__body",children:(0,Ei.jsxs)("div",{className:"profile-card ".concat(s?"profile-card--edit":""),children:[(0,Ei.jsxs)("div",{className:"profile-card__row",children:[(0,Ei.jsx)("strong",{children:"Name:"}),s?(0,Ei.jsxs)("div",{className:"profile-card__inputs",onClick:e=>e.stopPropagation(),children:[(0,Ei.jsx)("input",{type:"text",name:"firstName",value:p.firstName,onChange:e=>f(t=>Ne(Ne({},t),{},{firstName:e.target.value})),autoFocus:!0,placeholder:"First name",required:!0}),(0,Ei.jsx)("input",{type:"text",name:"lastName",value:p.lastName,onChange:e=>f(t=>Ne(Ne({},t),{},{lastName:e.target.value})),placeholder:"Last name",required:!0})]}):(0,Ei.jsx)("span",{children:x})]}),(0,Ei.jsxs)("div",{className:"profile-card__row",children:[(0,Ei.jsx)("strong",{children:"Email:"}),(0,Ei.jsx)("span",{children:(null===n||void 0===n?void 0:n.email)||(null===e||void 0===e?void 0:e.email)||"Unknown"})]}),(0,Ei.jsxs)("div",{className:"profile-card__row",children:[(0,Ei.jsx)("strong",{children:"Company:"}),s?(0,Ei.jsx)("input",{type:"text",name:"company",value:p.company,onChange:e=>f(t=>Ne(Ne({},t),{},{company:e.target.value})),placeholder:"Company name"}):(0,Ei.jsx)("span",{children:(null===n||void 0===n?void 0:n.company)||"Add your company"})]}),s&&(0,Ei.jsxs)("div",{className:"profile-card__actions",children:[(0,Ei.jsx)("button",{type:"button",onClick:async()=>{if(y(""),b(""),p.firstName.trim()&&p.lastName.trim()){d(!0);try{await o({firstName:p.firstName,lastName:p.lastName,company:p.company}),b("Profile updated."),l(!1)}catch(e){y((null===e||void 0===e?void 0:e.message)||"Failed to update profile.")}finally{d(!1)}}else y("Name is required (first and last).")},disabled:h,className:"btn-format-1",children:"Save"}),(0,Ei.jsx)("button",{type:"button",onClick:()=>{l(!1),y(""),b(""),f({firstName:(null===n||void 0===n?void 0:n.firstName)||"",lastName:(null===n||void 0===n?void 0:n.lastName)||"",company:(null===n||void 0===n?void 0:n.company)||""})},className:"btn-format-1",children:"Cancel"})]})]})})]}),(0,Ei.jsxs)("div",{className:"profile-section",children:[(0,Ei.jsxs)("div",{className:"profile-section__header",children:[(0,Ei.jsx)("h3",{children:"Login"}),c?null:(0,Ei.jsx)("button",{type:"button",className:"profile-section__edit profile-section__edit--ghost",onClick:()=>{g({email:(null===n||void 0===n?void 0:n.email)||(null===e||void 0===e?void 0:e.email)||"",password:""}),u(!0),y(""),b("")},children:"Edit"})]}),(0,Ei.jsx)("div",{className:"profile-section__body",children:(0,Ei.jsxs)("div",{className:"profile-card ".concat(c?"profile-card--edit":""),children:[(0,Ei.jsxs)("div",{className:"profile-card__row",children:[(0,Ei.jsx)("strong",{children:"Email:"}),c?(0,Ei.jsx)("input",{type:"email",name:"loginEmail",value:m.email,onChange:e=>g(t=>Ne(Ne({},t),{},{email:e.target.value})),required:!0}):(0,Ei.jsx)("span",{children:(null===n||void 0===n?void 0:n.email)||(null===e||void 0===e?void 0:e.email)||"Unknown"})]}),(0,Ei.jsxs)("div",{className:"profile-card__row",children:[(0,Ei.jsx)("strong",{children:"Password:"}),c?(0,Ei.jsx)("input",{type:"password",name:"loginPassword",value:m.password,onChange:e=>g(t=>Ne(Ne({},t),{},{password:e.target.value})),placeholder:"Leave blank to keep current password"}):(0,Ei.jsx)("span",{children:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"})]}),c&&(0,Ei.jsxs)("div",{className:"profile-card__actions",children:[(0,Ei.jsx)("button",{type:"button",onClick:async()=>{if(y(""),b(""),m.email.trim()){d(!0);try{await a({email:m.email,password:m.password||void 0}),b(m.password?"Login email/password updated.":"Login email updated."),u(!1),g(e=>Ne(Ne({},e),{},{password:""}))}catch(e){y((null===e||void 0===e?void 0:e.message)||"Failed to update login.")}finally{d(!1)}}else y("Email is required.")},disabled:h,className:"btn-format-1",children:"Save"}),(0,Ei.jsx)("button",{type:"button",onClick:()=>{u(!1),y(""),b(""),g({email:(null===n||void 0===n?void 0:n.email)||(null===e||void 0===e?void 0:e.email)||"",password:""})},className:"btn-format-1",children:"Cancel"})]})]})})]}),(0,Ei.jsx)("button",{type:"button",className:"profile-card__logout",onClick:async()=>{try{await r()}catch(e){console.error("Failed to logout",e)}},children:"Logout"})]})},lo={width:"100%",textAlign:"left",padding:"8px 12px",background:"transparent",border:"none",cursor:"pointer",fontSize:14,transition:"background 120ms ease"},co=e=>{let{projects:n,activeProjectId:r,onActivate:i,onEdit:o,onMembers:a,onDelete:s,onUnjoin:l,onUnarchive:c,currentUserId:u,isArchivedView:h=!1}=e;const d=Array.isArray(n)?n:[],[p,f]=(0,t.useState)(null),m=(0,t.useCallback)(()=>f(null),[]);if((0,t.useEffect)(()=>{const e=e=>{e.target.closest(".project-card-menu")||m()};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[m]),0===d.length)return(0,Ei.jsx)("div",{children:"No projects yet."});const g=d.find(e=>e.id===r),_=d.filter(e=>e.id!==r),y=(e,t)=>({border:"1px solid #e5e7eb",borderRadius:12,padding:"12px 14px",textAlign:"left",background:e?"#f4f7ff":"#fff",boxShadow:"0 1px 3px rgba(0,0,0,0.06)",cursor:"pointer",display:"flex",flexDirection:"column",gap:8,transition:"transform 120ms ease, box-shadow 120ms ease",position:"relative",overflow:"visible",zIndex:t?50:e?5:1}),v=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(e.role||"").toLowerCase(),r="owner"===n||"administrator"===n,d="owner"===n,g=e.owner_id&&u===e.owner_id,_=p===e.id;return(0,Ei.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>{m(),i(e)},onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),m(),i(e))},style:y(t,_),onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.08)"},onMouseLeave:e=>{e.currentTarget.style.transform="none",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.06)"},children:[(0,Ei.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:8},children:[(0,Ei.jsxs)("div",{children:[(0,Ei.jsx)("div",{style:{fontWeight:700,fontSize:15,marginBottom:6},children:e.name}),e.address?(0,Ei.jsx)("div",{style:{color:"#6b7280",fontSize:12},children:e.address}):null]}),(0,Ei.jsxs)("div",{className:"project-card-menu",style:{position:"relative",zIndex:_?60:1},children:[(0,Ei.jsx)("button",{type:"button","aria-label":"Project actions",onClick:t=>{t.stopPropagation(),f(t=>t===e.id?null:e.id)},style:{border:"1px solid #e5e7eb",borderRadius:"50%",width:28,height:28,background:"#fff",cursor:"pointer",lineHeight:"24px"},children:"\u22ee"}),_?(0,Ei.jsx)("div",{style:{position:"absolute",top:32,right:0,background:"#fff",border:"1px solid #e5e7eb",borderRadius:8,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",zIndex:70,minWidth:180,padding:"6px 0"},onClick:e=>e.stopPropagation(),children:h?(0,Ei.jsx)(Ei.Fragment,{children:(0,Ei.jsx)("button",{type:"button",style:lo,onMouseEnter:e=>{e.currentTarget.style.background="#f5f7fb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{m(),c(e)},children:"Unarchive"})}):r?(0,Ei.jsxs)(Ei.Fragment,{children:[(0,Ei.jsx)("button",{type:"button",style:lo,onMouseEnter:e=>{e.currentTarget.style.background="#f5f7fb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{m(),o(e)},children:"Edit"}),(0,Ei.jsx)("button",{type:"button",style:lo,onMouseEnter:e=>{e.currentTarget.style.background="#f5f7fb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{m(),a(e)},children:"Project Members"}),d?(0,Ei.jsx)("button",{type:"button",style:Ne(Ne({},lo),{},{color:"#dc2626"}),onMouseEnter:e=>{e.currentTarget.style.background="#fef2f2"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{m(),s(e)},children:"Archive"}):null,g?null:(0,Ei.jsx)("button",{type:"button",style:lo,onMouseEnter:e=>{e.currentTarget.style.background="#f5f7fb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{m(),l(e)},children:"Unjoin"})]}):(0,Ei.jsxs)(Ei.Fragment,{children:[(0,Ei.jsx)("button",{type:"button",style:lo,onMouseEnter:e=>{e.currentTarget.style.background="#f5f7fb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{m(),a(e)},children:"Project Members"}),g?null:(0,Ei.jsx)("button",{type:"button",style:lo,onMouseEnter:e=>{e.currentTarget.style.background="#f5f7fb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},onClick:()=>{m(),l(e)},children:"Unjoin"})]})}):null]})]}),(0,Ei.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Ei.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:e.role||"Viewer"}),t?(0,Ei.jsx)("span",{style:{fontSize:12,color:"#2563eb",fontWeight:600},children:"Active"}):null]})]},e.id)};return(0,Ei.jsxs)("div",{"data-testid":"project-list",style:{width:"100%",display:"flex",flexDirection:"column",gap:16},children:[g?(0,Ei.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(1, minmax(0, 1fr))"},children:v(g,!0)}):null,(0,Ei.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gap:16,width:"100%"},children:_.map(e=>v(e,!1))})]})},uo=e=>{let{open:n,onClose:r,onSubmit:i}=e;const[o,a]=(0,t.useState)(""),[s,l]=(0,t.useState)("");if((0,t.useEffect)(()=>{n&&(a(""),l(""))},[n]),!n)return null;return(0,Ei.jsx)("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.35)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,Ei.jsxs)("div",{style:{background:"#fff",padding:24,borderRadius:8,width:400,maxWidth:"90%"},children:[(0,Ei.jsx)("h3",{children:"Create Project"}),(0,Ei.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o.trim()?i({name:o.trim(),address:s.trim()||null}):alert("Project name is required")},style:{display:"flex",flexDirection:"column",gap:12},children:[(0,Ei.jsxs)("label",{children:["Name (required)",(0,Ei.jsx)("input",{type:"text",value:o,onChange:e=>a(e.target.value),required:!0,style:{width:"100%"}})]}),(0,Ei.jsxs)("label",{children:["Address (optional)",(0,Ei.jsx)("input",{type:"text",value:s,onChange:e=>l(e.target.value),style:{width:"100%"},placeholder:"Street, city, etc."})]}),(0,Ei.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,Ei.jsx)("button",{type:"button",onClick:r,className:"btn-format-1",children:"Cancel"}),(0,Ei.jsx)("button",{type:"submit",className:"btn-format-1",children:"Create"})]})]})]})})},ho=e=>{let{open:n,onClose:r,onSubmit:i,initial:o}=e;const[a,s]=(0,t.useState)((null===o||void 0===o?void 0:o.name)||""),[l,c]=(0,t.useState)((null===o||void 0===o?void 0:o.address)||"");if((0,t.useEffect)(()=>{n&&(s((null===o||void 0===o?void 0:o.name)||""),c((null===o||void 0===o?void 0:o.address)||""))},[n,o]),!n)return null;return(0,Ei.jsx)("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.35)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,Ei.jsxs)("div",{style:{background:"#fff",padding:24,borderRadius:8,width:400,maxWidth:"90%"},children:[(0,Ei.jsx)("h3",{children:"Edit Project"}),(0,Ei.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a.trim()?i({name:a.trim(),address:l.trim()||null}):alert("Project name is required")},style:{display:"flex",flexDirection:"column",gap:12},children:[(0,Ei.jsxs)("label",{children:["Name (required)",(0,Ei.jsx)("input",{type:"text",value:a,onChange:e=>s(e.target.value),required:!0,style:{width:"100%"}})]}),(0,Ei.jsxs)("label",{children:["Address (optional)",(0,Ei.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),style:{width:"100%"},placeholder:"Street, city, etc."})]}),(0,Ei.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,Ei.jsx)("button",{type:"button",onClick:r,className:"btn-format-1",children:"Cancel"}),(0,Ei.jsx)("button",{type:"submit",className:"btn-format-1",children:"Save"})]})]})]})})},po=()=>{const{projects:e,activeProject:n,setActiveProject:r,refreshProjects:i,isLoading:o,user:a}=Li(),[s,l]=(0,t.useState)(""),[c,u]=(0,t.useState)(!1),[h,d]=(0,t.useState)(null),p=re(),f=(null===n||void 0===n?void 0:n.id)||n||null;(0,t.useEffect)(()=>{i({redirectWhenEmpty:!1})},[i]);const m=(0,t.useCallback)(e=>{r(e),p("/map")},[p,r]),g=(0,t.useCallback)(e=>{d(e)},[]),_=(0,t.useCallback)(async e=>{if(null!==h&&void 0!==h&&h.id){l("");try{await Ti.patch("/v1/projects/".concat(h.id),e),d(null),await i({redirectWhenEmpty:!1,force:!0})}catch(n){var t;l((null===n||void 0===n||null===(t=n.payload)||void 0===t?void 0:t.error)||(null===n||void 0===n?void 0:n.message)||"Unable to update project. Please try again.")}}},[h,i]),y=(0,t.useCallback)(e=>{null!==e&&void 0!==e&&e.id&&p("/projects/".concat(e.id,"/members"))},[p]),v=(0,t.useCallback)(async e=>{if(null!==e&&void 0!==e&&e.id){l("");try{await Ti.delete("/v1/projects/".concat(e.id)),f===e.id&&r(null),await i({redirectWhenEmpty:!1,force:!0})}catch(n){var t;l((null===n||void 0===n||null===(t=n.payload)||void 0===t?void 0:t.error)||(null===n||void 0===n?void 0:n.message)||"Unable to archive project. Please try again.")}}},[f,i,r]),b=(0,t.useCallback)(async e=>{if(null!==e&&void 0!==e&&e.id){l("");try{await Ti.post("/v1/projects/".concat(e.id,"/unjoin")),f===e.id&&r(null),await i({redirectWhenEmpty:!1,force:!0})}catch(n){var t;l((null===n||void 0===n||null===(t=n.payload)||void 0===t?void 0:t.error)||(null===n||void 0===n?void 0:n.message)||"Unable to unjoin project. Please try again.")}}},[f,i,r]),x=(0,t.useCallback)(async e=>{let{name:t,address:n}=e;l("");try{const e=await Ti.post("/v1/projects",{name:t,address:n});await i({redirectWhenEmpty:!1,force:!0}),r(e),u(!1)}catch(a){var o;l((null===a||void 0===a||null===(o=a.payload)||void 0===o?void 0:o.error)||(null===a||void 0===a?void 0:a.message)||"Unable to create project. Please try again.")}},[p,i,r]),w=(0,t.useMemo)(()=>(e||[]).length>0,[e]),S=(0,t.useCallback)(()=>{p("/projects/archived")},[p]);return(0,Ei.jsx)("div",{className:"projects-page",style:{width:"100%",padding:"12px 24px",boxSizing:"border-box",display:"flex",justifyContent:"center"},children:(0,Ei.jsxs)("div",{style:{width:"min(1200px, 100%)"},children:[(0,Ei.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,Ei.jsx)("h2",{style:{margin:0},children:"Projects"}),(0,Ei.jsx)("button",{type:"button",onClick:()=>u(!0),title:"Create Project",style:{borderRadius:"50%",width:36,height:36,border:"1px solid #e0e0e0",background:"#f7f9fc",fontSize:20,fontWeight:600,lineHeight:"32px",cursor:"pointer"},children:"+"})]}),s&&(0,Ei.jsx)("div",{style:{marginBottom:12,color:"red"},children:s}),o&&!a?(0,Ei.jsx)("div",{children:"Loading..."}):(0,Ei.jsx)(co,{projects:e,activeProjectId:f,onActivate:m,onEdit:g,onMembers:y,onDelete:v,onUnjoin:b,currentUserId:(null===a||void 0===a?void 0:a.id)||null}),!w&&(0,Ei.jsx)("p",{style:{marginTop:12},children:"You have no projects yet. Create one to start uploading and viewing photos."}),(0,Ei.jsx)("div",{style:{marginTop:16,display:"flex",justifyContent:"center"},children:(0,Ei.jsx)("button",{type:"button",onClick:S,className:"btn-format-1",children:"Archived Projects"})}),(0,Ei.jsx)(uo,{open:c,onClose:()=>u(!1),onSubmit:x}),(0,Ei.jsx)(ho,{open:!!h,onClose:()=>d(null),onSubmit:_,initial:h||{}})]})})},fo=()=>{const{activeProject:e,setActiveProject:n,user:r,refreshProjects:i}=Li(),[o,a]=(0,t.useState)([]),[s,l]=(0,t.useState)(""),[c,u]=(0,t.useState)(!1),h=re(),d=(null===e||void 0===e?void 0:e.id)||e||null,p=(0,t.useCallback)(async()=>{u(!0),l("");try{const e=await Ti.get("/v1/projects?archived=true");a((null===e||void 0===e?void 0:e.projects)||[])}catch(t){var e;l((null===t||void 0===t||null===(e=t.payload)||void 0===e?void 0:e.error)||(null===t||void 0===t?void 0:t.message)||"Unable to load archived projects. Please try again.")}finally{u(!1)}},[]);(0,t.useEffect)(()=>{p()},[p]);const f=(0,t.useCallback)(e=>{n(e),h("/map")},[h,n]),m=(0,t.useCallback)(e=>{null!==e&&void 0!==e&&e.id&&h("/projects/".concat(e.id,"/members"))},[h]),g=(0,t.useCallback)(async e=>{if(null!==e&&void 0!==e&&e.id){l("");try{await Ti.post("/v1/projects/".concat(e.id,"/unjoin")),d===e.id&&n(null),await p()}catch(r){var t;l((null===r||void 0===r||null===(t=r.payload)||void 0===t?void 0:t.error)||(null===r||void 0===r?void 0:r.message)||"Unable to unjoin project. Please try again.")}}},[d,p,n]),_=(0,t.useCallback)(async e=>{if(null!==e&&void 0!==e&&e.id){l("");try{await Ti.patch("/v1/projects/".concat(e.id),{show_on_projects:!0}),d===e.id&&n(null),await p(),await i({redirectWhenEmpty:!1,force:!0})}catch(r){var t;l((null===r||void 0===r||null===(t=r.payload)||void 0===t?void 0:t.error)||(null===r||void 0===r?void 0:r.message)||"Unable to unarchive project. Please try again.")}}},[d,p,i,n]),y=(0,t.useMemo)(()=>o.length>0,[o]);return(0,Ei.jsx)("div",{className:"projects-page",style:{width:"100%",padding:"12px 24px",boxSizing:"border-box",display:"flex",justifyContent:"center"},children:(0,Ei.jsxs)("div",{style:{width:"min(1200px, 100%)"},children:[(0,Ei.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,Ei.jsx)("h2",{style:{margin:0},children:"Archived Projects"}),(0,Ei.jsx)("button",{type:"button",onClick:()=>h("/projects"),className:"btn-format-1",children:"Back to Projects"})]}),s?(0,Ei.jsx)("div",{style:{marginBottom:12,color:"red"},children:s}):null,c?(0,Ei.jsx)("div",{children:"Loading..."}):(0,Ei.jsx)(co,{projects:o,activeProjectId:d,onActivate:f,onEdit:()=>{},onMembers:m,onDelete:()=>{},onUnjoin:g,onUnarchive:_,currentUserId:(null===r||void 0===r?void 0:r.id)||null,isArchivedView:!0}),y||c?null:(0,Ei.jsx)("p",{style:{marginTop:12},children:"No archived projects yet."})]})})},mo=()=>{const{id:e}=ie(),n=re(),{projects:r,activeProject:i,setActiveProject:o,roleForActiveProject:a,user:s}=Li(),[l,c]=(0,t.useState)([]),[u,h]=(0,t.useState)(""),[d,p]=(0,t.useState)(!1),[f,m]=(0,t.useState)(!1),[g,_]=(0,t.useState)({email:"",role:"Viewer"}),[y,v]=(0,t.useState)(null),[b,x]=(0,t.useState)(null),[w,S]=(0,t.useState)({top:0,left:0}),[T,E]=(0,t.useState)(null),[k,P]=(0,t.useState)(!1),[C,I]=(0,t.useState)({role:"Viewer"}),[A,M]=(0,t.useState)(null),[R,D]=(0,t.useState)(!1),z=r.find(t=>t.id===e)||null,L=(null===i||void 0===i?void 0:i.id)||i||null,j=e||L,O=(0,t.useMemo)(()=>j?a(j):null,[j,a]),F=(0,t.useMemo)(()=>{const e=(O||"").toLowerCase();return"owner"===e||"administrator"===e},[O]),B=[{label:"Owner",value:"Owner"},{label:"Administrator",value:"Administrator"},{label:"Editor",value:"Editor"},{label:"Viewer",value:"Viewer"}];(0,t.useEffect)(()=>{j&&j!==L&&o(j)},[L,j,o]);const N=(0,t.useCallback)(async()=>{if(j)try{h("");const e=await Ti.get("/v1/projects/".concat(j,"/members"));c((null===e||void 0===e?void 0:e.members)||[])}catch(t){var e;h((null===t||void 0===t||null===(e=t.payload)||void 0===e?void 0:e.error)||(null===t||void 0===t?void 0:t.message)||"Unable to load project members")}},[j]);(0,t.useEffect)(()=>{N()},[N]),(0,t.useEffect)(()=>{const e=e=>{e.target.closest(".member-row-menu")||(v(null),x(null))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);return(0,Ei.jsxs)("div",{style:{padding:"16px 24px",maxWidth:1100,margin:"0 auto",width:"100%",boxSizing:"border-box"},children:[(0,Ei.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:12},children:[(0,Ei.jsx)("div",{style:{flex:1,display:"flex",justifyContent:"flex-start"},children:(0,Ei.jsx)("button",{type:"button",onClick:()=>n(-1),className:"btn-format-1",children:"\u2190 Back"})}),(0,Ei.jsx)("div",{style:{flex:1,display:"flex",justifyContent:"center"},children:(0,Ei.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,color:"#374151"},children:[(0,Ei.jsx)("span",{children:"Project:"}),(0,Ei.jsxs)("select",{value:j||"",onChange:e=>{const t=e.target.value;t&&(o(t),n("/projects/".concat(t,"/members")))},style:{minWidth:200,border:"1px solid #e5e7eb",borderRadius:6,padding:"6px 10px",background:"#fff",fontSize:14},children:[(0,Ei.jsx)("option",{value:"",children:"Select a project"}),r.map(e=>(0,Ei.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}),(0,Ei.jsx)("div",{style:{flex:1,display:"flex",justifyContent:"flex-end",gap:10},children:F?(0,Ei.jsx)("button",{type:"button",title:"Add Member","aria-label":"Add Member",onClick:()=>p(!0),style:{borderRadius:"50%",width:36,height:36,border:"1px solid #e0e0e0",background:"#f7f9fc",fontSize:20,fontWeight:600,lineHeight:"32px",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"+"}):null})]}),(0,Ei.jsx)("h2",{style:{marginTop:0},children:"Project Members"}),u?(0,Ei.jsx)("div",{style:{color:"red",marginBottom:12},children:u}):null,(0,Ei.jsx)("div",{style:{overflowX:"auto",overflowY:"visible",position:"relative"},children:(0,Ei.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:640,tableLayout:"fixed",overflow:"visible"},children:[(0,Ei.jsxs)("colgroup",{children:[(0,Ei.jsx)("col",{style:{width:"25%"}}),(0,Ei.jsx)("col",{style:{width:"20%"}}),(0,Ei.jsx)("col",{style:{width:"30%"}}),(0,Ei.jsx)("col",{style:{width:"17%"}}),(0,Ei.jsx)("col",{style:{width:"8%"}})]}),(0,Ei.jsx)("thead",{children:(0,Ei.jsxs)("tr",{style:{textAlign:"left"},children:[(0,Ei.jsx)("th",{style:{padding:"10px 8px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:"Name"}),(0,Ei.jsx)("th",{style:{padding:"10px 8px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:"Company"}),(0,Ei.jsx)("th",{style:{padding:"10px 8px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:"Email"}),(0,Ei.jsx)("th",{style:{padding:"10px 8px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:"Role"}),(0,Ei.jsx)("th",{style:{padding:"10px 8px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:"\xa0"})]})}),(0,Ei.jsxs)("tbody",{children:[l.map(e=>{const t=[e.first_name,e.last_name].filter(Boolean).join(" ").trim(),n=F&&e.user_id!==(null===s||void 0===s?void 0:s.id)&&e.user_id!==(null===z||void 0===z?void 0:z.owner_id);return(0,Ei.jsxs)("tr",{style:{borderBottom:"1px solid #f1f3f5"},children:[(0,Ei.jsx)("td",{style:{padding:"8px 6px",textAlign:"left",position:"relative",overflow:"visible"},children:t||""}),(0,Ei.jsx)("td",{style:{padding:"8px 6px",textAlign:"left"},children:e.company||""}),(0,Ei.jsx)("td",{style:{padding:"8px 6px",textAlign:"left"},children:e.email||""}),(0,Ei.jsx)("td",{style:{padding:"8px 6px",textTransform:"capitalize",textAlign:"left"},children:e.role||"Viewer"}),(0,Ei.jsx)("td",{style:{padding:"8px 6px",textAlign:"left"},children:n?(0,Ei.jsx)("div",{className:"member-row-menu",style:{position:"relative",display:"inline-block"},children:(0,Ei.jsx)("button",{type:"button","aria-label":"Member actions",onClick:t=>{t.stopPropagation();const n=t.currentTarget.getBoundingClientRect(),r=Math.min(n.left,window.innerWidth-160-8);S({top:n.bottom+6,left:Math.max(8,r)}),x(e),v(t=>{const n=t===e.user_id?null:e.user_id;return n||x(null),n})},style:{border:"1px solid #e5e7eb",borderRadius:"50%",width:28,height:28,background:"#fff",cursor:"pointer",lineHeight:"24px"},children:"\u22ee"})}):null})]},e.user_id)}),l.length?null:(0,Ei.jsx)("tr",{children:(0,Ei.jsx)("td",{colSpan:5,style:{padding:"12px 8px",color:"#6b7280"},children:"No members"})})]})]})}),d?(0,Ei.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:16},onClick:()=>{f||p(!1)},children:(0,Ei.jsxs)("div",{style:{background:"#fff",borderRadius:10,padding:20,width:"min(420px, 100%)",boxShadow:"0 10px 30px rgba(0,0,0,0.18)",boxSizing:"border-box"},onClick:e=>e.stopPropagation(),children:[(0,Ei.jsx)("h3",{style:{marginTop:0,marginBottom:12},children:"Add Member"}),(0,Ei.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,Ei.jsxs)("label",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,Ei.jsx)("span",{style:{fontWeight:600,fontSize:14},children:"Email"}),(0,Ei.jsx)("input",{type:"email",value:g.email,onChange:e=>_(t=>Ne(Ne({},t),{},{email:e.target.value})),placeholder:"person@example.com",required:!0,style:{padding:"10px 12px",borderRadius:8,border:"1px solid #e5e7eb",fontSize:14}})]}),(0,Ei.jsxs)("label",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,Ei.jsx)("span",{style:{fontWeight:600,fontSize:14},children:"Role"}),(0,Ei.jsx)("select",{value:g.role,onChange:e=>_(t=>Ne(Ne({},t),{},{role:e.target.value})),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #e5e7eb",fontSize:14},children:B.map(e=>(0,Ei.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,Ei.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:10,marginTop:16},children:[(0,Ei.jsx)("button",{type:"button",onClick:()=>p(!1),disabled:f,className:"btn-format-1",children:"Cancel"}),(0,Ei.jsx)("button",{type:"button",onClick:async()=>{if(!j)return;const e=(g.email||"").trim();if(e){m(!0),h("");try{await Ti.post("/v1/projects/".concat(j,"/members/invite"),{email:e,role:g.role}),p(!1),_({email:"",role:"Viewer"}),await N()}catch(n){var t;h((null===n||void 0===n||null===(t=n.payload)||void 0===t?void 0:t.error)||(null===n||void 0===n?void 0:n.message)||"Unable to add member. Please try again.")}finally{m(!1)}}else h("Email is required.")},disabled:f,style:{background:"#2563eb",color:"#fff",border:"1px solid #1d4ed8",borderRadius:8,padding:"10px 14px",fontWeight:700,cursor:"pointer"},children:f?"Adding...":"Add Member"})]})]})}):null,k?(0,Ei.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:16},onClick:()=>{f||(P(!1),E(null))},children:(0,Ei.jsxs)("div",{style:{background:"#fff",borderRadius:10,padding:20,width:"min(420px, 100%)",boxShadow:"0 10px 30px rgba(0,0,0,0.18)",boxSizing:"border-box"},onClick:e=>e.stopPropagation(),children:[(0,Ei.jsx)("h3",{style:{marginTop:0,marginBottom:12},children:"Edit Member"}),(0,Ei.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,Ei.jsxs)("label",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,Ei.jsx)("span",{style:{fontWeight:600,fontSize:14},children:"Email"}),(0,Ei.jsx)("input",{type:"email",value:(null===T||void 0===T?void 0:T.email)||"",disabled:!0,style:{padding:"10px 12px",borderRadius:8,border:"1px solid #e5e7eb",fontSize:14,background:"#f3f4f6",color:"#6b7280"}})]}),(0,Ei.jsxs)("label",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,Ei.jsx)("span",{style:{fontWeight:600,fontSize:14},children:"Role"}),(0,Ei.jsx)("select",{value:C.role,onChange:e=>I(t=>Ne(Ne({},t),{},{role:e.target.value})),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #e5e7eb",fontSize:14},children:B.map(e=>(0,Ei.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,Ei.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:10,marginTop:16},children:[(0,Ei.jsx)("button",{type:"button",onClick:()=>P(!1),disabled:f,className:"btn-format-1",children:"Cancel"}),(0,Ei.jsx)("button",{type:"button",onClick:async()=>{if(j&&null!==T&&void 0!==T&&T.user_id){m(!0),h("");try{await Ti.patch("/v1/projects/".concat(j,"/members/").concat(T.user_id),{role:C.role}),P(!1),E(null),await N()}catch(t){var e;h((null===t||void 0===t||null===(e=t.payload)||void 0===e?void 0:e.error)||(null===t||void 0===t?void 0:t.message)||"Unable to update member. Please try again.")}finally{m(!1)}}},disabled:f,style:{background:"#2563eb",color:"#fff",border:"1px solid #1d4ed8",borderRadius:8,padding:"10px 14px",fontWeight:700,cursor:"pointer"},children:f?"Saving...":"Save"})]})]})}):null,R?(0,Ei.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:16},onClick:()=>{f||(D(!1),M(null))},children:(0,Ei.jsxs)("div",{style:{background:"#fff",borderRadius:10,padding:20,width:"min(420px, 100%)",boxShadow:"0 10px 30px rgba(0,0,0,0.18)",boxSizing:"border-box"},onClick:e=>e.stopPropagation(),children:[(0,Ei.jsx)("h3",{style:{marginTop:0,marginBottom:8},children:"Remove Member"}),(0,Ei.jsxs)("p",{style:{marginTop:0,color:"#4b5563"},children:["Remove ",(null===A||void 0===A?void 0:A.email)||"this member"," from the project?"]}),(0,Ei.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:10,marginTop:16},children:[(0,Ei.jsx)("button",{type:"button",onClick:()=>D(!1),disabled:f,className:"btn-format-1",children:"Cancel"}),(0,Ei.jsx)("button",{type:"button",onClick:async()=>{if(j&&null!==A&&void 0!==A&&A.user_id){m(!0),h("");try{await Ti.delete("/v1/projects/".concat(j,"/members/").concat(A.user_id)),D(!1),M(null),await N()}catch(t){var e;h((null===t||void 0===t||null===(e=t.payload)||void 0===e?void 0:e.error)||(null===t||void 0===t?void 0:t.message)||"Unable to remove member. Please try again.")}finally{m(!1)}}},disabled:f,style:{background:"#dc2626",color:"#fff",border:"1px solid #b91c1c",borderRadius:8,padding:"10px 14px",fontWeight:700,cursor:"pointer"},children:f?"Removing...":"Remove"})]})]})}):null,y&&b?(0,Ei.jsxs)("div",{style:{position:"fixed",top:w.top,left:w.left,background:"#fff",border:"1px solid #e5e7eb",borderRadius:8,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",zIndex:2e3,minWidth:160,padding:"6px 0"},onClick:e=>e.stopPropagation(),children:[(0,Ei.jsx)("button",{type:"button",style:{width:"100%",textAlign:"left",padding:"8px 12px",background:"transparent",border:"none",cursor:"pointer",fontSize:14},onClick:()=>{var e;(e=b)&&(E(e),I({role:e.role||"Viewer"}),P(!0),v(null),x(null))},children:"Edit"}),(0,Ei.jsx)("button",{type:"button",style:{width:"100%",textAlign:"left",padding:"8px 12px",background:"transparent",border:"none",cursor:"pointer",fontSize:14,color:"#dc2626"},onClick:()=>{M(b),D(!0),v(null),x(null)},children:"Delete"})]}):null]})},go=wi(),_o=e=>{const t=Number(e);if(!Number.isFinite(t)||t<=0)return"";const n=t/1024;if(n<1024)return"".concat(Math.round(n)," KB");return"".concat((n/1024).toFixed(1)," MB")},yo=()=>{qi();const{id:e}=ie(),n=re(),r=te(),i=(0,t.useMemo)(()=>{var e;return"map"===(null===(e=r.state)||void 0===e?void 0:e.from)?"/map":"/photos"},[r.state]),{activeProject:o,projects:a}=Li(),[s,l]=(0,t.useState)(null),[c,u]=(0,t.useState)(""),[h,d]=(0,t.useState)(!1),[p,f]=(0,t.useState)(!1),m=(0,t.useRef)(null),g=(0,t.useRef)(null),_=(0,t.useRef)(null);null===o||void 0===o||o.id;(0,t.useEffect)(()=>{e&&(async()=>{u("");const t=localStorage.getItem("access_token")||"",n=go;for(const r of n)try{const n=await fetch("".concat(r,"/api/v1/photos/").concat(e),{headers:Ne({},t?{Authorization:"Bearer ".concat(t)}:{})}),i=await n.json();if(!n.ok)continue;const o=i.photo||i.data||i;if(o)return void l(o)}catch(Ao){}u("Unable to load photo.")})()},[e]);const y=(0,t.useMemo)(()=>{var e,t;if(!s)return null;const{primaryUrl:n,fallbackUrl:r,resolvedUrl:i}=(e=>{const t={NODE_ENV:"production",PUBLIC_URL:"/swallow-skyer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://swallow-skyer-v1.onrender.com",REACT_APP_SUPABASE_URL:"https://ykydjggblbdehtrwxzqj.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlreWRqZ2dibGJkZWh0cnd4enFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NjY0OTEsImV4cCI6MjA3MzA0MjQ5MX0.azZf_c-HrUhZ-7QhljyZg1uFbqlnHC-4ZKkz9ifjHw0"}.REACT_APP_R2_PUBLIC_BASE_URL||{NODE_ENV:"production",PUBLIC_URL:"/swallow-skyer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://swallow-skyer-v1.onrender.com",REACT_APP_SUPABASE_URL:"https://ykydjggblbdehtrwxzqj.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlreWRqZ2dibGJkZWh0cnd4enFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NjY0OTEsImV4cCI6MjA3MzA0MjQ5MX0.azZf_c-HrUhZ-7QhljyZg1uFbqlnHC-4ZKkz9ifjHw0"}.REACT_APP_R2_PUBLIC_URL||"",n=(e.r2_path||e.r2_key||"").trim(),r=(e.r2_url||"").trim(),i=(e.url||r||"").trim(),o=t&&n?"".concat(t.replace(/\/$/,""),"/").concat(n):"",a=i||o,s=(e.thumbnail_r2_path||"").trim();return{primaryUrl:i,fallbackUrl:o,resolvedUrl:a,resolvedThumb:(e.thumbnail_r2_url||e.thumbnail_url||"").trim()||(s&&t?"".concat(t.replace(/\/$/,""),"/").concat(s):"")}})(s),o=s.uploaded_at||s.uploadedAt||s.created_at||s.createdAt||s.captured_at||s.capturedAt,l=s.project_id||null,c=s.project_name||(null===a||void 0===a||null===(e=a.find(e=>e.id===l))||void 0===e?void 0:e.name)||"",u=(null===s||void 0===s||null===(t=s.uploaded_by)||void 0===t?void 0:t.display)||"";return Ne(Ne({},s),{},{primaryUrl:n,fallbackUrl:r,url:i||r,createdAt:(h=o,Gi(h)),projectName:c,uploadedBy:u,fileSizeLabel:_o(s.file_size)});var h},[s,a]);(0,t.useEffect)(()=>{var e,t;if(!m.current)return;if(!y)return;const n=Number(null!==(e=y.latitude)&&void 0!==e?e:y.mapLatitude),r=Number(null!==(t=y.longitude)&&void 0!==t?t:y.mapLongitude);if(Number.isFinite(n)&&Number.isFinite(r)){if(g.current)g.current.setCenter([r,n]);else try{g.current=new(Ui().Map)({container:m.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:[r,n],zoom:13,interactive:!1})}catch(c){return void console.error("Error initializing map:",c)}_.current&&(_.current.remove(),_.current=null),_.current=new(Ui().Marker)({color:"#1e88e5"}).setLngLat([r,n]).addTo(g.current)}},[null===y||void 0===y?void 0:y.latitude,null===y||void 0===y?void 0:y.longitude,null===y||void 0===y?void 0:y.mapLatitude,null===y||void 0===y?void 0:y.mapLongitude]),(0,t.useEffect)(()=>()=>{_.current&&(_.current.remove(),_.current=null),g.current&&(g.current.remove(),g.current=null)},[]);return y?(0,Ei.jsxs)("div",{style:{width:"100%",padding:"12px 24px 24px",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:12,flex:1,minHeight:0,overflowY:"auto",paddingBottom:80},children:[(0,Ei.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center",width:"100%",columnGap:12},children:[(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",onClick:()=>n(i),children:"Back"}),(0,Ei.jsx)("div",{style:{display:"flex",justifyContent:"center",width:"100%"},children:(0,Ei.jsx)("div",{style:{width:"min(1200px, 100%)",display:"flex",alignItems:"center"},children:(0,Ei.jsx)("h2",{style:{margin:0,padding:0},children:"Photo Options"})})})]}),(0,Ei.jsxs)("div",{style:{display:"flex",gap:18,alignItems:"flex-start",flexWrap:"wrap",width:"100%"},children:[(0,Ei.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,alignItems:"flex-start",maxWidth:"min(520px, 90vw)",width:"100%"},children:[(0,Ei.jsx)("img",{src:y.url,alt:y.caption||y.file_name||"Photo",style:{width:"100%",height:"auto",borderRadius:12,boxShadow:"0 6px 20px rgba(0,0,0,0.14)",objectFit:"cover",display:"block"},onError:e=>{y.fallbackUrl&&e.target.src!==y.fallbackUrl?e.target.src=y.fallbackUrl:e.target.style.display="none"}}),(0,Ei.jsxs)("div",{style:{display:"flex",gap:8,marginTop:10,width:"100%"},children:[(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",onClick:async()=>{if(null!==y&&void 0!==y&&y.url){f(!0);try{const t=document.createElement("a");t.href=y.url,t.download=y.file_name||y.caption||"photo-".concat(e),t.target="_blank",t.rel="noopener noreferrer",document.body.appendChild(t),t.click(),document.body.removeChild(t)}finally{f(!1)}}},disabled:p,children:p?"Downloading\u2026":"Download"}),(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",style:{color:"#b91c1c",borderColor:"#fca5a5"},onClick:async()=>{if(!e)return;d(!0);const t=localStorage.getItem("access_token")||"",r=go;for(const i of r)try{if((await fetch("".concat(i,"/api/v1/photos/").concat(e),{method:"DELETE",headers:Ne({},t?{Authorization:"Bearer ".concat(t)}:{})})).ok)return void n("/photos")}catch(Ao){}d(!1)},disabled:h,children:h?"Deleting\u2026":"Delete"})]})]}),(0,Ei.jsx)("div",{style:{flex:"1 1 320px",minWidth:300,display:"flex",flexDirection:"column",gap:12},children:(0,Ei.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1.2fr 1fr",gap:12,alignItems:"start"},children:[(0,Ei.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:"10px 12px",background:"#fff",display:"grid",gap:6},children:[(0,Ei.jsx)("div",{style:{fontWeight:600},children:"Information"}),(0,Ei.jsxs)("dl",{style:{margin:0,display:"grid",gridTemplateColumns:"110px 1fr",columnGap:10,rowGap:8,alignItems:"start",paddingTop:6},children:[(0,Ei.jsx)("dt",{style:{margin:0,fontSize:13,color:"#6b7280",fontWeight:600},children:"Date/Time"}),(0,Ei.jsx)("dd",{style:{margin:0,fontSize:13,color:"#374151",textAlign:"left"},children:y.createdAt||"Unknown"}),(0,Ei.jsx)("dt",{style:{margin:0,fontSize:13,color:"#6b7280",fontWeight:600},children:"Project"}),(0,Ei.jsx)("dd",{style:{margin:0,fontSize:13,color:"#374151",textAlign:"left"},children:y.projectName||"Unknown"}),(0,Ei.jsx)("dt",{style:{margin:0,fontSize:13,color:"#6b7280",fontWeight:600},children:"Uploaded By"}),(0,Ei.jsx)("dd",{style:{margin:0,fontSize:13,color:"#374151",textAlign:"left"},children:y.uploadedBy||"Unknown"}),(0,Ei.jsx)("dt",{style:{margin:0,fontSize:13,color:"#6b7280",fontWeight:600},children:"File Size"}),(0,Ei.jsx)("dd",{style:{margin:0,fontSize:13,color:"#374151",textAlign:"left"},children:y.fileSizeLabel||"Unknown"})]})]}),(0,Ei.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,overflow:"hidden",background:"#fff"},children:[(0,Ei.jsxs)("div",{style:{padding:"8px 10px",borderBottom:"1px solid #e5e7eb",fontWeight:600,fontSize:13,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Ei.jsx)("span",{children:"Location"}),(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",style:{padding:"4px 8px",fontSize:12},onClick:()=>n("/map"),children:"Open Map"})]}),(0,Ei.jsx)("div",{ref:m,style:{height:180,width:"100%",cursor:"pointer"},onClick:()=>n("/map")})]})]})})]})]}):(0,Ei.jsxs)("div",{style:{padding:24,boxSizing:"border-box",width:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:12},children:[(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",onClick:()=>n(i),children:"Back"}),c?(0,Ei.jsx)("div",{style:{color:"#dc2626"},children:c}):(0,Ei.jsx)("div",{children:"Loading photo..."})]})};const vo=new class{async getProject(e){return Ti.get("/v1/public/".concat(e,"/project"))}async getPhotos(e){return Ti.get("/v1/public/".concat(e,"/photos"))}async getDownloadURL(e,t){return Ti.get("/v1/public/".concat(e,"/photos/").concat(t,"/download"))}},bo=e=>{let{photos:n,onPhotoSelect:r,onLocationClick:i}=e;const o=t.useRef(null),a=t.useRef(null);return t.useEffect(()=>{o.current&&!a.current&&(a.current=new Ni.Map({container:o.current,style:"https://demotiles.maplibre.org/style.json",center:[0,0],zoom:2}))},[]),(0,Ei.jsx)("div",{className:"map-container",children:(0,Ei.jsx)("div",{ref:o,className:"map"})})},xo=()=>{const{token:e}=ie(),[n]=Le(),[r,i]=t.useState(null),[o,a]=t.useState([]),[s,l]=t.useState(""),[c,u]=t.useState(!0),h="1"===n.get("embed");t.useEffect(()=>{let t=!0;return(async()=>{try{const n=await vo.getProject(e),r=await vo.getPhotos(e);if(!t)return;i(n.project),a(r.photos||[])}catch(n){if(!t)return;410===(null===n||void 0===n?void 0:n.status)?l("This public link has expired."):l("Unable to load public project.")}finally{t&&u(!1)}})(),()=>{t=!1}},[e]);return c?(0,Ei.jsx)("div",{children:"Loading public project\u2026"}):s?(0,Ei.jsx)("div",{"data-testid":"public-error",children:s}):(0,Ei.jsxs)("div",{className:"map-page",style:h?{padding:0,margin:0}:void 0,"data-testid":"public-view",children:[(0,Ei.jsx)("h2",{children:null===r||void 0===r?void 0:r.name}),(null===r||void 0===r?void 0:r.description)&&(0,Ei.jsx)("p",{children:r.description}),(0,Ei.jsx)(bo,{photos:o}),(0,Ei.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:12,marginTop:16},children:o.map(t=>(0,Ei.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:6,padding:8,width:200},children:[(0,Ei.jsx)("img",{src:t.thumbnail_r2_url||t.r2_url,alt:t.caption||"Photo",style:{width:"100%",borderRadius:4}}),(0,Ei.jsx)("div",{children:t.caption}),(0,Ei.jsx)("button",{type:"button","data-testid":"download-photo-".concat(t.id),onClick:()=>(async t=>{try{const{url:n}=await vo.getDownloadURL(e,t);n&&"undefined"!==typeof window&&window.open(n,"_blank","noopener,noreferrer")}catch(n){410===(null===n||void 0===n?void 0:n.status)?l("This public link has expired."):l("Download not available.")}})(t.id),children:"Download"})]},t.id))})]})},wo=()=>{const e=te(),n=re(),r=(0,t.useMemo)(()=>{var t;return(null===(t=e.state)||void 0===t?void 0:t.email)||""},[e.state]),[i,o]=(0,t.useState)(""),[a,s]=(0,t.useState)(!1);return(0,Ei.jsxs)("div",{className:"auth-page",children:[(0,Ei.jsx)("h2",{children:"Confirm your email"}),(0,Ei.jsx)("p",{style:{maxWidth:560},children:"Signup successful. Please check your email to confirm your account before logging in."}),i?(0,Ei.jsx)("p",{style:{marginTop:12,maxWidth:560},children:i}):null,(0,Ei.jsxs)("div",{style:{display:"flex",gap:10,marginTop:16,flexWrap:"wrap"},children:[(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",onClick:async()=>{if(r){s(!0),o("");try{const{error:e}=await bi.auth.resend({type:"signup",email:r});if(e)throw e;o("Confirmation email re-sent. Please check your inbox.")}catch(e){o((null===e||void 0===e?void 0:e.message)||"Unable to resend confirmation email.")}finally{s(!1)}}else o("Enter your email on the Register page, then come back here.")},disabled:a,children:a?"Sending\u2026":"Resend confirmation email"}),(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",onClick:()=>n("/login",{replace:!0}),children:"Sign In"})]})]})},So=()=>{const e=re(),[n,r]=(0,t.useState)(""),[i,o]=(0,t.useState)("Signing you in\u2026");return(0,t.useEffect)(()=>{let t=!0;return(async()=>{r("");try{const{access_token:n,refresh_token:r,error:i,error_code:a,error_description:s}=(()=>{const e=(window.location.hash||"").replace(/^#/,""),t=new URLSearchParams(e),n=t.get("error")||"",r=t.get("error_code")||"",i=t.get("error_description")||"";return{access_token:t.get("access_token")||"",refresh_token:t.get("refresh_token")||"",error:n,error_code:r,error_description:i,params:t}})();if(i){const e="otp_expired"===a?"This email confirmation link is invalid or has expired. Please request a new confirmation email and try again.":decodeURIComponent(s||i);throw new Error(e)}if(n&&r){t&&o("Email confirmed. Finishing sign-in\u2026");const{data:e,error:i}=await bi.auth.setSession({access_token:n,refresh_token:r});if(i)throw i;if(null===e||void 0===e||!e.session)throw new Error("No session returned from auth callback.")}else{const{data:e,error:t}=await bi.auth.exchangeCodeForSession(window.location.href);if(t)throw t;if(null===e||void 0===e||!e.session)throw new Error("No session returned from auth callback.")}t&&e("/email-confirmed",{replace:!0})}catch(n){t&&(r((null===n||void 0===n?void 0:n.message)||"Unable to complete sign-in."),o("Email confirmation"))}})(),()=>{t=!1}},[e]),(0,Ei.jsxs)("div",{className:"auth-page",children:[(0,Ei.jsx)("h2",{children:i}),n?(0,Ei.jsxs)(Ei.Fragment,{children:[(0,Ei.jsx)("div",{className:"auth-error",children:n}),(0,Ei.jsxs)("div",{style:{display:"flex",gap:10,marginTop:16,flexWrap:"wrap"},children:[(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",onClick:()=>e("/check-email",{replace:!0}),children:"Resend confirmation email"}),(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",onClick:()=>e("/login",{replace:!0}),children:"Sign In"})]})]}):null]})},To=()=>{const e=re(),{user:t}=Li();return(0,Ei.jsxs)("div",{className:"auth-page",children:[(0,Ei.jsx)("h2",{children:"Email Confirmed"}),(0,Ei.jsx)("p",{style:{maxWidth:560},children:"Your email has been confirmed. You can continue into the portal."}),(0,Ei.jsx)("div",{style:{display:"flex",gap:10,marginTop:16,flexWrap:"wrap"},children:t?(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",onClick:()=>e("/map",{replace:!0}),children:"Continue"}):(0,Ei.jsx)("button",{type:"button",className:"btn-format-1",onClick:()=>e("/login",{replace:!0}),children:"Sign In"})})]})},Eo=()=>{const{user:e,activeProject:t}=Li(),n=!!(null!==t&&void 0!==t&&t.id||t);return(0,Ei.jsx)("header",{className:"App-header",children:(0,Ei.jsxs)("div",{className:"App-header__inner",children:[(0,Ei.jsxs)("div",{className:"App-header__brand",children:[(0,Ei.jsxs)("h1",{children:[(0,Ei.jsx)("span",{className:"App-header__brandPrimary",children:"Skyer"})," ",(0,Ei.jsx)("span",{className:"App-header__brandByline",children:"by Swallow Robotics"})]}),(0,Ei.jsx)("nav",{className:"App-nav",children:e?(0,Ei.jsxs)(Ei.Fragment,{children:[(0,Ei.jsx)(Re,{to:"/projects",children:"Projects"}),n&&(0,Ei.jsx)(Re,{to:"/photos",children:"Photos"}),(0,Ei.jsx)(Re,{to:"/map",children:"Map"})]}):(0,Ei.jsxs)(Ei.Fragment,{children:[(0,Ei.jsx)(Re,{to:"/login",children:"Login"}),(0,Ei.jsx)(Re,{to:"/register",children:"Register"})]})})]}),e&&(0,Ei.jsx)(Oi,{})]})})},ko=()=>{const{user:e,isLoading:t}=Li();if(t)return(0,Ei.jsx)("div",{children:"Loading..."});if("undefined"!==typeof window){const e=window.location.hash||"";if(e.includes("access_token=")||e.includes("refresh_token=")||e.includes("error="))return(0,Ei.jsx)(So,{})}return(0,Ei.jsx)(ve,{to:e?"/map":"/login",replace:!0})};function Po(){const e=te(),t=!(e.pathname.startsWith("/public")&&"1"===new URLSearchParams(e.search).get("embed"));return(0,Ei.jsxs)("div",{className:"App",children:[t&&(0,Ei.jsx)(Eo,{}),(0,Ei.jsx)("main",{className:"App-main",children:(0,Ei.jsxs)(we,{children:[(0,Ei.jsx)(be,{path:"/login",element:(0,Ei.jsx)(Fi,{})}),(0,Ei.jsx)(be,{path:"/register",element:(0,Ei.jsx)(Bi,{})}),(0,Ei.jsx)(be,{path:"/check-email",element:(0,Ei.jsx)(wo,{})}),(0,Ei.jsx)(be,{path:"/auth/callback",element:(0,Ei.jsx)(So,{})}),(0,Ei.jsx)(be,{path:"/email-confirmed",element:(0,Ei.jsx)(To,{})}),(0,Ei.jsx)(be,{path:"/map",element:(0,Ei.jsx)(ji,{children:(0,Ei.jsx)(to,{})})}),(0,Ei.jsx)(be,{path:"/photos",element:(0,Ei.jsx)(ji,{children:(0,Ei.jsx)(ao,{})})}),(0,Ei.jsx)(be,{path:"/photos/:id/options",element:(0,Ei.jsx)(ji,{children:(0,Ei.jsx)(yo,{})})}),(0,Ei.jsx)(be,{path:"/upload",element:(0,Ei.jsx)(ve,{to:"/photos",replace:!0})}),(0,Ei.jsx)(be,{path:"/projects",element:(0,Ei.jsx)(ji,{children:(0,Ei.jsx)(po,{})})}),(0,Ei.jsx)(be,{path:"/projects/archived",element:(0,Ei.jsx)(ji,{children:(0,Ei.jsx)(fo,{})})}),(0,Ei.jsx)(be,{path:"/projects/:id/members",element:(0,Ei.jsx)(ji,{children:(0,Ei.jsx)(mo,{})})}),(0,Ei.jsx)(be,{path:"/profile",element:(0,Ei.jsx)(ji,{children:(0,Ei.jsx)(so,{})})}),(0,Ei.jsx)(be,{path:"/public/:token",element:(0,Ei.jsx)(xo,{})}),(0,Ei.jsx)(be,{path:"/",element:(0,Ei.jsx)(ko,{})}),(0,Ei.jsx)(be,{path:"*",element:(0,Ei.jsx)(ve,{to:"/",replace:!0})})]})})]})}const Co=function(){return(0,Ei.jsx)(zi,{children:(0,Ei.jsx)(Ie,{basename:"/swallow-skyer",children:(0,Ei.jsx)(Po,{})})})},Io=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,453)).then(t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:o,getTTFB:a}=t;n(e),r(e),i(e),o(e),a(e)})};qi();i.createRoot(document.getElementById("root")).render((0,Ei.jsx)(t.StrictMode,{children:(0,Ei.jsx)(Co,{})})),Io()})()})();
//# sourceMappingURL=main.ca050b52.js.map